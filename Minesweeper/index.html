<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dungeon Sweeper: Artifacts</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel (for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @keyframes bounce {
            0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8,0,1,1); }
            50% { transform: none; animation-timing-function: cubic-bezier(0,0,0.2,1); }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .item-pop {
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes pop {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .float-text {
            animation: floatUp 1.2s ease-out forwards;
            position: absolute;
            pointer-events: none;
            z-index: 50;
            font-weight: bold;
            text-shadow: 2px 2px 0 #000;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-40px) scale(1.1); opacity: 0; }
        }
        /* Ìà¥ÌåÅ Ïä§ÌÉÄÏùº */
        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen flex items-center justify-center font-sans select-none overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // --- ÏïÑÏù¥ÏΩò Ïª¥Ìè¨ÎÑåÌä∏ ---
        const Icon = ({ path, className, fill = "none" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Heart: (props) => <Icon {...props} path={<path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>} />,
            Skull: (props) => <Icon {...props} path={<><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></>} />,
            Key: (props) => <Icon {...props} path={<><circle cx="7.5" cy="15.5" r="5.5"/><path d="m21 2-9.6 9.6"/><path d="m15.5 7.5 3 3L22 7l-3-3"/></>} />,
            Door: (props) => <Icon {...props} path={<><path d="M13 4h3a2 2 0 0 1 2 2v14"/><path d="M2 20h3"/><path d="M13 20h9"/><path d="M10 12v.01"/><path d="M13 4.562v16.157a1 1 0 0 1-1.242.97L5 20V5.562a2 2 0 0 1 1.515-1.94l4-1A2 2 0 0 1 13 4.561Z"/></>} />,
            Coin: (props) => <Icon {...props} path={<><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m7.1 13.8 3.1-9.1"/><path d="M10.8 17.7l-3.1-9.1"/></>} />,
            Shield: (props) => <Icon {...props} path={<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>} />,
            Telescope: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/><path d="M2 12h20"/></>} />,
            Chest: (props) => <Icon {...props} path={<><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></>} />,
            Refresh: (props) => <Icon {...props} path={<><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></>} />,
            Crown: (props) => <Icon {...props} path={<path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/>} />,
        };

        // --- Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞ ---
        const CONSTANTS = {
            GRID_SIZE: 10,
            TRAP_COUNT_BASE: 14,
            GOLD_COUNT: 6,
            PRICES: { POTION: 40, SHIELD: 50, TELESCOPE: 20, ARTIFACT: 150 },
            CLASSES: {
                knight: { name: "Í∏∞ÏÇ¨", hp: 6, gold: 0, desc: "ÌäºÌäºÌïú Ï≤¥Î†• (HP 6)" },
                rogue: { name: "ÎèÑÏ†Å", hp: 3, gold: 40, desc: "Î∂ÄÏú†Ìïú ÏãúÏûë (40G)" },
                wizard: { name: "ÎßàÎ≤ïÏÇ¨", hp: 3, gold: 0, desc: "Ï†ïÏ∞∞ ÎπÑÏö© Ìï†Ïù∏ (5G)" },
            },
            ARTIFACTS: {
                lucky_coin: { name: "ÌñâÏö¥Ïùò ÎèôÏ†Ñ", desc: "Í≥®Îìú ÌöçÎìùÎüâ +50%", icon: "ü™ô" },
                lens: { name: "ÌÉêÌóòÍ∞ÄÏùò Î†åÏ¶à", desc: "Ï†ïÏ∞∞ ÎπÑÏö© 50% Ìï†Ïù∏", icon: "üî≠" },
                chalice: { name: "ÏÉùÎ™ÖÏùò ÏÑ±Î∞∞", desc: "Ï∏µ Ïù¥Îèô Ïãú Ï≤¥Î†• +1", icon: "üç∑" },
                map: { name: "Í≥†ÎåÄÏùò ÏßÄÎèÑ", desc: "Ï∏µ ÏãúÏûë Ïãú Ìï®Ï†ï 1Í∞ú Ï†úÍ±∞", icon: "üìú" },
            }
        };

        const DungeonSweeper = () => {
            // --- State ---
            const [phase, setPhase] = useState('start'); // start, playing, gameover
            const [cls, setCls] = useState('knight');
            const [floor, setFloor] = useState(1);
            const [highScore, setHighScore] = useState(0);
            
            const [grid, setGrid] = useState([]);
            const [player, setPlayer] = useState({ x: 0, y: 0 });
            
            // Stats
            const [hp, setHp] = useState(3);
            const [gold, setGold] = useState(0);
            const [shield, setShield] = useState(0);
            const [hasKey, setHasKey] = useState(false);
            const [artifacts, setArtifacts] = useState([]); // List of artifact IDs
            
            // UI State
            const [msg, setMsg] = useState("");
            const [mode, setMode] = useState('move'); // move, telescope
            const [floats, setFloats] = useState([]); // Floating texts
            const [shopArtifact, setShopArtifact] = useState(null); // Current floor's shop artifact

            // --- Effects ---
            useEffect(() => {
                const savedScore = localStorage.getItem('ds_highscore');
                if (savedScore) setHighScore(parseInt(savedScore));
            }, []);

            useEffect(() => {
                if (floor > highScore) {
                    setHighScore(floor);
                    localStorage.setItem('ds_highscore', floor);
                }
            }, [floor, highScore]);

            // --- Helpers ---
            const addFloat = (text, color) => {
                const id = Date.now() + Math.random();
                setFloats(prev => [...prev, { id, text, color }]);
                setTimeout(() => setFloats(prev => prev.filter(f => f.id !== id)), 1200);
            };

            const getArtifactEffect = (id) => artifacts.includes(id);

            // --- Game Logic ---
            const initLevel = useCallback((level, keepStats) => {
                const gridSize = CONSTANTS.GRID_SIZE;
                const newGrid = [];
                const traps = [];
                
                // 1. Grid Creation
                for (let y = 0; y < gridSize; y++) {
                    const row = [];
                    for (let x = 0; x < gridSize; x++) {
                        row.push({ x, y, type: 'empty', state: 'hidden', danger: 0, id: `${x}-${y}` });
                    }
                    newGrid.push(row);
                }

                // 2. Start Pos
                newGrid[0][0].type = 'start';
                newGrid[0][0].state = 'revealed';
                const safeZone = ['0,0', '0,1', '1,0', '1,1'];

                // 3. Artifact Effect: Ancient Map (Reveal/Remove random trap logic prep)
                // We will handle this after placing traps

                // 4. Place Items
                const placeItem = (type, count) => {
                    let placed = 0;
                    while (placed < count) {
                        const rx = Math.floor(Math.random() * gridSize);
                        const ry = Math.floor(Math.random() * gridSize);
                        const k = `${rx},${ry}`;
                        if (!safeZone.includes(k) && newGrid[ry][rx].type === 'empty') {
                            newGrid[ry][rx].type = type;
                            if (type === 'trap') traps.push({x: rx, y: ry});
                            placed++;
                        }
                    }
                };

                const trapCount = CONSTANTS.TRAP_COUNT_BASE + Math.min((level - 1) * 2, 12);
                
                placeItem('door', 1);
                placeItem('key', 1);
                placeItem('trap', trapCount);
                placeItem('potion', 2);
                placeItem('shield', 1);
                placeItem('gold', CONSTANTS.GOLD_COUNT);
                
                // 10% chance for a chest
                if (Math.random() < 0.15) placeItem('chest', 1);

                // 5. Artifact Effect: Ancient Map (Remove 1 trap)
                if (keepStats && keepStats.artifacts.includes('map') && traps.length > 0) {
                    const removeIdx = Math.floor(Math.random() * traps.length);
                    const t = traps[removeIdx];
                    newGrid[t.y][t.x].type = 'empty'; // Remove trap
                    newGrid[t.y][t.x].state = 'revealed'; // Show it was safe
                    // Add a float text later in render or set immediate message
                    setTimeout(() => addFloat("üìú ÏßÄÎèÑ Î∞úÎèô!", "text-green-300"), 500);
                }

                // 6. Calc Numbers
                const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
                for(let y=0; y<gridSize; y++){
                    for(let x=0; x<gridSize; x++){
                        if(newGrid[y][x].type === 'trap') continue;
                        let d = 0;
                        directions.forEach(([dx, dy]) => {
                            const nx=x+dx, ny=y+dy;
                            if(nx>=0 && nx<gridSize && ny>=0 && ny<gridSize && newGrid[ny][nx].type === 'trap') d++;
                        });
                        newGrid[y][x].danger = d;
                    }
                }

                setGrid(newGrid);
                setPlayer({x:0, y:0});
                setHasKey(false);
                setMode('move');
                setFloor(level);
                
                // Shop Artifact Rotation
                const artifactKeys = Object.keys(CONSTANTS.ARTIFACTS);
                const randomArtifact = artifactKeys[Math.floor(Math.random() * artifactKeys.length)];
                setShopArtifact(randomArtifact);

                if (keepStats) {
                    setPhase('playing');
                    setHp(prev => getArtifactEffect('chalice') ? Math.min(prev + 1, 10) : prev);
                    if (keepStats.artifacts.includes('chalice')) addFloat("üç∑ ÏÑ±Î∞∞ Ìö®Í≥º", "text-pink-400");
                    setMsg(`${level}Ï∏µ ÎèÑÏ∞©.`);
                } else {
                    // Start from scratch handled in startGame
                    setMsg("ÏÉàÎ°úÏö¥ Î™®Ìóò ÏãúÏûë.");
                }

            }, [artifacts]);

            const startGame = (selectedClass) => {
                setCls(selectedClass);
                const cData = CONSTANTS.CLASSES[selectedClass];
                setHp(cData.hp);
                setGold(cData.gold);
                setShield(0);
                setArtifacts([]);
                setFloor(1);
                setPhase('playing');
                // Need to defer initLevel slightly or pass initial stats directly to logic, 
                // but since initLevel uses state for artifacts, we must clear them first.
                // Here we manually call logic similar to initLevel but forced clean state.
                setTimeout(() => initLevel(1, null), 0);
            };

            const revealArea = (g, x, y) => {
                const q = [{x,y}];
                const visited = new Set();
                const ng = [...g];
                while(q.length){
                    const {x:cx, y:cy} = q.shift();
                    const k = `${cx},${cy}`;
                    if(visited.has(k)) continue;
                    visited.add(k);
                    if(cx<0||cx>=10||cy<0||cy>=10) continue;
                    
                    const cell = ng[cy][cx];
                    if(cell.state === 'revealed' && !(cx===x && cy===y)) continue;
                    
                    cell.state = 'revealed';
                    if(cell.type === 'empty' && cell.danger === 0) {
                        [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(([dx,dy])=>q.push({x:cx+dx, y:cy+dy}));
                    }
                }
                return ng;
            };

            const handleAction = (x, y) => {
                if(phase !== 'playing') return;
                const cell = grid[y][x];

                // Telescope
                if(mode === 'telescope') {
                    if(cell.state === 'revealed') {
                        setMsg("Ïù¥ÎØ∏ ÌôïÏù∏Îêú Í≥≥ÏûÖÎãàÎã§."); setMode('move'); return;
                    }
                    
                    let cost = CONSTANTS.PRICES.TELESCOPE;
                    if(cls === 'wizard') cost = 5;
                    if(getArtifactEffect('lens')) cost = Math.floor(cost / 2);

                    if(gold < cost) {
                        setMsg(`Í≥®Îìú Î∂ÄÏ°± (${cost}G)`); setMode('move'); return;
                    }

                    setGold(g => g - cost);
                    addFloat(`-${cost}G`, "text-red-300");
                    
                    const ng = [...grid];
                    cell.state = 'revealed';
                    let m = "ÏïàÏ†Ñ ÌôïÏù∏.";
                    if(cell.type === 'trap') m = "‚ö†Ô∏è Ìï®Ï†ï Î∞úÍ≤¨!";
                    else if(cell.type === 'empty' && cell.danger === 0) {
                        // Reveal area logic not applied on telescope for balance, or maybe yes? 
                        // Let's do single cell reveal for telescope to keep it tactical.
                    }
                    setGrid(ng);
                    setMsg(m);
                    setMode('move');
                    return;
                }

                // Move
                const isAdj = Math.abs(player.x - x) <= 1 && Math.abs(player.y - y) <= 1;
                const isRev = cell.state === 'revealed';

                if(!isAdj && !isRev) {
                    setMsg("Ïù∏Ï†ëÌïú Í≥≥Îßå Ïù¥Îèô Í∞ÄÎä•Ìï©ÎãàÎã§."); return;
                }

                // Interaction Logic
                let ng = [...grid];
                let nHp = hp;
                let nGold = gold;
                let nShield = shield;
                let nKey = hasKey;
                let m = "";

                const processItem = (c) => {
                    if(c.type === 'key') {
                        nKey = true; m = "üîë Ïó¥Ïá† ÌöçÎìù!"; addFloat("KEY", "text-yellow-300"); c.type='empty';
                    } else if(c.type === 'potion') {
                        nHp = Math.min(nHp+1, 10); m="‚ù§Ô∏è Ï≤¥Î†• ÌöåÎ≥µ"; addFloat("+1 HP", "text-pink-400"); c.type='empty';
                    } else if(c.type === 'shield') {
                        nShield++; m="üõ°Ô∏è Î∞©Ìå® ÌöçÎìù"; addFloat("+1 SHIELD", "text-blue-400"); c.type='empty';
                    } else if(c.type === 'gold') {
                        let gain = 10 + Math.floor(Math.random()*6);
                        if(getArtifactEffect('lucky_coin')) gain = Math.floor(gain * 1.5);
                        nGold += gain; m=`üí∞ ${gain}G ÌöçÎìù`; addFloat(`+${gain}G`, "text-yellow-400"); c.type='empty';
                    } else if(c.type === 'chest') {
                        // Chest logic: Random artifact (rare) or massive gold
                        if(Math.random() < 0.4) {
                             // Artifact
                             const allArts = Object.keys(CONSTANTS.ARTIFACTS);
                             const newArt = allArts[Math.floor(Math.random() * allArts.length)];
                             if(!artifacts.includes(newArt)) {
                                 setArtifacts(prev => [...prev, newArt]);
                                 m = `üéÅ Ïú†Î¨º Î∞úÍ≤¨: ${CONSTANTS.ARTIFACTS[newArt].name}!`;
                                 addFloat("ARTIFACT!", "text-purple-400");
                             } else {
                                 nGold += 50; m="üéÅ ÏÉÅÏûêÏóêÏÑú 50G Î∞úÍ≤¨!"; addFloat("+50G", "text-yellow-300");
                             }
                        } else {
                             nGold += 30; m="üéÅ ÏÉÅÏûêÏóêÏÑú 30G Î∞úÍ≤¨!"; addFloat("+30G", "text-yellow-300");
                        }
                        c.type='empty';
                    }
                };

                if(isRev) {
                    // Moving to revealed
                    processItem(cell);
                    if(cell.type === 'door') {
                        if(nKey) {
                            initLevel(floor+1, {artifacts}); // Pass current artifacts
                            return; 
                        }
                        else m = "üîí Ïó¥Ïá†Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.";
                    }
                } else {
                    // Moving to hidden
                    if(cell.type === 'trap') {
                        cell.state = 'revealed';
                        if(nShield > 0) {
                            nShield--; m = "üõ°Ô∏è Î∞©Ìå® Î∞©Ïñ¥ ÏÑ±Í≥µ!"; addFloat("BLOCKED", "text-blue-300");
                        } else {
                            nHp--; m = "üî• Ìï®Ï†ï Î∞úÎèô!"; addFloat("-1 HP", "text-red-500");
                            if(nHp <= 0) {
                                setHp(0); setPhase('gameover'); return;
                            }
                        }
                    } else {
                        processItem(cell);
                        if(cell.type === 'door') m = "üö™ Ï∂úÍµ¨ Î∞úÍ≤¨ (Ïó¥Ïá† ÌïÑÏöî)";
                        
                        if(cell.type === 'empty' && cell.danger === 0) ng = revealArea(ng, x, y);
                        else cell.state = 'revealed';
                    }
                }

                setGrid(ng);
                setHp(nHp); setGold(nGold); setShield(nShield); setHasKey(nKey);
                setPlayer({x, y});
                if(m) setMsg(m);
            };

            const buy = (item) => {
                if(item === 'potion') {
                    if(gold >= CONSTANTS.PRICES.POTION) {
                        setGold(g=>g-CONSTANTS.PRICES.POTION); setHp(h=>h+1); setMsg("‚ù§Ô∏è Íµ¨Îß§ ÏôÑÎ£å");
                    } else setMsg("Í≥®Îìú Î∂ÄÏ°±");
                } else if(item === 'shield') {
                    if(gold >= CONSTANTS.PRICES.SHIELD) {
                        setGold(g=>g-CONSTANTS.PRICES.SHIELD); setShield(s=>s+1); setMsg("üõ°Ô∏è Íµ¨Îß§ ÏôÑÎ£å");
                    } else setMsg("Í≥®Îìú Î∂ÄÏ°±");
                } else if(item === 'artifact') {
                    if(!shopArtifact) return;
                    if(artifacts.includes(shopArtifact)) { setMsg("Ïù¥ÎØ∏ Î≥¥Ïú† Ï§ëÏûÖÎãàÎã§."); return; }
                    if(gold >= CONSTANTS.PRICES.ARTIFACT) {
                        setGold(g=>g-CONSTANTS.PRICES.ARTIFACT);
                        setArtifacts(prev => [...prev, shopArtifact]);
                        setMsg(`üéÅ ${CONSTANTS.ARTIFACTS[shopArtifact].name} ÌöçÎìù!`);
                        addFloat("ITEM GET!", "text-purple-400");
                    } else setMsg("Í≥®Îìú Î∂ÄÏ°±");
                }
            };

            // --- Render Helpers ---
            const Cell = ({ cell }) => {
                const isP = player.x === cell.x && player.y === cell.y;
                let content = null;
                let bg = "bg-slate-800";
                
                if(cell.state === 'hidden') {
                    bg = "bg-slate-700 hover:bg-slate-600 cursor-pointer";
                    if(mode === 'telescope') bg = "bg-slate-700 cursor-crosshair hover:bg-green-900/30 ring-1 ring-green-500/20";
                } else {
                    if(cell.type === 'trap') { content = <Icons.Skull className="text-red-500 w-3/4 h-3/4 item-pop" />; bg = "bg-red-900/40"; }
                    else if(cell.type === 'potion') content = <Icons.Heart className="text-pink-500 w-3/5 h-3/5 item-pop" fill="currentColor" />;
                    else if(cell.type === 'shield') content = <Icons.Shield className="text-blue-400 w-3/5 h-3/5 item-pop" />;
                    else if(cell.type === 'gold') content = <Icons.Coin className="text-yellow-400 w-3/5 h-3/5 item-pop" />;
                    else if(cell.type === 'key') content = <Icons.Key className="text-yellow-500 w-3/4 h-3/4 rotate-45 item-pop" />;
                    else if(cell.type === 'door') content = <Icons.Door className={`w-3/4 h-3/4 item-pop ${hasKey?'text-green-400':'text-slate-400'}`} />;
                    else if(cell.type === 'chest') content = <Icons.Chest className="text-amber-500 w-3/4 h-3/4 item-pop" fill="currentColor" />;
                    else if(cell.type === 'start') content = <span className="text-[10px] text-slate-500">START</span>;
                    else if(cell.danger > 0) {
                        const colors = ['text-blue-400', 'text-green-400', 'text-red-400', 'text-purple-400', 'text-orange-400', 'text-teal-400'];
                        content = <span className={`font-black text-xl ${colors[cell.danger-1]}`}>{cell.danger}</span>;
                    }
                }

                return (
                    <div onClick={() => handleAction(cell.x, cell.y)} 
                         className={`w-full h-full rounded-sm border border-slate-700/50 flex items-center justify-center relative transition-colors duration-200 ${bg}`}>
                        {content}
                        {isP && <div className="absolute inset-0 flex items-center justify-center pointer-events-none z-10">
                            <span className="text-2xl animate-bounce filter drop-shadow-lg">ü§†</span>
                        </div>}
                    </div>
                );
            };

            // --- Views ---
            if(phase === 'start') return (
                <div className="bg-slate-900 p-8 rounded-2xl shadow-2xl border border-slate-800 text-center max-w-sm w-full mx-4">
                    <h1 className="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500 mb-2">DUNGEON<br/>SWEEPER</h1>
                    <div className="flex items-center justify-center gap-2 mb-8 text-slate-400 text-sm">
                        <Icons.Crown className="w-4 h-4 text-yellow-500" />
                        <span>ÏµúÍ≥† Í∏∞Î°ù: {highScore}Ï∏µ</span>
                    </div>

                    <div className="space-y-3">
                        {Object.entries(CONSTANTS.CLASSES).map(([key, c]) => (
                            <button key={key} onClick={()=>startGame(key)} className="w-full bg-slate-800 hover:bg-slate-700 hover:scale-105 active:scale-95 transition-all p-4 rounded-xl border border-slate-700 group text-left flex items-center gap-4">
                                <div className={`p-3 rounded-full ${key==='knight'?'bg-blue-900/30 text-blue-400':key==='rogue'?'bg-yellow-900/30 text-yellow-400':'bg-purple-900/30 text-purple-400'}`}>
                                    {key==='knight'?<Icons.Shield className="w-6 h-6"/>:key==='rogue'?<Icons.Coin className="w-6 h-6"/>:<Icons.Telescope className="w-6 h-6"/>}
                                </div>
                                <div>
                                    <div className="font-bold text-lg text-slate-200">{c.name}</div>
                                    <div className="text-xs text-slate-500 group-hover:text-slate-400">{c.desc}</div>
                                </div>
                            </button>
                        ))}
                    </div>
                </div>
            );

            if(phase === 'gameover') return (
                <div className="bg-slate-900 p-8 rounded-2xl shadow-2xl border border-slate-800 text-center max-w-sm w-full relative overflow-hidden">
                    <div className="absolute inset-0 bg-red-600/5 z-0"></div>
                    <div className="relative z-10">
                        <Icons.Skull className="w-20 h-20 text-red-500 mx-auto mb-4 animate-bounce" />
                        <h2 className="text-3xl font-bold text-white mb-1">GAME OVER</h2>
                        <div className="text-slate-400 mb-6 text-sm">ÌÉêÌóòÏùÄ {floor}Ï∏µÏóêÏÑú ÎÅùÎÇ¨ÏäµÎãàÎã§.</div>
                        
                        <div className="bg-slate-800/50 rounded-lg p-4 mb-6 grid grid-cols-2 gap-4">
                            <div><div className="text-xs text-slate-500">ÏµúÏ¢Ö Ï∏µÏàò</div><div className="text-xl font-bold text-white">{floor}F</div></div>
                            <div><div className="text-xs text-slate-500">ÌöçÎìù Í≥®Îìú</div><div className="text-xl font-bold text-yellow-400">{gold}G</div></div>
                        </div>

                        <button onClick={()=>setPhase('start')} className="w-full bg-red-600 hover:bg-red-500 text-white font-bold py-3 px-6 rounded-xl flex items-center justify-center gap-2 transition-all hover:scale-105 shadow-lg shadow-red-900/20">
                            <Icons.Refresh className="w-5 h-5" /> Ï≤òÏùåÏúºÎ°ú
                        </button>
                    </div>
                </div>
            );

            // Game UI
            return (
                <div className="relative bg-slate-900 p-4 rounded-2xl shadow-2xl border border-slate-800 max-w-md w-full mx-auto">
                    {floats.map(f => (
                        <div key={f.id} className={`float-text ${f.color} text-2xl left-1/2 top-1/3 -translate-x-1/2`}>{f.text}</div>
                    ))}

                    {/* Header Stats */}
                    <div className="flex justify-between items-start mb-4 bg-slate-800/50 p-3 rounded-xl backdrop-blur-sm">
                        <div className="flex flex-col gap-1">
                            <div className="flex items-center gap-3">
                                <div className="flex items-center gap-1.5 text-pink-400 bg-pink-500/10 px-2 py-1 rounded-lg" title="Ï≤¥Î†•">
                                    <Icons.Heart className="w-4 h-4 fill-pink-500" />
                                    <span className="font-bold">{hp}</span>
                                </div>
                                <div className="flex items-center gap-1.5 text-blue-400 bg-blue-500/10 px-2 py-1 rounded-lg" title="Î∞©Ìå®">
                                    <Icons.Shield className="w-4 h-4" />
                                    <span className="font-bold">{shield}</span>
                                </div>
                                <div className="flex items-center gap-1.5 text-yellow-400 bg-yellow-500/10 px-2 py-1 rounded-lg" title="Í≥®Îìú">
                                    <Icons.Coin className="w-4 h-4 fill-yellow-500" />
                                    <span className="font-bold">{gold}</span>
                                </div>
                            </div>
                            {/* Artifacts Row */}
                            {artifacts.length > 0 && (
                                <div className="flex gap-1 mt-1 pl-1">
                                    {artifacts.map(a => (
                                        <div key={a} className="tooltip-container relative cursor-help">
                                            <span className="text-lg bg-slate-700 rounded w-6 h-6 flex items-center justify-center border border-slate-600">{CONSTANTS.ARTIFACTS[a].icon}</span>
                                            <div className="tooltip-text invisible absolute bottom-full left-0 mb-1 w-32 bg-black text-xs text-white p-2 rounded z-50 text-center">
                                                {CONSTANTS.ARTIFACTS[a].desc}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                        <div className="flex flex-col items-end gap-1">
                            <div className="flex items-center gap-1 text-slate-300 font-mono text-sm px-2 bg-slate-700/50 rounded">
                                <span className="font-bold text-lg">{floor}F</span>
                            </div>
                            {hasKey && <div className="text-green-400 bg-green-900/20 px-2 py-0.5 rounded text-xs font-bold animate-pulse flex items-center gap-1"><Icons.Key className="w-3 h-3"/>KEY</div>}
                        </div>
                    </div>

                    {/* Msg Bar */}
                    <div className={`text-center text-sm font-medium h-6 mb-2 transition-colors ${mode==='telescope'?'text-green-400':'text-cyan-300'}`}>
                        {mode === 'telescope' ? 'üî≠ Ï†ïÏ∞∞Ìï† Íµ¨Ïó≠ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî' : msg}
                    </div>

                    {/* Grid */}
                    <div className="grid gap-1 p-2 bg-slate-800 rounded-xl mb-4 shadow-inner" style={{ gridTemplateColumns: `repeat(${CONSTANTS.GRID_SIZE}, minmax(0, 1fr))` }}>
                        {grid.map(row => row.map(cell => <Cell key={cell.id} cell={cell} />))}
                    </div>

                    {/* Action Bar */}
                    <div className="grid grid-cols-4 gap-2">
                        <button onClick={()=>buy('potion')} className="flex flex-col items-center justify-center bg-slate-800 hover:bg-slate-750 active:bg-slate-700 p-2 rounded-lg border border-slate-700 transition-all">
                            <Icons.Heart className="w-5 h-5 text-pink-500 mb-1" />
                            <span className="text-[10px] text-yellow-500 font-bold">{CONSTANTS.PRICES.POTION}G</span>
                        </button>
                        <button onClick={()=>buy('shield')} className="flex flex-col items-center justify-center bg-slate-800 hover:bg-slate-750 active:bg-slate-700 p-2 rounded-lg border border-slate-700 transition-all">
                            <Icons.Shield className="w-5 h-5 text-blue-400 mb-1" />
                            <span className="text-[10px] text-yellow-500 font-bold">{CONSTANTS.PRICES.SHIELD}G</span>
                        </button>
                        <button onClick={()=>setMode(m => m==='move'?'telescope':'move')} className={`flex flex-col items-center justify-center p-2 rounded-lg border transition-all ${mode==='telescope'?'bg-green-900/30 border-green-500 text-green-400':'bg-slate-800 border-slate-700 text-slate-400 hover:text-slate-200'}`}>
                            <Icons.Telescope className="w-5 h-5 mb-1" />
                            <span className="text-[10px] font-bold">{cls==='wizard'?5:CONSTANTS.PRICES.TELESCOPE}G</span>
                        </button>
                        {/* Shop Artifact Slot */}
                        <button onClick={()=>buy('artifact')} className={`flex flex-col items-center justify-center p-2 rounded-lg border transition-all relative overflow-hidden group ${artifacts.includes(shopArtifact) ? 'opacity-30 grayscale' : 'bg-purple-900/20 border-purple-500/50 hover:bg-purple-900/40'}`}>
                            <div className="text-xl mb-1 filter drop-shadow">{shopArtifact ? CONSTANTS.ARTIFACTS[shopArtifact].icon : '?'}</div>
                            <span className="text-[10px] text-yellow-500 font-bold">{CONSTANTS.PRICES.ARTIFACT}G</span>
                            {/* Tooltip for shop item */}
                             <div className="tooltip-text invisible absolute bottom-full right-0 mb-2 w-32 bg-black text-xs text-white p-2 rounded z-50 text-center group-hover:visible opacity-0 group-hover:opacity-100 transition-opacity">
                                {shopArtifact ? CONSTANTS.ARTIFACTS[shopArtifact].name : '???'}
                            </div>
                        </button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DungeonSweeper />);
    </script>
</body>
</html>
