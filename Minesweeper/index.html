<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dungeon Sweeper RPG</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel (for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @keyframes bounce {
            0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8,0,1,1); }
            50% { transform: none; animation-timing-function: cubic-bezier(0,0,0.2,1); }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .item-pop {
            animation: pop 0.3s ease-out;
        }
        @keyframes pop {
            0% { transform: scale(0); }
            80% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        /* í”Œë¡œíŒ… í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ */
        .float-text {
            animation: floatUp 1s ease-out forwards;
            position: absolute;
            pointer-events: none;
            z-index: 50;
            font-weight: bold;
            text-shadow: 1px 1px 0 #000;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-30px) scale(1.2); opacity: 0; }
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen flex items-center justify-center font-sans select-none">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // --- ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ ---
        const Heart = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>;
        const Skull = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></svg>;
        const Key = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="7.5" cy="15.5" r="5.5"/><path d="m21 2-9.6 9.6"/><path d="m15.5 7.5 3 3L22 7l-3-3"/></svg>;
        const DoorOpen = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M13 4h3a2 2 0 0 1 2 2v14"/><path d="M2 20h3"/><path d="M13 20h9"/><path d="M10 12v.01"/><path d="M13 4.562v16.157a1 1 0 0 1-1.242.97L5 20V5.562a2 2 0 0 1 1.515-1.94l4-1A2 2 0 0 1 13 4.561Z"/></svg>;
        const RefreshCw = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>;
        const Trophy = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>;
        const Coins = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m7.1 13.8 3.1-9.1"/><path d="M10.8 17.7l-3.1-9.1"/></svg>;
        const Telescope = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/><path d="M2 12h20"/></svg>;
        const Shield = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>;
        const User = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;

        // --- ê²Œì„ ìƒìˆ˜ ---
        const GRID_SIZE = 10;
        const TRAP_COUNT = 15;
        const GOLD_COUNT = 6;
        const POTION_COUNT = 2;
        const SHIELD_COUNT = 1;
        
        // ìƒì  ê°€ê²©
        const PRICE_POTION = 40;
        const PRICE_SHIELD = 50;
        const PRICE_TELESCOPE_BASE = 20;

        // ì§ì—… ì •ì˜
        const CLASSES = {
            knight: { name: "ê¸°ì‚¬", hp: 5, gold: 0, desc: "ë†’ì€ ì²´ë ¥ìœ¼ë¡œ ì‹œì‘" },
            rogue: { name: "ë„ì ", hp: 3, gold: 30, desc: "ë§ì€ ê³¨ë“œë¡œ ì‹œì‘" },
            wizard: { name: "ë§ˆë²•ì‚¬", hp: 3, gold: 0, desc: "ì •ì°° ë¹„ìš© ëŒ€í­ í• ì¸" },
        };

        const DungeonSweeper = () => {
            const [gamePhase, setGamePhase] = useState('start'); // start, playing, gameover
            const [selectedClass, setSelectedClass] = useState('knight');
            
            const [grid, setGrid] = useState([]);
            const [playerPos, setPlayerPos] = useState({ x: 0, y: 0 });
            const [hp, setHp] = useState(3);
            const [shield, setShield] = useState(0);
            const [gold, setGold] = useState(0);
            const [hasKey, setHasKey] = useState(false);
            const [message, setMessage] = useState("");
            const [floor, setFloor] = useState(1);
            const [actionMode, setActionMode] = useState('move'); 
            const [floatTexts, setFloatTexts] = useState([]); // {id, x, y, text, color}

            const directions = [
                [-1, -1], [-1, 0], [-1, 1],
                [0, -1],           [0, 1],
                [1, -1],  [1, 0],  [1, 1]
            ];

            // í”Œë¡œíŒ… í…ìŠ¤íŠ¸ ì¶”ê°€ í•¨ìˆ˜
            const addFloatText = (text, color) => {
                const id = Date.now();
                // í™”ë©´ ì¤‘ì•™ ìƒë‹¨ì¯¤ì— ë„ìš°ê¸° ìœ„í•´ (í”Œë ˆì´ì–´ ìœ„ì¹˜ ê¸°ë°˜ì´ ì¢‹ì§€ë§Œ ê°„ë‹¨íˆ ì¤‘ì•™ì—)
                // ì‹¤ì œë¡œëŠ” CSS ì• ë‹ˆë©”ì´ì…˜ì´ ì²˜ë¦¬í•˜ë¯€ë¡œ ìƒíƒœë§Œ ì¶”ê°€
                setFloatTexts(prev => [...prev, { id, text, color }]);
                setTimeout(() => {
                    setFloatTexts(prev => prev.filter(ft => ft.id !== id));
                }, 1000);
            };

            const startGame = (cls) => {
                setSelectedClass(cls);
                const classData = CLASSES[cls];
                setHp(classData.hp);
                setGold(classData.gold);
                setShield(0);
                setFloor(1);
                initLevel(1, classData.hp, classData.gold, 0);
            };

            const initLevel = useCallback((level, currentHp, currentGold, currentShield) => {
                const newGrid = [];
                const traps = [];
                
                // 1. ê·¸ë¦¬ë“œ ìƒì„±
                for (let y = 0; y < GRID_SIZE; y++) {
                    const row = [];
                    for (let x = 0; x < GRID_SIZE; x++) {
                        row.push({
                            x, y,
                            type: 'empty',
                            state: 'hidden',
                            adjacentDanger: 0,
                            id: `${x}-${y}`
                        });
                    }
                    newGrid.push(row);
                }

                // 2. ì‹œì‘ì  ì„¤ì • (0,0)
                newGrid[0][0].type = 'start';
                newGrid[0][0].state = 'revealed';
                const safeZone = [`0,0`, `0,1`, `1,0`, `1,1`];

                // 3. ì•„ì´í…œ ë°°ì¹˜
                const placeItem = (type, count) => {
                    let placed = 0;
                    while (placed < count) {
                        const rx = Math.floor(Math.random() * GRID_SIZE);
                        const ry = Math.floor(Math.random() * GRID_SIZE);
                        const key = `${rx},${ry}`;
                        
                        if (!safeZone.includes(key) && newGrid[ry][rx].type === 'empty') {
                            newGrid[ry][rx].type = type;
                            if (type === 'trap') traps.push({x: rx, y: ry});
                            placed++;
                        }
                    }
                };

                const currentTrapCount = TRAP_COUNT + Math.min((level - 1) * 2, 10);

                placeItem('door', 1);
                placeItem('key', 1);
                placeItem('trap', currentTrapCount);
                placeItem('potion', POTION_COUNT);
                placeItem('shield', SHIELD_COUNT);
                placeItem('gold', GOLD_COUNT);

                // 4. ìœ„í—˜ë„ ê³„ì‚°
                for (let y = 0; y < GRID_SIZE; y++) {
                    for (let x = 0; x < GRID_SIZE; x++) {
                        if (newGrid[y][x].type === 'trap') continue;

                        let danger = 0;
                        directions.forEach(([dx, dy]) => {
                            const nx = x + dx;
                            const ny = y + dy;
                            if (nx >= 0 && nx < GRID_SIZE && ny >= 0 && ny < GRID_SIZE) {
                                if (newGrid[ny][nx].type === 'trap') danger++;
                            }
                        });
                        newGrid[y][x].adjacentDanger = danger;
                    }
                }

                setGrid(newGrid);
                setPlayerPos({ x: 0, y: 0 });
                setHasKey(false);
                setGamePhase('playing');
                setActionMode('move');
                setHp(currentHp);
                setGold(currentGold);
                setShield(currentShield);
                setFloor(level);

                if (level === 1) {
                    setMessage("ë˜ì „ì— ì…ì¥í–ˆìŠµë‹ˆë‹¤.");
                } else {
                    setMessage(`${level}ì¸µ: ë” ê¹Šì€ ê³³ìœ¼ë¡œ ì™”ìŠµë‹ˆë‹¤.`);
                }
            }, []);


            // í™ìˆ˜ ì•Œê³ ë¦¬ì¦˜
            const revealEmptyArea = (startGrid, x, y) => {
                const queue = [{x, y}];
                const visited = new Set();
                const newGrid = [...startGrid];

                while (queue.length > 0) {
                    const {x: cx, y: cy} = queue.shift();
                    const key = `${cx},${cy}`;
                    if (visited.has(key)) continue;
                    visited.add(key);

                    if (cx < 0 || cx >= GRID_SIZE || cy < 0 || cy >= GRID_SIZE) continue;
                    
                    const cell = newGrid[cy][cx];
                    if (cell.state === 'revealed' && !(cx === x && cy === y)) continue;

                    cell.state = 'revealed';

                    if (cell.type === 'empty' && cell.adjacentDanger === 0) {
                        directions.forEach(([dx, dy]) => {
                            queue.push({x: cx + dx, y: cy + dy});
                        });
                    }
                }
                return newGrid;
            };

            const checkItemPickup = (cell, currentHp, currentGold, currentKey, currentShield) => {
                let msg = "";
                let newHp = currentHp;
                let newGold = currentGold;
                let newKey = currentKey;
                let newShield = currentShield;
                let itemType = cell.type;

                if (itemType === 'key') {
                    newKey = true;
                    msg = "ğŸ”‘ ì—´ì‡  íšë“! íƒˆì¶œêµ¬ë¥¼ ì°¾ìœ¼ì„¸ìš”.";
                    addFloatText("KEY!", "text-yellow-300");
                    cell.type = 'empty';
                } else if (itemType === 'potion') {
                    newHp = Math.min(currentHp + 1, 10);
                    msg = "â¤ï¸ í¬ì…˜ ì‚¬ìš©! ì²´ë ¥ íšŒë³µ.";
                    addFloatText("+1 HP", "text-pink-400");
                    cell.type = 'empty';
                } else if (itemType === 'shield') {
                    newShield += 1;
                    msg = "ğŸ›¡ï¸ ë°©íŒ¨ íšë“! í•¨ì •ì„ 1íšŒ ë§‰ì•„ì¤ë‹ˆë‹¤.";
                    addFloatText("+1 SHIELD", "text-blue-400");
                    cell.type = 'empty';
                } else if (itemType === 'gold') {
                    const gain = 10 + Math.floor(Math.random() * 6);
                    newGold += gain;
                    msg = `ğŸ’° ${gain} ê³¨ë“œ íšë“!`;
                    addFloatText(`+${gain} G`, "text-yellow-400");
                    cell.type = 'empty';
                }

                return { newHp, newGold, newKey, newShield, msg };
            };

            const handleInteraction = (x, y) => {
                if (gamePhase !== 'playing') return;

                const targetCell = grid[y][x];
                const telescopePrice = selectedClass === 'wizard' ? 5 : PRICE_TELESCOPE_BASE;

                // --- ğŸ”­ ë§ì›ê²½ ëª¨ë“œ ---
                if (actionMode === 'telescope') {
                    if (targetCell.state === 'revealed') {
                        setMessage("ì´ë¯¸ ë°í˜€ì§„ ê³³ì…ë‹ˆë‹¤.");
                        setActionMode('move');
                        return;
                    }
                    if (gold < telescopePrice) {
                        setMessage(`ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: ${telescopePrice}G)`);
                        setActionMode('move');
                        return;
                    }

                    setGold(g => g - telescopePrice);
                    addFloatText(`-${telescopePrice} G`, "text-red-400");
                    
                    let newGrid = [...grid];
                    targetCell.state = 'revealed';
                    
                    let msg = "ì •ì°° ì™„ë£Œ.";
                    if (targetCell.type === 'trap') {
                        msg = "âš ï¸ í•¨ì •ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!";
                    } else if (targetCell.adjacentDanger === 0 && targetCell.type === 'empty') {
                        newGrid = revealEmptyArea(newGrid, x, y);
                        msg = "ì•ˆì „í•œ ì§€ì—­ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.";
                    }
                    
                    setGrid(newGrid);
                    setMessage(msg);
                    setActionMode('move');
                    return;
                }

                // --- ğŸ¦¶ ì´ë™ ëª¨ë“œ ---
                const isAdjacent = Math.abs(playerPos.x - x) <= 1 && Math.abs(playerPos.y - y) <= 1;
                const isRevealed = targetCell.state === 'revealed';

                if (!isAdjacent && !isRevealed) {
                    setMessage("ë¯¸íƒí—˜ ì§€ì—­ì€ ì¸ì ‘í•œ ì¹¸ìœ¼ë¡œë§Œ ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
                    return;
                }

                let newGrid = [...grid];
                let currentHp = hp;
                let currentGold = gold;
                let currentKey = hasKey;
                let currentShield = shield;
                let currentMsg = "";

                // 1. ì´ë¯¸ ê³µê°œëœ ê³³ìœ¼ë¡œ ì´ë™
                if (targetCell.state === 'revealed') {
                    const pickup = checkItemPickup(targetCell, currentHp, currentGold, currentKey, currentShield);
                    currentHp = pickup.newHp;
                    currentGold = pickup.newGold;
                    currentKey = pickup.newKey;
                    currentShield = pickup.newShield;
                    if(pickup.msg) currentMsg = pickup.msg;

                    if (targetCell.type === 'door') {
                        if (currentKey) {
                            initLevel(floor + 1, currentHp, currentGold, currentShield);
                            return;
                        } else {
                            currentMsg = "ë¬¸ì´ ì ê²¨ìˆìŠµë‹ˆë‹¤. ì—´ì‡ ê°€ í•„ìš”í•©ë‹ˆë‹¤!";
                        }
                    } 
                    
                    setHp(currentHp);
                    setGold(currentGold);
                    setHasKey(currentKey);
                    setShield(currentShield);
                    setPlayerPos({ x, y });
                    if(currentMsg) setMessage(currentMsg);
                } 
                // 2. ë¯¸íƒí—˜ ì§€ì—­ìœ¼ë¡œ ì´ë™
                else {
                    if (targetCell.type === 'trap') {
                        targetCell.state = 'revealed';
                        
                        // ë°©íŒ¨ ì²´í¬
                        if (currentShield > 0) {
                            currentShield -= 1;
                            currentMsg = "ğŸ›¡ï¸ ë°©íŒ¨ê°€ í•¨ì • í”¼í•´ë¥¼ ë§‰ì•˜ìŠµë‹ˆë‹¤!";
                            addFloatText("BLOCKED!", "text-blue-300");
                        } else {
                            currentHp -= 1;
                            currentMsg = "ğŸ”¥ í•¨ì •ì„ ë°Ÿì•˜ìŠµë‹ˆë‹¤! (HP -1)";
                            addFloatText("-1 HP", "text-red-500");
                            
                            if (currentHp <= 0) {
                                setHp(0);
                                setGamePhase('gameover');
                                return;
                            }
                        }
                    } else {
                        // ì•ˆì „ ë„ì°©
                        const pickup = checkItemPickup(targetCell, currentHp, currentGold, currentKey, currentShield);
                        currentHp = pickup.newHp;
                        currentGold = pickup.newGold;
                        currentKey = pickup.newKey;
                        currentShield = pickup.newShield;
                        if(pickup.msg) currentMsg = pickup.msg;

                        if (targetCell.type === 'door') currentMsg = "ì¶œêµ¬ ë°œê²¬! ì—´ì‡ ê°€ í•„ìš”í•©ë‹ˆë‹¤.";

                        if (targetCell.adjacentDanger === 0 && targetCell.type === 'empty') {
                            newGrid = revealEmptyArea(newGrid, x, y);
                        } else {
                            targetCell.state = 'revealed';
                        }
                    }

                    setGrid(newGrid);
                    setHp(currentHp);
                    setGold(currentGold);
                    setHasKey(currentKey);
                    setShield(currentShield);
                    setPlayerPos({ x, y });
                    if (currentMsg) setMessage(currentMsg);
                }
            };

            const buyItem = (item) => {
                if (item === 'potion') {
                    if (gold >= PRICE_POTION) {
                        setGold(g => g - PRICE_POTION);
                        setHp(h => h + 1);
                        setMessage("â¤ï¸ í¬ì…˜ êµ¬ë§¤ ì™„ë£Œ");
                        addFloatText("+1 HP", "text-pink-400");
                    } else setMessage("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
                } else if (item === 'shield') {
                    if (gold >= PRICE_SHIELD) {
                        setGold(g => g - PRICE_SHIELD);
                        setShield(s => s + 1);
                        setMessage("ğŸ›¡ï¸ ë°©íŒ¨ êµ¬ë§¤ ì™„ë£Œ");
                        addFloatText("+1 SHIELD", "text-blue-400");
                    } else setMessage("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
                }
            };

            const toggleTelescope = () => {
                if (actionMode === 'telescope') {
                    setActionMode('move');
                    setMessage("ì´ë™ ëª¨ë“œë¡œ ì „í™˜í•©ë‹ˆë‹¤.");
                } else {
                    const price = selectedClass === 'wizard' ? 5 : PRICE_TELESCOPE_BASE;
                    if (gold >= price) {
                        setActionMode('telescope');
                        setMessage(`ğŸ”­ ì •ì°° ëª¨ë“œ (ë¹„ìš©: ${price}G)`);
                    } else {
                        setMessage(`ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. (${price}G í•„ìš”)`);
                    }
                }
            };

            const getCellContent = (cell) => {
                const isPlayerHere = playerPos.x === cell.x && playerPos.y === cell.y;
                
                if (cell.state === 'hidden') {
                     if (isPlayerHere) return <div className="w-full h-full flex items-center justify-center bg-slate-700 border border-slate-600 rounded-sm"><div className="text-2xl animate-bounce z-10">ğŸ¤ </div></div>;
                     const cursorClass = actionMode === 'telescope' ? 'cursor-crosshair hover:bg-green-900/30' : 'cursor-pointer hover:bg-slate-600';
                     return <div className={`w-full h-full bg-slate-700 rounded-sm border border-slate-600 transition-colors ${cursorClass}`} />;
                }

                let content = null;
                if (cell.type === 'trap') content = <Skull className="text-red-500 w-6 h-6 item-pop" />;
                else if (cell.type === 'potion') content = <Heart className="text-pink-500 fill-pink-500 w-5 h-5 item-pop" />;
                else if (cell.type === 'shield') content = <Shield className="text-blue-400 fill-blue-400/20 w-5 h-5 item-pop" />;
                else if (cell.type === 'gold') content = <Coins className="text-yellow-400 w-5 h-5 item-pop" />;
                else if (cell.type === 'key') content = <Key className="text-yellow-500 w-6 h-6 rotate-45 item-pop" />;
                else if (cell.type === 'door') content = <DoorOpen className={`w-6 h-6 ${hasKey ? 'text-green-400' : 'text-slate-400'} item-pop`} />;
                else if (cell.type === 'start') content = <span className="text-xs text-slate-400">START</span>;
                else if (cell.adjacentDanger > 0) {
                    const colors = ['text-blue-400', 'text-green-400', 'text-red-400', 'text-purple-400', 'text-orange-400'];
                    content = <span className={`font-bold text-xl ${colors[cell.adjacentDanger-1] || 'text-red-600'}`}>{cell.adjacentDanger}</span>;
                }

                return (
                    <div className={`w-full h-full flex items-center justify-center border border-slate-800 rounded-sm relative ${cell.type === 'trap' ? 'bg-red-900/30' : 'bg-slate-900'}`}>
                        {content}
                        {isPlayerHere && (
                            <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                                <div className={`text-2xl animate-bounce transition-opacity duration-300 ${content ? 'opacity-60' : 'opacity-100'}`} style={{ textShadow: '0 0 10px rgba(0,0,0,0.5)' }}>ğŸ¤ </div>
                            </div>
                        )}
                    </div>
                );
            };

            // --- ğŸ–¥ï¸ í™”ë©´: ì‹œì‘ í™”ë©´ ---
            if (gamePhase === 'start') {
                return (
                    <div className="max-w-md w-full bg-slate-900 p-8 rounded-xl shadow-2xl border border-slate-800 text-center">
                        <h1 className="text-3xl font-bold text-yellow-400 mb-2">DUNGEON SWEEPER</h1>
                        <p className="text-slate-400 mb-8">ì§ì—…ì„ ì„ íƒí•˜ì—¬ ë˜ì „ì„ íƒí—˜í•˜ì„¸ìš”</p>

                        <div className="space-y-4 mb-8">
                            <button onClick={() => startGame('knight')} className="w-full bg-slate-800 hover:bg-slate-700 border border-slate-700 p-4 rounded-lg flex items-center gap-4 transition-all hover:border-yellow-500 group">
                                <div className="bg-slate-900 p-3 rounded-full text-blue-400 group-hover:scale-110 transition-transform"><Shield className="w-6 h-6" /></div>
                                <div className="text-left">
                                    <div className="font-bold text-lg text-slate-200">ê¸°ì‚¬ (Knight)</div>
                                    <div className="text-sm text-slate-500">ì²´ë ¥ 5ì¹¸ìœ¼ë¡œ ì‹œì‘</div>
                                </div>
                            </button>
                            <button onClick={() => startGame('rogue')} className="w-full bg-slate-800 hover:bg-slate-700 border border-slate-700 p-4 rounded-lg flex items-center gap-4 transition-all hover:border-yellow-500 group">
                                <div className="bg-slate-900 p-3 rounded-full text-yellow-400 group-hover:scale-110 transition-transform"><Coins className="w-6 h-6" /></div>
                                <div className="text-left">
                                    <div className="font-bold text-lg text-slate-200">ë„ì  (Rogue)</div>
                                    <div className="text-sm text-slate-500">ê³¨ë“œ 30G ì†Œì§€í•˜ê³  ì‹œì‘</div>
                                </div>
                            </button>
                            <button onClick={() => startGame('wizard')} className="w-full bg-slate-800 hover:bg-slate-700 border border-slate-700 p-4 rounded-lg flex items-center gap-4 transition-all hover:border-yellow-500 group">
                                <div className="bg-slate-900 p-3 rounded-full text-purple-400 group-hover:scale-110 transition-transform"><Telescope className="w-6 h-6" /></div>
                                <div className="text-left">
                                    <div className="font-bold text-lg text-slate-200">ë§ˆë²•ì‚¬ (Wizard)</div>
                                    <div className="text-sm text-slate-500">ì •ì°° ìŠ¤í‚¬ ë¹„ìš© í• ì¸ (5G)</div>
                                </div>
                            </button>
                        </div>
                    </div>
                );
            }

            // --- ğŸ–¥ï¸ í™”ë©´: ê²Œì„ ì˜¤ë²„ ---
            if (gamePhase === 'gameover') {
                return (
                    <div className="max-w-md w-full bg-slate-900 p-8 rounded-xl shadow-2xl border border-slate-800 text-center relative overflow-hidden">
                        <div className="absolute inset-0 bg-red-900/10 z-0"></div>
                        <div className="relative z-10">
                            <Skull className="w-20 h-20 text-red-500 mx-auto mb-4 animate-bounce" />
                            <h2 className="text-3xl font-bold text-white mb-2">GAME OVER</h2>
                            <p className="text-slate-400 mb-2">ë‹¹ì‹ ì˜ ì—¬ì •ì€ {floor}ì¸µì—ì„œ ëë‚¬ìŠµë‹ˆë‹¤.</p>
                            <div className="text-yellow-500 font-bold text-xl mb-8">íšë“ ê³¨ë“œ: {gold} G</div>
                            <button onClick={() => setGamePhase('start')} className="bg-red-600 hover:bg-red-700 text-white px-8 py-3 rounded-full font-bold transition-transform hover:scale-105 flex items-center gap-2 mx-auto">
                                <RefreshCw className="w-5 h-5" /> ë‹¤ì‹œ ë„ì „
                            </button>
                        </div>
                    </div>
                );
            }

            // --- ğŸ–¥ï¸ í™”ë©´: ê²Œì„ í”Œë ˆì´ ---
            return (
                <div className="max-w-md w-full bg-slate-900 p-5 rounded-xl shadow-2xl border border-slate-800 relative">
                    {/* í”Œë¡œíŒ… í…ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ */}
                    <div className="absolute top-1/3 left-1/2 -translate-x-1/2 pointer-events-none z-50">
                        {floatTexts.map(ft => (
                            <div key={ft.id} className={`float-text ${ft.color} text-2xl`}>{ft.text}</div>
                        ))}
                    </div>

                    {/* ìƒë‹¨ ì •ë³´ì°½ */}
                    <div className="flex justify-between items-center mb-3 bg-slate-800 p-3 rounded-lg">
                        <div className="flex items-center gap-3">
                            <div className="flex items-center gap-1 text-pink-400 bg-pink-900/20 px-2 py-1 rounded" title="ì²´ë ¥">
                                <Heart className="fill-pink-400 w-4 h-4" />
                                <span className="font-bold">{hp}</span>
                            </div>
                            <div className="flex items-center gap-1 text-blue-400 bg-blue-900/20 px-2 py-1 rounded" title="ë°©íŒ¨">
                                <Shield className="fill-blue-400/20 w-4 h-4" />
                                <span className="font-bold">{shield}</span>
                            </div>
                            <div className="flex items-center gap-1 text-yellow-400 bg-yellow-900/20 px-2 py-1 rounded" title="ê³¨ë“œ">
                                <Coins className="w-4 h-4 fill-yellow-400/20" />
                                <span className="font-bold">{gold}</span>
                            </div>
                        </div>
                        <div className="flex items-center gap-2">
                            <div className="flex items-center gap-1 text-slate-300 px-2">
                                <Trophy className="w-4 h-4" /> <span className="font-bold text-sm">{floor}F</span>
                            </div>
                            {hasKey && <div className="text-yellow-400 animate-pulse"><Key className="w-5 h-5" /></div>}
                        </div>
                    </div>

                    {/* ë©”ì‹œì§€ & ì§ì—… ì•„ì´ì½˜ */}
                    <div className="flex items-center justify-between mb-2 px-1">
                        <div className={`text-sm font-medium transition-colors ${actionMode === 'telescope' ? 'text-green-400' : 'text-cyan-300'}`}>
                            {message}
                        </div>
                        <div className="text-xs text-slate-500 border border-slate-700 px-2 py-0.5 rounded-full">
                            {CLASSES[selectedClass].name}
                        </div>
                    </div>

                    {/* ê·¸ë¦¬ë“œ */}
                    <div 
                        className={`grid gap-1 mb-4 mx-auto bg-slate-800 p-2 rounded-lg relative transition-all duration-300 
                        ${actionMode === 'telescope' ? 'ring-2 ring-green-500/50 shadow-[0_0_20px_rgba(34,197,94,0.2)]' : ''}`}
                        style={{ gridTemplateColumns: `repeat(${GRID_SIZE}, minmax(0, 1fr))`, width: 'fit-content' }}
                    >
                        {grid.map((row, y) => row.map((cell, x) => (
                            <div key={cell.id} onClick={() => handleInteraction(x, y)} className="w-8 h-8 sm:w-9 sm:h-9 relative">
                                {getCellContent(cell)}
                            </div>
                        )))}
                    </div>

                    {/* í•˜ë‹¨: ìƒì  ë° ì•¡ì…˜ ë°” */}
                    <div className="grid grid-cols-3 gap-2">
                        <button onClick={() => buyItem('potion')} className="flex flex-col items-center justify-center bg-slate-800 hover:bg-slate-700 active:bg-slate-600 p-2 rounded-lg border border-slate-700 transition-colors group">
                            <div className="text-pink-400 mb-1"><Heart className="w-5 h-5 fill-pink-400" /></div>
                            <div className="text-[10px] text-slate-400 font-bold">íšŒë³µ</div>
                            <span className="text-[10px] text-yellow-500 group-hover:text-yellow-400">{PRICE_POTION}G</span>
                        </button>

                        <button onClick={() => buyItem('shield')} className="flex flex-col items-center justify-center bg-slate-800 hover:bg-slate-700 active:bg-slate-600 p-2 rounded-lg border border-slate-700 transition-colors group">
                            <div className="text-blue-400 mb-1"><Shield className="w-5 h-5 fill-blue-400/20" /></div>
                            <div className="text-[10px] text-slate-400 font-bold">ë°©íŒ¨</div>
                            <span className="text-[10px] text-yellow-500 group-hover:text-yellow-400">{PRICE_SHIELD}G</span>
                        </button>

                        <button onClick={toggleTelescope} className={`flex flex-col items-center justify-center p-2 rounded-lg border transition-colors group ${actionMode === 'telescope' ? 'bg-green-900/40 border-green-500 text-green-300' : 'bg-slate-800 border-slate-700 hover:bg-slate-700 text-slate-300'}`}>
                            <div className="mb-1"><Telescope className="w-5 h-5" /></div>
                            <div className="text-[10px] font-bold">ì •ì°°</div>
                            <span className="text-[10px] text-yellow-500 group-hover:text-yellow-400">{selectedClass === 'wizard' ? 5 : PRICE_TELESCOPE_BASE}G</span>
                        </button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DungeonSweeper />);
    </script>
</body>
</html>
