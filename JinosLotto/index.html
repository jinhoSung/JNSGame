<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucky Lotto Master</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Custom Styles -->
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #0f172a; }
        /* Scrollbar hide utility */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            query, 
            orderBy, 
            onSnapshot, 
            deleteDoc, 
            doc, 
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Icon Components (SVG) ---
        const IconBase = ({ children, className, ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="24" height="24" viewBox="0 0 24 24" 
                fill="none" stroke="currentColor" strokeWidth="2" 
                strokeLinecap="round" strokeLinejoin="round" 
                className={className} {...props}
            >
                {children}
            </svg>
        );

        const Trash2 = (props) => <IconBase {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></IconBase>;
        const Copy = (props) => <IconBase {...props}><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></IconBase>;
        const History = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/><path d="M12 7v5l4 2"/></IconBase>;
        const RefreshCw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>;
        const Settings = (props) => <IconBase {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconBase>;
        const Save = (props) => <IconBase {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconBase>;
        const X = (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconBase>;
        const Trophy = (props) => <IconBase {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 1 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></IconBase>;
        const Sparkles = (props) => <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 9h4"/><path d="M3 5h4"/></IconBase>;
        const Wind = (props) => <IconBase {...props}><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></IconBase>;

        // --- Firebase Config & Setup ---
        // 주의: 로컬 파일로 실행 시 아래 설정 객체에 본인의 Firebase 설정을 입력해야 합니다.
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- Constants & Helpers ---
        const LOTTO_COLORS = {
            yellow: 'bg-yellow-400 text-yellow-900 border-yellow-500 shadow-[inset_-2px_-2px_6px_rgba(0,0,0,0.2)]',
            blue: 'bg-blue-500 text-white border-blue-600 shadow-[inset_-2px_-2px_6px_rgba(0,0,0,0.2)]',
            red: 'bg-red-500 text-white border-red-600 shadow-[inset_-2px_-2px_6px_rgba(0,0,0,0.2)]',
            gray: 'bg-gray-500 text-white border-gray-600 shadow-[inset_-2px_-2px_6px_rgba(0,0,0,0.2)]',
            green: 'bg-green-500 text-white border-green-600 shadow-[inset_-2px_-2px_6px_rgba(0,0,0,0.2)]'
        };

        const getBallColor = (num) => {
            if (num <= 10) return LOTTO_COLORS.yellow;
            if (num <= 20) return LOTTO_COLORS.blue;
            if (num <= 30) return LOTTO_COLORS.red;
            if (num <= 40) return LOTTO_COLORS.gray;
            return LOTTO_COLORS.green;
        };

        const animationStyles = `
            @keyframes bounce-in-circle {
                0% { transform: translate(0, 0) rotate(0deg); }
                25% { transform: translate(100px, -60px) rotate(90deg); }
                50% { transform: translate(20px, 80px) rotate(180deg); }
                75% { transform: translate(-100px, -20px) rotate(270deg); }
                100% { transform: translate(0, 0) rotate(360deg); }
            }
            @keyframes bounce-variant-1 {
                0% { transform: translate(0, 0); }
                20% { transform: translate(-90px, -110px) rotate(-45deg); }
                40% { transform: translate(80px, -40px) rotate(90deg); }
                60% { transform: translate(-60px, 90px) rotate(180deg); }
                80% { transform: translate(100px, 50px) rotate(270deg); }
                100% { transform: translate(0, 0) rotate(360deg); }
            }
            @keyframes bounce-variant-2 {
                0% { transform: translate(0, 0); }
                25% { transform: translate(110px, -90px) rotate(120deg); }
                50% { transform: translate(-100px, 100px) rotate(240deg); }
                75% { transform: translate(90px, -80px) rotate(300deg); }
                100% { transform: translate(0, 0) rotate(360deg); }
            }
            @keyframes bounce-variant-3 {
                0% { transform: translate(0, 0); }
                15% { transform: translate(60px, 80px) rotate(30deg); }
                30% { transform: translate(-80px, 40px) rotate(-60deg); }
                45% { transform: translate(40px, -100px) rotate(100deg); }
                60% { transform: translate(-50px, -50px) rotate(200deg); }
                75% { transform: translate(90px, 20px) rotate(280deg); }
                100% { transform: translate(0, 0) rotate(360deg); }
            }
            @keyframes bounce-variant-4 {
                0% { transform: translate(0, 0); }
                30% { transform: translate(-30px, -120px) rotate(180deg); }
                50% { transform: translate(20px, 80px) rotate(270deg); }
                70% { transform: translate(-40px, -90px) rotate(90deg); }
                100% { transform: translate(0, 0) rotate(0deg); }
            }
            @keyframes bounce-variant-5 {
                0% { transform: translateX(0px) translateY(0px) rotate(0deg); }
                20% { transform: translateX(100px) translateY(50px) rotate(70deg); }
                40% { transform: translateX(0px) translateY(120px) rotate(140deg); }
                60% { transform: translateX(-100px) translateY(50px) rotate(210deg); }
                80% { transform: translateX(0px) translateY(-50px) rotate(280deg); }
                100% { transform: translateX(0px) translateY(0px) rotate(360deg); }
            }
            @keyframes bounce-variant-6 {
                0% { transform: translate(0, 0) rotate(0deg); }
                25% { transform: translate(120px, 20px) rotate(180deg); }
                50% { transform: translate(-110px, -40px) rotate(360deg); }
                75% { transform: translate(90px, 60px) rotate(180deg); }
                100% { transform: translate(0, 0) rotate(0deg); }
            }
            @keyframes bounce-variant-7 {
                0% { transform: translate(0, 0) rotate(0deg); }
                20% { transform: translate(50px, -100px) rotate(45deg); }
                40% { transform: translate(-60px, 80px) rotate(135deg); }
                60% { transform: translate(100px, -50px) rotate(225deg); }
                80% { transform: translate(-80px, -80px) rotate(315deg); }
                100% { transform: translate(0, 0) rotate(360deg); }
            }
            @keyframes bounce-variant-8 {
                0% { transform: translate(0, 0) rotate(0deg); }
                25% { transform: translate(40px, -60px) rotate(90deg); }
                50% { transform: translate(-40px, 60px) rotate(180deg); }
                75% { transform: translate(40px, 60px) rotate(270deg); }
                100% { transform: translate(0, 0) rotate(360deg); }
            }
            @keyframes bounce-variant-9 {
                0% { transform: translate(0, 0) rotate(0deg); }
                25% { transform: translate(70px, -70px) rotate(90deg); }
                50% { transform: translate(0, -130px) rotate(180deg); }
                75% { transform: translate(-70px, -70px) rotate(270deg); }
                100% { transform: translate(0, 0) rotate(360deg); }
            }
            @keyframes shoot-up-tube {
                0% { transform: translateY(100px) scale(0.5); opacity: 0; }
                50% { transform: translateY(-20px) scale(0.9); opacity: 1; }
                100% { transform: translateY(-60px) scale(1); opacity: 1; }
            }
        `;

        // --- App Components ---

        const LottoBall = ({ number, size = 'md', className = '', style = {} }) => {
            const sizeClasses = {
                sm: 'w-8 h-8 text-sm border-2',
                md: 'w-10 h-10 text-base border-4',
                lg: 'w-12 h-12 sm:w-14 sm:h-14 text-xl border-4',
                xl: 'w-16 h-16 text-2xl border-4'
            };

            return (
                <div 
                    className={`${sizeClasses[size]} ${getBallColor(number)} rounded-full flex items-center justify-center font-bold shadow-lg ${className}`}
                    style={style}
                >
                    {number}
                </div>
            );
        };

        const Toast = ({ message, show, onClose }) => {
            React.useEffect(() => {
                if (show) {
                    const timer = setTimeout(onClose, 2000);
                    return () => clearTimeout(timer);
                }
            }, [show, onClose]);

            if (!show) return null;

            return (
                <div className="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-2xl z-50 flex items-center gap-2 animate-fade-in-up">
                    <Sparkles className="w-4 h-4 text-yellow-400" />
                    <span>{message}</span>
                </div>
            );
        };

        const LottoMachine = ({ isRolling, currentDrawingNumber, machineBalls }) => {
            return (
                <div className="relative w-full flex flex-col items-center justify-center py-4">
                    <style>{animationStyles}</style>

                    {/* Top Tube */}
                    <div className="relative z-20 w-16 h-24 -mb-8 overflow-hidden">
                        <div className="absolute inset-x-0 bottom-0 top-0 bg-gradient-to-r from-white/10 via-white/30 to-white/10 border-x border-white/40 rounded-t-lg backdrop-blur-sm"></div>
                        {currentDrawingNumber && (
                            <div className="absolute left-1/2 bottom-0 w-10 h-10 -ml-5 animate-[shoot-up-tube_0.6s_cubic-bezier(0.22,1,0.36,1)_forwards] z-30">
                                <LottoBall number={currentDrawingNumber} size="md" className="shadow-xl" />
                            </div>
                        )}
                    </div>

                    {/* Sphere Body */}
                    <div className="relative w-72 h-72 sm:w-80 sm:h-80 rounded-full border-[8px] border-white/10 shadow-[0_0_50px_rgba(255,255,255,0.1)] overflow-hidden backdrop-blur-sm bg-gradient-to-br from-white/5 to-white/0 flex items-center justify-center z-10">
                        <div className="absolute inset-0 rounded-full shadow-[inset_10px_10px_20px_rgba(255,255,255,0.2),inset_-10px_-10px_30px_rgba(0,0,0,0.2)] pointer-events-none z-30"></div>
                        <div className="absolute top-10 right-10 w-24 h-12 bg-white/20 blur-xl rounded-full transform -rotate-45 pointer-events-none z-30"></div>
                        <div className="absolute bottom-10 left-10 w-32 h-32 bg-indigo-500/10 blur-2xl rounded-full pointer-events-none z-0"></div>

                        <div className={`absolute w-full h-full flex items-center justify-center transition-opacity duration-500 ${isRolling ? 'opacity-30' : 'opacity-0'}`}>
                            <div className="w-20 h-20 border-4 border-white/10 rounded-full animate-[spin_3s_linear_infinite] border-dashed"></div>
                        </div>

                        {/* Balls in Machine */}
                        <div className="relative w-full h-full z-10">
                            {machineBalls.map((ball) => {
                                const animationName = [
                                    'bounce-in-circle', 
                                    'bounce-variant-1', 
                                    'bounce-variant-2', 
                                    'bounce-variant-3',
                                    'bounce-variant-4',
                                    'bounce-variant-5',
                                    'bounce-variant-6',
                                    'bounce-variant-7',
                                    'bounce-variant-8',
                                    'bounce-variant-9'
                                ][ball.variant || 0];
                                
                                return (
                                    <LottoBall
                                        key={ball.id}
                                        number={ball.number}
                                        size="sm"
                                        className={`absolute left-1/2 top-1/2 -ml-4 -mt-4 transition-all ${isRolling ? '' : 'duration-700 ease-out'}`}
                                        style={{
                                            transform: isRolling ? 'none' : `translate(${ball.x}px, ${ball.y}px) rotate(${ball.rotation}deg)`,
                                            animationName: isRolling ? animationName : 'none',
                                            animationDuration: `${ball.duration}s`,
                                            animationTimingFunction: 'ease-in-out',
                                            animationIterationCount: 'infinite',
                                            animationDirection: 'alternate',
                                            animationDelay: `-${ball.delay}s`,
                                            zIndex: Math.floor(Math.random() * 10)
                                        }}
                                    />
                                );
                            })}
                        </div>
                    </div>

                    {/* Bottom Base */}
                    <div className="w-48 h-12 bg-gradient-to-b from-gray-700 to-gray-800 -mt-4 rounded-b-3xl border-t-4 border-gray-600 shadow-xl z-0 flex items-center justify-center">
                        <div className="flex items-center gap-2 text-white/50 text-xs font-bold tracking-widest uppercase">
                            <Wind className={`w-4 h-4 ${isRolling ? 'animate-spin text-blue-400' : ''}`} />
                            Sphere System
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = React.useState(null);
            const [gameCount, setGameCount] = React.useState(1);
            const [finalNumbers, setFinalNumbers] = React.useState([]);
            const [drawnNumbers, setDrawnNumbers] = React.useState([]);
            const [isRolling, setIsRolling] = React.useState(false);
            const [history, setHistory] = React.useState([]);
            const [showHistory, setShowHistory] = React.useState(false);
            const [toast, setToast] = React.useState({ show: false, message: '' });
            const [machineBalls, setMachineBalls] = React.useState([]);
            const [currentDrawingNumber, setCurrentDrawingNumber] = React.useState(null);
            const [currentGameIndex, setCurrentGameIndex] = React.useState(0);

            React.useEffect(() => {
                const initAuth = async () => {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                };
                initAuth();
                const unsubscribe = onAuthStateChanged(auth, setUser);
                return () => unsubscribe();
            }, []);

            React.useEffect(() => {
                if (!user) return;
                const historyRef = collection(db, 'artifacts', appId, 'users', user.uid, 'lotto_history');
                const unsubscribeHistory = onSnapshot(historyRef, (snapshot) => {
                    const loadedHistory = snapshot.docs.map(doc => {
                        const data = doc.data();
                        let parsedNumbers = [];
                        try {
                            parsedNumbers = typeof data.numbers === 'string' ? JSON.parse(data.numbers) : data.numbers;
                        } catch (e) {
                            console.error("Error parsing history numbers:", e);
                            parsedNumbers = [];
                        }
                        return { id: doc.id, ...data, numbers: parsedNumbers };
                    }).sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                    setHistory(loadedHistory);
                }, (error) => console.error("Error loading history:", error));
                return () => unsubscribeHistory();
            }, [user]);

            React.useEffect(() => {
                resetMachineBalls();
            }, []);

            const resetMachineBalls = () => {
                const balls = Array.from({ length: 45 }, (_, i) => {
                    const angle = Math.random() * Math.PI;
                    const radius = Math.random() * 100;
                    const x = (Math.cos(angle) * radius * 0.8) + (Math.random() * 20 - 10);
                    const y = Math.abs(Math.sin(angle) * radius) + 20;
                    return {
                        id: i + 1, number: i + 1, x, y,
                        rotation: Math.random() * 360,
                        delay: Math.random() * 1.5,
                        duration: 0.5 + Math.random() * 0.7,
                        variant: Math.floor(Math.random() * 10)
                    };
                });
                setMachineBalls(balls);
                setDrawnNumbers([]);
                setCurrentDrawingNumber(null);
            };

            const generateSingleSet = () => {
                const numbers = new Set();
                while (numbers.size < 6) {
                    numbers.add(Math.floor(Math.random() * 45) + 1);
                }
                return Array.from(numbers);
            };

            const startDrawProcess = async () => {
                if (isRolling) return;
                setIsRolling(true);
                setFinalNumbers([]);
                setCurrentGameIndex(0);
                resetMachineBalls();

                const allGamesNumbers = Array(gameCount).fill(0).map(() => generateSingleSet());
                
                for (let i = 0; i < gameCount; i++) {
                    setCurrentGameIndex(i);
                    setDrawnNumbers([]);
                    if (i > 0) {
                        setMachineBalls([]);
                        await new Promise(r => setTimeout(r, 50));
                        resetMachineBalls();
                    }
                    await drawSingleGame(allGamesNumbers[i]);
                    if (i < gameCount - 1) {
                        await new Promise(resolve => setTimeout(resolve, 800));
                    }
                }
                finalizeAllGames(allGamesNumbers.map(set => [...set].sort((a, b) => a - b)));
            };

            const drawSingleGame = async (targetNumbers) => {
                setIsRolling(true);
                await new Promise(resolve => setTimeout(resolve, 1200));
                for (let i = 0; i < 6; i++) {
                    const numberToDraw = targetNumbers[i];
                    setMachineBalls(prev => prev.filter(ball => ball.number !== numberToDraw));
                    setCurrentDrawingNumber(numberToDraw);
                    await new Promise(resolve => setTimeout(resolve, 600));
                    setDrawnNumbers(prev => [...prev, numberToDraw]);
                    setCurrentDrawingNumber(null);
                    if (i < 5) await new Promise(resolve => setTimeout(resolve, 300));
                }
                setIsRolling(false);
            };

            const finalizeAllGames = async (sortedNumberSets) => {
                setFinalNumbers(sortedNumberSets);
                setIsRolling(false);
                resetMachineBalls();
                if (user) {
                    try {
                        await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'lotto_history'), {
                            numbers: JSON.stringify(sortedNumberSets),
                            gameCount: gameCount,
                            createdAt: serverTimestamp()
                        });
                        showToast("결과가 저장되었습니다!");
                    } catch (e) {
                        console.error("Save failed", e);
                        showToast("저장에 실패했습니다.");
                    }
                }
            };

            const deleteHistoryItem = async (docId) => {
                if (!user) return;
                try {
                    await deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'lotto_history', docId));
                    showToast("기록이 삭제되었습니다.");
                } catch (e) {
                    showToast("삭제 실패");
                }
            };

            const copyToClipboard = (numberSet) => {
                const text = numberSet.join(',');
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    const successful = document.execCommand('copy');
                    if (successful) showToast(`복사 완료: ${text}`);
                    else showToast('복사 실패');
                } catch (err) {
                    showToast('복사 실패');
                }
                document.body.removeChild(textArea);
            };

            const showToast = (msg) => {
                setToast({ show: true, message: msg });
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 text-white font-sans selection:bg-purple-500 overflow-hidden">
                    <div className="max-w-md mx-auto min-h-screen flex flex-col relative shadow-2xl bg-black/30 border-x border-white/5">
                        
                        {/* Header */}
                        <header className="p-4 flex justify-between items-center bg-black/20 backdrop-blur-md sticky top-0 z-40 border-b border-white/10">
                            <div className="flex items-center gap-2">
                                <div className="w-9 h-9 rounded-full bg-gradient-to-tr from-yellow-400 to-orange-500 flex items-center justify-center font-bold text-black shadow-lg ring-2 ring-orange-400/30">L</div>
                                <h1 className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-yellow-200 to-orange-200">Lotto Sphere</h1>
                            </div>
                            <button onClick={() => setShowHistory(true)} className="p-2 rounded-full hover:bg-white/10 transition-colors relative">
                                <History className="w-6 h-6 text-indigo-200" />
                                {history.length > 0 && <span className="absolute top-1.5 right-1.5 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-slate-900"></span>}
                            </button>
                        </header>

                        {/* Main Game Area */}
                        <main className="flex-1 p-6 flex flex-col items-center gap-6 overflow-y-auto pb-24 scrollbar-hide">
                            <LottoMachine isRolling={isRolling} currentDrawingNumber={currentDrawingNumber} machineBalls={machineBalls} />

                            {/* Drawn Numbers */}
                            <div className="w-full min-h-[120px] bg-white/5 rounded-3xl p-5 border border-white/10 backdrop-blur-md flex flex-col items-center justify-center gap-4 relative shadow-lg">
                                <span className="absolute top-3 left-5 text-xs text-indigo-300 uppercase tracking-widest font-semibold opacity-70">
                                    {isRolling ? `DRAWING GAME ${currentGameIndex + 1}/${gameCount}` : 'RESULTS'}
                                </span>
                                {(isRolling || drawnNumbers.length > 0) && (
                                    <div className="flex gap-2 mt-4 animate-fade-in flex-wrap justify-center">
                                        {drawnNumbers.map((num, i) => (
                                            <LottoBall key={`drawn-${i}`} number={num} size="md" className="animate-[bounce-in_0.5s] shadow-xl ring-2 ring-white/10" />
                                        ))}
                                        {isRolling && [...Array(6 - drawnNumbers.length)].map((_, i) => (
                                            <div key={`empty-${i}`} className="w-10 h-10 rounded-full border-2 border-white/5 border-dashed bg-black/20"></div>
                                        ))}
                                    </div>
                                )}
                                {!isRolling && finalNumbers.length > 0 && (
                                    <div className="w-full flex flex-col gap-3 mt-4 animate-fade-in">
                                        {finalNumbers.map((set, idx) => (
                                            <div key={idx} onClick={() => copyToClipboard(set)} className="bg-black/30 p-2.5 rounded-2xl flex justify-center gap-2 cursor-pointer hover:bg-black/50 active:scale-95 transition-all border border-white/5 hover:border-white/20 group relative">
                                                <span className="absolute left-3 top-1/2 -translate-y-1/2 text-xs text-white/20 font-mono group-hover:text-white/50 transition-colors font-bold">{idx + 1}</span>
                                                {set.map((num, i) => <LottoBall key={i} number={num} size="sm" className="shadow-md" />)}
                                                <Copy className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/10 group-hover:text-white/60 transition-all" />
                                            </div>
                                        ))}
                                    </div>
                                )}
                                {!isRolling && finalNumbers.length === 0 && drawnNumbers.length === 0 && (
                                    <div className="text-center text-white/20 flex flex-col items-center gap-3 mt-2">
                                        <div className="w-12 h-12 rounded-full bg-white/5 flex items-center justify-center"><Trophy className="w-6 h-6 opacity-40" /></div>
                                        <p className="text-sm font-medium">행운을 시험해보세요</p>
                                    </div>
                                )}
                            </div>

                            {/* Controls */}
                            <div className="w-full flex flex-col gap-4 bg-black/20 p-5 rounded-3xl border border-white/5 backdrop-blur-sm">
                                <div className="flex justify-between items-center text-sm text-indigo-200">
                                    <span className="flex items-center gap-2 font-medium"><Settings className="w-4 h-4 opacity-70"/> 게임 수 설정</span>
                                    <span className="font-bold text-white bg-indigo-600/50 px-3 py-1 rounded-full border border-indigo-500/30">{gameCount} SETS</span>
                                </div>
                                <div className="relative pt-2 pb-1">
                                    <input type="range" min="1" max="5" value={gameCount} onChange={(e) => setGameCount(Number(e.target.value))} disabled={isRolling} className="w-full h-2 bg-indigo-950/80 rounded-lg appearance-none cursor-pointer accent-yellow-400 disabled:opacity-50 hover:accent-yellow-300 transition-all" />
                                    <div className="flex justify-between text-[10px] text-white/20 px-1 font-mono mt-2 font-bold">
                                        <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                                    </div>
                                </div>
                            </div>

                            {/* Button */}
                            <button onClick={startDrawProcess} disabled={isRolling} className={`w-full py-4 rounded-2xl font-bold text-lg shadow-xl flex items-center justify-center gap-3 transition-all duration-300 transform active:scale-95 relative overflow-hidden group ${isRolling ? 'bg-gray-800/80 text-gray-500 cursor-not-allowed border border-white/5' : 'bg-gradient-to-r from-yellow-500 to-orange-600 text-white hover:shadow-orange-500/40 hover:from-yellow-400 hover:to-orange-500 border border-orange-400/30'}`}>
                                {!isRolling && <div className="absolute inset-0 bg-gradient-to-tr from-white/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>}
                                {isRolling ? (
                                    <>
                                        <RefreshCw className="w-5 h-5 animate-spin" />
                                        <span className="tracking-widest text-sm">추첨 진행 중...</span>
                                    </>
                                ) : (
                                    <>
                                        <Wind className="w-5 h-5 group-hover:animate-pulse" />
                                        <span className="tracking-widest">START DRAW</span>
                                    </>
                                )}
                            </button>
                        </main>

                        {/* History Modal */}
                        {showHistory && (
                            <div className="absolute inset-0 z-50 bg-slate-950/95 backdrop-blur-xl flex flex-col animate-fade-in">
                                <div className="p-5 border-b border-white/10 flex justify-between items-center bg-slate-900/50">
                                    <h2 className="text-lg font-bold flex items-center gap-2 text-white"><History className="w-5 h-5 text-yellow-400" /> History</h2>
                                    <button onClick={() => setShowHistory(false)} className="p-2 hover:bg-white/10 rounded-full transition-colors text-white/50 hover:text-white"><X className="w-6 h-6" /></button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-4 space-y-4 scrollbar-hide">
                                    {history.length === 0 ? (
                                        <div className="h-full flex flex-col items-center justify-center text-white/20 gap-4">
                                            <div className="w-16 h-16 rounded-full bg-white/5 flex items-center justify-center"><History className="w-8 h-8 opacity-40" /></div>
                                            <p className="text-sm">기록이 없습니다</p>
                                        </div>
                                    ) : (
                                        history.map((item) => (
                                            <div key={item.id} className="bg-white/5 rounded-2xl p-4 border border-white/5 space-y-3 animate-fade-in-up hover:border-white/10 transition-colors">
                                                <div className="flex justify-between items-center text-xs text-indigo-300/70 mb-2 border-b border-white/5 pb-2">
                                                    <span className="flex items-center gap-1.5 font-mono"><Sparkles className="w-3 h-3 text-yellow-500/50"/> {item.createdAt?.toDate().toLocaleDateString()} {item.createdAt?.toDate().toLocaleTimeString()}</span>
                                                    <button onClick={() => deleteHistoryItem(item.id)} className="text-red-400/60 hover:text-red-400 p-1.5 hover:bg-red-400/10 rounded-md transition-all"><Trash2 className="w-4 h-4" /></button>
                                                </div>
                                                {item.numbers.map((set, idx) => (
                                                    <div key={idx} onClick={() => copyToClipboard(set)} className="flex items-center gap-3 cursor-pointer hover:bg-white/5 p-2 rounded-xl transition-colors group">
                                                        <span className="text-[10px] text-white/20 w-4 font-bold flex justify-center">{idx + 1}</span>
                                                        <div className="flex gap-2 flex-1 justify-start">
                                                            {set.map(num => <LottoBall key={num} number={num} size="sm" className="w-7 h-7 text-xs border-2 shadow-sm" />)}
                                                        </div>
                                                        <Copy className="w-3.5 h-3.5 text-white/5 group-hover:text-white/40 transition-colors" />
                                                    </div>
                                                ))}
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        )}

                        <Toast show={toast.show} message={toast.message} onClose={() => setToast(prev => ({ ...prev, show: false }))} />
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
