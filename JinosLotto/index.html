<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ì§€ë…¸ìŠ¤ ë¡œë˜ ì¶”ì¶œê¸°</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1055/1055658.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <!-- Custom Styles -->
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #0f172a; overflow: hidden; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .no-select { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        
        .receipt-pattern {
            background-image: radial-gradient(currentColor 0.5px, transparent 0.5px);
            background-size: 8px 8px;
        }
        .ticket-zigzag {
            background: linear-gradient(45deg, transparent 33.333%, currentColor 33.333%, currentColor 66.667%, transparent 66.667%), linear-gradient(-45deg, transparent 33.333%, currentColor 33.333%, currentColor 66.667%, transparent 66.667%);
            background-size: 10px 20px;
            height: 10px;
        }
    </style>
</head>
<body>
    <div id="root" style="height: 100%;"></div>

    <script type="text/babel" data-type="module">
        // --- Icon Components ---
        const IconBase = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Trash2 = (p) => <IconBase {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></IconBase>;
        const Copy = (p) => <IconBase {...p}><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></IconBase>;
        const History = (p) => <IconBase {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/><path d="M12 7v5l4 2"/></IconBase>;
        const RefreshCw = (p) => <IconBase {...p}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>;
        const Settings = (p) => <IconBase {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconBase>;
        const Save = (p) => <IconBase {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconBase>;
        const X = (p) => <IconBase {...p}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconBase>;
        const Trophy = (p) => <IconBase {...p}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 1 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></IconBase>;
        const Sparkles = (p) => <IconBase {...p}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 9h4"/><path d="M3 5h4"/></IconBase>;
        const Wind = (p) => <IconBase {...p}><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></IconBase>;
        const Zap = (p) => <IconBase {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></IconBase>;
        const ShareIcon = (p) => <IconBase {...p}><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></IconBase>;
        const Volume2 = (p) => <IconBase {...p}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></IconBase>;
        const VolumeX = (p) => <IconBase {...p}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></IconBase>;
        const Smartphone = (p) => <IconBase {...p}><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></IconBase>;
        const Palette = (p) => <IconBase {...p}><circle cx="13.5" cy="6.5" r=".5"/><circle cx="17.5" cy="10.5" r=".5"/><circle cx="8.5" cy="7.5" r=".5"/><circle cx="6.5" cy="12.5" r=".5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></IconBase>;
        const BarChart = (p) => <IconBase {...p}><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></IconBase>;
        const RotateCcw = (p) => <IconBase {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/></IconBase>;
        const Target = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></IconBase>;
        const Check = (p) => <IconBase {...p}><polyline points="20 6 9 17 4 12"/></IconBase>;
        const Ban = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></IconBase>;
        const FileDown = (p) => <IconBase {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></IconBase>;
        const Receipt = (p) => <IconBase {...p}><path d="M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z"/><line x1="16" y1="8" x2="8" y2="8"/><line x1="16" y1="12" x2="8" y2="12"/><line x1="16" y1="16" x2="10" y2="16"/></IconBase>;
        const Mic = (p) => <IconBase {...p}><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></IconBase>;
        const MicOff = (p) => <IconBase {...p}><line x1="1" y1="1" x2="23" y2="23"/><path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"/><path d="M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></IconBase>;
        const Award = (p) => <IconBase {...p}><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></IconBase>;
        const Download = (p) => <IconBase {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></IconBase>;
        const Moon = (p) => <IconBase {...p}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></IconBase>;
        const Cloud = (p) => <IconBase {...p}><path d="M17.5 19c0-3.037-2.463-5.5-5.5-5.5S6.5 15.963 6.5 19"/><path d="M12 13.5v-3"/></IconBase>;

        // --- Sound Manager & TTS ---
        const SoundManager = {
            ctx: null,
            init: function() {
                if (!this.ctx) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (this.ctx.state === 'suspended') this.ctx.resume();
            },
            playPop: function() {
                if (!this.ctx) return;
                const t = this.ctx.currentTime;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, t);
                osc.frequency.linearRampToValueAtTime(800, t + 0.1);
                gain.gain.setValueAtTime(0, t);
                gain.gain.linearRampToValueAtTime(0.3, t + 0.02);
                gain.gain.linearRampToValueAtTime(0.01, t + 0.1);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start(t);
                osc.stop(t + 0.1);
            },
            playWin: function() {
                if (!this.ctx) return;
                const now = this.ctx.currentTime;
                [523.25, 659.25, 783.99].forEach((freq, i) => {
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.type = 'triangle';
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(0, now + i * 0.1);
                    gain.gain.linearRampToValueAtTime(0.2, now + i * 0.1 + 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.1 + 0.8);
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start(now + i * 0.1);
                    osc.stop(now + i * 0.1 + 0.8);
                });
            },
            speak: function(text) {
                if (!window.speechSynthesis) return;
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ko-KR';
                utterance.rate = 1.0;
                window.speechSynthesis.speak(utterance);
            }
        };

        // --- Firebase Config & Setup ---
        const defaultFirebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : defaultFirebaseConfig;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        
        let app, auth, db;
        let isFirebaseAvailable = false;

        try {
            if (firebaseConfig.apiKey !== "YOUR_API_KEY") {
                import("https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js").then(mod => {
                     app = mod.initializeApp(firebaseConfig);
                     import("https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js").then(authMod => {
                         auth = authMod.getAuth(app);
                     });
                     import("https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js").then(fsMod => {
                         db = fsMod.getFirestore(app);
                         isFirebaseAvailable = true;
                     });
                });
            } else {
                console.warn("Firebase Configê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì €ì¥ ê¸°ëŠ¥ì´ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.");
            }
        } catch (e) {
            console.error("Firebase Init Error:", e);
        }

        // --- Themes ---
        const THEMES = {
            classic: {
                name: 'ë¯¸ë“œë‚˜ì‡',
                ui: {
                    bg: 'bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900',
                    panel: 'bg-black/30 border-white/10',
                    text: 'text-indigo-200',
                    accent: 'text-yellow-400',
                    highlight: 'bg-indigo-600/50',
                    button: 'bg-indigo-500 hover:bg-indigo-400',
                    receipt: 'bg-white text-slate-900'
                },
                balls: {
                    yellow: 'bg-yellow-400 text-yellow-900 border-yellow-500 shadow-[inset_-2px_-2px_6px_rgba(0,0,0,0.2),0_4px_6px_-1px_rgba(0,0,0,0.3)]',
                    blue: 'bg-blue-500 text-white border-blue-600 shadow-[inset_-2px_-2px_6px_rgba(0,0,0,0.2),0_4px_6px_-1px_rgba(0,0,0,0.3)]',
                    red: 'bg-red-500 text-white border-red-600 shadow-[inset_-2px_-2px_6px_rgba(0,0,0,0.2),0_4px_6px_-1px_rgba(0,0,0,0.3)]',
                    gray: 'bg-gray-500 text-white border-gray-600 shadow-[inset_-2px_-2px_6px_rgba(0,0,0,0.2),0_4px_6px_-1px_rgba(0,0,0,0.3)]',
                    green: 'bg-green-500 text-white border-green-600 shadow-[inset_-2px_-2px_6px_rgba(0,0,0,0.2),0_4px_6px_-1px_rgba(0,0,0,0.3)]'
                }
            },
            forest: {
                name: 'í¬ë ˆìŠ¤íŠ¸',
                ui: {
                    bg: 'bg-gradient-to-br from-green-900 via-emerald-900 to-teal-950',
                    panel: 'bg-black/20 border-emerald-500/20',
                    text: 'text-emerald-200',
                    accent: 'text-amber-300',
                    highlight: 'bg-emerald-600/50',
                    button: 'bg-emerald-600 hover:bg-emerald-500',
                    receipt: 'bg-[#f0fdf4] text-emerald-900'
                },
                balls: {
                    yellow: 'bg-amber-400 text-amber-900 border-amber-500 shadow-lg',
                    blue: 'bg-teal-500 text-white border-teal-600 shadow-lg',
                    red: 'bg-rose-500 text-white border-rose-600 shadow-lg',
                    gray: 'bg-slate-500 text-white border-slate-600 shadow-lg',
                    green: 'bg-lime-500 text-white border-lime-600 shadow-lg'
                }
            },
            ocean: {
                name: 'ì˜¤ì…˜',
                ui: {
                    bg: 'bg-gradient-to-br from-blue-900 via-cyan-900 to-sky-950',
                    panel: 'bg-black/20 border-cyan-500/20',
                    text: 'text-cyan-200',
                    accent: 'text-white',
                    highlight: 'bg-cyan-600/50',
                    button: 'bg-cyan-600 hover:bg-cyan-500',
                    receipt: 'bg-[#f0f9ff] text-blue-900'
                },
                balls: {
                    yellow: 'bg-yellow-300 text-blue-900 border-yellow-400 shadow-[0_0_10px_rgba(253,224,71,0.5)]',
                    blue: 'bg-cyan-400 text-blue-900 border-cyan-500 shadow-[0_0_10px_rgba(34,211,238,0.5)]',
                    red: 'bg-pink-500 text-white border-pink-600 shadow-[0_0_10px_rgba(236,72,153,0.5)]',
                    gray: 'bg-slate-400 text-slate-900 border-slate-500 shadow-[0_0_10px_rgba(148,163,184,0.5)]',
                    green: 'bg-teal-400 text-teal-900 border-teal-500 shadow-[0_0_10px_rgba(45,212,191,0.5)]'
                }
            },
            sunset: {
                name: 'ì„ ì…‹',
                ui: {
                    bg: 'bg-gradient-to-br from-rose-900 via-orange-900 to-purple-950',
                    panel: 'bg-black/20 border-orange-500/20',
                    text: 'text-orange-200',
                    accent: 'text-yellow-300',
                    highlight: 'bg-orange-600/50',
                    button: 'bg-gradient-to-r from-orange-500 to-rose-500 hover:from-orange-400 hover:to-rose-400',
                    receipt: 'bg-[#fff7ed] text-orange-900'
                },
                balls: {
                    yellow: 'bg-yellow-500 text-white border-yellow-600 shadow-md',
                    blue: 'bg-blue-600 text-white border-blue-700 shadow-md',
                    red: 'bg-red-600 text-white border-red-700 shadow-md',
                    gray: 'bg-gray-600 text-white border-gray-700 shadow-md',
                    green: 'bg-green-600 text-white border-green-700 shadow-md'
                }
            },
            mono: {
                name: 'ëª¨ë…¸',
                ui: {
                    bg: 'bg-gradient-to-br from-gray-900 via-gray-800 to-black',
                    panel: 'bg-white/10 border-white/20',
                    text: 'text-gray-300',
                    accent: 'text-white',
                    highlight: 'bg-white/20',
                    button: 'bg-white text-black hover:bg-gray-200',
                    receipt: 'bg-white text-black border-2 border-black'
                },
                balls: {
                    yellow: 'bg-transparent text-white border-2 border-white',
                    blue: 'bg-transparent text-white border-2 border-white',
                    red: 'bg-transparent text-white border-2 border-white',
                    gray: 'bg-transparent text-white border-2 border-white',
                    green: 'bg-transparent text-white border-2 border-white'
                }
            }
        };

        const getBallColor = (num, theme = 'classic') => {
            const colors = THEMES[theme].balls;
            if (num <= 10) return colors.yellow;
            if (num <= 20) return colors.blue;
            if (num <= 30) return colors.red;
            if (num <= 40) return colors.gray;
            return colors.green;
        };

        const animationStyles = `
            @keyframes bounce-in-circle { 0% { transform: translate(0, 0) rotate(0deg); } 25% { transform: translate(100px, -60px) rotate(90deg); } 50% { transform: translate(20px, 80px) rotate(180deg); } 75% { transform: translate(-100px, -20px) rotate(270deg); } 100% { transform: translate(0, 0) rotate(360deg); } }
            @keyframes bounce-variant-1 { 0% { transform: translate(0, 0); } 20% { transform: translate(-90px, -110px) rotate(-45deg); } 40% { transform: translate(80px, -40px) rotate(90deg); } 60% { transform: translate(-60px, 90px) rotate(180deg); } 80% { transform: translate(100px, 50px) rotate(270deg); } 100% { transform: translate(0, 0) rotate(360deg); } }
            @keyframes bounce-variant-2 { 0% { transform: translate(0, 0); } 25% { transform: translate(110px, -90px) rotate(120deg); } 50% { transform: translate(-100px, 100px) rotate(240deg); } 75% { transform: translate(90px, -80px) rotate(300deg); } 100% { transform: translate(0, 0) rotate(360deg); } }
            @keyframes bounce-variant-3 { 0% { transform: translate(0, 0); } 15% { transform: translate(60px, 80px) rotate(30deg); } 30% { transform: translate(-80px, 40px) rotate(-60deg); } 45% { transform: translate(40px, -100px) rotate(100deg); } 60% { transform: translate(-50px, -50px) rotate(200deg); } 75% { transform: translate(90px, 20px) rotate(280deg); } 100% { transform: translate(0, 0) rotate(360deg); } }
            @keyframes bounce-variant-4 { 0% { transform: translate(0, 0); } 30% { transform: translate(-30px, -120px) rotate(180deg); } 50% { transform: translate(20px, 80px) rotate(270deg); } 70% { transform: translate(-40px, -90px) rotate(90deg); } 100% { transform: translate(0, 0) rotate(0deg); } }
            @keyframes bounce-variant-5 { 0% { transform: translateX(0px) translateY(0px) rotate(0deg); } 20% { transform: translateX(100px) translateY(50px) rotate(70deg); } 40% { transform: translateX(0px) translateY(120px) rotate(140deg); } 60% { transform: translateX(-100px) translateY(50px) rotate(210deg); } 80% { transform: translateX(0px) translateY(-50px) rotate(280deg); } 100% { transform: translateX(0px) translateY(0px) rotate(360deg); } }
            @keyframes bounce-variant-6 { 0% { transform: translate(0, 0) rotate(0deg); } 25% { transform: translate(120px, 20px) rotate(180deg); } 50% { transform: translate(-110px, -40px) rotate(360deg); } 75% { transform: translate(90px, 60px) rotate(180deg); } 100% { transform: translate(0, 0) rotate(0deg); } }
            @keyframes bounce-variant-7 { 0% { transform: translate(0, 0) rotate(0deg); } 20% { transform: translate(50px, -100px) rotate(45deg); } 40% { transform: translate(-60px, 80px) rotate(135deg); } 60% { transform: translate(100px, -50px) rotate(225deg); } 80% { transform: translate(-80px, -80px) rotate(315deg); } 100% { transform: translate(0, 0) rotate(360deg); } }
            @keyframes bounce-variant-8 { 0% { transform: translate(0, 0) rotate(0deg); } 25% { transform: translate(40px, -60px) rotate(90deg); } 50% { transform: translate(-40px, 60px) rotate(180deg); } 75% { transform: translate(40px, 60px) rotate(270deg); } 100% { transform: translate(0, 0) rotate(360deg); } }
            @keyframes bounce-variant-9 { 0% { transform: translate(0, 0) rotate(0deg); } 25% { transform: translate(70px, -70px) rotate(90deg); } 50% { transform: translate(0, -130px) rotate(180deg); } 75% { transform: translate(-70px, -70px) rotate(270deg); } 100% { transform: translate(0, 0) rotate(360deg); } }
            @keyframes shoot-up-tube { 0% { transform: translateY(100px) scale(0.5); opacity: 0; } 50% { transform: translateY(-20px) scale(0.9); opacity: 1; } 100% { transform: translateY(-60px) scale(1); opacity: 1; } }
            @keyframes ball-glow { 0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); } 50% { box-shadow: 0 0 20px 10px rgba(255, 255, 255, 0.5); } 100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); } }
            @keyframes shake-machine { 0% { transform: rotate(0deg) scale(1); } 25% { transform: rotate(-3deg) scale(1.02); } 50% { transform: rotate(3deg) scale(1.02); } 75% { transform: rotate(-1deg) scale(1.02); } 100% { transform: rotate(0deg) scale(1); } }
        `;

        // --- Components ---

        const LottoBall = ({ number, size = 'md', className = '', style = {}, theme = 'classic' }) => {
            const sizeClasses = {
                sm: 'w-8 h-8 text-sm border-2',
                md: 'w-10 h-10 text-base border-4',
                lg: 'w-12 h-12 sm:w-14 sm:h-14 text-xl border-4',
                xl: 'w-16 h-16 text-2xl border-4'
            };

            return (
                <div 
                    className={`${sizeClasses[size]} ${getBallColor(number, theme)} rounded-full flex items-center justify-center font-bold shadow-lg ${className}`}
                    style={style}
                >
                    {number}
                </div>
            );
        };

        const Toast = ({ message, show, onClose }) => {
            React.useEffect(() => {
                if (show) {
                    const timer = setTimeout(onClose, 2000);
                    return () => clearTimeout(timer);
                }
            }, [show, onClose]);

            if (!show) return null;

            return (
                <div className="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-2xl z-50 flex items-center gap-2 animate-fade-in-up pointer-events-none whitespace-nowrap">
                    <Sparkles className="w-4 h-4 text-yellow-400" />
                    <span>{message}</span>
                </div>
            );
        };

        const DreamModal = ({ show, onClose, theme, onApply }) => {
            const [keyword, setKeyword] = React.useState('');
            const ui = THEMES[theme].ui;

            if (!show) return null;

            const handleDream = () => {
                if (!keyword.trim()) {
                    alert('ê¿ˆ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    return;
                }
                
                // Simple hash based generator from string
                let hash = 0;
                for (let i = 0; i < keyword.length; i++) {
                    hash = ((hash << 5) - hash) + keyword.charCodeAt(i);
                    hash |= 0;
                }
                
                // Generate 6 unique numbers based on hash
                const nums = new Set();
                let seed = Math.abs(hash);
                while (nums.size < 6) {
                    seed = (seed * 9301 + 49297) % 233280;
                    const num = (Math.floor(seed / 233280 * 45) + 1);
                    nums.add(num);
                }
                const result = Array.from(nums).sort((a,b) => a-b);
                onApply(result);
                onClose();
            };

            return (
                <div className="absolute inset-0 z-50 bg-slate-950/95 backdrop-blur-xl flex flex-col animate-fade-in justify-center p-6">
                    <div className={`p-6 rounded-3xl border flex flex-col gap-4 ${ui.panel}`}>
                        <div className="flex justify-between items-center">
                            <h2 className={`text-xl font-bold flex items-center gap-2 ${ui.text}`}><Moon className={`w-6 h-6 ${ui.accent}`} /> ë“œë¦¼ ëª¨ë“œ</h2>
                            <button onClick={onClose} className={`p-2 rounded-full hover:bg-white/10 ${ui.text}`}><X className="w-6 h-6" /></button>
                        </div>
                        <p className={`text-sm opacity-70 ${ui.text}`}>ì–´ì ¯ë°¤ ê¾¸ì—ˆë˜ ê¿ˆì´ë‚˜ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”. í–‰ìš´ì˜ ë²ˆí˜¸ë¡œ í•´ì„í•´ë“œë¦½ë‹ˆë‹¤.</p>
                        <input 
                            type="text" 
                            value={keyword}
                            onChange={(e) => setKeyword(e.target.value)}
                            className="w-full p-4 rounded-xl bg-black/30 border border-white/10 text-white focus:outline-none focus:border-white/30"
                            placeholder="ì˜ˆ: ë¼ì§€, ì¡°ìƒë‹˜, ë˜¥..."
                            onKeyDown={(e) => e.key === 'Enter' && handleDream()}
                        />
                        <button 
                            onClick={handleDream}
                            className={`w-full py-4 rounded-xl font-bold text-lg shadow-lg ${ui.button} text-white`}
                        >
                            ë²ˆí˜¸ ì¶”ì¶œí•˜ê¸°
                        </button>
                    </div>
                </div>
            );
        };

        const WinCheckModal = ({ show, onClose, history, theme }) => {
            const [winningNumbers, setWinningNumbers] = React.useState(['', '', '', '', '', '']);
            const [bonusNumber, setBonusNumber] = React.useState('');
            const [results, setResults] = React.useState(null);
            const ui = THEMES[theme].ui;

            if (!show) return null;

            const handleInputChange = (index, value) => {
                const newNumbers = [...winningNumbers];
                newNumbers[index] = value;
                setWinningNumbers(newNumbers);
            };

            const checkWin = () => {
                const winNums = winningNumbers.map(n => parseInt(n)).filter(n => !isNaN(n));
                const bonus = parseInt(bonusNumber);
                
                if (winNums.length !== 6 || isNaN(bonus)) {
                    alert("ë‹¹ì²¨ ë²ˆí˜¸ 6ê°œì™€ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    return;
                }

                const winResults = [];
                history.forEach(item => {
                    item.numbers.forEach(set => {
                        const matchCount = set.filter(n => winNums.includes(n)).length;
                        const hasBonus = set.includes(bonus);
                        let rank = 0;

                        if (matchCount === 6) rank = 1;
                        else if (matchCount === 5 && hasBonus) rank = 2;
                        else if (matchCount === 5) rank = 3;
                        else if (matchCount === 4) rank = 4;
                        else if (matchCount === 3) rank = 5;

                        if (rank > 0) {
                            winResults.push({ rank, set, date: item.createdAt });
                        }
                    });
                });

                // Sort by rank (1st place first)
                winResults.sort((a, b) => a.rank - b.rank);
                setResults(winResults);
            };

            return (
                <div className="absolute inset-0 z-50 bg-slate-950/95 backdrop-blur-xl flex flex-col animate-fade-in">
                    <div className={`p-5 border-b flex justify-between items-center shrink-0 ${ui.panel}`}>
                        <h2 className={`text-lg font-bold flex items-center gap-2 ${ui.text}`}><Award className="w-5 h-5 text-yellow-400" /> ë‹¹ì²¨ í™•ì¸</h2>
                        <button onClick={onClose} className={`p-2 rounded-full transition-colors opacity-70 hover:opacity-100 ${ui.text}`}><X className="w-6 h-6" /></button>
                    </div>
                    <div className="flex-1 overflow-y-auto p-4 scrollbar-hide">
                        {/* Input Area */}
                        <div className="bg-white/5 p-4 rounded-2xl mb-4 border border-white/10">
                            <h3 className={`text-sm mb-2 text-center opacity-80 ${ui.text}`}>ì´ë²ˆ ì£¼ ë‹¹ì²¨ ë²ˆí˜¸ ì…ë ¥</h3>
                            <div className="flex justify-center gap-1 mb-2">
                                {winningNumbers.map((num, i) => (
                                    <input 
                                        key={i} 
                                        type="number" 
                                        value={num} 
                                        onChange={(e) => handleInputChange(i, e.target.value)}
                                        className="w-10 h-10 bg-white/10 text-center rounded-lg text-white font-bold outline-none focus:ring-2 focus:ring-yellow-400"
                                    />
                                ))}
                                <span className="flex items-center text-white/50">+</span>
                                <input 
                                    type="number" 
                                    value={bonusNumber} 
                                    onChange={(e) => setBonusNumber(e.target.value)}
                                    className="w-10 h-10 bg-white/10 text-center rounded-lg text-yellow-300 font-bold outline-none focus:ring-2 focus:ring-yellow-400"
                                    placeholder="B"
                                />
                            </div>
                            <button onClick={checkWin} className={`w-full py-2 rounded-xl font-bold mt-2 transition-colors ${ui.button} text-white`}>í™•ì¸í•˜ê¸°</button>
                        </div>

                        {/* Results Area */}
                        {results && (
                            <div className="space-y-3">
                                {results.length === 0 ? (
                                    <div className="text-center py-10 opacity-50 text-white">ë‹¹ì²¨ëœ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ˜­</div>
                                ) : (
                                    results.map((res, idx) => (
                                        <div key={idx} className={`p-3 rounded-xl border border-white/10 flex justify-between items-center ${ui.panel}`}>
                                            <div className="flex flex-col gap-1">
                                                <span className={`text-xs font-bold ${res.rank <= 3 ? 'text-yellow-400' : 'text-white'}`}>{res.rank}ë“± ë‹¹ì²¨!</span>
                                                <div className="flex gap-1">
                                                    {res.set.map(n => <span key={n} className="text-xs text-white/70">{n}</span>)}
                                                </div>
                                                <span className="text-[10px] text-white/30">{new Date(res.date).toLocaleDateString()}</span>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const StrategyModal = ({ show, onClose, fixedNumbers, setFixedNumbers, excludedNumbers, setExcludedNumbers, theme }) => {
            if (!show) return null;
            const ui = THEMES[theme].ui;

            const toggleNumber = (num) => {
                if (fixedNumbers.includes(num)) {
                    setFixedNumbers(prev => prev.filter(n => n !== num));
                    setExcludedNumbers(prev => [...prev, num]);
                } else if (excludedNumbers.includes(num)) {
                    setExcludedNumbers(prev => prev.filter(n => n !== num));
                } else {
                    if (fixedNumbers.length >= 5) {
                        alert("ê³ ì •ìˆ˜ëŠ” ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ ì„¤ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                        return;
                    }
                    setFixedNumbers(prev => [...prev, num]);
                }
            };

            const getStatusColor = (num) => {
                if (fixedNumbers.includes(num)) return 'ring-4 ring-green-500 scale-110 z-10';
                if (excludedNumbers.includes(num)) return 'ring-4 ring-red-500 opacity-50 grayscale';
                return '';
            };

            const getStatusIcon = (num) => {
                if (fixedNumbers.includes(num)) return <div className="absolute -top-1 -right-1 bg-green-500 rounded-full p-0.5"><Check className="w-3 h-3 text-black"/></div>;
                if (excludedNumbers.includes(num)) return <div className="absolute -top-1 -right-1 bg-red-500 rounded-full p-0.5"><X className="w-3 h-3 text-white"/></div>;
                return null;
            };

            return (
                <div className="absolute inset-0 z-50 bg-slate-950/95 backdrop-blur-xl flex flex-col animate-fade-in">
                    <div className={`p-5 border-b flex justify-between items-center shrink-0 ${ui.panel}`}>
                        <h2 className={`text-lg font-bold flex items-center gap-2 ${ui.text}`}><Target className="w-5 h-5" /> ì „ëµ ì„¤ì •</h2>
                        <button onClick={onClose} className={`p-2 rounded-full transition-colors opacity-70 hover:opacity-100 ${ui.text}`}><X className="w-6 h-6" /></button>
                    </div>
                    <div className="flex-1 overflow-y-auto p-4 scrollbar-hide">
                        <div className="mb-4 text-center text-sm opacity-70 space-y-1" style={{color: 'white'}}>
                            <p>ë²ˆí˜¸ë¥¼ í„°ì¹˜í•˜ì—¬ ìƒíƒœë¥¼ ë³€ê²½í•˜ì„¸ìš”.</p>
                            <div className="flex justify-center gap-4 text-xs">
                                <span className="flex items-center gap-1"><span className="w-3 h-3 rounded-full bg-green-500"></span> ê³ ì •ìˆ˜</span>
                                <span className="flex items-center gap-1"><span className="w-3 h-3 rounded-full bg-red-500"></span> ì œì™¸ìˆ˜</span>
                            </div>
                        </div>
                        <div className="grid grid-cols-5 gap-3 max-w-sm mx-auto">
                            {Array.from({length: 45}, (_, i) => i + 1).map(num => (
                                <div key={num} className="relative cursor-pointer" onClick={() => toggleNumber(num)}>
                                    <LottoBall number={num} size="sm" theme={theme} className={`w-12 h-12 text-lg transition-all duration-200 ${getStatusColor(num)}`} />
                                    {getStatusIcon(num)}
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className={`p-4 border-t ${ui.panel}`}>
                        <button onClick={() => { setFixedNumbers([]); setExcludedNumbers([]); }} className={`w-full py-3 rounded-xl font-bold transition-colors ${ui.button} text-white opacity-90 hover:opacity-100`}>
                            ì´ˆê¸°í™”
                        </button>
                    </div>
                </div>
            );
        };

        const LottoMachine = ({ isRolling, currentDrawingNumber, machineBalls, theme, onMix }) => {
            return (
                <div 
                    className="relative w-full flex flex-col items-center justify-center py-4 shrink-0 no-select cursor-pointer active:scale-95 transition-transform"
                    onClick={onMix}
                >
                    <style>{animationStyles}</style>

                    <div className="relative z-20 w-16 h-24 -mb-8 overflow-hidden">
                        <div className="absolute inset-x-0 bottom-0 top-0 bg-gradient-to-r from-white/10 via-white/30 to-white/10 border-x border-white/40 rounded-t-lg backdrop-blur-sm"></div>
                        {currentDrawingNumber && (
                            <div className="absolute left-1/2 bottom-0 w-10 h-10 -ml-5 animate-[shoot-up-tube_0.6s_cubic-bezier(0.22,1,0.36,1)_forwards] z-30">
                                <LottoBall number={currentDrawingNumber} size="md" className="shadow-xl" theme={theme} style={{ animation: 'ball-glow 0.6s ease-out' }} />
                            </div>
                        )}
                    </div>

                    <div className={`relative w-64 h-64 sm:w-72 sm:h-72 rounded-full border-[8px] border-white/10 shadow-[0_0_50px_rgba(255,255,255,0.1)] overflow-hidden backdrop-blur-sm bg-gradient-to-br from-white/5 to-white/0 flex items-center justify-center z-10 transition-all duration-300 ${isRolling ? 'animate-[shake-machine_0.5s_linear_infinite]' : ''}`}>
                        <div className="absolute inset-0 rounded-full shadow-[inset_10px_10px_20px_rgba(255,255,255,0.2),inset_-10px_-10px_30px_rgba(0,0,0,0.2)] pointer-events-none z-30"></div>
                        <div className="absolute top-10 right-10 w-24 h-12 bg-white/20 blur-xl rounded-full transform -rotate-45 pointer-events-none z-30"></div>
                        <div className="absolute bottom-10 left-10 w-32 h-32 bg-indigo-500/10 blur-2xl rounded-full pointer-events-none z-0"></div>

                        <div className={`absolute w-full h-full flex items-center justify-center transition-opacity duration-500 ${isRolling ? 'opacity-30' : 'opacity-0'}`}>
                            <div className="w-20 h-20 border-4 border-white/10 rounded-full animate-[spin_3s_linear_infinite] border-dashed"></div>
                        </div>

                        <div className="relative w-full h-full z-10">
                            {machineBalls.map((ball) => {
                                const animationName = [
                                    'bounce-in-circle', 'bounce-variant-1', 'bounce-variant-2', 'bounce-variant-3',
                                    'bounce-variant-4', 'bounce-variant-5', 'bounce-variant-6', 'bounce-variant-7',
                                    'bounce-variant-8', 'bounce-variant-9'
                                ][ball.variant || 0];
                                
                                return (
                                    <LottoBall
                                        key={ball.id}
                                        number={ball.number}
                                        size="sm"
                                        theme={theme}
                                        className={`absolute left-1/2 top-1/2 -ml-4 -mt-4 transition-all ${isRolling ? '' : 'duration-700 ease-out'}`}
                                        style={{
                                            transform: isRolling ? 'none' : `translate(${ball.x}px, ${ball.y}px) rotate(${ball.rotation}deg)`,
                                            animationName: isRolling ? animationName : 'none',
                                            animationDuration: `${ball.duration}s`,
                                            animationTimingFunction: 'ease-in-out',
                                            animationIterationCount: 'infinite',
                                            animationDirection: 'alternate',
                                            animationDelay: `-${ball.delay}s`,
                                            zIndex: Math.floor(Math.random() * 10)
                                        }}
                                    />
                                );
                            })}
                        </div>
                    </div>

                    <div className="w-48 h-12 bg-gradient-to-b from-gray-700 to-gray-800 -mt-4 rounded-b-3xl border-t-4 border-gray-600 shadow-xl z-0 flex items-center justify-center">
                        <div className="flex items-center gap-2 text-white/50 text-xs font-bold tracking-widest uppercase">
                            <Wind className={`w-4 h-4 ${isRolling ? 'animate-spin text-blue-400' : ''}`} />
                            Ginos System
                        </div>
                    </div>
                </div>
            );
        };

        const StatsView = ({ history, theme, onCopy, onShare, showHeatmap, setShowHeatmap, onWinCheck }) => {
            const ui = THEMES[theme].ui;
            const getFrequentNumbers = () => {
                const counts = {};
                history.forEach(item => {
                    item.numbers.flat().forEach(num => {
                        counts[num] = (counts[num] || 0) + 1;
                    });
                });
                return Object.entries(counts)
                    .sort((a, b) => b[1] - a[1])
                    .map(([num, count]) => ({ num: parseInt(num), count }));
            };

            const frequentNumbers = getFrequentNumbers();
            const topNumbers = frequentNumbers.slice(0, 6);
            const topNumbersSet = topNumbers.map(item => item.num).sort((a, b) => a - b);
            const allCountsVal = Object.values(frequentNumbers.reduce((acc, cur) => ({...acc, [cur.num]: cur.count}), {}));
            const maxCount = Math.max(...allCountsVal, 1);
            const minCount = Math.min(...allCountsVal, 0);
            const countsMap = {};
            frequentNumbers.forEach(item => countsMap[item.num] = item.count);

            const getHeatmapColor = (count, min, max) => {
                if (max === min) return 'bg-white/5 text-white/30';
                const ratio = (count - min) / (max - min);
                if (ratio >= 0.9) return 'bg-red-600 text-white font-bold shadow-md shadow-red-500/50';
                if (ratio >= 0.75) return 'bg-orange-500 text-white'; 
                if (ratio >= 0.5) return 'bg-yellow-500 text-black';
                if (ratio >= 0.25) return 'bg-green-500 text-white';
                if (ratio > 0) return 'bg-blue-500 text-white';
                return 'bg-white/10 text-white/30';
            };

            return (
                <div className={`mb-6 rounded-2xl p-4 border ${ui.panel}`}>
                    <div className="flex justify-between items-center mb-3">
                        <div className="flex items-center gap-2">
                            <button onClick={() => setShowHeatmap(false)} className={`text-xs font-bold px-2 py-1 rounded transition-colors ${!showHeatmap ? 'bg-white/20 ' + ui.text : 'text-white/30'}`}>TOP 6</button>
                            <button onClick={() => setShowHeatmap(true)} className={`text-xs font-bold px-2 py-1 rounded transition-colors ${showHeatmap ? 'bg-white/20 ' + ui.text : 'text-white/30'}`}>íˆíŠ¸ë§µ</button>
                        </div>
                        <div className="flex gap-1">
                            {!showHeatmap && topNumbers[0]?.count > 0 && (
                                <>
                                    <button onClick={() => onCopy(topNumbersSet)} className={`p-1.5 hover:bg-white/10 rounded-full opacity-70 hover:opacity-100 transition-colors ${ui.text}`}><Copy className="w-3.5 h-3.5" /></button>
                                    <button onClick={() => onShare(topNumbersSet)} className={`p-1.5 hover:bg-white/10 rounded-full opacity-70 hover:opacity-100 transition-colors ${ui.text}`}><ShareIcon className="w-3.5 h-3.5" /></button>
                                </>
                            )}
                            <button onClick={onWinCheck} className={`p-1.5 hover:bg-white/10 rounded-full opacity-70 hover:opacity-100 transition-colors text-yellow-400 font-bold`} title="ë‹¹ì²¨ í™•ì¸"><Award className="w-3.5 h-3.5" /></button>
                        </div>
                    </div>
                    
                    {history.length === 0 ? (
                        <div className={`text-xs text-center py-4 opacity-50 ${ui.text}`}>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                    ) : (
                        <>
                            {!showHeatmap ? (
                                <div className="flex justify-between gap-1 overflow-x-auto pb-2">
                                    {topNumbers.map((item, idx) => (
                                        <div key={item.num} className="flex flex-col items-center gap-1 min-w-[32px]">
                                            <LottoBall number={item.num} size="sm" className="w-8 h-8 text-xs" theme={theme} />
                                            <span className={`text-[10px] opacity-70 ${ui.text}`}>{item.count}íšŒ</span>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <div className="grid grid-cols-9 gap-1.5">
                                    {Array.from({length: 45}, (_, i) => i + 1).map(num => (
                                        <div 
                                            key={num} 
                                            className={`aspect-square rounded flex items-center justify-center text-[10px] transition-colors duration-300 ${getHeatmapColor(countsMap[num] || 0, minCount, maxCount)}`}
                                        >
                                            {num}
                                        </div>
                                    ))}
                                </div>
                            )}
                        </>
                    )}
                </div>
            );
        };

        const App = () => {
            const [gameCount, setGameCount] = React.useState(1);
            const [finalNumbers, setFinalNumbers] = React.useState([]);
            const [drawnNumbers, setDrawnNumbers] = React.useState([]);
            const [isRolling, setIsRolling] = React.useState(false);
            const [history, setHistory] = React.useState(() => {
                try { return JSON.parse(localStorage.getItem('lotto_history')) || []; } catch { return []; }
            });
            
            const [showHistory, setShowHistory] = React.useState(false);
            const [showStrategy, setShowStrategy] = React.useState(false);
            const [showWinCheck, setShowWinCheck] = React.useState(false);
            const [showDream, setShowDream] = React.useState(false);
            const [toast, setToast] = React.useState({ show: false, message: '' });
            const [machineBalls, setMachineBalls] = React.useState([]);
            const [currentDrawingNumber, setCurrentDrawingNumber] = React.useState(null);
            const [currentGameIndex, setCurrentGameIndex] = React.useState(0);
            
            const [skipAnimation, setSkipAnimation] = React.useState(() => JSON.parse(localStorage.getItem('skipAnimation')) || false);
            const [soundEnabled, setSoundEnabled] = React.useState(() => JSON.parse(localStorage.getItem('soundEnabled')) || false);
            const [shakeEnabled, setShakeEnabled] = React.useState(() => JSON.parse(localStorage.getItem('shakeEnabled')) || false);
            const [ttsEnabled, setTtsEnabled] = React.useState(() => JSON.parse(localStorage.getItem('ttsEnabled')) || false);
            const [ballTheme, setBallTheme] = React.useState(() => localStorage.getItem('ballTheme') || 'classic');
            const [fixedNumbers, setFixedNumbers] = React.useState(() => JSON.parse(localStorage.getItem('fixedNumbers')) || []);
            const [excludedNumbers, setExcludedNumbers] = React.useState(() => JSON.parse(localStorage.getItem('excludedNumbers')) || []);
            const [receiptMode, setReceiptMode] = React.useState(false);
            const [showHeatmap, setShowHeatmap] = React.useState(false);

            const lastShakeTime = React.useRef(0);
            const ui = THEMES[ballTheme].ui;

            React.useEffect(() => localStorage.setItem('skipAnimation', JSON.stringify(skipAnimation)), [skipAnimation]);
            React.useEffect(() => localStorage.setItem('soundEnabled', JSON.stringify(soundEnabled)), [soundEnabled]);
            React.useEffect(() => localStorage.setItem('shakeEnabled', JSON.stringify(shakeEnabled)), [shakeEnabled]);
            React.useEffect(() => localStorage.setItem('ttsEnabled', JSON.stringify(ttsEnabled)), [ttsEnabled]);
            React.useEffect(() => localStorage.setItem('ballTheme', ballTheme), [ballTheme]);
            React.useEffect(() => localStorage.setItem('fixedNumbers', JSON.stringify(fixedNumbers)), [fixedNumbers]);
            React.useEffect(() => localStorage.setItem('excludedNumbers', JSON.stringify(excludedNumbers)), [excludedNumbers]);

            React.useEffect(() => {
                if (!shakeEnabled) return;
                const handleMotion = (event) => {
                    if (isRolling) return;
                    const now = Date.now();
                    if (now - lastShakeTime.current < 1000) return;
                    const accel = event.accelerationIncludingGravity;
                    if (!accel) return;
                    const threshold = 20; 
                    if (Math.abs(accel.x) > threshold || Math.abs(accel.y) > threshold || Math.abs(accel.z) > threshold) {
                        lastShakeTime.current = now;
                        startDrawProcess();
                    }
                };
                window.addEventListener('devicemotion', handleMotion);
                return () => window.removeEventListener('devicemotion', handleMotion);
            }, [shakeEnabled, isRolling, fixedNumbers, excludedNumbers]);

            React.useEffect(() => {
                resetMachineBalls();
            }, []);

            const toggleShake = async () => {
                if (!shakeEnabled) {
                    if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                        try {
                            const response = await DeviceMotionEvent.requestPermission();
                            if (response === 'granted') {
                                setShakeEnabled(true);
                                showToast("í”ë“¤ì–´ì„œ ì¶”ì²¨ ê¸°ëŠ¥ì´ ì¼œì¡ŒìŠµë‹ˆë‹¤!");
                            } else {
                                showToast("ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.");
                            }
                        } catch (e) {
                            console.error(e);
                            setShakeEnabled(true); 
                            showToast("í”ë“¤ê¸° ê¸°ëŠ¥ ON (ì„¼ì„œ í™•ì¸ í•„ìš”)");
                        }
                    } else {
                        setShakeEnabled(true);
                        showToast("í”ë“¤ì–´ì„œ ì¶”ì²¨ ê¸°ëŠ¥ì´ ì¼œì¡ŒìŠµë‹ˆë‹¤!");
                    }
                } else {
                    setShakeEnabled(false);
                }
            };

            const resetMachineBalls = () => {
                const balls = Array.from({ length: 45 }, (_, i) => {
                    const angle = Math.random() * Math.PI;
                    const radius = Math.random() * 80;
                    const x = (Math.cos(angle) * radius * 0.8) + (Math.random() * 20 - 10);
                    const y = Math.abs(Math.sin(angle) * radius) + 20;
                    return {
                        id: i + 1, number: i + 1, x, y,
                        rotation: Math.random() * 360,
                        delay: Math.random() * 1.5,
                        duration: 0.5 + Math.random() * 0.7,
                        variant: Math.floor(Math.random() * 10)
                    };
                });
                setMachineBalls(balls);
                setDrawnNumbers([]);
                setCurrentDrawingNumber(null);
            };

            const generateSingleSet = () => {
                const numbers = new Set(fixedNumbers);
                const availableNumbers = Array.from({length: 45}, (_, i) => i + 1)
                    .filter(n => !excludedNumbers.includes(n) && !fixedNumbers.includes(n));
                
                if (numbers.size + availableNumbers.length < 6) {
                    showToast("ê°€ëŠ¥í•œ ë²ˆí˜¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! ì œì™¸ìˆ˜ë¥¼ ì¤„ì—¬ì£¼ì„¸ìš”.");
                    throw new Error("Not enough numbers");
                }

                while (numbers.size < 6) {
                    const randomBuffer = new Uint32Array(1);
                    window.crypto.getRandomValues(randomBuffer);
                    const randomIndex = randomBuffer[0] % availableNumbers.length;
                    
                    const num = availableNumbers[randomIndex];
                    numbers.add(num);
                    availableNumbers.splice(randomIndex, 1);
                }
                return Array.from(numbers).sort((a, b) => a - b);
            };

            const startDrawProcess = async () => {
                if (document.body.getAttribute('data-rolling') === 'true') return;
                const possibleCount = 45 - excludedNumbers.length;
                if (possibleCount < 6) {
                    showToast("ì œì™¸ìˆ˜ê°€ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤! (ìµœëŒ€ 39ê°œ)");
                    return;
                }

                document.body.setAttribute('data-rolling', 'true');
                setIsRolling(true);
                
                if (soundEnabled) SoundManager.init();

                setFinalNumbers([]);
                setCurrentGameIndex(0);
                resetMachineBalls();

                const gameCountRef = gameCount;
                let allGamesNumbers;
                try {
                    allGamesNumbers = Array(gameCountRef).fill(0).map(() => generateSingleSet());
                } catch (e) {
                    setIsRolling(false);
                    document.body.removeAttribute('data-rolling');
                    return;
                }
                
                if (skipAnimation) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    finalizeAllGames(allGamesNumbers);
                } else {
                    for (let i = 0; i < gameCountRef; i++) {
                        setCurrentGameIndex(i);
                        setDrawnNumbers([]);
                        if (i > 0) {
                            setMachineBalls([]);
                            await new Promise(r => setTimeout(r, 50));
                            resetMachineBalls();
                        }
                        await drawSingleGame(allGamesNumbers[i]);
                        if (i < gameCountRef - 1) {
                            await new Promise(resolve => setTimeout(resolve, 800));
                        }
                    }
                    finalizeAllGames(allGamesNumbers);
                }
            };

            const drawSingleGame = async (targetNumbers) => {
                await new Promise(resolve => setTimeout(resolve, 1200));
                for (let i = 0; i < 6; i++) {
                    const numberToDraw = targetNumbers[i];
                    setMachineBalls(prev => prev.filter(ball => ball.number !== numberToDraw));
                    setCurrentDrawingNumber(numberToDraw);
                    if (soundEnabled) SoundManager.playPop();
                    if (navigator.vibrate) navigator.vibrate(30);
                    await new Promise(resolve => setTimeout(resolve, 600));
                    setDrawnNumbers(prev => [...prev, numberToDraw]);
                    setCurrentDrawingNumber(null);
                    if (i < 5) await new Promise(resolve => setTimeout(resolve, 300));
                }
            };

            const finalizeAllGames = async (sortedNumberSets) => {
                setFinalNumbers(sortedNumberSets);
                setIsRolling(false);
                document.body.removeAttribute('data-rolling');
                resetMachineBalls();
                
                if (soundEnabled) SoundManager.playWin();
                if (ttsEnabled) {
                    const lastSet = sortedNumberSets[sortedNumberSets.length - 1];
                    SoundManager.speak(`í–‰ìš´ì˜ ë²ˆí˜¸ëŠ” ${lastSet.join(', ')} ì…ë‹ˆë‹¤.`);
                }
                if (window.confetti) {
                    window.confetti({
                        particleCount: 150,
                        spread: 70,
                        origin: { y: 0.6 },
                        colors: ['#fbbf24', '#f87171', '#60a5fa', '#a78bfa', '#34d399']
                    });
                }

                // Save to LocalStorage
                const newEntry = {
                    id: Date.now(),
                    numbers: sortedNumberSets,
                    gameCount: gameCount,
                    createdAt: new Date().toISOString()
                };
                const updatedHistory = [newEntry, ...history];
                setHistory(updatedHistory);
                localStorage.setItem('lotto_history', JSON.stringify(updatedHistory));
                showToast("ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
            };

            const deleteHistoryItem = async (docId) => {
                const updatedHistory = history.filter(item => item.id !== docId);
                setHistory(updatedHistory);
                localStorage.setItem('lotto_history', JSON.stringify(updatedHistory));
                showToast("ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            };

            const clearAllHistory = () => {
                if (confirm("ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                    setHistory([]);
                    localStorage.removeItem('lotto_history');
                    showToast("ëª¨ë“  ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                }
            }

            const copyToClipboard = (numberSet) => {
                const text = numberSet.join(',');
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    const successful = document.execCommand('copy');
                    if (successful) showToast(`ë³µì‚¬ ì™„ë£Œ: ${text}`);
                    else showToast('ë³µì‚¬ ì‹¤íŒ¨');
                } catch (err) {
                    showToast('ë³µì‚¬ ì‹¤íŒ¨');
                }
                document.body.removeChild(textArea);
            };

            const shareNumbers = (numberSet) => {
                const text = `í–‰ìš´ì˜ ë²ˆí˜¸: ${numberSet.join(', ')}`;
                if (navigator.share) {
                    navigator.share({ title: 'ì§€ë…¸ìŠ¤ ë¡œë˜ ì¶”ì¶œê¸°', text: text }).catch(console.error);
                } else {
                    copyToClipboard(numberSet);
                }
            };

            const saveReceiptImage = async (elementId) => {
                const element = document.getElementById(elementId);
                if (!element) return;
                try {
                    const canvas = await html2canvas(element, { backgroundColor: null, scale: 2 });
                    const link = document.createElement('a');
                    link.download = `lotto_receipt_${Date.now()}.png`;
                    link.href = canvas.toDataURL();
                    link.click();
                    showToast("ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
                } catch (e) {
                    showToast("ì´ë¯¸ì§€ ì €ì¥ ì‹¤íŒ¨");
                }
            };

            const showToast = (msg) => {
                setToast({ show: true, message: msg });
            };

            const clearResults = () => {
                setFinalNumbers([]);
                setDrawnNumbers([]);
                showToast("ê²°ê³¼ í™”ë©´ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
            };

            const handleMix = () => {
                if (isRolling) return;
                const newBalls = machineBalls.map(ball => ({
                    ...ball,
                    x: Math.random() * 80 + 10,
                    y: Math.random() * 80 + 10,
                    rotation: Math.random() * 360
                }));
                setMachineBalls(newBalls);
                if (soundEnabled) SoundManager.playPop();
                if (navigator.vibrate) navigator.vibrate(20);
            };

            const getAnalysis = (numbers) => {
                const sum = numbers.reduce((a, b) => a + b, 0);
                const odd = numbers.filter(n => n % 2 !== 0).length;
                const even = numbers.length - odd;
                const high = numbers.filter(n => n >= 23).length;
                const low = numbers.length - high;
                
                const diffs = new Set();
                for (let i = 0; i < numbers.length; i++) {
                    for (let j = i + 1; j < numbers.length; j++) {
                        diffs.add(Math.abs(numbers[i] - numbers[j]));
                    }
                }
                const acValue = diffs.size - (numbers.length - 1);
                
                const badges = [];
                if (acValue >= 7) badges.push({ label: 'ACì™„ë²½', color: 'bg-indigo-500 text-white' });
                for (let i = 0; i < numbers.length - 1; i++) {
                    if (numbers[i] + 1 === numbers[i+1]) {
                        badges.push({ label: 'ì—°ì†', color: 'bg-yellow-500 text-black' });
                        break; 
                    }
                }
                
                return { sum, odd, even, high, low, badges, acValue };
            };

            return (
                <div className={`h-screen w-screen transition-colors duration-500 font-sans selection:bg-purple-500 overflow-hidden flex flex-col no-select ${ui.bg}`}>
                    <div className="h-full w-full max-w-md mx-auto flex flex-col relative shadow-2xl overflow-hidden border-x border-white/5">
                        
                        {/* Header */}
                        <header className={`p-4 flex justify-between items-center backdrop-blur-md sticky top-0 z-40 border-b shrink-0 ${ui.panel}`}>
                            <div className="flex items-center gap-2">
                                <div className="w-9 h-9 rounded-full bg-gradient-to-tr from-yellow-400 to-orange-500 flex items-center justify-center font-bold text-black shadow-lg ring-2 ring-orange-400/30">G</div>
                                <h1 className={`text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400`}>ì§€ë…¸ìŠ¤ ë¡œë˜ ì¶”ì¶œê¸°</h1>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => setShowDream(true)} className={`p-2 rounded-full transition-colors relative hover:bg-white/10 ${ui.text}`} aria-label="ë“œë¦¼ ëª¨ë“œ">
                                    <Moon className={`w-6 h-6 ${ui.accent}`} />
                                </button>
                                <button onClick={() => setShowStrategy(true)} className={`p-2 rounded-full transition-colors relative hover:bg-white/10 ${ui.text}`} aria-label="ì „ëµ ì„¤ì •">
                                    <Target className={`w-6 h-6 ${ui.accent}`} />
                                    {(fixedNumbers.length > 0 || excludedNumbers.length > 0) && <span className="absolute top-1.5 right-1.5 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-slate-900"></span>}
                                </button>
                                <button onClick={() => setShowHistory(true)} className={`p-2 rounded-full transition-colors relative hover:bg-white/10 ${ui.text}`} aria-label="ê¸°ë¡ ë³´ê¸°">
                                    <History className="w-6 h-6" />
                                    {history.length > 0 && <span className="absolute top-1.5 right-1.5 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-slate-900"></span>}
                                </button>
                            </div>
                        </header>

                        {/* Main Game Area */}
                        <main className="flex-1 p-4 sm:p-6 flex flex-col items-center gap-4 sm:gap-6 overflow-y-auto pb-24 scrollbar-hide w-full">
                            <LottoMachine isRolling={isRolling} currentDrawingNumber={currentDrawingNumber} machineBalls={machineBalls} theme={ballTheme} onMix={handleMix} />

                            {/* Drawn Numbers */}
                            <div className={`w-full min-h-[120px] rounded-3xl p-5 border backdrop-blur-md flex flex-col items-center justify-center gap-4 relative shadow-lg shrink-0 ${ui.panel}`}>
                                <div className="w-full flex justify-between items-center px-2">
                                    <span className={`text-xs uppercase tracking-widest font-semibold opacity-70 ${ui.text}`}>
                                        {isRolling ? `DRAWING GAME ${currentGameIndex + 1}/${gameCount}` : 'RESULTS'}
                                    </span>
                                    <div className="flex gap-2">
                                        {!isRolling && finalNumbers.length > 0 && (
                                            <button onClick={() => setReceiptMode(!receiptMode)} className={`p-1 hover:bg-white/10 rounded-full transition-colors ${receiptMode ? ui.accent : 'opacity-50 hover:opacity-100 ' + ui.text}`} aria-label="ì˜ìˆ˜ì¦ ëª¨ë“œ">
                                                <Receipt className="w-3.5 h-3.5" />
                                            </button>
                                        )}
                                        {!isRolling && (finalNumbers.length > 0 || drawnNumbers.length > 0) && (
                                            <button onClick={clearResults} className={`p-1 hover:bg-white/10 rounded-full opacity-50 hover:opacity-100 transition-colors ${ui.text}`} aria-label="ê²°ê³¼ ì´ˆê¸°í™”">
                                                <RotateCcw className="w-3.5 h-3.5" />
                                            </button>
                                        )}
                                    </div>
                                </div>

                                {(isRolling || drawnNumbers.length > 0) && (
                                    <div className="flex gap-2 mt-2 animate-fade-in flex-wrap justify-center">
                                        {drawnNumbers.map((num, i) => (
                                            <LottoBall key={`drawn-${i}`} number={num} size="md" className="animate-[bounce-in_0.5s] shadow-xl ring-2 ring-white/10" theme={ballTheme} />
                                        ))}
                                        {isRolling && [...Array(6 - drawnNumbers.length)].map((_, i) => (
                                            <div key={`empty-${i}`} className="w-10 h-10 rounded-full border-2 border-white/5 border-dashed bg-black/20"></div>
                                        ))}
                                    </div>
                                )}
                                {!isRolling && finalNumbers.length > 0 && (
                                    <div className="w-full flex flex-col gap-3 mt-2 animate-fade-in">
                                        {finalNumbers.map((set, idx) => {
                                            const analysis = getAnalysis(set);
                                            const receiptId = `receipt-${idx}`;
                                            if (receiptMode) {
                                                return (
                                                    <div key={idx} id={receiptId} className={`p-4 rounded-sm shadow-md font-mono text-sm relative ${ui.receipt} receipt-pattern`}>
                                                        <div className="ticket-zigzag absolute -bottom-2 left-0 w-full" style={{color: 'inherit'}}></div>
                                                        <div className="flex justify-between border-b-2 border-dashed border-current pb-2 mb-2 opacity-80">
                                                            <span className="font-bold">GINOS LOTTO</span>
                                                            <span className="text-xs">{new Date().toLocaleDateString()}</span>
                                                        </div>
                                                        <div className="flex justify-between items-center text-lg font-bold tracking-wider mb-2">
                                                            <span className="mr-2 opacity-50">{String.fromCharCode(65+idx)}</span>
                                                            {set.map(n => String(n).padStart(2, '0')).join(' ')}
                                                        </div>
                                                        
                                                        {/* QR Code & Save Button */}
                                                        <div className="flex justify-between items-center my-3">
                                                            <img 
                                                                src={`https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=LOTTO:${set.join(',')}`} 
                                                                alt="Lotto QR" 
                                                                className="w-16 h-16 opacity-90 mix-blend-multiply" 
                                                            />
                                                            <button onClick={() => saveReceiptImage(receiptId)} className="text-xs border border-current px-2 py-1 rounded opacity-60 hover:opacity-100 flex items-center gap-1">
                                                                <Download className="w-3 h-3" /> ì €ì¥
                                                            </button>
                                                        </div>
                                                        
                                                        <div className="mt-2 pt-2 border-t border-dashed border-current flex justify-between text-[10px] opacity-70">
                                                            <span>SUM: {analysis.sum}</span>
                                                            <span>H/L: {analysis.high}/{analysis.low}</span>
                                                        </div>
                                                    </div>
                                                )
                                            }
                                            return (
                                                <div key={idx} className={`p-2.5 rounded-2xl flex flex-col gap-2 border hover:border-white/40 group relative transition-all ${ui.panel}`}>
                                                    {analysis.badges.length > 0 && (
                                                        <div className="absolute -top-2 left-2 flex gap-1 z-10">
                                                            {analysis.badges.map((b, i) => (
                                                                <span key={i} className={`text-[9px] px-1.5 py-0.5 rounded-full shadow-sm font-bold ${b.color} animate-fade-in-up`}>{b.label}</span>
                                                            ))}
                                                        </div>
                                                    )}
                                                    <div className="flex justify-center gap-2 items-center relative mt-1">
                                                        <span className={`absolute left-1 top-1/2 -translate-y-1/2 text-xs font-mono opacity-50 font-bold ${ui.text}`}>{idx + 1}</span>
                                                        <div className="flex gap-2 justify-center cursor-pointer" onClick={() => copyToClipboard(set)}>
                                                            {set.map((num, i) => <LottoBall key={i} number={num} size="sm" className="shadow-md" theme={ballTheme} />)}
                                                        </div>
                                                        <div className="absolute right-0 top-1/2 -translate-y-1/2 flex gap-1">
                                                            <button onClick={() => copyToClipboard(set)} className={`p-1.5 hover:bg-white/10 rounded-full opacity-50 hover:opacity-100 ${ui.text}`}><Copy className="w-3.5 h-3.5" /></button>
                                                            <button onClick={() => shareNumbers(set)} className={`p-1.5 hover:bg-white/10 rounded-full opacity-50 hover:opacity-100 ${ui.text}`}><ShareIcon className="w-3.5 h-3.5" /></button>
                                                        </div>
                                                    </div>
                                                    <div className="flex justify-center gap-4 text-[10px] opacity-60 border-t border-white/5 pt-1.5 mt-0.5">
                                                        <span className={`${ui.text}`}>í•©ê³„: <strong>{analysis.sum}</strong></span>
                                                        <span className={`${ui.text}`}>ê³ ì €: <strong>{analysis.high}:{analysis.low}</strong></span>
                                                        <span className={`${ui.text}`}>AC: <strong>{analysis.acValue}</strong></span>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                                {!isRolling && finalNumbers.length === 0 && drawnNumbers.length === 0 && (
                                    <div className="text-center opacity-30 flex flex-col items-center gap-3 mt-2">
                                        <div className="w-12 h-12 rounded-full bg-white/5 flex items-center justify-center"><Trophy className={`w-6 h-6 ${ui.text}`} /></div>
                                        <p className={`text-sm font-medium ${ui.text}`}>í–‰ìš´ì„ ì‹œí—˜í•´ë³´ì„¸ìš”</p>
                                    </div>
                                )}
                            </div>

                            {/* Controls */}
                            <div className={`w-full flex flex-col gap-4 p-5 rounded-3xl border backdrop-blur-sm shrink-0 ${ui.panel}`}>
                                <div className={`flex justify-between items-center text-sm ${ui.text}`}>
                                    <span className="flex items-center gap-2 font-medium"><Settings className="w-4 h-4 opacity-70"/> ì„¤ì •</span>
                                    <span className={`font-bold px-3 py-1 rounded-full border ${ui.highlight} text-white border-white/10`}>{gameCount} SETS</span>
                                </div>
                                <div className="relative pt-2 pb-1">
                                    <input type="range" min="1" max="5" value={gameCount} onChange={(e) => setGameCount(Number(e.target.value))} disabled={isRolling} aria-label="ê²Œì„ ìˆ˜ ì„¤ì •" className={`w-full h-2 rounded-lg appearance-none cursor-pointer disabled:opacity-50 hover:opacity-90 transition-all bg-black/40`} style={{accentColor: ballTheme === 'classic' ? '#fbbf24' : 'currentColor'}} />
                                    <div className={`flex justify-between text-[10px] px-1 font-mono mt-2 font-bold opacity-50 ${ui.text}`}>
                                        <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                                    </div>
                                </div>
                                
                                {/* Toggles Container */}
                                <div className="flex flex-col gap-3 mt-1 border-t border-white/10 pt-3">
                                    <div className="flex gap-2">
                                        {/* Motion Skip Toggle */}
                                        <div className="flex-1 flex justify-between items-center text-sm bg-black/20 p-2 rounded-xl">
                                            <span className={`flex items-center gap-2 font-medium ${ui.text}`}><Zap className={`w-3.5 h-3.5 opacity-90 ${ui.accent}`}/> ë¹ ë¥¸ ê²°ê³¼</span>
                                            <button 
                                                onClick={() => setSkipAnimation(!skipAnimation)}
                                                className={`w-9 h-5 rounded-full p-0.5 transition-colors duration-200 ease-in-out ${skipAnimation ? 'bg-yellow-500' : 'bg-gray-700'}`}
                                            >
                                                <div className={`w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-200 ease-in-out ${skipAnimation ? 'translate-x-4' : 'translate-x-0'}`} />
                                            </button>
                                        </div>
                                        
                                        {/* Sound Toggle */}
                                        <div className="flex-1 flex justify-between items-center text-sm bg-black/20 p-2 rounded-xl">
                                            <span className={`flex items-center gap-2 font-medium ${ui.text}`}>
                                                {soundEnabled ? <Volume2 className="w-3.5 h-3.5 text-green-400 opacity-90"/> : <VolumeX className="w-3.5 h-3.5 text-gray-400 opacity-90"/>}
                                                ì‚¬ìš´ë“œ
                                            </span>
                                            <button 
                                                onClick={() => setSoundEnabled(!soundEnabled)}
                                                className={`w-9 h-5 rounded-full p-0.5 transition-colors duration-200 ease-in-out ${soundEnabled ? 'bg-green-500' : 'bg-gray-700'}`}
                                            >
                                                <div className={`w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-200 ease-in-out ${soundEnabled ? 'translate-x-4' : 'translate-x-0'}`} />
                                            </button>
                                        </div>
                                    </div>

                                    <div className="flex gap-2">
                                        {/* TTS Toggle */}
                                        <div className="flex-1 flex justify-between items-center text-sm bg-black/20 p-2 rounded-xl">
                                            <span className={`flex items-center gap-2 font-medium ${ui.text}`}>
                                                {ttsEnabled ? <Mic className="w-3.5 h-3.5 text-blue-400 opacity-90"/> : <MicOff className="w-3.5 h-3.5 text-gray-400 opacity-90"/>}
                                                ìŒì„± ì•ˆë‚´
                                            </span>
                                            <button 
                                                onClick={() => setTtsEnabled(!ttsEnabled)}
                                                className={`w-9 h-5 rounded-full p-0.5 transition-colors duration-200 ease-in-out ${ttsEnabled ? 'bg-blue-500' : 'bg-gray-700'}`}
                                            >
                                                <div className={`w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-200 ease-in-out ${ttsEnabled ? 'translate-x-4' : 'translate-x-0'}`} />
                                            </button>
                                        </div>

                                        {/* Shake Toggle */}
                                        <div className="flex-1 flex justify-between items-center text-sm bg-black/20 p-2 rounded-xl">
                                            <span className={`flex items-center gap-2 font-medium ${ui.text}`}><Smartphone className="w-3.5 h-3.5 text-purple-400 opacity-90"/> í”ë“¤ê¸°</span>
                                            <button 
                                                onClick={toggleShake}
                                                className={`w-9 h-5 rounded-full p-0.5 transition-colors duration-200 ease-in-out ${shakeEnabled ? 'bg-purple-500' : 'bg-gray-700'}`}
                                            >
                                                <div className={`w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-200 ease-in-out ${shakeEnabled ? 'translate-x-4' : 'translate-x-0'}`} />
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {/* Theme Selector */}
                                    <div className="flex gap-2 mt-1">
                                        <div className="flex-1 flex justify-between items-center text-sm bg-black/20 p-2 rounded-xl relative group">
                                            <span className={`flex items-center gap-2 font-medium ${ui.text}`}><Palette className="w-3.5 h-3.5 text-pink-400 opacity-90"/> í…Œë§ˆ</span>
                                            <select 
                                                value={ballTheme} 
                                                onChange={(e) => setBallTheme(e.target.value)}
                                                className={`bg-transparent text-xs rounded-lg px-2 py-1 outline-none text-right font-bold appearance-none ${ui.text} ${ui.accent}`}
                                            >
                                                <option value="classic" className="text-black">ë¯¸ë“œë‚˜ì‡</option>
                                                <option value="forest" className="text-black">í¬ë ˆìŠ¤íŠ¸</option>
                                                <option value="ocean" className="text-black">ì˜¤ì…˜</option>
                                                <option value="sunset" className="text-black">ì„ ì…‹</option>
                                                <option value="mono" className="text-black">ëª¨ë…¸</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Button */}
                            <button onClick={startDrawProcess} disabled={isRolling} className={`w-full py-4 rounded-2xl font-bold text-lg shadow-xl flex items-center justify-center gap-3 transition-all duration-300 transform active:scale-95 relative overflow-hidden group shrink-0 text-white ${ui.button} ${isRolling ? 'opacity-50 cursor-not-allowed' : ''}`}>
                                {!isRolling && <div className="absolute inset-0 bg-gradient-to-tr from-white/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>}
                                {isRolling ? (
                                    <>
                                        <RefreshCw className="w-5 h-5 animate-spin" />
                                        <span className="tracking-widest text-sm">ì¶”ì²¨ ì§„í–‰ ì¤‘...</span>
                                    </>
                                ) : (
                                    <>
                                        <Wind className="w-5 h-5 group-hover:animate-pulse" />
                                        <span className="tracking-widest">{skipAnimation ? 'ë¹ ë¥¸ ì¶”ì²¨ ì‹œì‘' : 'START DRAW'}</span>
                                    </>
                                )}
                            </button>
                        </main>

                        {/* Modals */}
                        <StrategyModal 
                            show={showStrategy} 
                            onClose={() => setShowStrategy(false)} 
                            fixedNumbers={fixedNumbers}
                            setFixedNumbers={setFixedNumbers}
                            excludedNumbers={excludedNumbers}
                            setExcludedNumbers={setExcludedNumbers}
                            theme={ballTheme}
                        />

                        <DreamModal
                            show={showDream}
                            onClose={() => setShowDream(false)}
                            theme={ballTheme}
                            onApply={(nums) => {
                                setFixedNumbers(nums.slice(0, 5));
                                showToast(`${nums.length}ê°œì˜ ë²ˆí˜¸ê°€ ê³ ì •ìˆ˜ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                            }}
                        />

                        <WinCheckModal
                            show={showWinCheck}
                            onClose={() => setShowWinCheck(false)}
                            history={history}
                            theme={ballTheme}
                        />

                        {showHistory && (
                            <div className="absolute inset-0 z-50 bg-slate-950/95 backdrop-blur-xl flex flex-col animate-fade-in">
                                <div className={`p-5 border-b flex justify-between items-center shrink-0 ${ui.panel}`}>
                                    <h2 className={`text-lg font-bold flex items-center gap-2 ${ui.text}`}><History className={`w-5 h-5 ${ui.accent}`} /> History</h2>
                                    <div className="flex gap-2">
                                        <button onClick={clearAllHistory} className="p-2 hover:bg-white/10 rounded-full transition-colors text-red-400 hover:text-red-300" aria-label="ì „ì²´ ì‚­ì œ"><Trash2 className="w-5 h-5" /></button>
                                        <button onClick={() => setShowHistory(false)} className={`p-2 rounded-full transition-colors opacity-70 hover:opacity-100 ${ui.text}`}><X className="w-6 h-6" /></button>
                                    </div>
                                </div>
                                <div className="flex-1 overflow-y-auto p-4 space-y-4 scrollbar-hide">
                                    <StatsView 
                                        history={history} 
                                        theme={ballTheme} 
                                        onCopy={copyToClipboard} 
                                        onShare={shareNumbers} 
                                        showHeatmap={showHeatmap} 
                                        setShowHeatmap={setShowHeatmap} 
                                        onWinCheck={() => {
                                            setShowHistory(false);
                                            setShowWinCheck(true);
                                        }}
                                    />
                                    
                                    {history.length === 0 ? (
                                        <div className="h-40 flex flex-col items-center justify-center opacity-30 gap-4">
                                            <div className="w-16 h-16 rounded-full bg-white/5 flex items-center justify-center"><History className={`w-8 h-8 ${ui.text}`} /></div>
                                            <p className={`text-sm ${ui.text}`}>ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>
                                        </div>
                                    ) : (
                                        history.map((item) => (
                                            <div key={item.id} className={`rounded-2xl p-4 border space-y-3 animate-fade-in-up transition-colors ${ui.panel}`}>
                                                <div className={`flex justify-between items-center text-xs opacity-70 border-b border-white/5 pb-2 ${ui.text}`}>
                                                    <span className="flex items-center gap-1.5 font-mono"><Sparkles className={`w-3 h-3 ${ui.accent}`}/> {new Date(item.createdAt).toLocaleDateString()} {new Date(item.createdAt).toLocaleTimeString()}</span>
                                                    <button onClick={() => deleteHistoryItem(item.id)} className="text-red-400/60 hover:text-red-400 p-1.5 hover:bg-red-400/10 rounded-md transition-all"><Trash2 className="w-4 h-4" /></button>
                                                </div>
                                                {item.numbers.map((set, idx) => {
                                                    const setAnalysis = getAnalysis(set);
                                                    return (
                                                    <div key={idx} className={`p-2.5 rounded-2xl flex flex-col gap-2 border hover:border-white/40 group relative transition-all ${ui.panel}`}>
                                                        {setAnalysis.badges.length > 0 && (
                                                            <div className="absolute -top-2 left-2 flex gap-1 z-10">
                                                                {setAnalysis.badges.map((b, i) => (
                                                                    <span key={i} className={`text-[9px] px-1.5 py-0.5 rounded-full shadow-sm font-bold ${b.color} animate-fade-in-up`}>{b.label}</span>
                                                                ))}
                                                            </div>
                                                        )}
                                                        <div className="flex justify-center gap-2 items-center relative mt-1">
                                                            <span className={`absolute left-1 top-1/2 -translate-y-1/2 text-xs font-mono opacity-50 font-bold ${ui.text}`}>{idx + 1}</span>
                                                            <div className="flex gap-2 justify-center cursor-pointer" onClick={() => copyToClipboard(set)}>
                                                                {set.map((num, i) => <LottoBall key={i} number={num} size="sm" className="shadow-md" theme={ballTheme} />)}
                                                            </div>
                                                            <div className="absolute right-0 top-1/2 -translate-y-1/2 flex gap-1">
                                                                <button onClick={() => copyToClipboard(set)} className={`p-1.5 hover:bg-white/10 rounded-full opacity-50 hover:opacity-100 ${ui.text}`}><Copy className="w-3.5 h-3.5" /></button>
                                                                <button onClick={() => shareNumbers(set)} className={`p-1.5 hover:bg-white/10 rounded-full opacity-50 hover:opacity-100 ${ui.text}`}><ShareIcon className="w-3.5 h-3.5" /></button>
                                                            </div>
                                                        </div>
                                                        <div className="flex justify-center gap-4 text-[10px] opacity-60 border-t border-white/5 pt-1.5 mt-0.5">
                                                            <span className={`${ui.text}`}>í•©ê³„: <strong>{setAnalysis.sum}</strong></span>
                                                            <span className={`${ui.text}`}>ê³ ì €: <strong>{setAnalysis.high}:{setAnalysis.low}</strong></span>
                                                            <span className={`${ui.text}`}>AC: <strong>{setAnalysis.acValue}</strong></span>
                                                        </div>
                                                    </div>
                                                )})} 
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        )}

                        <Toast show={toast.show} message={toast.message} onClose={() => setToast(prev => ({ ...prev, show: false }))} />
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
