<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>세상에서 가장 어려운 게임 - 50레벨 (모바일 조이스틱)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #222;
      font-family: Arial, sans-serif;
      color: #fff;
      user-select: none;
      overflow: hidden;
    }
    #gameWrapper {
      position: relative;
    }
    #gameCanvas {
      background: #eee;
      border: 4px solid #000;
      touch-action: none;
    }
    #ui {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      font-size: 14px;
      text-align: center;
      z-index: 10;
    }
    #joystickArea {
      position: absolute;
      left: 10px;
      bottom: 10px;
      width: 160px;
      height: 160px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      display: none; /* 모바일에서만 보이게 */
      touch-action: none;
    }
    #joystickBase, #joystickStick {
      position: absolute;
      border-radius: 50%;
      pointer-events: none;
    }
    #joystickBase {
      width: 120px;
      height: 120px;
      left: 20px;
      top: 20px;
      background: rgba(0, 0, 0, 0.3);
    }
    #joystickStick {
      width: 60px;
      height: 60px;
      left: 50px;
      top: 50px;
      background: rgba(255, 255, 255, 0.8);
    }
  </style>
</head>
<body>
<div id="ui">
  <div>레벨: <span id="levelDisplay">1</span> / 50</div>
  <div>죽은 횟수: <span id="deathDisplay">0</span></div>
  <div>PC: 방향키 / 모바일: 조이스틱</div>
</div>

<div id="gameWrapper">
  <canvas id="gameCanvas" width="640" height="480"></canvas>
  <div id="joystickArea">
    <div id="joystickBase"></div>
    <div id="joystickStick"></div>
  </div>
</div>

<script>
/* ===== 기본 설정 + 디바이스 감지 ===== */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const keys = {};
let currentLevelIndex = 0;
let deaths = 0;
let gameWon = false;
let showLevelMessage = false;
let levelMessageText = "";

const levelDisplay = document.getElementById("levelDisplay");
const deathDisplay = document.getElementById("deathDisplay");

const joystickArea = document.getElementById("joystickArea");
const joystickBase = document.getElementById("joystickBase");
const joystickStick = document.getElementById("joystickStick");

// 간단한 모바일 감지[web:94]
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobi/i.test(
  navigator.userAgent
);

/* ===== 반응형 캔버스 ===== */
const DESIGN_WIDTH = 640;
const DESIGN_HEIGHT = 480;

function resizeCanvas() {
  const wrapper = document.getElementById("gameWrapper");
  const maxWidth = window.innerWidth;
  const maxHeight = window.innerHeight;

  const scaleX = maxWidth / DESIGN_WIDTH;
  const scaleY = maxHeight / DESIGN_HEIGHT;
  const scale = Math.min(scaleX, scaleY);

  const displayWidth = DESIGN_WIDTH * scale;
  const displayHeight = DESIGN_HEIGHT * scale;

  canvas.style.width = displayWidth + "px";
  canvas.style.height = displayHeight + "px";

  wrapper.style.width = displayWidth + "px";
  wrapper.style.height = displayHeight + "px";
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

/* ===== 입력 처리 (키보드 + 조이스틱) ===== */
window.addEventListener("keydown", e => {
  if (showLevelMessage) {
    if (!gameWon && e.key === " ") {
      showLevelMessage = false;
      loadLevel(currentLevelIndex);
    } else if (gameWon && e.key === "Enter") {
      currentLevelIndex = 0;
      deaths = 0;
      gameWon = false;
      showLevelMessage = false;
      loadLevel(currentLevelIndex);
    }
    return;
  }
  keys[e.key] = true;
});
window.addEventListener("keyup", e => {
  keys[e.key] = false;
});

/* ===== 플레이어 / 구조체 ===== */
const player = { x: 0, y: 0, w: 18, h: 18, speed: 3, startX: 0, startY: 0 };
let goal = { x: 0, y: 0, w: 40, h: 80 };
let walls = [];
let enemies = [];
let coins = [];

/* ===== 레벨 데이터 1~10 (직접 디자인) ===== */
const baseLevels = [
  // 1
  {
    start: { x: 50, y: 230 },
    goal:  { x: 550, y: 200, w: 60, h: 80 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 120 },
      { x: 0,   y: 360, w: 640, h: 120 }
    ],
    enemies: [
      { x: 200, y: 150, r: 10, dx: 0,  dy: 2, minY: 140, maxY: 340 },
      { x: 260, y: 340, r: 10, dx: 0,  dy: -2, minY: 140, maxY: 340 },
      { x: 320, y: 150, r: 10, dx: 0,  dy: 2, minY: 140, maxY: 340 },
      { x: 380, y: 340, r: 10, dx: 0,  dy: -2, minY: 140, maxY: 340 }
    ],
    coins: []
  },
  // 2
  {
    start: { x: 40, y: 230 },
    goal:  { x: 560, y: 210, w: 50, h: 60 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 160 },
      { x: 0,   y: 320, w: 640, h: 160 }
    ],
    enemies: [
      { x: 150, y: 170, r: 9, dx: 0, dy: 3, minY: 170, maxY: 310 },
      { x: 220, y: 310, r: 9, dx: 0, dy: -3, minY: 170, maxY: 310 },
      { x: 290, y: 170, r: 9, dx: 0, dy: 3, minY: 170, maxY: 310 },
      { x: 360, y: 310, r: 9, dx: 0, dy: -3, minY: 170, maxY: 310 },
      { x: 430, y: 170, r: 9, dx: 0, dy: 3, minY: 170, maxY: 310 }
    ],
    coins: [
      { x: 120, y: 240, r: 6, taken: false },
      { x: 320, y: 240, r: 6, taken: false },
      { x: 520, y: 240, r: 6, taken: false }
    ]
  },
  // 3
  {
    start: { x: 50, y: 230 },
    goal:  { x: 550, y: 210, w: 60, h: 60 },
    walls: [
      { x: 0, y: 0,   w: 640, h: 120 },
      { x: 0, y: 360, w: 640, h: 120 },
      { x: 280, y: 180, w: 80, h: 120 }
    ],
    enemies: [
      { x: 120, y: 170, r: 9, dx: 2.5, dy: 0, minX: 120, maxX: 520 },
      { x: 520, y: 310, r: 9, dx: -2.5, dy: 0, minX: 120, maxX: 520 },
      { x: 120, y: 285, r: 9, dx: 2.5, dy: 0, minX: 120, maxX: 520 }
    ],
    coins: [
      { x: 320, y: 150, r: 6, taken: false },
      { x: 320, y: 330, r: 6, taken: false }
    ]
  },
  // 4
  {
    start: { x: 300, y: 400 },
    goal:  { x: 300, y: 40, w: 40, h: 40 },
    walls: [
      { x: 0, y: 0, w: 640, h: 40 },
      { x: 0, y: 440, w: 640, h: 40 },
      { x: 0, y: 0, w: 40, h: 480 },
      { x: 600, y: 0, w: 40, h: 480 }
    ],
    enemies: [
      { x: 200, y: 80,  r: 9, dx: 0, dy: 3, minY: 80, maxY: 400 },
      { x: 440, y: 400, r: 9, dx: 0, dy: -3, minY: 80, maxY: 400 },
      { x: 80,  y: 260, r: 9, dx: 3, dy: 0, minX: 80, maxX: 560 },
      { x: 560, y: 220, r: 9, dx: -3, dy: 0, minX: 80, maxX: 560 }
    ],
    coins: [
      { x: 320, y: 260, r: 6, taken: false }
    ]
  },
  // 5
  {
    start: { x: 60, y: 400 },
    goal:  { x: 560, y: 60, w: 40, h: 40 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 40 },
      { x: 0,   y: 440, w: 640, h: 40 },
      { x: 0,   y: 80,  w: 200, h: 40 },
      { x: 440, y: 80,  w: 200, h: 40 },
      { x: 200, y: 80,  w: 40,  h: 240 },
      { x: 400, y: 200, w: 40,  h: 240 },
      { x: 240, y: 280, w: 160, h: 40 }
    ],
    enemies: [
      { x: 120, y: 120, r: 8, dx: 2, dy: 0, minX: 60, maxX: 340 },
      { x: 520, y: 160, r: 8, dx: -2, dy: 0, minX: 300, maxX: 580 },
      { x: 220, y: 360, r: 8, dx: 2.5, dy: 0, minX: 60, maxX: 380 },
      { x: 420, y: 240, r: 8, dx: 0, dy: 2.5, minY: 120, maxY: 360 }
    ],
    coins: [
      { x: 320, y: 260, r: 6, taken: false },
      { x: 100, y: 420, r: 6, taken: false }
    ]
  },
  // 6
  {
    start: { x: 40, y: 220 },
    goal:  { x: 580, y: 220, w: 40, h: 40 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 80 },
      { x: 0,   y: 400, w: 640, h: 80 },
      { x: 280, y: 80,  w: 80,  h: 240 }
    ],
    enemies: [
      { x: 160, y: 120, r: 9, dx: 0, dy: 3, minY: 100, maxY: 380 },
      { x: 480, y: 380, r: 9, dx: 0, dy: -3, minY: 100, maxY: 380 },
      { x: 160, y: 380, r: 9, dx: 0, dy: -3, minY: 100, maxY: 380 },
      { x: 480, y: 100, r: 9, dx: 0, dy: 3, minY: 100, maxY: 380 }
    ],
    coins: [
      { x: 120, y: 120, r: 6, taken: false },
      { x: 520, y: 120, r: 6, taken: false },
      { x: 120, y: 360, r: 6, taken: false },
      { x: 520, y: 360, r: 6, taken: false }
    ]
  },
  // 7
  {
    start: { x: 40, y: 230 },
    goal:  { x: 560, y: 230, w: 60, h: 60 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 100 },
      { x: 0,   y: 380, w: 640, h: 100 }
    ],
    enemies: [
      { x: 160, y: 150, r: 8, dx: 3.5, dy: 0, minX: 80, maxX: 560 },
      { x: 160, y: 330, r: 8, dx: 3.5, dy: 0, minX: 80, maxX: 560 },
      { x: 560, y: 190, r: 8, dx: -3.5, dy: 0, minX: 80, maxX: 560 },
      { x: 80,  y: 290, r: 8, dx: 3.5, dy: 0, minX: 80, maxX: 560 },
      { x: 320, y: 150, r: 8, dx: 0, dy: 3.5, minY: 120, maxY: 360 }
    ],
    coins: [
      { x: 320, y: 230, r: 6, taken: false }
    ]
  },
  // 8
  {
    start: { x: 40, y: 230 },
    goal:  { x: 560, y: 230, w: 60, h: 60 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 80 },
      { x: 0,   y: 400, w: 640, h: 80 },
      { x: 280, y: 80,  w: 80,  h: 140 },
      { x: 280, y: 260, w: 80,  h: 140 }
    ],
    enemies: [
      { x: 160, y: 120, r: 9, dx: 0, dy: 3, minY: 100, maxY: 380 },
      { x: 480, y: 380, r: 9, dx: 0, dy: -3, minY: 100, maxY: 380 },
      { x: 160, y: 380, r: 9, dx: 0, dy: -3, minY: 100, maxY: 380 },
      { x: 480, y: 100, r: 9, dx: 0, dy: 3, minY: 100, maxY: 380 },
      { x: 320, y: 120, r: 9, dx: 3, dy: 0, minX: 80, maxX: 560 },
      { x: 320, y: 360, r: 9, dx: -3, dy: 0, minX: 80, maxX: 560 }
    ],
    coins: [
      { x: 100, y: 240, r: 6, taken: false },
      { x: 540, y: 240, r: 6, taken: false }
    ]
  },
  // 9
  {
    start: { x: 60, y: 420 },
    goal:  { x: 560, y: 60, w: 40, h: 40 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 40 },
      { x: 0,   y: 440, w: 640, h: 40 },
      { x: 200, y: 80,  w: 40,  h: 320 },
      { x: 400, y: 80,  w: 40,  h: 320 }
    ],
    enemies: [
      { x: 120, y: 120, r: 8, dx: 3.8, dy: 0, minX: 60, maxX: 180 },
      { x: 320, y: 200, r: 8, dx: -3.8, dy: 0, minX: 220, maxX: 420 },
      { x: 520, y: 360, r: 8, dx: -4.0, dy: 0, minX: 460, maxX: 580 },
      { x: 320, y: 360, r: 8, dx: 0, dy: -3.8, minY: 120, maxY: 360 }
    ],
    coins: [
      { x: 120, y: 420, r: 6, taken: false },
      { x: 320, y: 60,  r: 6, taken: false },
      { x: 520, y: 420, r: 6, taken: false }
    ]
  },
  // 10
  {
    start: { x: 40, y: 230 },
    goal:  { x: 580, y: 40, w: 40, h: 40 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 40 },
      { x: 0,   y: 440, w: 640, h: 40 },
      { x: 200, y: 80,  w: 40,  h: 320 },
      { x: 400, y: 80,  w: 40,  h: 320 },
      { x: 0,   y: 200, w: 200, h: 40 },
      { x: 440, y: 280, w: 200, h: 40 }
    ],
    enemies: [
      { x: 120, y: 120, r: 9, dx: 0, dy: 4, minY: 80,  maxY: 400 },
      { x: 520, y: 400, r: 9, dx: 0, dy: -4, minY: 80, maxY: 400 },
      { x: 220, y: 120, r: 9, dx: 4, dy: 0, minX: 220, maxX: 380 },
      { x: 420, y: 400, r: 9, dx: -4, dy: 0, minX: 260, maxX: 580 },
      { x: 320, y: 240, r: 9, dx: 3.5, dy: 0, minX: 220, maxX: 420 }
    ],
    coins: [
      { x: 100, y: 60,  r: 6, taken: false },
      { x: 100, y: 420, r: 6, taken: false },
      { x: 540, y: 60,  r: 6, taken: false },
      { x: 540, y: 420, r: 6, taken: false },
      { x: 320, y: 240, r: 6, taken: false }
    ]
  }
];

/* ===== 자동 생성 레벨 11~50 ===== */
const levels = [...baseLevels];

function generateAutoLevels() {
  for (let lvl = 11; lvl <= 50; lvl++) {
    const progress = (lvl - 11) / 39;
    const enemyCount = 4 + Math.floor(progress * 6);
    const coinCount  = Math.floor(progress * 4);
    const speedBase  = 2 + progress * 3;

    const isHorizontalCourse = lvl % 2 === 1;

    const start = isHorizontalCourse
      ? { x: 40, y: 240 }
      : { x: 320, y: 420 };

    const goal = isHorizontalCourse
      ? { x: 560, y: 220, w: 50, h: 80 }
      : { x: 320, y: 40,  w: 50, h: 50 };

    const walls = [];
    walls.push({ x: 0, y: 0,   w: 640, h: 40 + 20 * (lvl % 3) });
    walls.push({ x: 0, y: 440 - 20 * (lvl % 3), w: 640, h: 40 + 20 * (lvl % 3) });

    if (isHorizontalCourse) {
      for (let i = 0; i < 3; i++) {
        walls.push({
          x: 200 + i * 80,
          y: 120 + (i % 2) * 80,
          w: 30,
          h: 240
        });
      }
    } else {
      for (let i = 0; i < 3; i++) {
        walls.push({
          x: 80 + (i % 2) * 240,
          y: 140 + i * 60,
          w: 200,
          h: 30
        });
      }
    }

    const enemies = [];
    for (let i = 0; i < enemyCount; i++) {
      const speed = speedBase + (i % 3) * 0.5;
      if (i % 2 === 0) {
        const yMin = 80 + 20 * (i % 3);
        const yMax = 400 - 20 * (i % 3);
        enemies.push({
          x: 100 + (i * 40) % 440,
          y: (yMin + yMax) / 2,
          r: 8,
          dx: 0,
          dy: (i % 4 < 2 ? speed : -speed),
          minY: yMin,
          maxY: yMax
        });
      } else {
        const xMin = 80 + 20 * (i % 3);
        const xMax = 560 - 20 * (i % 3);
        enemies.push({
          x: (xMin + xMax) / 2,
          y: 120 + (i * 30) % 240,
          r: 8,
          dx: (i % 4 < 2 ? speed : -speed),
          dy: 0,
          minX: xMin,
          maxX: xMax
        });
      }
    }

    const coins = [];
    for (let i = 0; i < coinCount; i++) {
      coins.push({
        x: 120 + (i * 120),
        y: 120 + ((i + lvl) % 3) * 120,
        r: 6,
        taken: false
      });
    }

    levels.push({ start, goal, walls, enemies, coins });
  }
}
generateAutoLevels();

/* ===== 레벨 로드 ===== */
function loadLevel(index) {
  const level = levels[index];
  player.x = level.start.x;
  player.y = level.start.y;
  player.startX = level.start.x;
  player.startY = level.start.y;
  goal = { ...level.goal };
  walls = level.walls.map(w => ({ ...w }));
  enemies = level.enemies.map(e => ({ ...e }));
  coins = level.coins.map(c => ({ ...c }));
  levelDisplay.textContent = (index + 1).toString();
  deathDisplay.textContent = deaths.toString();
}

/* ===== 충돌 유틸 ===== */
function rectIntersect(a, b) {
  return a.x < b.x + b.w &&
         a.x + a.w > b.x &&
         a.y < b.y + b.h &&
         a.y + a.h > b.y;
}
function circleRectCollide(circle, rect) {
  const closestX = Math.max(rect.x, Math.min(circle.x, rect.x + rect.w));
  const closestY = Math.max(rect.y, Math.min(circle.y, rect.y + rect.h));
  const dx = circle.x - closestX;
  const dy = circle.y - closestY;
  return (dx * dx + dy * dy) < (circle.r * circle.r);
}

/* ===== 모바일 조이스틱 ===== */
let joystickActive = false;
let joystickCenter = { x: 80, y: 80 };
let joystickVector = { x: 0, y: 0 };

if (isMobile) {
  joystickArea.style.display = "block";
  const maxDistance = 40; // 스틱 최대 이동[web:82]

  function updateStickPosition(clientX, clientY) {
    const rect = joystickArea.getBoundingClientRect();
    const localX = clientX - rect.left;
    const localY = clientY - rect.top;

    const dx = localX - joystickCenter.x;
    const dy = localY - joystickCenter.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    const clampedDist = Math.min(dist, maxDistance);
    const angle = Math.atan2(dy, dx);

    const stickX = joystickCenter.x + Math.cos(angle) * clampedDist;
    const stickY = joystickCenter.y + Math.sin(angle) * clampedDist;

    joystickStick.style.left = (stickX - joystickStick.offsetWidth / 2) + "px";
    joystickStick.style.top  = (stickY - joystickStick.offsetHeight / 2) + "px";

    if (dist > 5) {
      joystickVector.x = Math.cos(angle);
      joystickVector.y = Math.sin(angle);
    } else {
      joystickVector.x = 0;
      joystickVector.y = 0;
    }
  }

  joystickArea.addEventListener("touchstart", e => {
    e.preventDefault();
    joystickActive = true;
    const t = e.touches[0];
    updateStickPosition(t.clientX, t.clientY);
  });
  joystickArea.addEventListener("touchmove", e => {
    e.preventDefault();
    if (!joystickActive) return;
    const t = e.touches[0];
    updateStickPosition(t.clientX, t.clientY);
  });
  joystickArea.addEventListener("touchend", e => {
    e.preventDefault();
    joystickActive = false;
    joystickVector.x = 0;
    joystickVector.y = 0;
    joystickStick.style.left = (joystickCenter.x - joystickStick.offsetWidth / 2) + "px";
    joystickStick.style.top  = (joystickCenter.y - joystickStick.offsetHeight / 2) + "px";
  });
}

/* ===== 게임 로직 ===== */
function update() {
  if (gameWon || showLevelMessage) return;

  let vx = 0, vy = 0;

  if (isMobile && joystickActive) {
    vx = joystickVector.x * player.speed;
    vy = joystickVector.y * player.speed;
  } else {
    if (keys["ArrowUp"])    vy -= player.speed;
    if (keys["ArrowDown"])  vy += player.speed;
    if (keys["ArrowLeft"])  vx -= player.speed;
    if (keys["ArrowRight"]) vx += player.speed;
  }

  movePlayerWithCollision(vx, vy);

  enemies.forEach(e => {
    e.x += e.dx || 0;
    e.y += e.dy || 0;
    if (e.minX !== undefined && (e.x < e.minX || e.x > e.maxX)) e.dx *= -1;
    if (e.minY !== undefined && (e.y < e.minY || e.y > e.maxY)) e.dy *= -1;
  });

  for (const e of enemies) {
    if (circleRectCollide(e, player)) {
      deaths++;
      deathDisplay.textContent = deaths.toString();
      player.x = player.startX;
      player.y = player.startY;
      break;
    }
  }

  coins.forEach(c => {
    if (!c.taken) {
      const dx = (player.x + player.w / 2) - c.x;
      const dy = (player.y + player.h / 2) - c.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if (dist < c.r + Math.min(player.w, player.h) / 2) {
        c.taken = true;
      }
    }
  });

  const allCoinsTaken = coins.every(c => c.taken);

  if (rectIntersect(player, goal) && allCoinsTaken) {
    currentLevelIndex++;
    for (const k in keys) keys[k] = false;

    if (currentLevelIndex >= levels.length) {
      gameWon = true;
      showLevelMessage = true;
      levelMessageText = "축하합니다! 50레벨 모두 클리어!\n엔터 키를 눌러 다시 시작할 수 있습니다.";
    } else {
      showLevelMessage = true;
      levelMessageText = "레벨 " + currentLevelIndex + " 클리어!\n스페이스 키를 눌러 다음 레벨로 진행하세요.";
    }
  }
}

function movePlayerWithCollision(vx, vy) {
  if (vx !== 0) {
    player.x += vx;
    for (const w of walls) {
      if (rectIntersect(player, w)) {
        if (vx > 0) player.x = w.x - player.w;
        else        player.x = w.x + w.w;
      }
    }
  }
  if (vy !== 0) {
    player.y += vy;
    for (const w of walls) {
      if (rectIntersect(player, w)) {
        if (vy > 0) player.y = w.y - player.h;
        else        player.y = w.y + w.h;
      }
    }
  }

  player.x = Math.max(0, Math.min(DESIGN_WIDTH  - player.w, player.x));
  player.y = Math.max(0, Math.min(DESIGN_HEIGHT - player.h, player.y));
}

/* ===== 렌더링 ===== */
function draw() {
  ctx.clearRect(0, 0, DESIGN_WIDTH, DESIGN_HEIGHT);

  ctx.fillStyle = "#88dd88";
  ctx.fillRect(0, 0, DESIGN_WIDTH, DESIGN_HEIGHT);

  ctx.fillStyle = "#888888";
  walls.forEach(w => ctx.fillRect(w.x, w.y, w.w, w.h));

  ctx.fillStyle = "#cccc00";
  ctx.fillRect(player.startX - 20, player.startY - 20, 40, 40);

  ctx.fillStyle = "#00aa00";
  ctx.fillRect(goal.x, goal.y, goal.w, goal.h);

  coins.forEach(c => {
    if (!c.taken) {
      ctx.beginPath();
      ctx.arc(c.x, c.y, c.r, 0, Math.PI * 2);
      ctx.fillStyle = "#ffcc00";
      ctx.fill();
    }
  });

  ctx.fillStyle = "#ff0000";
  ctx.fillRect(player.x, player.y, player.w, player.h);

  enemies.forEach(e => {
    ctx.beginPath();
    ctx.arc(e.x, e.y, e.r, 0, Math.PI * 2);
    ctx.fillStyle = "#0077ff";
    ctx.fill();
  });

  if (showLevelMessage) {
    ctx.fillStyle = "rgba(0,0,0,0.6)";
    ctx.fillRect(0, 0, DESIGN_WIDTH, DESIGN_HEIGHT);

    ctx.fillStyle = "#ffffff";
    ctx.textAlign = "center";
    ctx.font = "24px Arial";

    const lines = levelMessageText.split("\n");
    let baseY = DESIGN_HEIGHT / 2 - (lines.length - 1) * 20;
    lines.forEach((line, i) => {
      ctx.fillText(line, DESIGN_WIDTH / 2, baseY + i * 30);
    });
  }
}

/* ===== 메인 루프 ===== */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

/* 시작 */
loadLevel(currentLevelIndex);
loop();
</script>
</body>
</html>
