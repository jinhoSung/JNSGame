<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>세상에서 가장 어려운 게임 - 10레벨</title>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #222;
      font-family: Arial, sans-serif;
      color: #fff;
      user-select: none;
    }
    #gameCanvas {
      background: #eee;
      border: 4px solid #000;
    }
    #ui {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      font-size: 16px;
      text-align: center;
    }
  </style>
</head>
<body>
<div id="ui">
  <div>레벨: <span id="levelDisplay">1</span> / 10</div>
  <div>죽은 횟수: <span id="deathDisplay">0</span></div>
  <div>← ↑ ↓ → 방향키로 이동</div>
</div>
<canvas id="gameCanvas" width="640" height="480"></canvas>

<script>
/* ===== 기본 설정 ===== */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const keys = {};
let currentLevelIndex = 0;
let deaths = 0;
let gameWon = false;

const levelDisplay = document.getElementById("levelDisplay");
const deathDisplay = document.getElementById("deathDisplay");

window.addEventListener("keydown", e => {
  keys[e.key] = true;
  // 레벨 클리어 후 엔터로 다시 시작
  if (gameWon && e.key === "Enter") {
    currentLevelIndex = 0;
    deaths = 0;
    gameWon = false;
    loadLevel(currentLevelIndex);
  }
});
window.addEventListener("keyup", e => keys[e.key] = false);

/* ===== 플레이어 / 구조체 ===== */
const player = { x: 0, y: 0, w: 18, h: 18, speed: 3, startX: 0, startY: 0 };
let goal = { x: 0, y: 0, w: 40, h: 80 };
let walls = [];      // {x,y,w,h}
let enemies = [];    // {x,y,r,dx,dy,minX,maxX,minY,maxY}
let coins = [];      // {x,y,r,taken}

/* ===== 레벨 데이터 (10개) ===== */
/* 각 레벨: 시작/도착, 벽, 적, 코인만 다르게 배치 */
const levels = [
  // 레벨 1: 기본 상하 이동 적
  {
    start: { x: 50, y: 230 },
    goal:  { x: 550, y: 200, w: 60, h: 80 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 120 },
      { x: 0,   y: 360, w: 640, h: 120 }
    ],
    enemies: [
      { x: 200, y: 150, r: 10, dx: 0,  dy: 2, minY: 140, maxY: 340 },
      { x: 260, y: 340, r: 10, dx: 0,  dy: -2, minY: 140, maxY: 340 },
      { x: 320, y: 150, r: 10, dx: 0,  dy: 2, minY: 140, maxY: 340 },
      { x: 380, y: 340, r: 10, dx: 0,  dy: -2, minY: 140, maxY: 340 }
    ],
    coins: []
  },
  // 레벨 2: 좁은 통로 + 상하 적
  {
    start: { x: 40, y: 230 },
    goal:  { x: 560, y: 210, w: 50, h: 60 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 160 },
      { x: 0,   y: 320, w: 640, h: 160 }
    ],
    enemies: [
      { x: 150, y: 170, r: 9, dx: 0, dy: 3, minY: 170, maxY: 310 },
      { x: 220, y: 310, r: 9, dx: 0, dy: -3, minY: 170, maxY: 310 },
      { x: 290, y: 170, r: 9, dx: 0, dy: 3, minY: 170, maxY: 310 },
      { x: 360, y: 310, r: 9, dx: 0, dy: -3, minY: 170, maxY: 310 },
      { x: 430, y: 170, r: 9, dx: 0, dy: 3, minY: 170, maxY: 310 }
    ],
    coins: [
      { x: 120, y: 240, r: 6, taken: false },
      { x: 320, y: 240, r: 6, taken: false },
      { x: 520, y: 240, r: 6, taken: false }
    ]
  },
  // 레벨 3: 좌우 이동 적
  {
    start: { x: 50, y: 230 },
    goal:  { x: 550, y: 210, w: 60, h: 60 },
    walls: [
      { x: 0, y: 0,   w: 640, h: 120 },
      { x: 0, y: 360, w: 640, h: 120 },
      { x: 280, y: 180, w: 80, h: 120 }
    ],
    enemies: [
      { x: 120, y: 170, r: 9, dx: 2.5, dy: 0, minX: 120, maxX: 520 },
      { x: 520, y: 310, r: 9, dx: -2.5, dy: 0, minX: 120, maxX: 520 },
      { x: 120, y: 285, r: 9, dx: 2.5, dy: 0, minX: 120, maxX: 520 }
    ],
    coins: [
      { x: 320, y: 150, r: 6, taken: false },
      { x: 320, y: 330, r: 6, taken: false }
    ]
  },
  // 레벨 4: 십자형 패턴
  {
    start: { x: 300, y: 400 },
    goal:  { x: 300, y: 40, w: 40, h: 40 },
    walls: [
      { x: 0, y: 0, w: 640, h: 40 },
      { x: 0, y: 440, w: 640, h: 40 },
      { x: 0, y: 0, w: 40, h: 480 },
      { x: 600, y: 0, w: 40, h: 480 }
    ],
    enemies: [
      // 상하
      { x: 200, y: 80, r: 9, dx: 0, dy: 3, minY: 80, maxY: 400 },
      { x: 440, y: 400, r: 9, dx: 0, dy: -3, minY: 80, maxY: 400 },
      // 좌우
      { x: 80,  y: 260, r: 9, dx: 3, dy: 0, minX: 80, maxX: 560 },
      { x: 560, y: 220, r: 9, dx: -3, dy: 0, minX: 80, maxX: 560 }
    ],
    coins: [
      { x: 320, y: 260, r: 6, taken: false }
    ]
  },
  // 레벨 5: 좁은 미로 느낌
  {
    start: { x: 60, y: 400 },
    goal:  { x: 560, y: 60, w: 40, h: 40 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 40 },
      { x: 0,   y: 440, w: 640, h: 40 },
      { x: 0,   y: 80,  w: 200, h: 40 },
      { x: 440, y: 80,  w: 200, h: 40 },
      { x: 200, y: 80,  w: 40,  h: 240 },
      { x: 400, y: 200, w: 40,  h: 240 },
      { x: 240, y: 280, w: 160, h: 40 }
    ],
    enemies: [
      { x: 120, y: 120, r: 8, dx: 2, dy: 0, minX: 60, maxX: 340 },
      { x: 520, y: 160, r: 8, dx: -2, dy: 0, minX: 300, maxX: 580 },
      { x: 220, y: 360, r: 8, dx: 2.5, dy: 0, minX: 60, maxX: 380 },
      { x: 420, y: 240, r: 8, dx: 0, dy: 2.5, minY: 120, maxY: 360 }
    ],
    coins: [
      { x: 320, y: 260, r: 6, taken: false },
      { x: 100, y: 420, r: 6, taken: false }
    ]
  },
  // 레벨 6: 코인 전부 먹기
  {
    start: { x: 40, y: 220 },
    goal:  { x: 580, y: 220, w: 40, h: 40 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 80 },
      { x: 0,   y: 400, w: 640, h: 80 },
      { x: 280, y: 80,  w: 80,  h: 240 }
    ],
    enemies: [
      { x: 160, y: 120, r: 9, dx: 0, dy: 3, minY: 100, maxY: 380 },
      { x: 480, y: 380, r: 9, dx: 0, dy: -3, minY: 100, maxY: 380 },
      { x: 160, y: 380, r: 9, dx: 0, dy: -3, minY: 100, maxY: 380 },
      { x: 480, y: 100, r: 9, dx: 0, dy: 3, minY: 100, maxY: 380 }
    ],
    coins: [
      { x: 120, y: 120, r: 6, taken: false },
      { x: 520, y: 120, r: 6, taken: false },
      { x: 120, y: 360, r: 6, taken: false },
      { x: 520, y: 360, r: 6, taken: false }
    ]
  },
  // 레벨 7: 빠른 대각선 느낌 (상하+좌우 섞음)
  {
    start: { x: 40, y: 230 },
    goal:  { x: 560, y: 230, w: 60, h: 60 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 100 },
      { x: 0,   y: 380, w: 640, h: 100 }
    ],
    enemies: [
      { x: 160, y: 150, r: 8, dx: 3.5, dy: 0, minX: 80, maxX: 560 },
      { x: 160, y: 330, r: 8, dx: 3.5, dy: 0, minX: 80, maxX: 560 },
      { x: 560, y: 190, r: 8, dx: -3.5, dy: 0, minX: 80, maxX: 560 },
      { x: 80,  y: 290, r: 8, dx: 3.5, dy: 0, minX: 80, maxX: 560 },
      { x: 320, y: 150, r: 8, dx: 0, dy: 3.5, minY: 120, maxY: 360 }
    ],
    coins: [
      { x: 320, y: 230, r: 6, taken: false }
    ]
  },
  // 레벨 8: 중앙 십자 벽 + 회피
  {
    start: { x: 40, y: 230 },
    goal:  { x: 560, y: 230, w: 60, h: 60 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 80 },
      { x: 0,   y: 400, w: 640, h: 80 },
      { x: 280, y: 80,  w: 80,  h: 140 },
      { x: 280, y: 260, w: 80,  h: 140 }
    ],
    enemies: [
      { x: 160, y: 120, r: 9, dx: 0, dy: 3, minY: 100, maxY: 380 },
      { x: 480, y: 380, r: 9, dx: 0, dy: -3, minY: 100, maxY: 380 },
      { x: 160, y: 380, r: 9, dx: 0, dy: -3, minY: 100, maxY: 380 },
      { x: 480, y: 100, r: 9, dx: 0, dy: 3, minY: 100, maxY: 380 },
      { x: 320, y: 120, r: 9, dx: 3, dy: 0, minX: 80, maxX: 560 },
      { x: 320, y: 360, r: 9, dx: -3, dy: 0, minX: 80, maxX: 560 }
    ],
    coins: [
      { x: 100, y: 240, r: 6, taken: false },
      { x: 540, y: 240, r: 6, taken: false }
    ]
  },
  // 레벨 9: 매우 빠른 적
  {
    start: { x: 60, y: 420 },
    goal:  { x: 560, y: 60, w: 40, h: 40 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 40 },
      { x: 0,   y: 440, w: 640, h: 40 },
      { x: 200, y: 80,  w: 40,  h: 320 },
      { x: 400, y: 80,  w: 40,  h: 320 }
    ],
    enemies: [
      { x: 120, y: 120, r: 8, dx: 3.8, dy: 0, minX: 60, maxX: 180 },
      { x: 320, y: 200, r: 8, dx: -3.8, dy: 0, minX: 220, maxX: 420 },
      { x: 520, y: 360, r: 8, dx: -4.0, dy: 0, minX: 460, maxX: 580 },
      { x: 320, y: 360, r: 8, dx: 0, dy: -3.8, minY: 120, maxY: 360 }
    ],
    coins: [
      { x: 120, y: 420, r: 6, taken: false },
      { x: 320, y: 60,  r: 6, taken: false },
      { x: 520, y: 420, r: 6, taken: false }
    ]
  },
  // 레벨 10: 마지막, 코인 전부 + 빠른 패턴
  {
    start: { x: 40, y: 230 },
    goal:  { x: 580, y: 40, w: 40, h: 40 },
    walls: [
      { x: 0,   y: 0,   w: 640, h: 40 },
      { x: 0,   y: 440, w: 640, h: 40 },
      { x: 200, y: 80,  w: 40,  h: 320 },
      { x: 400, y: 80,  w: 40,  h: 320 },
      { x: 0,   y: 200, w: 200, h: 40 },
      { x: 440, y: 280, w: 200, h: 40 }
    ],
    enemies: [
      { x: 120, y: 120, r: 9, dx: 0, dy: 4, minY: 80,  maxY: 400 },
      { x: 520, y: 400, r: 9, dx: 0, dy: -4, minY: 80, maxY: 400 },
      { x: 220, y: 120, r: 9, dx: 4, dy: 0, minX: 220, maxX: 380 },
      { x: 420, y: 400, r: 9, dx: -4, dy: 0, minX: 260, maxX: 580 },
      { x: 320, y: 240, r: 9, dx: 3.5, dy: 0, minX: 220, maxX: 420 }
    ],
    coins: [
      { x: 100, y: 60,  r: 6, taken: false },
      { x: 100, y: 420, r: 6, taken: false },
      { x: 540, y: 60,  r: 6, taken: false },
      { x: 540, y: 420, r: 6, taken: false },
      { x: 320, y: 240, r: 6, taken: false }
    ]
  }
];

/* ===== 레벨 로드 함수 ===== */
function loadLevel(index) {
  const level = levels[index];
  player.x = level.start.x;
  player.y = level.start.y;
  player.startX = level.start.x;
  player.startY = level.start.y;

  goal = { ...level.goal };
  walls = level.walls.map(w => ({ ...w }));
  enemies = level.enemies.map(e => ({ ...e }));
  coins = level.coins.map(c => ({ ...c }));

  levelDisplay.textContent = (index + 1).toString();
  deathDisplay.textContent = deaths.toString();
}

/* ===== 유틸 함수 ===== */
function rectIntersect(a, b) {
  return a.x < b.x + b.w &&
         a.x + a.w > b.x &&
         a.y < b.y + b.h &&
         a.y + a.h > b.y;
}

function circleRectCollide(circle, rect) {
  // 원-사각형 충돌
  const closestX = Math.max(rect.x, Math.min(circle.x, rect.x + rect.w));
  const closestY = Math.max(rect.y, Math.min(circle.y, rect.y + rect.h));
  const dx = circle.x - closestX;
  const dy = circle.y - closestY;
  return (dx * dx + dy * dy) < (circle.r * circle.r);
}

/* ===== 게임 루프 ===== */
function update() {
  if (gameWon) return;

  // 플레이어 이동
  let vx = 0, vy = 0;
  if (keys["ArrowUp"])    vy -= player.speed;
  if (keys["ArrowDown"])  vy += player.speed;
  if (keys["ArrowLeft"])  vx -= player.speed;
  if (keys["ArrowRight"]) vx += player.speed;

  // 벽 충돌을 고려한 이동
  movePlayerWithCollision(vx, vy);

  // 적 이동
  enemies.forEach(e => {
    e.x += e.dx || 0;
    e.y += e.dy || 0;
    if (e.minX !== undefined && (e.x < e.minX || e.x > e.maxX)) e.dx *= -1;
    if (e.minY !== undefined && (e.y < e.minY || e.y > e.maxY)) e.dy *= -1;
  });

  // 적에 닿으면 사망
  for (const e of enemies) {
    if (circleRectCollide(e, player)) {
      deaths++;
      deathDisplay.textContent = deaths.toString();
      player.x = player.startX;
      player.y = player.startY;
      break;
    }
  }

  // 코인 먹기
  coins.forEach(c => {
    if (!c.taken) {
      const dx = (player.x + player.w / 2) - c.x;
      const dy = (player.y + player.h / 2) - c.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if (dist < c.r + Math.min(player.w, player.h) / 2) {
        c.taken = true;
      }
    }
  });

  // 모든 코인 먹었는지
  const allCoinsTaken = coins.every(c => c.taken);

  // 도착 지점 도달 + 코인 조건
  if (rectIntersect(player, goal) && allCoinsTaken) {
    currentLevelIndex++;
    if (currentLevelIndex >= levels.length) {
      // 모든 레벨 클리어
      gameWon = true;
      alert("축하합니다! 10레벨 모두 클리어!\n엔터 키를 눌러 다시 시작할 수 있습니다.");
    } else {
      alert("레벨 " + currentLevelIndex + " 클리어! 다음 레벨로 갑니다.");
      loadLevel(currentLevelIndex);
    }
  }
}

function movePlayerWithCollision(vx, vy) {
  // X축 이동
  if (vx !== 0) {
    player.x += vx;
    for (const w of walls) {
      if (rectIntersect(player, w)) {
        if (vx > 0) player.x = w.x - player.w;
        else        player.x = w.x + w.w;
      }
    }
  }
  // Y축 이동
  if (vy !== 0) {
    player.y += vy;
    for (const w of walls) {
      if (rectIntersect(player, w)) {
        if (vy > 0) player.y = w.y - player.h;
        else        player.y = w.y + w.h;
      }
    }
  }

  // 화면 밖 방지
  player.x = Math.max(0, Math.min(canvas.width  - player.w, player.x));
  player.y = Math.max(0, Math.min(canvas.height - player.h, player.y));
}

/* ===== 렌더링 ===== */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // 배경
  ctx.fillStyle = "#88dd88";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // 벽
  ctx.fillStyle = "#888888";
  walls.forEach(w => {
    ctx.fillRect(w.x, w.y, w.w, w.h);
  });

  // 시작 영역
  ctx.fillStyle = "#cccc00";
  ctx.fillRect(player.startX - 20, player.startY - 20, 40, 40);

  // 도착 지점
  ctx.fillStyle = "#00aa00";
  ctx.fillRect(goal.x, goal.y, goal.w, goal.h);

  // 코인
  coins.forEach(c => {
    if (!c.taken) {
      ctx.beginPath();
      ctx.arc(c.x, c.y, c.r, 0, Math.PI * 2);
      ctx.fillStyle = "#ffcc00";
      ctx.fill();
    }
  });

  // 플레이어
  ctx.fillStyle = "#ff0000";
  ctx.fillRect(player.x, player.y, player.w, player.h);

  // 적
  enemies.forEach(e => {
    ctx.beginPath();
    ctx.arc(e.x, e.y, e.r, 0, Math.PI * 2);
    ctx.fillStyle = "#0077ff";
    ctx.fill();
  });

  // 게임 클리어 메시지
  if (gameWon) {
    ctx.fillStyle = "rgba(0,0,0,0.6)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#ffffff";
    ctx.textAlign = "center";
    ctx.font = "28px Arial";
    ctx.fillText("모든 레벨 클리어!", canvas.width / 2, canvas.height / 2 - 10);
    ctx.font = "20px Arial";
    ctx.fillText("엔터 키를 눌러 다시 시작", canvas.width / 2, canvas.height / 2 + 30);
  }
}

/* ===== 메인 루프 ===== */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

/* 시작 */
loadLevel(currentLevelIndex);
loop();
</script>
</body>
</html>
