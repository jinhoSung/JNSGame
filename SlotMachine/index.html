<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sea Story - Neon Jackpot (Shop Update v2)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Do+Hyeon&family=Orbitron:wght@700&display=swap');

        :root {
            --neon-cyan: #00f3ff;
            --neon-mint: #00ff9d;
            --neon-purple: #bc13fe;
            --neon-pink: #ff0055;
            --neon-gold: #ffd700;
        }

        body {
            font-family: 'Do Hyeon', sans-serif;
            background-color: #000;
            color: white;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            padding-bottom: 3vh;
            user-select: none;
            -webkit-user-select: none;
        }

        /* 1. ë°°ê²½ ë¹„ë””ì˜¤ & íš¨ê³¼ */
        .bg-video {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -5;
            filter: brightness(0.7);
        }

        .deep-sea-bg {
            position: absolute;
            inset: 0;
            background-color: #0b1026; 
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            transition: background-image 0.5s ease-in-out;
            z-index: -6;
            display: none;
        }
        
        .aurora {
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, rgba(0, 243, 255, 0.05), rgba(188, 19, 254, 0.05));
            filter: blur(50px);
            animation: auroraMove 10s infinite alternate;
            z-index: -4;
        }
        @keyframes auroraMove { 0% { opacity: 0.3; } 100% { opacity: 0.7; } }

        .bubble-container {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: -3;
            overflow: hidden;
        }
        .bubble {
            position: absolute;
            bottom: -20px;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.1));
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: rise var(--duration) linear infinite;
            left: var(--left);
            width: var(--size);
            height: var(--size);
            opacity: 0;
        }
        @keyframes rise {
            0% { transform: translateY(0) scale(1); opacity: 0.6; }
            100% { transform: translateY(-110vh) scale(1.2); opacity: 0; }
        }

        /* 2. ê²Œì„ ìºë¹„ë‹› */
        .cabinet {
            position: relative;
            width: 95%;
            max-width: 1100px;
            aspect-ratio: 16 / 9;
            max-height: 70vh; 
            background: rgba(17, 17, 17, 0.6);
            border-radius: 20px;
            border: 2px solid rgba(51, 51, 51, 0.7);
            box-shadow: 
                0 0 0 4px rgba(0,0,0,0.5),
                0 0 0 6px rgba(0, 243, 255, 0.6),
                0 0 50px rgba(0, 243, 255, 0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: translateZ(0);
            backdrop-filter: blur(2px);
            z-index: 10;
        }

        @media (max-aspect-ratio: 1/1) {
            .cabinet {
                aspect-ratio: 3 / 4.2; 
                max-width: 500px;
                max-height: 60vh; 
                margin-bottom: 2vh;
            }
        }

        /* 3. í—¤ë” */
        .header {
            flex: 0 0 45px;
            background: linear-gradient(to bottom, rgba(34, 34, 34, 0.65), rgba(0, 0, 0, 0.6));
            border-bottom: 1px solid rgba(255, 215, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            z-index: 30;
        }
        .logo-text {
            font-family: 'Black Han Sans', sans-serif;
            font-size: 1.5rem;
            background: linear-gradient(to right, #fff, var(--neon-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
            white-space: nowrap;
        }
        .header-icons { display: flex; align-items: center; }
        .header-icons button {
            background: none;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: rgba(255,255,255,0.7);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-left: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .header-icons button:hover { color: #fff; border-color: #fff; background: rgba(255,255,255,0.1); }
        
        /* ì•Œë¦¼ ë°°ì§€ (ë¹¨ê°„ ì ) */
        .badge {
            position: absolute;
            top: -2px; right: -2px;
            width: 10px; height: 10px;
            background-color: #ff0055;
            border-radius: 50%;
            border: 1px solid #fff;
            display: none;
        }
        .badge.active { display: block; }

        .diamond-display {
            display: flex;
            align-items: center;
            background: rgba(0,0,0,0.5);
            padding: 2px 10px;
            border-radius: 15px;
            border: 1px solid var(--neon-purple);
            margin-right: 10px;
            font-family: 'Orbitron', monospace;
            color: #fff;
        }

        /* 4. ë¦´ ì˜ì—­ */
        .reel-area {
            flex: 1;
            position: relative;
            background: rgba(0, 0, 0, 0.15);
            display: flex;
            padding: 5px;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        .reels-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            width: 100%;
            height: 100%;
            position: relative;
            gap: 2px;
            z-index: 5;
        }

        .reel-col {
            position: relative;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.1); 
            border-radius: 4px;
        }
        
        .reel-col::after {
            content: '';
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: linear-gradient(180deg, 
                rgba(0,0,0,0.6) 0%, 
                rgba(0,0,0,0.2) 10%,
                rgba(255,255,255,0.08) 25%, 
                rgba(255,255,255,0.01) 40%, 
                rgba(255,255,255,0.01) 60%, 
                rgba(255,255,255,0.08) 75%, 
                rgba(0,0,0,0.2) 90%,
                rgba(0,0,0,0.6) 100%);
            z-index: 20;
            border-left: 1px solid rgba(255,255,255,0.03);
            border-right: 1px solid rgba(0,0,0,0.3);
        }

        .reel-strip {
            display: flex;
            flex-direction: column;
            will-change: transform;
        }

        .symbol-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            border-top: 1px solid rgba(255,255,255,0.03);
            border-bottom: 1px solid rgba(0,0,0,0.3);
            background: rgba(20, 20, 20, 0.2); 
            position: relative;
            margin: 0; 
            overflow: hidden; 
        }

        .symbol {
            font-size: 2rem; 
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.6));
            transform: scale(0.9);
            z-index: 10;
            line-height: 1; 
        }

        .symbol-wrapper.win-highlight {
            background: linear-gradient(to bottom, rgba(42, 42, 42, 0.7), rgba(34, 34, 34, 0.7));
            border: 2px solid rgba(255, 215, 0, 0.8);
            z-index: 15;
            box-shadow: inset 0 0 15px rgba(255, 215, 0, 0.5);
        }
        .symbol-wrapper.win-highlight .symbol {
            transform: scale(1.15);
            filter: drop-shadow(0 0 15px var(--neon-gold)) brightness(1.3);
        }

        /* 5. ê°€ë¡œ ë¼ì¸ */
        .grid-lines {
            position: absolute;
            top: 5px; left: 5px; right: 5px; bottom: 5px;
            pointer-events: none;
            z-index: 25;
        }
        .horizontal-line {
            position: absolute;
            left: 0; right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--neon-gold), transparent);
            opacity: 0.3;
            box-shadow: 0 0 2px var(--neon-gold);
        }

        /* 6. í•˜ë‹¨ ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel {
            flex: 0 0 auto;
            min-height: 75px; 
            background: linear-gradient(to top, rgba(21, 21, 21, 0.7), rgba(0, 0, 0, 0.6));
            border-top: 1px solid rgba(51, 51, 51, 0.7);
            padding: 8px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 50;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }

        .lcd-display {
            background: rgba(5, 5, 5, 0.6);
            border: 1px solid rgba(51, 51, 51, 0.7);
            border-radius: 6px;
            padding: 4px 8px;
            min-width: 70px;
            box-shadow: inset 0 0 5px rgba(255,255,255,0.05);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .lcd-label { font-size: 0.6rem; color: #888; margin-bottom: 2px; }
        .lcd-value { font-family: 'Orbitron', monospace; font-size: 1rem; color: #fff; text-align: right; line-height: 1; }
        .text-neon-gold { color: var(--neon-gold); text-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
        .text-neon-green { color: var(--neon-mint); text-shadow: 0 0 5px rgba(0, 255, 157, 0.5); }

        .btn-group { display: flex; gap: 8px; align-items: center; }

        .game-btn {
            border: none;
            border-radius: 50%;
            color: white;
            font-weight: bold;
            font-family: 'Do Hyeon', sans-serif;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            box-shadow: 0 4px 0 rgba(0,0,0,0.7), 0 5px 10px rgba(0,0,0,0.3);
            transition: transform 0.1s;
            position: relative;
            overflow: hidden;
            background: rgba(68, 68, 68, 0.8);
        }
        .game-btn::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 45%;
            background: linear-gradient(to bottom, rgba(255,255,255,0.4), transparent);
            border-radius: 50% 50% 0 0;
        }
        .game-btn:active { transform: translateY(4px); box-shadow: 0 0 0 #000; }
        .game-btn:disabled {
            filter: brightness(0.5);
            cursor: not-allowed;
            transform: translateY(4px);
            box-shadow: none;
            opacity: 1 !important;
        }

        .btn-auto.active {
            background: radial-gradient(circle at 50% 50%, #00ff00, #006600);
            box-shadow: 0 0 10px #00ff00, 0 4px 0 #003300;
            color: #000;
        }

        .btn-bet { width: 50px; height: 50px; font-size: 0.75rem; background: radial-gradient(circle at 50% 50%, #4a90e2, #004488); }
        .btn-max { width: 50px; height: 50px; font-size: 0.75rem; background: radial-gradient(circle at 50% 50%, #9b59b6, #5b2c6f); }
        .btn-auto { width: 50px; height: 50px; font-size: 0.75rem; background: radial-gradient(circle at 50% 50%, #555, #222); }
        
        .btn-spin { 
            width: 70px; height: 70px; font-size: 1.3rem; 
            background: radial-gradient(circle at 50% 50%, #ff5252, #a70000); 
            border: 2px solid #ff8a80; 
        }
        .btn-spin.stop-mode {
            background: radial-gradient(circle at 50% 50%, #ffaa00, #995500);
            border: 2px solid #ffeeaa;
            font-size: 1rem;
        }

        /* ì˜¤ë²„ë ˆì´ë“¤ */
        .lines-layer {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 40;
        }
        .win-float-text {
            position: absolute;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            font-size: 1.5rem;
            color: #fff;
            background: rgba(0,0,0,0.6);
            padding: 4px 12px;
            border-radius: 20px;
            border: 2px solid currentColor;
            z-index: 60;
            transform: translate(-50%, -50%);
            white-space: nowrap;
            box-shadow: 0 0 15px currentColor;
            animation: popUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transition: top 0.3s ease, left 0.3s ease; 
        }
        @keyframes popUp { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; } }

        .free-spin-notice {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 0, 85, 0.8);
            color: white;
            padding: 5px 20px;
            border-radius: 20px;
            font-family: 'Black Han Sans', sans-serif;
            font-size: 1.2rem;
            z-index: 55;
            box-shadow: 0 0 20px #ff0055;
            border: 2px solid rgba(255,255,255,0.8);
            display: none;
            animation: pulse 1s infinite;
        }
        @keyframes pulse { 0% { transform: translateX(-50%) scale(1); } 50% { transform: translateX(-50%) scale(1.05); } }

        .jackpot-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .jackpot-msg {
            font-family: 'Black Han Sans', sans-serif;
            font-size: 4rem;
            color: var(--neon-gold);
            text-shadow: 0 0 20px var(--neon-gold);
            animation: bounce 1s infinite;
        }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        /* ì—…ì  í† ìŠ¤íŠ¸ ì•Œë¦¼ */
        .toast-notification {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: 0 0 15px rgba(37, 117, 252, 0.5);
            font-family: 'Do Hyeon', sans-serif;
            font-size: 1.1rem;
            z-index: 90;
            opacity: 0;
            transition: opacity 0.5s, transform 0.5s;
            pointer-events: none;
            white-space: nowrap;
            border: 2px solid rgba(255,255,255,0.3);
        }
        .toast-notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        /* ê³µí†µ íŒì—… ìŠ¤íƒ€ì¼ */
        .popup-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
            backdrop-filter: blur(5px);
        }
        .popup-content {
            background: rgba(20, 20, 25, 0.95);
            border: 2px solid var(--neon-cyan);
            border-radius: 12px;
            padding: 20px;
            max-width: 95%;
            max-height: 85vh;
            width: 500px;
            overflow-y: auto;
            box-shadow: 0 0 30px var(--neon-cyan);
            color: #fff;
        }
        .popup-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 10px; }
        .popup-title { font-size: 1.5rem; color: var(--neon-gold); font-family: 'Black Han Sans', sans-serif; }
        .popup-close { background: none; border: none; font-size: 1.5rem; color: #fff; cursor: pointer; }
        
        /* ìƒì  ìŠ¤íƒ€ì¼ */
        .shop-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .shop-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .shop-item h4 { color: var(--neon-mint); margin-bottom: 5px; font-size: 1rem; font-weight: bold; }
        .shop-item p { font-size: 0.8rem; color: #aaa; margin-bottom: 8px; line-height: 1.2; }
        .shop-btn {
            background: linear-gradient(to right, #6a11cb 0%, #2575fc 100%);
            border: none;
            padding: 8px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9rem;
            transition: transform 0.1s;
        }
        .shop-btn:active { transform: scale(0.95); }
        .shop-btn:disabled { filter: grayscale(1); opacity: 0.6; cursor: not-allowed; }
        .price-tag { display: flex; align-items: center; justify-content: center; gap: 4px; }
        .discount-tag { font-size: 0.7em; color: #ffeb3b; background: rgba(0,0,0,0.5); padding: 1px 4px; border-radius: 4px; margin-left: 4px; }

        .upgrade-level { font-size: 0.7rem; color: var(--neon-gold); margin-top: 2px; }

        /* ì—…ì  ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .achievement-list { display: flex; flex-direction: column; gap: 8px; }
        .achievement-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .ach-info { display: flex; flex-direction: column; text-align: left; }
        .ach-title { font-weight: bold; color: var(--neon-cyan); font-size: 0.9rem; }
        .ach-desc { font-size: 0.75rem; color: #aaa; }
        .ach-reward { font-size: 0.75rem; color: var(--neon-gold); margin-top: 2px; }
        .ach-btn {
            background: #444;
            border: 1px solid #666;
            color: #ccc;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: not-allowed;
        }
        .ach-btn.claimable {
            background: linear-gradient(to right, #11998e, #38ef7d);
            color: #000;
            font-weight: bold;
            border: none;
            cursor: pointer;
            animation: pulse-btn 1s infinite;
        }
        .ach-btn.completed {
            background: transparent;
            border: 1px solid var(--neon-mint);
            color: var(--neon-mint);
        }
        @keyframes pulse-btn { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

    </style>
</head>
<body>

    <video id="bg-video" class="bg-video" autoplay muted loop playsinline></video>
    <div class="deep-sea-bg"></div>
    <div class="aurora"></div>
    <div id="bubble-container" class="bubble-container"></div>

    <div class="cabinet" id="gameCabinet">
        <header class="header">
            <div style="display: flex; align-items: center;">
                <div class="logo-text">SEA STORY <span style="font-size:0.6em; color:var(--neon-gold);">NEON</span></div>
            </div>
            
            <div style="display: flex; align-items: center;">
                <div class="diamond-display" title="ë‹¤ì´ì•„ëª¬ë“œ">
                    ğŸ’ <span id="diamond-display-val">50</span>
                </div>
                <div class="header-icons">
                    <button id="btn-sound" onclick="toggleSound()">ğŸ”Š</button>
                    <button onclick="toggleShop()">ğŸ›’</button>
                    <button onclick="toggleAchievements()" style="position:relative;">
                        ğŸ†
                        <div id="ach-badge" class="badge"></div>
                    </button>
                    <button id="btn-tip" onclick="toggleTipPopup()">â„¹ï¸</button>
                    <button onclick="toggleFullscreen()">â›¶</button>
                </div>
            </div>
        </header>

        <div class="reel-area" id="reelArea">
            <div id="free-spin-ui" class="free-spin-notice">FREE SPIN: 10</div>
            
            <div class="grid-lines">
                <div class="horizontal-line" style="top: 33.3%;"></div>
                <div class="horizontal-line" style="top: 66.6%;"></div>
            </div>

            <div class="reels-container" id="reelsContainer">
                <div class="reel-col"><div class="reel-strip" id="reel0"></div></div>
                <div class="reel-col"><div class="reel-strip" id="reel1"></div></div>
                <div class="reel-col"><div class="reel-strip" id="reel2"></div></div>
                <div class="reel-col"><div class="reel-strip" id="reel3"></div></div>
                <div class="reel-col"><div class="reel-strip" id="reel4"></div></div>
            </div>

            <svg id="lines-svg" class="lines-layer"></svg>
            <div id="text-layer" class="lines-layer" style="z-index:60;"></div>
        </div>

        <footer class="control-panel">
            <div style="display:flex; gap:10px;">
                <div class="lcd-display">
                    <span class="lcd-label">CREDIT</span>
                    <span class="lcd-value text-neon-gold" id="credit-display">10000</span>
                </div>
                <div class="lcd-display">
                    <span class="lcd-label">WIN</span>
                    <span class="lcd-value text-neon-green" id="win-display">0</span>
                </div>
                <div class="lcd-display hidden md:flex"> 
                    <span class="lcd-label">BET</span>
                    <span class="lcd-value" id="bet-display-lcd">200</span>
                </div>
            </div>

            <div class="btn-group">
                <button class="game-btn btn-auto" onclick="toggleAuto()" id="btn-auto">
                    AUTO<br><span style="font-size:0.6em" id="auto-count-display">0</span>
                </button>
                <button class="game-btn btn-bet" onclick="changeBet()" id="btn-bet">
                    BET<br><span style="font-size:0.8em; color:#ddd;" id="btn-bet-val">250</span>
                </button>
                <button class="game-btn btn-spin" onclick="handleSpinClick()" id="btn-spin">SPIN</button>
            </div>
        </footer>

        <div id="jackpot-overlay" class="jackpot-overlay">
            <div class="jackpot-msg">JACKPOT!</div>
            <div style="font-size:3rem; color:#fff; margin-top:10px;" id="jackpot-amount">+5000</div>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
    <div id="toast" class="toast-notification">ì—…ì  ë‹¬ì„±!</div>

    <!-- ìƒì  íŒì—… -->
    <div id="shop-popup" class="popup-overlay" onclick="if(event.target===this)toggleShop()">
        <div class="popup-content">
            <div class="popup-header">
                <div class="popup-title">ì•„ì´í…œ ìƒì </div>
                <button class="popup-close" onclick="toggleShop()">Ã—</button>
            </div>
            
            <div style="margin-bottom: 15px; text-align: right; color: var(--neon-cyan);">
                ë³´ìœ  ë‹¤ì´ì•„ëª¬ë“œ: ğŸ’ <span id="shop-diamond-val">50</span>
            </div>

            <div class="shop-grid">
                <!-- í¬ë ˆë”§ 1ë§Œ -->
                <div class="shop-item">
                    <h4>1ë§Œ í¬ë ˆë”§</h4>
                    <p>ê¸°ë³¸ ì¶©ì „</p>
                    <button class="shop-btn" onclick="buyItem('credit_10k')">
                        <div class="price-tag">ğŸ’ 10</div>
                    </button>
                </div>
                <!-- í¬ë ˆë”§ 10ë§Œ -->
                <div class="shop-item">
                    <h4>10ë§Œ í¬ë ˆë”§</h4>
                    <p>ëŒ€ëŸ‰ ì¶©ì „ (10% í• ì¸)</p>
                    <button class="shop-btn" onclick="buyItem('credit_100k')">
                        <div class="price-tag">ğŸ’ 90 <span class="discount-tag">-10%</span></div>
                    </button>
                </div>
                <!-- í¬ë ˆë”§ 100ë§Œ -->
                <div class="shop-item">
                    <h4>100ë§Œ í¬ë ˆë”§</h4>
                    <p>ì´ˆëŒ€ëŸ‰ ì¶©ì „ (20% í• ì¸)</p>
                    <button class="shop-btn" onclick="buyItem('credit_1m')">
                        <div class="price-tag">ğŸ’ 800 <span class="discount-tag">-20%</span></div>
                    </button>
                </div>
                
                <!-- ì˜¤í†  -->
                <div class="shop-item">
                    <h4>ì˜¤í†  ìŠ¤í•€ í‹°ì¼“</h4>
                    <p>50íšŒ ì¶©ì „</p>
                    <button class="shop-btn" onclick="buyItem('auto')">
                        <div class="price-tag">ğŸ’ 5</div>
                    </button>
                </div>
                
                <!-- ë°°íŒ… -->
                <div class="shop-item">
                    <h4>ë°°íŒ… í•œë„ í•´ê¸ˆ</h4>
                    <p>ë‹¤ìŒ ë‹¨ê³„ ì ê¸ˆ í•´ì œ</p>
                    <div class="upgrade-level" id="bet-unlock-msg">í˜„ì¬: 250</div>
                    <button class="shop-btn" id="btn-unlock-bet" onclick="buyItem('unlock_bet')">
                        <div class="price-tag">ğŸ’ 100</div>
                    </button>
                </div>
                <!-- ì†ë„ -->
                <div class="shop-item">
                    <h4>í„°ë³´ ëª¨í„°</h4>
                    <p>ë¦´ íšŒì „ ì†ë„ ì¦ê°€</p>
                    <div class="upgrade-level" id="speed-level-msg">Lv. 1</div>
                    <button class="shop-btn" id="btn-upgrade-speed" onclick="buyItem('speed')">
                        <div class="price-tag">ğŸ’ 50</div>
                    </button>
                </div>
                <!-- í–‰ìš´ (í•˜) -->
                <div class="shop-item">
                    <h4>í–‰ìš´ (ì¼ë°˜)</h4>
                    <p>ì¼ë°˜ ì‹¬ë³¼ í™•ë¥  ì¦ê°€</p>
                    <div class="upgrade-level" id="luck-common-lvl">Lv. 0</div>
                    <button class="shop-btn" onclick="buyItem('luck_common')" id="btn-luck-common">
                        <div class="price-tag">ğŸ’ <span id="cost-luck-common">20</span></div>
                    </button>
                </div>
                <!-- í–‰ìš´ (ì¤‘) -->
                <div class="shop-item">
                    <h4>í–‰ìš´ (í¬ê·€)</h4>
                    <p>í¬ê·€ ì‹¬ë³¼ í™•ë¥  ì¦ê°€</p>
                    <div class="upgrade-level" id="luck-rare-lvl">Lv. 0</div>
                    <button class="shop-btn" onclick="buyItem('luck_rare')" id="btn-luck-rare">
                        <div class="price-tag">ğŸ’ <span id="cost-luck-rare">50</span></div>
                    </button>
                </div>
                <!-- í–‰ìš´ (ìƒ) -->
                <div class="shop-item" style="grid-column: span 2;">
                    <h4>í–‰ìš´ (ì „ì„¤)</h4>
                    <p>ì „ì„¤ ì‹¬ë³¼ í™•ë¥  ì¦ê°€</p>
                    <div class="upgrade-level" id="luck-legend-lvl">Lv. 0</div>
                    <button class="shop-btn" onclick="buyItem('luck_legend')" id="btn-luck-legend">
                        <div class="price-tag">ğŸ’ <span id="cost-luck-legend">100</span></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì—…ì  íŒì—… -->
    <div id="ach-popup" class="popup-overlay" onclick="if(event.target===this)toggleAchievements()">
        <div class="popup-content">
            <div class="popup-header">
                <div class="popup-title">ì—…ì  (Achievements)</div>
                <button class="popup-close" onclick="toggleAchievements()">Ã—</button>
            </div>
            <div class="achievement-list" id="ach-list-container">
                <!-- JSë¡œ ë™ì  ìƒì„±ë¨ -->
            </div>
        </div>
    </div>

    <!-- TIP íŒì—… -->
    <div id="tip-popup" class="popup-overlay" onclick="if(event.target===this)toggleTipPopup()">
        <div class="popup-content">
            <div class="popup-header">
                <div class="popup-title">ê²Œì„ ì •ë³´</div>
                <button class="popup-close" onclick="toggleTipPopup()">Ã—</button>
            </div>
            
            <div class="tip-section">
                <h3>ê²Œì„ ë°©ë²•</h3>
                <p>SPIN ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¦´ì„ íšŒì „ì‹œí‚¤ì„¸ìš”. ì™¼ìª½ì—ì„œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë™ì¼í•œ ì‹¬ë³¼ì´ 3ê°œ ì´ìƒ ì—°ê²°ë˜ë©´ ë‹¹ì²¨ë©ë‹ˆë‹¤.</p>
                <p style="color:#aaa; font-size:0.9rem; margin-top:5px;">â€» í¬ë ˆë”§ì´ ë¶€ì¡±í•˜ë©´ ë¬´ë£Œ ì¶©ì „(5,000)ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
            </div>
            <div class="tip-section">
                <h3>ì—…ì  ì‹œìŠ¤í…œ</h3>
                <p>ì´ 500ê°œ ì´ìƒì˜ ì—…ì ì´ ì¤€ë¹„ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ìŠ¤í•€, ë‹¹ì²¨, ì­íŒŸ ë“±ì„ ë‹¬ì„±í•˜ê³  ğŸ† ë²„íŠ¼ì„ ëˆŒëŸ¬ ë³´ìƒì„ ë°›ìœ¼ì„¸ìš”!</p>
            </div>
            <div class="tip-section">
                <h3>ë‹¹ì²¨ ì¡±ë³´ (ë°°ë‹¹ë¥ )</h3>
                <div class="paytable-grid">
                    <div class="paytable-item">ğŸš: x5 ~ x50</div>
                    <div class="paytable-item">ğŸ¡: x10 ~ x100</div>
                    <div class="paytable-item">ğŸ™: x15 ~ x150</div>
                    <div class="paytable-item">ğŸ : x20 ~ x200</div>
                    <div class="paytable-item">ğŸ¦€: x25 ~ x250</div>
                    <div class="paytable-item">ğŸ¦: x30 ~ x300</div>
                    <div class="paytable-item">ğŸ¦‘: x40 ~ x400</div>
                    <div class="paytable-item">ğŸ¢: x50 ~ x500</div>
                    <div class="paytable-item">ğŸ¦ˆ: x100 ~ x1000</div>
                    <div class="paytable-item">ğŸ’: x30 ~ x300</div>
                    <div class="paytable-item">7ï¸âƒ£: x100 ~ x5000</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let isSoundOn = true;
        let spinOscillator = null; 
        let lfoOscillator = null;

        const backgroundConfig = [
            { filename: 'img/img1.jpg', ratio: 16 / 9 },
            { filename: 'img/img2.jpg', ratio: 16 / 10 },
            { filename: 'img/img3.jpg', ratio: 9 / 16 }
        ];

        function updateBackground() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            const currentRatio = width / height;
            let closestImage = backgroundConfig[0];
            let minDiff = Math.abs(currentRatio - closestImage.ratio);
            for (let i = 1; i < backgroundConfig.length; i++) {
                const diff = Math.abs(currentRatio - backgroundConfig[i].ratio);
                if (diff < minDiff) { minDiff = diff; closestImage = backgroundConfig[i]; }
            }
            const bgElement = document.querySelector('.deep-sea-bg');
            if (bgElement) {
                const newBg = `linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)), url('${closestImage.filename}')`;
                if (bgElement.style.backgroundImage !== newBg) bgElement.style.backgroundImage = newBg;
            }
        }

        function updateBackgroundVideo() {
            const video = document.getElementById('bg-video');
            const bgImage = document.querySelector('.deep-sea-bg');
            const width = window.innerWidth;
            const height = window.innerHeight;
            const isLandscape = width > height;
            const newSrc = isLandscape ? 'move1.mp4' : 'move2.mp4';
            
            video.onerror = function() {
                video.style.display = 'none';
                if(bgImage) { bgImage.style.display = 'block'; updateBackground(); }
            };

            const currentSrc = video.getAttribute('src');
            if (currentSrc !== newSrc) {
                video.style.display = 'block';
                if(bgImage) bgImage.style.display = 'none';
                video.src = newSrc;
                video.load();
                video.play().catch(e => {});
            }
        }

        // --- ì‚¬ìš´ë“œ ---
        function playTone(freq, type, duration, vol=0.1) {
            if(!isSoundOn) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function startSpinSound() {
            if(!isSoundOn) return;
            if(spinOscillator) return;
            spinOscillator = audioCtx.createOscillator();
            spinOscillator.type = 'triangle';
            spinOscillator.frequency.setValueAtTime(800, audioCtx.currentTime); 
            lfoOscillator = audioCtx.createOscillator();
            lfoOscillator.type = 'square';
            lfoOscillator.frequency.setValueAtTime(20, audioCtx.currentTime); 
            const modGain = audioCtx.createGain();
            modGain.gain.value = 100; 
            lfoOscillator.connect(modGain);
            modGain.connect(spinOscillator.frequency);
            const mainGain = audioCtx.createGain();
            mainGain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            spinOscillator.connect(mainGain);
            mainGain.connect(audioCtx.destination);
            spinOscillator.start();
            lfoOscillator.start();
        }

        function stopSpinSound() {
            if(spinOscillator) {
                try { spinOscillator.stop(); if(lfoOscillator) lfoOscillator.stop(); } catch(e){}
                spinOscillator = null; lfoOscillator = null;
            }
        }

        function playReelStopSound() {
            if(!isSoundOn) return;
            const bufferSize = audioCtx.sampleRate * 0.05; 
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) data[i] = (Math.random() * 2 - 1) * 0.8; 
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            const noiseGain = audioCtx.createGain();
            noiseGain.gain.setValueAtTime(0.8, audioCtx.currentTime);
            noiseGain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
            noise.connect(noiseGain); noiseGain.connect(audioCtx.destination);
            noise.start(); 
            noise.stop(audioCtx.currentTime + 0.1); 
        }

        function createBubbles() {
            const container = document.getElementById('bubble-container');
            for(let i=0; i<15; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                const size = Math.random() * 20 + 10;
                bubble.style.setProperty('--size', `${size}px`);
                bubble.style.setProperty('--left', `${Math.random() * 100}%`);
                bubble.style.setProperty('--duration', `${Math.random() * 5 + 5}s`);
                bubble.style.animationDelay = `${Math.random() * 5}s`;
                container.appendChild(bubble);
            }
        }

        // --- ë°ì´í„° ê´€ë¦¬ (ì €ì¥/ë¡œë“œ) ---
        let gameState = {
            credit: 10000,
            diamond: 50,
            autoSpins: 0,
            unlockedBetIndex: 1, // ì´ˆê¸° ë°°íŒ… 250, 500 ê°€ëŠ¥í•˜ë„ë¡ 1ë¡œ ì„¤ì •
            speedLevel: 0,
            luck: { common: 0, rare: 0, legend: 0 },
            // í†µê³„ (ì—…ì ìš©)
            stats: {
                spins: 0,
                totalWin: 0,
                diamondsEarned: 0,
                jackpots: 0,
                freeSpins: 0
            },
            // ì—…ì  ë‹¬ì„± ìƒíƒœ (ID: boolean)
            achievements: {} 
        };

        function loadData() {
            const saved = localStorage.getItem('seaStorySaveV4'); // ë²„ì „ ì—…ë°ì´íŠ¸ V4
            if (saved) {
                const parsed = JSON.parse(saved);
                // ê¸°ì¡´ ë°ì´í„°ì™€ ë³‘í•© (ìƒˆë¡œìš´ í•„ë“œ ì¶”ê°€ ëŒ€ë¹„)
                gameState = { ...gameState, ...parsed };
                // ì¤‘ì²© ê°ì²´ ë³‘í•© (stats, luck ë“±)
                if(parsed.stats) gameState.stats = { ...gameState.stats, ...parsed.stats };
                if(parsed.luck) gameState.luck = { ...gameState.luck, ...parsed.luck };
                if(parsed.achievements) gameState.achievements = { ...gameState.achievements, ...parsed.achievements };
            }
            credit = gameState.credit;
            diamonds = gameState.diamond;
            autoSpinCount = gameState.autoSpins;
        }

        function saveData() {
            gameState.credit = credit;
            gameState.diamond = diamonds;
            gameState.autoSpins = autoSpinCount;
            localStorage.setItem('seaStorySaveV4', JSON.stringify(gameState));
        }

        // --- ì—…ì  ì‹œìŠ¤í…œ ë°ì´í„° ìƒì„± ---
        const ACHIEVEMENTS = [];
        
        function generateAchievements() {
            // 1. ìŠ¤í•€ íšŸìˆ˜ ì—…ì  (100ë‹¨ê³„)
            for(let i=1; i<=100; i++) {
                const target = i * (i <= 10 ? 10 : (i <= 50 ? 50 : 100)); // ë‚œì´ë„ ì¡°ì ˆ
                ACHIEVEMENTS.push({
                    id: `spin_${i}`,
                    title: `ëˆê¸°ì˜ íšŒì „ Lv.${i}`,
                    desc: `ì´ ìŠ¤í•€ ${target.toLocaleString()}íšŒ ë‹¬ì„±`,
                    type: 'spins',
                    target: target,
                    reward: { credit: 1000 * i, diamond: 1 * i }
                });
            }
            // 2. ëˆ„ì  ë‹¹ì²¨ê¸ˆ ì—…ì  (100ë‹¨ê³„)
            for(let i=1; i<=100; i++) {
                const target = i * 50000;
                ACHIEVEMENTS.push({
                    id: `win_${i}`,
                    title: `ë¶€ìì˜ ê¸¸ Lv.${i}`,
                    desc: `ëˆ„ì  ë‹¹ì²¨ê¸ˆ ${target.toLocaleString()} ë‹¬ì„±`,
                    type: 'totalWin',
                    target: target,
                    reward: { credit: 5000 * i, diamond: 2 * i }
                });
            }
            // 3. ë‹¤ì´ì•„ëª¬ë“œ ìˆ˜ì§‘ ì—…ì  (100ë‹¨ê³„)
            for(let i=1; i<=100; i++) {
                const target = i * 10;
                ACHIEVEMENTS.push({
                    id: `dia_${i}`,
                    title: `ë³´ì„ ì‚¬ëƒ¥ê¾¼ Lv.${i}`,
                    desc: `ë‹¤ì´ì•„ëª¬ë“œ ëˆ„ì  íšë“ ${target.toLocaleString()}ê°œ`,
                    type: 'diamondsEarned',
                    target: target,
                    reward: { credit: 10000 * i, diamond: 5 * i }
                });
            }
            // 4. ì­íŒŸ íšŸìˆ˜ (50ë‹¨ê³„)
            for(let i=1; i<=50; i++) {
                ACHIEVEMENTS.push({
                    id: `jackpot_${i}`,
                    title: `í–‰ìš´ì˜ ì£¼ì¸ê³µ Lv.${i}`,
                    desc: `ì­íŒŸ ${i}íšŒ ë‹¹ì²¨`,
                    type: 'jackpots',
                    target: i,
                    reward: { credit: 50000 * i, diamond: 20 * i }
                });
            }
            // 5. í”„ë¦¬ ìŠ¤í•€ íšŸìˆ˜ (50ë‹¨ê³„)
            for(let i=1; i<=50; i++) {
                ACHIEVEMENTS.push({
                    id: `freespin_${i}`,
                    title: `ë³´ë„ˆìŠ¤ íƒ€ì„ Lv.${i}`,
                    desc: `í”„ë¦¬ ìŠ¤í•€ ${i}íšŒ ì§„ì…`,
                    type: 'freeSpins',
                    target: i,
                    reward: { credit: 20000 * i, diamond: 10 * i }
                });
            }
            // ì´í•© ì•½ 400ê°œ + @
        }
        generateAchievements();

        function checkAchievements() {
            let newlyUnlocked = false;
            ACHIEVEMENTS.forEach(ach => {
                // ì´ë¯¸ ë³´ìƒê¹Œì§€ ë°›ì€ ê²½ìš°(claimed === true)ëŠ” ê±´ë„ˆëœ€
                // ì—¬ê¸°ì„œëŠ” ìƒíƒœë¥¼ 3ê°€ì§€ë¡œ ê´€ë¦¬: null(ë¯¸ë‹¬ì„±), 'unlocked'(ë‹¬ì„±, ë¯¸ìˆ˜ë ¹), 'claimed'(ìˆ˜ë ¹ì™„ë£Œ)
                const state = gameState.achievements[ach.id];
                if (state === 'claimed') return;

                const currentVal = gameState.stats[ach.type];
                if (currentVal >= ach.target && !state) {
                    gameState.achievements[ach.id] = 'unlocked';
                    newlyUnlocked = true;
                    showToast(`${ach.title} ë‹¬ì„±!`);
                }
            });

            if (newlyUnlocked) {
                saveData();
                updateBadge();
            }
        }

        function updateBadge() {
            const hasUnclaimed = Object.values(gameState.achievements).some(val => val === 'unlocked');
            const badge = document.getElementById('ach-badge');
            if(hasUnclaimed) badge.classList.add('active');
            else badge.classList.remove('active');
        }

        function toggleAchievements() {
            const popup = document.getElementById('ach-popup');
            if(popup.style.display === 'flex') {
                popup.style.display = 'none';
            } else {
                renderAchievements();
                popup.style.display = 'flex';
            }
        }

        function renderAchievements() {
            const container = document.getElementById('ach-list-container');
            container.innerHTML = '';

            // ì •ë ¬: ìˆ˜ë ¹ ê°€ëŠ¥ > ë¯¸ë‹¬ì„± > ìˆ˜ë ¹ ì™„ë£Œ
            const sorted = ACHIEVEMENTS.slice().sort((a, b) => {
                const stateA = gameState.achievements[a.id];
                const stateB = gameState.achievements[b.id];
                
                const scoreA = stateA === 'unlocked' ? 2 : (stateA === 'claimed' ? 0 : 1);
                const scoreB = stateB === 'unlocked' ? 2 : (stateB === 'claimed' ? 0 : 1);
                return scoreB - scoreA; // ë‚´ë¦¼ì°¨ìˆœ
            });

            // ë Œë”ë§ ìµœì í™”: ì²˜ìŒ 50ê°œë§Œ ë¨¼ì € ê·¸ë¦¬ê³  ìŠ¤í¬ë¡¤ ì‹œ ë” ê·¸ë¦¬ëŠ” ë°©ì‹ì´ ì¢‹ìœ¼ë‚˜ ì—¬ê¸°ì„  ê°„ë‹¨íˆ 
            // ë„ˆë¬´ ë§ìœ¼ë‹ˆ unlocked ìƒíƒœì¸ ê²ƒê³¼ ê·¸ ë‹¤ìŒ ë‹¨ê³„ë§Œ ë³´ì—¬ì£¼ëŠ” ì‹ìœ¼ë¡œ í•„í„°ë§ í•  ìˆ˜ë„ ìˆìŒ.
            // ì—¬ê¸°ì„œëŠ” ì „ì²´ ë¦¬ìŠ¤íŠ¸ ì¤‘ ìƒíƒœê°€ ìˆëŠ” ê²ƒ + ê° íƒ€ì…ë³„ ë‹¤ìŒ ëª©í‘œ 1ê°œì”©ë§Œ ë³´ì—¬ì£¼ê¸°
            
            // íƒ€ì…ë³„ë¡œ ê°€ì¥ ë‚®ì€ ë¯¸ë‹¬ì„± ì—…ì  ì°¾ê¸°
            const nextGoals = {};
            ACHIEVEMENTS.forEach(ach => {
                if(!gameState.achievements[ach.id] && !nextGoals[ach.type]) {
                    nextGoals[ach.type] = ach.id;
                }
            });

            sorted.forEach(ach => {
                const state = gameState.achievements[ach.id];
                // ë³´ì—¬ì¤„ ì¡°ê±´: ë‹¬ì„±í–ˆê±°ë‚˜(unlocked/claimed) OR ë‹¤ìŒ ëª©í‘œì¸ ê²½ìš°
                if (state || nextGoals[ach.type] === ach.id) {
                    const item = document.createElement('div');
                    item.className = 'achievement-item';
                    
                    let btnHtml = '';
                    if (state === 'unlocked') {
                        btnHtml = `<button class="ach-btn claimable" onclick="claimAchievement('${ach.id}')">ë³´ìƒ ë°›ê¸°</button>`;
                    } else if (state === 'claimed') {
                        btnHtml = `<button class="ach-btn completed" disabled>ì™„ë£Œë¨</button>`;
                    } else {
                        const current = gameState.stats[ach.type] || 0;
                        const percent = Math.min(100, Math.floor((current / ach.target) * 100));
                        btnHtml = `<button class="ach-btn" disabled>${percent}%</button>`;
                    }

                    item.innerHTML = `
                        <div class="ach-info">
                            <div class="ach-title">${ach.title}</div>
                            <div class="ach-desc">${ach.desc}</div>
                            <div class="ach-reward">ë³´ìƒ: ğŸ’°${ach.reward.credit} ğŸ’${ach.reward.diamond}</div>
                        </div>
                        <div>${btnHtml}</div>
                    `;
                    container.appendChild(item);
                }
            });
        }

        function claimAchievement(id) {
            const ach = ACHIEVEMENTS.find(a => a.id === id);
            if(ach && gameState.achievements[id] === 'unlocked') {
                gameState.achievements[id] = 'claimed';
                credit += ach.reward.credit;
                diamonds += ach.reward.diamond;
                
                playTone(1500, 'sine', 0.2); // ëµ~ ì†Œë¦¬
                saveData();
                updateUI();
                renderAchievements(); // ë¦¬ìŠ¤íŠ¸ ê°±ì‹ 
                updateBadge();
            }
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }


        // --- ì „ì—­ ë³€ìˆ˜ ---
        const REEL_COUNT = 5;
        const ROW_COUNT = 3;
        const WILD_SYMBOL = 'ğŸ‘‘'; 
        const SCATTER_SYMBOL = 'ğŸ”®'; 
        const SYMBOLS = ['ğŸš', 'ğŸ¡', 'ğŸ™', 'ğŸ ', 'ğŸ¦€', 'ğŸ¦', 'ğŸ¦‘', 'ğŸ¢', 'ğŸ¦ˆ', 'ğŸ’', '7ï¸âƒ£', WILD_SYMBOL, SCATTER_SYMBOL];
        const BET_AMOUNTS = [250, 500, 1250, 2500, 5000];
        
        const PAYTABLE = {
            'ğŸš': [0, 0, 5, 15, 50],
            'ğŸ¡': [0, 0, 10, 25, 100],
            'ğŸ™': [0, 0, 15, 40, 150],
            'ğŸ ': [0, 0, 20, 50, 200],
            'ğŸ¦€': [0, 0, 25, 60, 250],
            'ğŸ¦': [0, 0, 30, 80, 300],
            'ğŸ¦‘': [0, 0, 40, 100, 400],
            'ğŸ¢': [0, 0, 50, 150, 500],
            'ğŸ¦ˆ': [0, 5, 100, 300, 1000],
            'ğŸ’': [0, 0, 30, 100, 300],
            '7ï¸âƒ£': [0, 0, 100, 500, 5000],
            'ğŸ‘‘': [0, 0, 200, 1000, 10000] 
        };
        const PAYLINES = [
            [1,1,1,1,1], [0,0,0,0,0], [2,2,2,2,2], 
            [0,1,2,1,0], [2,1,0,1,2], 
            [0,0,1,2,2], [2,2,1,0,0], 
            [1,2,2,2,1], [1,0,0,0,1], 
            [0,1,1,1,0], [2,1,1,1,2], 
            [0,1,0,1,0], [2,1,2,1,2], 
            [1,0,1,0,1], [1,2,1,2,1],
            [0,1,2,2,2], [2,1,0,0,0],
            [0,2,0,2,0], [2,0,2,0,2],
            [1,1,0,1,1],
            [0,0,1,1,1], [2,2,1,1,1], 
            [1,1,1,0,0], [1,1,1,2,2],
            [0,2,2,2,0]
        ];

        let credit = 10000;
        let diamonds = 50;
        let totalBet = 250;
        let isSpinning = false;
        let forceStop = false; 
        let isAuto = false;
        let autoSpinCount = 0; 
        let autoTimeout = null;
        let currentReelSymbols = [[], [], [], [], []];
        let symbolHeight = 0;
        let freeSpins = 0; 

        // UI Elements
        const reels = Array.from({length: REEL_COUNT}, (_, i) => document.getElementById(`reel${i}`));
        const svgLayer = document.getElementById('lines-svg');
        const textLayer = document.getElementById('text-layer');
        const elCredit = document.getElementById('credit-display');
        const elWin = document.getElementById('win-display');
        const elBetLcd = document.getElementById('bet-display-lcd');
        const btnBetVal = document.getElementById('btn-bet-val');
        const freeSpinUI = document.getElementById('free-spin-ui');
        const elDiamond = document.getElementById('diamond-display-val');
        const elShopDiamond = document.getElementById('shop-diamond-val');
        const elAutoCount = document.getElementById('auto-count-display');
        
        const btnSpin = document.getElementById('btn-spin');
        const btnBet = document.getElementById('btn-bet');
        const btnAuto = document.getElementById('btn-auto');
        
        function init() {
            createBubbles();
            loadData();
            updateUI();
            updateShopUI(); 
            updateBadge(); // ì´ˆê¸° ë±ƒì§€ ìƒíƒœ í™•ì¸
            
            updateBackgroundVideo();
            window.addEventListener('resize', () => {
                updateBackgroundVideo();
                const bgImage = document.querySelector('.deep-sea-bg');
                if(bgImage && bgImage.style.display !== 'none') updateBackground();
            });

            reels.forEach((reel, i) => {
                let html = '';
                currentReelSymbols[i] = [];
                for(let j=0; j<ROW_COUNT; j++) {
                    const sym = getRandomSymbol();
                    currentReelSymbols[i].push(sym);
                    html += createSymbolHTML(sym);
                }
                reel.innerHTML = html;
            });
            updateLayout();
            window.addEventListener('resize', updateLayout);
            
            setTimeout(updateLayout, 100);
            setTimeout(updateLayout, 500);

            document.addEventListener('keydown', (e) => {
                if(e.code === 'Space') {
                    e.preventDefault();
                    handleSpinClick();
                }
            });
            
            document.body.addEventListener('click', () => {
                const video = document.getElementById('bg-video');
                if (video && video.style.display !== 'none' && video.paused) video.play().catch(()=>{});
                if (audioCtx.state === 'suspended') audioCtx.resume();
            }, {once: true});
        }

        function createSymbolHTML(sym) {
            return `<div class="symbol-wrapper" style="height:${symbolHeight}px">
                        <div class="symbol" style="font-size:${symbolHeight*0.5}px">${sym}</div>
                    </div>`;
        }

        function updateLayout() {
            const container = document.getElementById('reelsContainer');
            if(!container) return;
            const h = container.clientHeight / 3;
            symbolHeight = h;
            
            document.querySelectorAll('.symbol-wrapper').forEach(el => {
                el.style.height = `${h}px`;
            });
            document.querySelectorAll('.symbol').forEach(el => {
                el.style.fontSize = `${h * 0.5}px`;
            });
            reels.forEach(r => r.style.transform = 'translateY(0)');
            svgLayer.setAttribute('viewBox', `0 0 ${container.clientWidth} ${container.clientHeight}`);
        }

        // --- í™•ë¥  ì‹œìŠ¤í…œ (ë¬´ì œí•œ ë ˆë²¨ ë°˜ì˜) ---
        function getRandomSymbol() {
            // ë ˆë²¨ë‹¹ ê°€ì¤‘ì¹˜ ì¦ê°€
            const bonusCommon = gameState.luck.common * 1.5; 
            const bonusRare = gameState.luck.rare * 1.2;
            const bonusLegend = gameState.luck.legend * 0.8;

            const weights = [
                { s: 'ğŸš', w: 30 + bonusCommon }, 
                { s: 'ğŸ¡', w: 25 + bonusCommon }, 
                { s: 'ğŸ™', w: 22 + bonusCommon }, 
                { s: 'ğŸ ', w: 20 + bonusCommon }, 
                { s: 'ğŸ¦€', w: 18 + bonusRare }, 
                { s: 'ğŸ¦', w: 15 + bonusRare }, 
                { s: 'ğŸ¦‘', w: 12 + bonusRare }, 
                { s: 'ğŸ¢', w: 10 + bonusRare }, 
                { s: 'ğŸ¦ˆ', w: 8 + bonusLegend },  
                { s: 'ğŸ’', w: 6 + bonusLegend },  
                { s: '7ï¸âƒ£', w: 4 + bonusLegend },  
                { s: 'ğŸ‘‘', w: 5 + bonusLegend },  
                { s: SCATTER_SYMBOL, w: 4 } 
            ];
            
            let totalWeight = weights.reduce((sum, item) => sum + item.w, 0);
            let random = Math.random() * totalWeight;
            
            for (let i = 0; i < weights.length; i++) {
                if (random < weights[i].w) return weights[i].s;
                random -= weights[i].w;
            }
            return weights[0].s; 
        }

        // --- ìƒì  ë¡œì§ ---
        function toggleShop() {
            const shop = document.getElementById('shop-popup');
            if(shop.style.display === 'flex') {
                shop.style.display = 'none';
            } else {
                updateShopUI();
                shop.style.display = 'flex';
            }
        }

        // ë¹„ìš© ê³„ì‚° í•¨ìˆ˜ (ë ˆë²¨ì— ë”°ë¼ ì¦ê°€)
        function getUpgradeCost(type, currentLevel) {
            const baseCost = { common: 20, rare: 50, legend: 100 };
            const multiplier = { common: 1.1, rare: 1.15, legend: 1.2 };
            return Math.floor(baseCost[type] * Math.pow(multiplier[type], currentLevel));
        }

        function updateShopUI() {
            elShopDiamond.innerText = diamonds.toLocaleString();
            
            const nextBetIdx = gameState.unlockedBetIndex + 1;
            const btnUnlock = document.getElementById('btn-unlock-bet');
            if(nextBetIdx < BET_AMOUNTS.length) {
                document.getElementById('bet-unlock-msg').innerText = `ë‹¤ìŒ: ${BET_AMOUNTS[nextBetIdx]}`;
                btnUnlock.disabled = false;
                btnUnlock.querySelector('.price-tag').innerHTML = 'ğŸ’ 100';
            } else {
                document.getElementById('bet-unlock-msg').innerText = "ìµœëŒ€ ë ˆë²¨";
                btnUnlock.disabled = true;
                btnUnlock.querySelector('.price-tag').innerHTML = 'MAX';
            }

            const speedBtn = document.getElementById('btn-upgrade-speed');
            if(gameState.speedLevel < 2) {
                document.getElementById('speed-level-msg').innerText = `Lv. ${gameState.speedLevel + 1}`;
                speedBtn.disabled = false;
            } else {
                document.getElementById('speed-level-msg').innerText = "MAX";
                speedBtn.disabled = true;
            }

            // í–‰ìš´ ì—…ê·¸ë ˆì´ë“œ UI (ë™ì  ë¹„ìš© í‘œì‹œ)
            const costCommon = getUpgradeCost('common', gameState.luck.common);
            const costRare = getUpgradeCost('rare', gameState.luck.rare);
            const costLegend = getUpgradeCost('legend', gameState.luck.legend);

            document.getElementById('luck-common-lvl').innerText = `Lv. ${gameState.luck.common}`;
            document.getElementById('cost-luck-common').innerText = costCommon.toLocaleString();

            document.getElementById('luck-rare-lvl').innerText = `Lv. ${gameState.luck.rare}`;
            document.getElementById('cost-luck-rare').innerText = costRare.toLocaleString();

            document.getElementById('luck-legend-lvl').innerText = `Lv. ${gameState.luck.legend}`;
            document.getElementById('cost-luck-legend').innerText = costLegend.toLocaleString();
        }

        function buyItem(type) {
            let cost = 0;
            let success = false;

            switch(type) {
                case 'credit_10k':
                    cost = 10;
                    if(diamonds >= cost) { diamonds -= cost; credit += 10000; success = true; }
                    break;
                case 'credit_100k':
                    cost = 90; // 10% off
                    if(diamonds >= cost) { diamonds -= cost; credit += 100000; success = true; }
                    break;
                case 'credit_1m':
                    cost = 800; // 20% off
                    if(diamonds >= cost) { diamonds -= cost; credit += 1000000; success = true; }
                    break;
                case 'auto':
                    cost = 5;
                    if(diamonds >= cost) { diamonds -= cost; autoSpinCount += 50; success = true; }
                    break;
                case 'unlock_bet':
                    cost = 100;
                    if(diamonds >= cost && gameState.unlockedBetIndex < BET_AMOUNTS.length - 1) {
                        diamonds -= cost; gameState.unlockedBetIndex++; success = true;
                    }
                    break;
                case 'speed':
                    cost = 50;
                    if(diamonds >= cost && gameState.speedLevel < 2) {
                        diamonds -= cost; gameState.speedLevel++; success = true;
                    }
                    break;
                case 'luck_common':
                    cost = getUpgradeCost('common', gameState.luck.common);
                    if(diamonds >= cost) { diamonds -= cost; gameState.luck.common++; success = true; }
                    break;
                case 'luck_rare':
                    cost = getUpgradeCost('rare', gameState.luck.rare);
                    if(diamonds >= cost) { diamonds -= cost; gameState.luck.rare++; success = true; }
                    break;
                case 'luck_legend':
                    cost = getUpgradeCost('legend', gameState.luck.legend);
                    if(diamonds >= cost) { diamonds -= cost; gameState.luck.legend++; success = true; }
                    break;
            }

            if(success) {
                playTone(1200, 'sine', 0.1); 
                saveData();
                updateUI();
                updateShopUI();
            } else {
                alert("ë‹¤ì´ì•„ëª¬ë“œê°€ ë¶€ì¡±í•˜ê±°ë‚˜ ë” ì´ìƒ êµ¬ë§¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
        }

        function changeBet() {
            if(isSpinning || freeSpins > 0) return;
            const availableBets = BET_AMOUNTS.slice(0, gameState.unlockedBetIndex + 1);
            let idx = availableBets.indexOf(totalBet);
            if (idx === -1 || idx === availableBets.length - 1) totalBet = availableBets[0];
            else totalBet = availableBets[idx + 1];
            if(totalBet > credit && credit > 0) totalBet = availableBets[0];
            updateUI();
            playTone(400, 'sine', 0.1);
        }

        function toggleAuto() {
            if(isAuto) {
                isAuto = false;
                btnAuto.classList.remove('active');
                if(autoTimeout) clearTimeout(autoTimeout);
            } else {
                if(autoSpinCount > 0) {
                    isAuto = true;
                    btnAuto.classList.add('active');
                    if(!isSpinning) spin();
                } else {
                    if(confirm("ì˜¤í†  ìŠ¤í•€ íšŸìˆ˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ìƒì ì—ì„œ êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) toggleShop();
                }
            }
        }

        function handleSpinClick() {
            if (isSpinning) stopSpin();
            else spin();
        }

        function stopSpin() {
            forceStop = true;
        }

        function toggleTipPopup() {
            const popup = document.getElementById('tip-popup');
            if(popup.style.display === 'flex') popup.style.display = 'none';
            else popup.style.display = 'flex';
        }

        async function spin() {
            if (freeSpins === 0) {
                if(isSpinning) return;
                if (isAuto) {
                    if (autoSpinCount > 0) autoSpinCount--;
                    else {
                        isAuto = false;
                        btnAuto.classList.remove('active');
                        alert("ì˜¤í†  ìŠ¤í•€ íšŸìˆ˜ê°€ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤.");
                        return;
                    }
                }
                if(credit < totalBet) {
                    if(confirm("ëˆì´ ì—†ìŠµë‹ˆë‹¤. ë¬´ë£Œ ì¶©ì „í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                        credit = 5000;
                        saveData();
                        updateUI();
                        alert("5,000 í¬ë ˆë”§ì´ ì¶©ì „ë˜ì—ˆìŠµë‹ˆë‹¤!");
                    }
                    isAuto = false;
                    btnAuto.classList.remove('active');
                    return;
                }
                credit -= totalBet;
            } else {
                if(isSpinning) return;
                freeSpins--;
                freeSpinUI.innerText = `FREE SPIN: ${freeSpins}`;
                if(freeSpins === 0) freeSpinUI.style.display = 'none';
            }

            if(audioCtx.state === 'suspended') audioCtx.resume();
            
            // í†µê³„ ì—…ë°ì´íŠ¸ (ìŠ¤í•€ ìˆ˜)
            gameState.stats.spins++;
            saveData();

            isSpinning = true;
            forceStop = false;
            elWin.innerText = "0";
            clearWinEffects();
            updateUI();
            
            btnSpin.innerText = "STOP";
            btnSpin.classList.add('stop-mode');
            btnBet.disabled = true;

            startSpinSound();

            const results = [];
            for(let i=0; i<REEL_COUNT; i++) {
                const col = [];
                for(let j=0; j<ROW_COUNT; j++) col.push(getRandomSymbol());
                results.push(col);
            }

            const promises = reels.map((reel, idx) => spinReel(reel, idx, results[idx]));
            await Promise.all(promises);

            stopSpinSound();
            checkWin(results);
            
            isSpinning = false;
            btnSpin.innerText = "SPIN";
            btnSpin.classList.remove('stop-mode');
            if(freeSpins === 0) btnBet.disabled = false;
            
            // ì—…ì  ì²´í¬
            checkAchievements();
            saveData(); 
            updateUI();

            if (freeSpins > 0 || (isAuto && credit >= totalBet && autoSpinCount > 0)) {
                autoTimeout = setTimeout(() => {
                    if(isAuto || freeSpins > 0) spin();
                }, 800);
            } else if (isAuto && (credit < totalBet || autoSpinCount <= 0)) {
                isAuto = false;
                btnAuto.classList.remove('active');
            }
        }

        function spinReel(reel, index, finalSymbols) {
            return new Promise(resolve => {
                const dummyCount = 20 + index * 5; 
                let stripSymbols = [];
                const bufferSymbol = getRandomSymbol();
                stripSymbols.push(bufferSymbol); 
                stripSymbols.push(...finalSymbols); 
                for(let k=0; k<dummyCount; k++) stripSymbols.push(getRandomSymbol());
                stripSymbols.push(...currentReelSymbols[index]); 

                reel.innerHTML = stripSymbols.map(s => createSymbolHTML(s)).join('');
                
                const totalHeight = stripSymbols.length * symbolHeight;
                const visibleHeight = ROW_COUNT * symbolHeight;
                const startY = -(totalHeight - visibleHeight);
                
                reel.style.transition = 'none';
                reel.style.transform = `translateY(${startY}px)`;
                void reel.offsetWidth; 

                requestAnimationFrame(() => {
                    const endY = -(symbolHeight);
                    const speedMultiplier = 1 - (gameState.speedLevel * 0.2); 
                    const baseDuration = (1.5 + (index * 0.6)) * speedMultiplier; 
                    
                    reel.style.transition = `transform ${baseDuration}s cubic-bezier(0.25, 1.15, 0.25, 1)`; 
                    reel.style.transform = `translateY(${endY}px)`;

                    const soundHandler = () => {
                        playReelStopSound();
                        reel.removeEventListener('transitionend', soundHandler);
                    };
                    reel.addEventListener('transitionend', soundHandler);

                    const startTime = performance.now();
                    function checkStop() {
                        const elapsed = (performance.now() - startTime) / 1000;
                        if (forceStop) {
                            reel.style.transition = `transform 0.4s cubic-bezier(0.25, 1, 0.5, 1)`;
                            reel.style.transform = `translateY(${endY}px)`;
                            setTimeout(() => {
                                reel.removeEventListener('transitionend', soundHandler);
                                playReelStopSound();
                                finish();
                            }, 400); 
                        } else if (elapsed >= baseDuration) {
                            setTimeout(finish, 100);
                        } else {
                            requestAnimationFrame(checkStop);
                        }
                    }
                    
                    function finish() {
                        reel.innerHTML = finalSymbols.map(s => createSymbolHTML(s)).join('');
                        reel.style.transition = 'none';
                        reel.style.transform = 'translateY(0)'; 
                        currentReelSymbols[index] = [...finalSymbols];
                        resolve();
                    }

                    checkStop();
                });
            });
        }

        function checkWin(grid) {
            let totalWin = 0;
            let winners = [];
            const lineBet = totalBet / PAYLINES.length; 

            PAYLINES.forEach((pattern, idx) => {
                const firstSym = grid[0][pattern[0]]; 
                let effectiveSym = firstSym; 
                let count = 1;
                let isWildWin = (firstSym === WILD_SYMBOL); 

                for(let c=1; c<REEL_COUNT; c++) {
                    const currentSym = grid[c][pattern[c]];
                    if(currentSym === effectiveSym || currentSym === WILD_SYMBOL) {
                        count++;
                        if(isWildWin && currentSym !== WILD_SYMBOL) {
                            effectiveSym = currentSym;
                            isWildWin = false;
                        }
                    } else if (isWildWin && currentSym !== WILD_SYMBOL) {
                         effectiveSym = currentSym;
                         isWildWin = false;
                         count++; 
                    } else {
                        break; 
                    }
                }

                if(isWildWin) effectiveSym = WILD_SYMBOL;

                if(count >= 3 && PAYTABLE[effectiveSym]) {
                    const mul = PAYTABLE[effectiveSym][count-1];
                    if(mul > 0) {
                        const amt = lineBet * mul;
                        totalWin += amt;
                        winners.push({
                            lineIdx: idx,
                            amount: amt,
                            coords: pattern.slice(0, count).map((r, c) => [c, r]), 
                            color: getNeonColor(idx)
                        });
                    }
                }
            });

            let scatterCount = 0;
            let scatterCoords = [];
            for(let c=0; c<REEL_COUNT; c++) {
                for(let r=0; r<ROW_COUNT; r++) {
                    if(grid[c][r] === SCATTER_SYMBOL) {
                        scatterCount++;
                        scatterCoords.push([c, r]);
                    }
                }
            }

            if (scatterCount >= 3) {
                freeSpins += 10;
                diamonds += 5; 
                
                // í†µê³„ ì—…ë°ì´íŠ¸
                gameState.stats.freeSpins++;
                gameState.stats.diamondsEarned += 5;

                freeSpinUI.innerText = `FREE SPIN: ${freeSpins}`;
                freeSpinUI.style.display = 'block';
                
                winners.push({
                    lineIdx: -1, 
                    amount: 0,
                    coords: scatterCoords,
                    color: '#ffffff' 
                });
                playTone(1000, 'square', 0.2);
            }

            let diamondCount = 0;
            for(let c=0; c<REEL_COUNT; c++) {
                for(let r=0; r<ROW_COUNT; r++) {
                    if(grid[c][r] === 'ğŸ’') diamondCount++;
                }
            }
            if(diamondCount >= 3) {
                const bonusDiamonds = diamondCount * 2;
                diamonds += bonusDiamonds;
                
                // í†µê³„ ì—…ë°ì´íŠ¸
                gameState.stats.diamondsEarned += bonusDiamonds;

                const noti = document.createElement('div');
                noti.className = 'win-float-text';
                noti.innerText = `ğŸ’ +${bonusDiamonds}`;
                noti.style.top = '20%';
                noti.style.left = '50%';
                noti.style.color = '#00f3ff';
                document.body.appendChild(noti);
                setTimeout(()=>noti.remove(), 1500);
            }

            if(winners.filter(w => w.lineIdx !== -1).length >= 5) {
                diamonds += 10; 
                gameState.stats.diamondsEarned += 10;
                showJackpot(totalWin, "SPECIAL COMBO!"); 
            }

            if(totalWin > 0) {
                credit += totalWin;
                
                // í†µê³„ ì—…ë°ì´íŠ¸
                gameState.stats.totalWin += totalWin;

                elWin.innerText = Math.floor(totalWin).toLocaleString();
                playWinMusic(); 
                drawWinEffects(winners);
                if(totalWin >= totalBet * 50) {
                    showJackpot(totalWin);
                    diamonds += 20; 
                    gameState.stats.diamondsEarned += 20;
                    gameState.stats.jackpots++;
                }
            }
        }

        function getNeonColor(idx) {
            const colors = ['#00ff9d', '#00f3ff', '#ff0055', '#bc13fe', '#ffd700'];
            return colors[idx % colors.length];
        }

        function checkCollision(y, occupiedYPositions, minGap = 40) {
            for (let existingY of occupiedYPositions) {
                if (Math.abs(y - existingY) < minGap) {
                    return true;
                }
            }
            return false;
        }

        function drawWinEffects(winners) {
            svgLayer.innerHTML = '';
            textLayer.innerHTML = '';
            const container = document.getElementById('reelsContainer');
            svgLayer.setAttribute('viewBox', `0 0 ${container.clientWidth} ${container.clientHeight}`);

            let occupiedYPositions = []; 

            winners.forEach((win, index) => { 
                let points = "";
                let labelPos = {x: 0, y: 0};
                const targetCol = [2, 0, 4, 1, 3][index % 5]; 

                if (win.lineIdx !== -1) {
                    const fullLinePattern = PAYLINES[win.lineIdx];
                    fullLinePattern.forEach((rowIdx, colIdx) => {
                         const reelEl = reels[colIdx]; 
                         const colEl = reelEl.parentElement; 
                         const symbolEl = reelEl.children[rowIdx]; 

                         if(colEl && symbolEl) {
                            const centerX = colEl.offsetLeft + (colEl.offsetWidth / 2);
                            const centerY = colEl.offsetTop + symbolEl.offsetTop + (symbolEl.offsetHeight / 2);
                            points += `${centerX},${centerY} `;
                            if (colIdx === targetCol) labelPos = {x: centerX, y: centerY};
                         }
                    });

                    const poly = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
                    poly.setAttribute("points", points);
                    poly.setAttribute("fill", "none");
                    poly.setAttribute("stroke", win.color);
                    poly.setAttribute("stroke-width", "5");
                    poly.setAttribute("stroke-linecap", "round");
                    poly.setAttribute("stroke-linejoin", "round");
                    poly.style.filter = `drop-shadow(0 0 8px ${win.color})`;
                    svgLayer.appendChild(poly);

                    let adjustedY = labelPos.y;
                    let attempt = 0;
                    while (checkCollision(adjustedY, occupiedYPositions) && attempt < 10) {
                        adjustedY += (attempt % 2 === 0 ? 30 : -30) * Math.ceil(attempt / 2); 
                        attempt++;
                    }
                    occupiedYPositions.push(adjustedY);

                    const label = document.createElement('div');
                    label.className = 'win-float-text';
                    label.innerText = "+" + Math.floor(win.amount).toLocaleString();
                    label.style.left = `${labelPos.x}px`;
                    label.style.top = `${adjustedY}px`; 
                    label.style.color = win.color;
                    label.style.borderColor = win.color;
                    label.style.boxShadow = `0 0 10px ${win.color}`;
                    textLayer.appendChild(label);
                }

                win.coords.forEach(([c, r]) => {
                    const reelEl = reels[c];
                    const symbolEl = reelEl.children[r]; 
                    if(symbolEl) {
                        symbolEl.classList.add('win-highlight');
                    }
                });
            });
        }

        function clearWinEffects() {
            svgLayer.innerHTML = '';
            textLayer.innerHTML = '';
            document.querySelectorAll('.symbol-wrapper').forEach(el => {
                el.classList.remove('win-highlight');
            });
        }

        function playWinMusic() {
            if(!isSoundOn) return;
            [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
                playTone(freq, 'triangle', 0.3, 0.1);
            });
        }

        function showJackpot(amount, msg="JACKPOT!") {
            const el = document.getElementById('jackpot-overlay');
            const elMsg = document.querySelector('.jackpot-msg');
            const txt = document.getElementById('jackpot-amount');
            elMsg.innerText = msg;
            txt.innerText = "+" + Math.floor(amount).toLocaleString();
            el.style.display = 'flex';
            setTimeout(() => { el.style.display = 'none'; }, 4000);
        }

        function updateUI() {
            elCredit.innerText = Math.floor(credit).toLocaleString();
            elBetLcd.innerText = totalBet.toLocaleString();
            btnBetVal.innerText = totalBet;
            elDiamond.innerText = diamonds.toLocaleString();
            elAutoCount.innerText = autoSpinCount > 0 ? autoSpinCount : "";
        }

        function toggleSound() {
            isSoundOn = !isSoundOn;
            document.getElementById('btn-sound').innerText = isSoundOn ? 'ğŸ”Š' : 'ğŸ”‡';
            if(isSoundOn && audioCtx.state === 'suspended') audioCtx.resume();
        }

        function toggleFullscreen() {
            if(!document.fullscreenElement) document.documentElement.requestFullscreen();
            else document.exitFullscreen();
        }

        init();
    </script>
</body>
</html>
