<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sea Story - Neon Jackpot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Do+Hyeon&family=Orbitron:wght@700&display=swap');

        :root {
            /* ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ë„¤ì˜¨ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ */
            --neon-cyan: #00f3ff;
            --neon-mint: #00ff9d;
            --neon-purple: #bc13fe;
            --neon-pink: #ff0055;
            --neon-gold: #ffd700;
            --bg-dark: #050505;
            --panel-bg: #1a1a1a;
        }

        body {
            font-family: 'Do Hyeon', sans-serif;
            background-color: #000;
            color: white;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            -webkit-user-select: none;
        }

        /* ë°°ê²½: ì‹¬í•´ì˜ ê¹Šì€ ëŠë‚Œ + ì€ì€í•œ ì˜¤ë¡œë¼ */
        .deep-sea-bg {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at center, #0b1026 0%, #000000 100%);
            z-index: -2;
        }
        .aurora {
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, rgba(0, 243, 255, 0.05), rgba(188, 19, 254, 0.05));
            filter: blur(50px);
            animation: auroraMove 10s infinite alternate;
            z-index: -1;
        }
        @keyframes auroraMove { 0% { opacity: 0.3; } 100% { opacity: 0.7; } }

        /* ê²Œì„ ìºë¹„ë‹› (ë³¸ì²´) */
        .cabinet {
            position: relative;
            width: 95%;
            max-width: 1100px;
            aspect-ratio: 16 / 9;
            max-height: 90vh;
            background: #111;
            border-radius: 20px;
            border: 2px solid #333;
            box-shadow: 
                0 0 0 4px #000,
                0 0 0 6px var(--neon-cyan), /* ë„¤ì˜¨ í…Œë‘ë¦¬ */
                0 0 30px rgba(0, 243, 255, 0.3); /* ì™¸ê³½ ê´‘ì› */
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ëª¨ë°”ì¼ ëŒ€ì‘ */
        @media (max-aspect-ratio: 1/1) {
            .cabinet {
                aspect-ratio: 3 / 5;
                max-width: 500px;
            }
        }

        /* ìƒë‹¨ í—¤ë” */
        .header {
            flex: 0 0 60px;
            background: linear-gradient(to bottom, #222, #000);
            border-bottom: 2px solid var(--neon-gold);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 10;
        }

        .logo-text {
            font-family: 'Black Han Sans', sans-serif;
            font-size: 1.8rem;
            background: linear-gradient(to right, #fff, var(--neon-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
        }

        .header-icons button {
            background: none;
            border: 1px solid #444;
            color: #888;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            margin-left: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .header-icons button:hover { color: #fff; border-color: #fff; background: rgba(255,255,255,0.1); }

        /* ë¦´ ì˜ì—­ */
        .reel-area {
            flex: 1;
            position: relative;
            background: #000;
            display: flex;
            padding: 10px;
            /* 3D ê¹Šì´ê°ì„ ìœ„í•œ ë‚´ë¶€ ê·¸ë¦¼ì (ìƒí•˜) */
            box-shadow: inset 0 20px 30px -10px rgba(0,0,0,0.9), inset 0 -20px 30px -10px rgba(0,0,0,0.9);
        }

        /* ë¦´ ë’¤ì˜ ê²©ì ë°°ê²½ (ê°€ë¡œ ì„¸ë¡œ ë¼ì¸) */
        .grid-overlay {
            position: absolute;
            inset: 10px; /* padding ì•ˆìª½ */
            pointer-events: none;
            /* ì„¸ë¡œì„  */
            background-image: linear-gradient(90deg, 
                transparent 19.5%, #333 20%, 
                transparent 20.5%, transparent 39.5%, #333 40%, 
                transparent 40.5%, transparent 59.5%, #333 60%, 
                transparent 60.5%, transparent 79.5%, #333 80%, 
                transparent 80.5%);
            background-size: 100% 100%;
            z-index: 5;
        }
        
        /* ê°€ë¡œì„  (ë³„ë„ ë ˆì´ì–´) */
        .horizontal-lines {
            position: absolute;
            inset: 10px;
            pointer-events: none;
            /* ê°€ë¡œì„  (3í–‰ ê¸°ì¤€: 33.3%, 66.6%) */
            background: linear-gradient(to bottom, 
                transparent 33%, rgba(255,255,255,0.1) 33.3%, transparent 33.6%,
                transparent 66.3%, rgba(255,255,255,0.1) 66.6%, transparent 66.9%
            );
            z-index: 6;
        }

        .reels-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            width: 100%;
            height: 100%;
            position: relative;
        }

        .reel-col {
            position: relative;
            overflow: hidden;
            /* 3D ì›í†µí˜• ì‰ì´ë”© ê°•í™” */
            background: linear-gradient(90deg, 
                rgba(0,0,0,0.95) 0%, 
                rgba(20,20,20,0.5) 15%, 
                rgba(40,40,40,0.1) 40%, 
                rgba(40,40,40,0.1) 60%, 
                rgba(20,20,20,0.5) 85%, 
                rgba(0,0,0,0.95) 100%);
        }

        .reel-strip {
            display: flex;
            flex-direction: column;
            will-change: transform;
            /* ë¸”ëŸ¬ ì œê±°ë¨ */
        }

        /* ì‹¬ë³¼ ìŠ¤íƒ€ì¼ */
        .symbol {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem; /* JSì—ì„œ ì¡°ì ˆ */
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.8));
            transform: scale(0.9);
            transition: transform 0.2s;
            position: relative;
        }
        
        /* ë‹¹ì²¨ ì‹¬ë³¼ ê°•ì¡° íš¨ê³¼ */
        .symbol.win-highlight {
            transform: scale(1.1);
            filter: drop-shadow(0 0 10px var(--neon-gold)) brightness(1.3);
            z-index: 10;
        }

        /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ íŒ¨ë„ (ê³ ì • UI) */
        .control-panel {
            flex: 0 0 auto;
            background: linear-gradient(to top, #1a1a1a, #000);
            border-top: 2px solid #333;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 20;
            position: relative;
        }

        /* ì •ë³´ì°½ ë””ìì¸ */
        .lcd-display {
            background: #000;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 5px 12px;
            min-width: 90px;
            box-shadow: inset 0 0 10px rgba(255,255,255,0.05);
            display: flex;
            flex-direction: column;
        }
        .lcd-label {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
        }
        .lcd-value {
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            color: #fff;
            text-align: right;
        }
        .text-neon-gold { color: var(--neon-gold); text-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
        .text-neon-green { color: var(--neon-mint); text-shadow: 0 0 5px rgba(0, 255, 157, 0.5); }

        /* ë²„íŠ¼ ë””ìì¸ */
        .btn-group { display: flex; gap: 15px; align-items: center; }

        .game-btn {
            border: none;
            border-radius: 50%;
            color: white;
            font-weight: bold;
            font-family: 'Do Hyeon', sans-serif;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            box-shadow: 0 5px 0 #000, 0 10px 10px rgba(0,0,0,0.5);
            transition: all 0.1s;
            position: relative;
            overflow: hidden;
        }
        /* ë²„íŠ¼ ê´‘íƒ */
        .game-btn::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 50%;
            background: linear-gradient(to bottom, rgba(255,255,255,0.2), transparent);
            border-radius: 50% 50% 0 0;
        }

        .game-btn:active {
            transform: translateY(5px);
            box-shadow: 0 0 0 #000, 0 0 5px rgba(0,0,0,0.5);
        }
        
        /* ë²„íŠ¼ ë¹„í™œì„±í™” (ì‚¬ë¼ì§€ì§€ ì•Šê³  ì–´ë‘¡ê²Œë§Œ ì²˜ë¦¬) */
        .game-btn:disabled {
            filter: brightness(0.6); /* íˆ¬ëª…ë„ ëŒ€ì‹  ë°ê¸°ë§Œ ì¤„ì„ */
            cursor: not-allowed;
            transform: translateY(5px); /* ëˆŒë¦° ìƒíƒœ ê³ ì • */
            box-shadow: none;
            opacity: 1; /* íˆ¬ëª…ë„ ìœ ì§€ */
        }

        .btn-bet { 
            width: 60px; height: 60px; font-size: 0.9rem;
            background: linear-gradient(to bottom, #4a90e2, #004488);
        }
        .btn-spin { 
            width: 80px; height: 80px; font-size: 1.5rem;
            background: linear-gradient(to bottom, #ff5252, #a70000);
            border: 2px solid #ff8a80;
        }

        /* SVG ë¼ì¸ ë ˆì´ì–´ */
        .lines-layer {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 15;
            filter: drop-shadow(0 0 5px currentColor); 
        }
        
        /* ì­íŒŸ ì˜¤ë²„ë ˆì´ */
        .jackpot-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .jackpot-msg {
            font-family: 'Black Han Sans', sans-serif;
            font-size: 5rem;
            color: var(--neon-gold);
            text-shadow: 0 0 20px var(--neon-gold);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        /* ë‹¹ì²¨ê¸ˆ íŒì—… í…ìŠ¤íŠ¸ */
        .win-float-text {
            position: absolute;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            font-size: 1.5rem;
            color: #fff;
            text-shadow: 0 0 5px #000;
            background: rgba(0,0,0,0.7);
            padding: 2px 10px;
            border-radius: 10px;
            border: 1px solid currentColor;
            z-index: 50;
            white-space: nowrap;
            animation: floatUp 1.5s forwards;
        }
        @keyframes floatUp {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            20% { transform: translate(-50%, -60%) scale(1.1); opacity: 1; }
            100% { transform: translate(-50%, -100%) scale(1); opacity: 0; }
        }

    </style>
</head>
<body>

    <div class="deep-sea-bg"></div>
    <div class="aurora"></div>

    <div class="cabinet" id="gameCabinet">
        <!-- í—¤ë” -->
        <header class="header">
            <div class="logo-text">SEA STORY <span style="font-size:0.6em; color:var(--neon-gold);">NEON</span></div>
            <div class="header-icons">
                <button id="btn-sound" onclick="toggleSound()">ğŸ”Š</button>
                <button onclick="toggleFullscreen()">â›¶</button>
            </div>
        </header>

        <!-- ë©”ì¸ í™”ë©´ -->
        <div class="reel-area" id="reelArea">
            <!-- ë°°ê²½ ê²©ì (ê°€ë¡œ/ì„¸ë¡œì„ ) -->
            <div class="grid-overlay"></div>
            <div class="horizontal-lines"></div>

            <div class="reels-container" id="reelsContainer">
                <!-- Reels -->
                <div class="reel-col"><div class="reel-strip" id="reel0"></div></div>
                <div class="reel-col"><div class="reel-strip" id="reel1"></div></div>
                <div class="reel-col"><div class="reel-strip" id="reel2"></div></div>
                <div class="reel-col"><div class="reel-strip" id="reel3"></div></div>
                <div class="reel-col"><div class="reel-strip" id="reel4"></div></div>
            </div>

            <!-- ë¼ì¸ ì´í™íŠ¸ -->
            <svg id="lines-svg" class="lines-layer"></svg>
            <!-- í…ìŠ¤íŠ¸ ì´í™íŠ¸ -->
            <div id="text-layer" class="lines-layer" style="z-index:50;"></div>
        </div>

        <!-- í•˜ë‹¨ ì»¨íŠ¸ë¡¤ (ì ˆëŒ€ ì‚¬ë¼ì§€ì§€ ì•ŠìŒ) -->
        <footer class="control-panel">
            <div style="display:flex; gap:10px;">
                <div class="lcd-display">
                    <span class="lcd-label">CREDIT</span>
                    <span class="lcd-value text-neon-gold" id="credit-display">10000</span>
                </div>
                <div class="lcd-display">
                    <span class="lcd-label">WIN</span>
                    <span class="lcd-value text-neon-green" id="win-display">0</span>
                </div>
                <div class="lcd-display mobile-hide" style="display:none;"> <!-- PC Only -->
                    <span class="lcd-label">BET</span>
                    <span class="lcd-value" id="bet-display-lcd">200</span>
                </div>
            </div>

            <div class="btn-group">
                <button class="game-btn btn-bet" onclick="changeBet()" id="btn-bet">
                    BET<br><span style="font-size:0.8em" id="btn-bet-val">200</span>
                </button>
                <button class="game-btn btn-bet" onclick="maxBet()" id="btn-max" style="background:linear-gradient(to bottom, #9b59b6, #5b2c6f);">
                    MAX
                </button>
                <button class="game-btn btn-spin" onclick="spin()" id="btn-spin">
                    SPIN
                </button>
            </div>
        </footer>

        <!-- ì­íŒŸ ì˜¤ë²„ë ˆì´ -->
        <div id="jackpot-overlay" class="jackpot-overlay">
            <div class="jackpot-msg">JACKPOT!</div>
            <div style="font-size:3rem; color:#fff; margin-top:10px;" id="jackpot-amount">+5000</div>
        </div>
    </div>

    <script>
        // --- ì‚¬ìš´ë“œ ì—”ì§„ ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let isSoundOn = true;

        function playTone(freq, type, duration, vol=0.1) {
            if(!isSoundOn) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        // ê¸°ê³„ì ì¸ ìŠ¤í•€ ì†Œë¦¬ (ë“œë¥´ë¥µ)
        function playSpinSound() {
            if(!isSoundOn) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'square';
            osc.frequency.setValueAtTime(60, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.03, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.05);
        }

        // --- ê²Œì„ ë°ì´í„° ---
        const REEL_COUNT = 5;
        const ROW_COUNT = 3;
        const SYMBOLS = ['ğŸš', 'ğŸ¡', 'ğŸ™', 'ğŸ ', 'ğŸ¢', 'ğŸ¦ˆ', 'ğŸ’', '7ï¸âƒ£'];
        const PAYTABLE = {
            'ğŸš': [0, 0, 5, 15, 50],
            'ğŸ¡': [0, 0, 10, 25, 100],
            'ğŸ™': [0, 0, 15, 40, 150],
            'ğŸ ': [0, 0, 20, 50, 200],
            'ğŸ¢': [0, 0, 50, 150, 500],
            'ğŸ¦ˆ': [0, 5, 100, 300, 1000],
            'ğŸ’': [0, 0, 30, 100, 300],
            '7ï¸âƒ£': [0, 0, 100, 500, 5000]
        };
        const PAYLINES = [
            [1,1,1,1,1], [0,0,0,0,0], [2,2,2,2,2], // ì§ì„ 
            [0,1,2,1,0], [2,1,0,1,2], // V
            [0,0,1,2,2], [2,2,1,0,0], // ê³„ë‹¨
            [1,2,2,2,1], [1,0,0,0,1], // M, W
            [0,1,1,1,0], [2,1,1,1,2], // êµ´ê³¡
            [0,1,0,1,0], [2,1,2,1,2], // ì§€ê·¸ì¬ê·¸
            [1,0,1,0,1], [1,2,1,2,1],
            [0,1,2,2,2], [2,1,0,0,0],
            [0,2,0,2,0], [2,0,2,0,2],
            [1,1,0,1,1]
        ];

        // --- ìƒíƒœ ë³€ìˆ˜ ---
        let credit = 10000;
        let totalBet = 200;
        let isSpinning = false;
        let currentReelSymbols = [[], [], [], [], []];
        let symbolHeight = 0;

        // --- DOM ---
        const reels = Array.from({length: REEL_COUNT}, (_, i) => document.getElementById(`reel${i}`));
        const svgLayer = document.getElementById('lines-svg');
        const textLayer = document.getElementById('text-layer');
        const elCredit = document.getElementById('credit-display');
        const elWin = document.getElementById('win-display');
        const elBetLcd = document.getElementById('bet-display-lcd');
        const btnBetVal = document.getElementById('btn-bet-val');
        
        // ë²„íŠ¼ë“¤
        const btnSpin = document.getElementById('btn-spin');
        const btnBet = document.getElementById('btn-bet');
        const btnMax = document.getElementById('btn-max');
        const btns = [btnSpin, btnBet, btnMax];

        // ì´ˆê¸°í™”
        function init() {
            reels.forEach((reel, i) => {
                let html = '';
                currentReelSymbols[i] = [];
                for(let j=0; j<ROW_COUNT; j++) {
                    const sym = getRandomSymbol();
                    currentReelSymbols[i].push(sym);
                    html += `<div class="symbol">${sym}</div>`;
                }
                reel.innerHTML = html;
            });
            updateLayout();
            window.addEventListener('resize', updateLayout);
            
            if(window.innerWidth > 768) {
                document.querySelector('.mobile-hide').style.display = 'flex';
            }

            document.addEventListener('keydown', (e) => {
                if(e.code === 'Space') {
                    e.preventDefault();
                    if(!isSpinning) spin();
                }
            });
        }

        function updateLayout() {
            const h = document.getElementById('reelsContainer').clientHeight / 3;
            symbolHeight = h;
            document.querySelectorAll('.symbol').forEach(el => {
                el.style.height = `${h}px`;
                el.style.fontSize = `${h * 0.6}px`;
            });
            reels.forEach(r => r.style.transform = 'translateY(0)');
        }

        function getRandomSymbol() {
            return SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
        }

        function changeBet() {
            if(isSpinning) return;
            const bets = [200, 400, 1000, 2000, 5000];
            let idx = bets.indexOf(totalBet);
            totalBet = bets[(idx + 1) % bets.length];
            if(totalBet > credit && credit > 0) totalBet = bets[0];
            updateUI();
            playTone(400, 'sine', 0.1);
        }

        function maxBet() {
            if(isSpinning) return;
            totalBet = 5000;
            if(totalBet > credit) totalBet = Math.floor(credit/100)*100 || 200;
            updateUI();
            playTone(600, 'sine', 0.1);
        }

        // ìŠ¤í•€ ë¡œì§
        async function spin() {
            if(isSpinning) return;
            if(credit < totalBet) {
                alert("í¬ë ˆë”§ ë¶€ì¡±!");
                return;
            }
            if(audioCtx.state === 'suspended') audioCtx.resume();

            isSpinning = true;
            credit -= totalBet;
            
            toggleButtons(false);
            elWin.innerText = "0";
            clearWinEffects();
            updateUI();

            const results = [];
            for(let i=0; i<REEL_COUNT; i++) {
                const col = [];
                for(let j=0; j<ROW_COUNT; j++) col.push(getRandomSymbol());
                results.push(col);
            }

            const promises = reels.map((reel, idx) => spinReel(reel, idx, results[idx]));
            await Promise.all(promises);

            checkWin(results);
            
            isSpinning = false;
            toggleButtons(true);
            updateUI();
        }

        function toggleButtons(enable) {
            btns.forEach(b => {
                b.disabled = !enable;
            });
        }

        function spinReel(reel, index, finalSymbols) {
            return new Promise(resolve => {
                const dummyCount = 20 + index * 5; 
                let stripSymbols = [...currentReelSymbols[index]];
                
                for(let k=0; k<dummyCount; k++) stripSymbols.push(getRandomSymbol());
                stripSymbols.push(...finalSymbols);

                reel.innerHTML = stripSymbols.map(s => 
                    `<div class="symbol" style="height:${symbolHeight}px; font-size:${symbolHeight*0.6}px">${s}</div>`
                ).join('');
                
                reel.style.transition = 'none';
                reel.style.transform = 'translateY(0)';
                // ë¸”ëŸ¬ ì œê±°
                void reel.offsetWidth;

                const spinInterval = setInterval(playSpinSound, 100);

                requestAnimationFrame(() => {
                    const totalMove = (stripSymbols.length - ROW_COUNT) * symbolHeight;
                    const duration = 1.5 + (index * 0.3);
                    reel.style.transition = `transform ${duration}s cubic-bezier(0.25, 1, 0.5, 1)`;
                    reel.style.transform = `translateY(-${totalMove}px)`;

                    setTimeout(() => {
                        clearInterval(spinInterval);
                        playTone(100, 'square', 0.05, 0.1);

                        reel.innerHTML = finalSymbols.map(s => 
                            `<div class="symbol" style="height:${symbolHeight}px; font-size:${symbolHeight*0.6}px">${s}</div>`
                        ).join('');
                        reel.style.transition = 'none';
                        reel.style.transform = 'translateY(0)';
                        
                        currentReelSymbols[index] = [...finalSymbols];
                        resolve();
                    }, duration * 1000);
                });
            });
        }

        function checkWin(grid) {
            let totalWin = 0;
            let winners = [];
            const lineBet = totalBet / 20;

            PAYLINES.forEach((pattern, idx) => {
                const first = grid[0][pattern[0]];
                let count = 1;
                for(let c=1; c<REEL_COUNT; c++) {
                    if(grid[c][pattern[c]] === first) count++;
                    else break;
                }

                if(count >= 3) {
                    const mul = PAYTABLE[first][count-1];
                    if(mul > 0) {
                        const amt = lineBet * mul;
                        totalWin += amt;
                        const coords = [];
                        for(let i=0; i<count; i++) coords.push([i, pattern[i]]);
                        winners.push({
                            lineIdx: idx,
                            amount: amt,
                            coords: coords,
                            color: getNeonColor(idx)
                        });
                    }
                }
            });

            if(totalWin > 0) {
                credit += totalWin;
                elWin.innerText = Math.floor(totalWin).toLocaleString();
                playWinMusic(); 
                drawWinEffects(winners);
                
                if(totalWin >= totalBet * 50) {
                    showJackpot(totalWin);
                }
            }
        }

        function getNeonColor(idx) {
            const colors = [
                '#00ff9d', // Mint
                '#00f3ff', // Cyan
                '#ff0055', // Hot Pink
                '#bc13fe', // Electric Purple
                '#ffd700'  // Gold
            ];
            return colors[idx % colors.length];
        }

        function drawWinEffects(winners) {
            svgLayer.innerHTML = '';
            textLayer.innerHTML = '';
            svgLayer.setAttribute("viewBox", "0 0 500 300");

            winners.forEach(win => {
                const points = PAYLINES[win.lineIdx].map((row, col) => `${col*100 + 50},${row*100 + 50}`).join(' ');
                const poly = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
                poly.setAttribute("points", points);
                poly.setAttribute("fill", "none");
                poly.setAttribute("stroke", win.color);
                poly.setAttribute("stroke-width", "6");
                poly.setAttribute("stroke-linecap", "round");
                poly.setAttribute("stroke-linejoin", "round");
                poly.style.filter = `drop-shadow(0 0 5px ${win.color}) drop-shadow(0 0 10px ${win.color})`;
                poly.style.opacity = "0.9";
                svgLayer.appendChild(poly);

                win.coords.forEach(([c, r]) => {
                    const symbolEl = reels[c].children[r];
                    if(symbolEl) {
                        symbolEl.classList.add('win-highlight');
                        symbolEl.style.textShadow = `0 0 20px ${win.color}`;
                    }
                });

                const last = win.coords[win.coords.length-1];
                const label = document.createElement('div');
                label.className = 'win-float-text';
                label.innerText = "+" + Math.floor(win.amount).toLocaleString();
                label.style.left = `${last[0]*20 + 10}%`;
                label.style.top = `${last[1]*33.33 + 16.66}%`;
                label.style.color = win.color;
                label.style.borderColor = win.color;
                label.style.boxShadow = `0 0 10px ${win.color}`;
                textLayer.appendChild(label);
            });
        }

        function clearWinEffects() {
            svgLayer.innerHTML = '';
            textLayer.innerHTML = '';
            document.querySelectorAll('.symbol').forEach(el => {
                el.classList.remove('win-highlight');
                el.style.textShadow = 'none';
            });
        }

        function playWinMusic() {
            if(!isSoundOn) return;
            const now = audioCtx.currentTime;
            const chord = [523.25, 659.25, 783.99]; 
            chord.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'triangle';
                osc.frequency.value = freq;
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.5);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now);
                osc.stop(now + 0.5);
            });
        }

        function showJackpot(amount) {
            const el = document.getElementById('jackpot-overlay');
            const txt = document.getElementById('jackpot-amount');
            txt.innerText = "+" + Math.floor(amount).toLocaleString();
            el.style.display = 'flex';
            setTimeout(() => { el.style.display = 'none'; }, 4000);
        }

        function updateUI() {
            elCredit.innerText = Math.floor(credit).toLocaleString();
            elBetLcd.innerText = totalBet.toLocaleString();
            btnBetVal.innerText = totalBet;
        }

        function toggleSound() {
            isSoundOn = !isSoundOn;
            document.getElementById('btn-sound').innerText = isSoundOn ? 'ğŸ”Š' : 'ğŸ”‡';
            if(isSoundOn && audioCtx.state === 'suspended') audioCtx.resume();
        }

        function toggleFullscreen() {
            if(!document.fullscreenElement) document.documentElement.requestFullscreen();
            else document.exitFullscreen();
        }

        init();
    </script>
</body>
</html>
