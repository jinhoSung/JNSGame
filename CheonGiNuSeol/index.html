<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²œê¸°ëˆ„ì„¤ (CheonGiNuSeol) - ìš´ëª… ë¶„ì„ ì‹œìŠ¤í…œ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { font-family: 'Pretendard', sans-serif; }
        @keyframes fade-in { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
        .text-shadow { text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans selection:bg-purple-500 selection:text-white flex flex-col items-center min-h-screen">

    <div id="root" class="w-full flex justify-center"></div>

    <!-- Firebase SDK Setup -->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyBzqw4WEVcRjPQ6qbqibwLrPWakD4slLZs",
        authDomain: "sajucompatibility.firebaseapp.com",
        projectId: "sajucompatibility",
        storageBucket: "sajucompatibility.firebasestorage.app",
        messagingSenderId: "188903468088",
        appId: "1:188903468088:web:e2f2c4bfd9743716428acd",
        measurementId: "G-SWQ608XNYM"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons ---
        const Icon = ({ path, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>
        );
        const Sparkles = (p) => <Icon {...p} path={<><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 9h4"/><path d="M3 5h4"/></>} />;
        const Heart = (p) => <Icon {...p} path={<path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>} />;
        const Calendar = (p) => <Icon {...p} path={<><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></>} />;
        const Clock = (p) => <Icon {...p} path={<><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>} />;
        const ArrowRight = (p) => <Icon {...p} path={<path d="M5 12h14m-7-7 7 7-7 7"/>} />;
        const RefreshCw = (p) => <Icon {...p} path={<><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></>} />;
        const Sun = (p) => <Icon {...p} path={<><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></>} />;
        const BookOpen = (p) => <Icon {...p} path={<path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>} />;
        const Search = (p) => <Icon {...p} path={<><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></>} />;
        const User = (p) => <Icon {...p} path={<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} />;
        const CheckCircle = (p) => <Icon {...p} path={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>} />;
        const Compass = (p) => <Icon {...p} path={<><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></>} />;
        const Palette = (p) => <Icon {...p} path={<path d="M13.5 22H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5h10a5 5 0 0 1 5 5v6.5M10.5 8.5 7 12l3.5 3.5M17 12l-3.5 3.5"/>} />;
        const Hash = (p) => <Icon {...p} path={<><line x1="4" x2="20" y1="9" y2="9"/><line x1="4" x2="20" y1="15" y2="15"/><line x1="10" x2="8" y1="3" y2="21"/><line x1="16" x2="14" y1="3" y2="21"/></>} />;
        const Shield = (p) => <Icon {...p} path={<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/>} />;
        const Scale = (p) => <Icon {...p} path={<><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></>} />;

        // --- Data ---
        const GAN = ["ê°‘(ç”²)", "ì„(ä¹™)", "ë³‘(ä¸™)", "ì •(ä¸)", "ë¬´(æˆŠ)", "ê¸°(å·±)", "ê²½(åºš)", "ì‹ (è¾›)", "ì„(å£¬)", "ê³„(ç™¸)"];
        const JI = ["ì(å­)", "ì¶•(ä¸‘)", "ì¸(å¯…)", "ë¬˜(å¯)", "ì§„(è¾°)", "ì‚¬(å·³)", "ì˜¤(åˆ)", "ë¯¸(æœª)", "ì‹ (ç”³)", "ìœ (é…‰)", "ìˆ (æˆŒ)", "í•´(äº¥)"];
        
        const COLORS = {
            "ê°‘(ç”²)": "bg-green-600", "ì„(ä¹™)": "bg-green-500", "ë³‘(ä¸™)": "bg-red-600", "ì •(ä¸)": "bg-red-500",
            "ë¬´(æˆŠ)": "bg-yellow-600", "ê¸°(å·±)": "bg-yellow-500", "ê²½(åºš)": "bg-gray-400", "ì‹ (è¾›)": "bg-gray-300",
            "ì„(å£¬)": "bg-blue-800", "ê³„(ç™¸)": "bg-blue-600", "ì¸(å¯…)": "bg-green-600", "ë¬˜(å¯)": "bg-green-500",
            "ì‚¬(å·³)": "bg-red-600", "ì˜¤(åˆ)": "bg-red-500", "ì§„(è¾°)": "bg-yellow-600", "ìˆ (æˆŒ)": "bg-yellow-600", "ì¶•(ä¸‘)": "bg-yellow-500", "ë¯¸(æœª)": "bg-yellow-500",
            "ì‹ (ç”³)": "bg-gray-400", "ìœ (é…‰)": "bg-gray-300", "í•´(äº¥)": "bg-blue-800", "ì(å­)": "bg-blue-600",
        };

        const ELEMENTS = {
            Wood: { label: "ëª©(Wood)", color: "text-green-400", bg: "bg-green-500", desc: "ì„±ì¥, ì¸ìí•¨, ì¶”ì§„ë ¥, ì‹œì‘" },
            Fire: { label: "í™”(Fire)", color: "text-red-400", bg: "bg-red-500", desc: "ì—´ì •, ì˜ˆì˜, í™”ë ¤í•¨, í™•ì‚°" },
            Earth: { label: "í† (Earth)", color: "text-yellow-400", bg: "bg-yellow-500", desc: "ë¯¿ìŒ, í¬ìš©, ì¤‘ìš©, ì•ˆì •" },
            Metal: { label: "ê¸ˆ(Metal)", color: "text-gray-300", bg: "bg-gray-400", desc: "ê²°ë‹¨, ì˜ë¦¬, ëƒ‰ì² í•¨, ë§ˆë¬´ë¦¬" },
            Water: { label: "ìˆ˜(Water)", color: "text-blue-400", bg: "bg-blue-500", desc: "ì§€í˜œ, ìœ ì—°í•¨, ì¹œí™”ë ¥, ì €ì¥" },
        };

        const DAY_MASTER_DETAILS = {
            "ê°‘(ç”²)": "ê³§ê²Œ ë»—ì€ ì†Œë‚˜ë¬´ì²˜ëŸ¼ ìì¡´ì‹¬ì´ ê°•í•˜ê³  ë¦¬ë”ì‹­ì´ ìˆìŠµë‹ˆë‹¤. êµ½íˆê¸°ë³´ë‹¤ëŠ” ë¶€ëŸ¬ì§€ëŠ” ì„±ê²©ìœ¼ë¡œ, ì‹œì‘ì€ ì˜í•˜ë‚˜ ë§ˆë¬´ë¦¬ê°€ ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ì„(ä¹™)": "ìœ ì—°í•œ í™”ì´ˆì²˜ëŸ¼ í™˜ê²½ ì ì‘ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤. ëˆì§ˆê¸´ ìƒëª…ë ¥ì„ ê°€ì¡Œìœ¼ë©°, ì‹¤ì†ì„ ì˜ ì±™ê¸°ê³  ì‚¬êµì ì…ë‹ˆë‹¤.",
            "ë³‘(ä¸™)": "íƒœì–‘ì²˜ëŸ¼ ë°ê³  ì •ì—´ì ì…ë‹ˆë‹¤. ìˆ¨ê¸°ëŠ” ê²ƒì´ ì—†ê³  ë§¤ì‚¬ ê³µëª…ì •ëŒ€í•˜ì§€ë§Œ, ë‹¤í˜ˆì§ˆì ì¸ ë©´ì´ ìˆì–´ ì‹¤ìˆ˜ê°€ ì¦ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ì •(ä¸)": "ì´›ë¶ˆì²˜ëŸ¼ ì€ì€í•œ í—Œì‹ ê³¼ ë”°ëœ»í•¨ì„ ê°€ì¡ŒìŠµë‹ˆë‹¤. ì„¬ì„¸í•˜ê³  ê°ìˆ˜ì„±ì´ í’ë¶€í•˜ë©°, ë‚´ë©´ì— ê°•í•œ ì—´ì •ì„ í’ˆê³  ìˆìŠµë‹ˆë‹¤.",
            "ë¬´(æˆŠ)": "í° ì‚°ì²˜ëŸ¼ ë¬µì§í•˜ê³  í¬ìš©ë ¥ì´ ìˆìŠµë‹ˆë‹¤. ì‹ ìš©ì„ ì¤‘ì‹œí•˜ë©° ì¤‘í›„í•œ ë§¤ë ¥ì´ ìˆìœ¼ë‚˜, ê³ ì§‘ì´ ì„¸ê³  ìœµí†µì„±ì´ ë¶€ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ê¸°(å·±)": "ë¹„ì˜¥í•œ ë°­ì²˜ëŸ¼ ë§Œë¬¼ì„ ê¸¸ëŸ¬ë‚´ëŠ” ì–´ë¨¸ë‹ˆì˜ ë§ˆìŒì„ ê°€ì¡ŒìŠµë‹ˆë‹¤. ì‹¤ì† ìˆê³  ìê¸° ê´€ë¦¬ê°€ ì² ì €í•˜ì§€ë§Œ, ì˜ì‹¬ì´ ë§ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ê²½(åºš)": "ë‹¨ë‹¨í•œ ë°”ìœ„ë‚˜ ë¬´ì‡ ì²˜ëŸ¼ ê²°ë‹¨ë ¥ì´ ìˆê³  ì˜ë¦¬ê°€ ê°•í•©ë‹ˆë‹¤. í˜ëª…ì ì¸ ê¸°ì§ˆì´ ìˆì–´ ë§ºê³  ëŠìŒì´ í™•ì‹¤í•˜ë‚˜, ë…ë‹¨ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ì‹ (è¾›)": "ê°€ê³µëœ ë³´ì„ì²˜ëŸ¼ ì„¬ì„¸í•˜ê³  ì˜ˆë¯¼í•˜ë©° ê¹”ë”í•©ë‹ˆë‹¤. ìì¡´ì‹¬ì´ ë§¤ìš° ê°•í•˜ê³  ëƒ‰ì² í•œ íŒë‹¨ë ¥ì„ ê°€ì¡ŒìŠµë‹ˆë‹¤.",
            "ì„(å£¬)": "í° ë°”ë‹¤ì²˜ëŸ¼ ë„ëŸ‰ì´ ë„“ê³  ì§€í˜œë¡­ìŠµë‹ˆë‹¤. ìœ ì—°í•œ ì‚¬ê³ ë¥¼ ê°€ì¡Œìœ¼ë‚˜, ì†ì„ ì•Œ ìˆ˜ ì—†ê³  ë³€ë•ì´ ì‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ê³„(ç™¸)": "ë´„ë¹„ì²˜ëŸ¼ ë§Œë¬¼ì„ ì ì‹œëŠ” ìì• ë¡œì›€ì´ ìˆìŠµë‹ˆë‹¤. ì´ëª…í•˜ê³  ì•„ì´ë””ì–´ê°€ ë›°ì–´ë‚˜ì§€ë§Œ, ì‹ ê²½ì´ ì˜ˆë¯¼í•˜ê³  ì†Œê·¹ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        };

        const SULI_DETAILS = {
            1: "ë§Œë¬¼ì˜ ì‹œì´ˆê°€ ë˜ëŠ” ìˆ˜ë¡œ, ë¶€ê·€ì™€ ëª…ì˜ˆë¥¼ ê²¸ë¹„í•˜ì—¬ ëŒ€ì—…ì„ ì´ë£° ëŒ€ê¸¸ìš´ì…ë‹ˆë‹¤. (ë‘ë ¹ê²©)",
            3: "ì§€í˜œì™€ ì¬ëŠ¥ì´ ë›°ì–´ë‚˜ ëª…ì„±ì„ ë–¨ì¹˜ê³ , ì§€ë„ìì˜ ìœ„ì¹˜ì— ì˜¤ë¥¼ ëŒ€ê¸¸ìš´ì…ë‹ˆë‹¤. (ëª…ë§ê²©)",
            11: "ê°€ë¬¸ì„ ì¼ìœ¼í‚¤ê³  ë¶€ê·€ì˜í™”ë¥¼ ëˆ„ë¦¬ë©°, ë§Œì¸ì´ ìš°ëŸ¬ëŸ¬ë³´ëŠ” ìœ„ì¹˜ì— ì˜¤ë¥¼ ëŒ€ê¸¸ìš´ì…ë‹ˆë‹¤. (ì‹ ì„±ê²©)",
            13: "ë‘ë‡Œê°€ ëª…ì„í•˜ê³  ì²˜ì„¸ìˆ ì´ ë›°ì–´ë‚˜ ì–´ë–¤ ë¶„ì•¼ì—ì„œë„ ì„±ê³µí•  ëŒ€ê¸¸ìš´ì…ë‹ˆë‹¤. (ì´ëª…ê²©)",
            15: "ë•ë§ê³¼ ë³µë¡ì„ ê²¸ë¹„í•˜ì—¬ ìœ—ì‚¬ëŒì˜ í›„ì›ê³¼ ì•„ë«ì‚¬ëŒì˜ ì¡´ê²½ì„ ë°›ëŠ” ìµœìƒì˜ ê¸¸ìš´ì…ë‹ˆë‹¤. (í†µì†”ê²©)",
            21: "íƒì›”í•œ ë¦¬ë”ì‹­ìœ¼ë¡œ ë§Œì¸ì„ í†µì†”í•˜ê³ , ììˆ˜ì„±ê°€í•˜ì—¬ í° ì„±ê³µì„ ê±°ë‘˜ ëŒ€ê¸¸ìš´ì…ë‹ˆë‹¤. (ë‘ë ¹ê²©)",
            23: "ì‘ì€ ê²ƒìœ¼ë¡œ í° ê²ƒì„ ì´ë£¨ëŠ” ê¸°ìƒìœ¼ë¡œ, ëª…ì˜ˆì™€ ì§€ìœ„ê°€ í¬ê²Œ ì˜¤ë¥¼ ëŒ€ê¸¸ìš´ì…ë‹ˆë‹¤. (ê³µëª…ê²©)",
            24: "ì¬ë¬¼ìš´ì´ ì™•ì„±í•˜ì—¬ ì†ëŒ€ëŠ” ì¼ë§ˆë‹¤ í° ì´ìµì„ ì–»ê³ , ê°€ë¬¸ì´ ë²ˆì°½í•  ëŒ€ê¸¸ìš´ì…ë‹ˆë‹¤. (ì…ì‹ ê²©)",
            25: "ì¬ì£¼ê°€ ë¹„ìƒí•˜ê³  ì„±ì‹¤í•˜ì—¬ ììˆ˜ì„±ê°€í•˜ë©°, í‰ìƒ ì•ˆë½í•œ ì‚¶ì„ ëˆ„ë¦´ ê¸¸ìš´ì…ë‹ˆë‹¤. (ì•ˆì „ê²©)",
            29: "ê¶Œë ¥ê³¼ ì¬ë¬¼ì„ í•¨ê»˜ ì–»ê³ , ì§€í˜œì™€ ë•ë§ìœ¼ë¡œ ì¡´ê²½ë°›ì„ ëŒ€ê¸¸ìš´ì…ë‹ˆë‹¤. (ì„±ê³µê²©)",
            31: "ì˜ì§€ê°€ êµ³ê³  íŒë‹¨ë ¥ì´ ì •í™•í•˜ì—¬ í•™ë¬¸ì´ë‚˜ ì˜ˆìˆ  ë¶„ì•¼ì—ì„œ ëŒ€ì„±í•  ëŒ€ê¸¸ìš´ì…ë‹ˆë‹¤. (ìœµì°½ê²©)",
            33: "ìì‹ ê°ì´ ë„˜ì¹˜ê³  ì¬ëŠ¥ì´ ë›°ì–´ë‚˜ ì²œí•˜ì— ëª…ì„±ì„ ë–¨ì¹  ê°•í•œ ìš´ì„¸ì…ë‹ˆë‹¤. (ìŠ¹ì²œê²©)",
            35: "ì˜¨í™”í•˜ê³  ì„±ì‹¤í•œ ì„±í’ˆìœ¼ë¡œ ì£¼ìœ„ì˜ ì‹ ë§ì„ ì–»ì–´ í‰ì˜¨í•˜ê³  í–‰ë³µí•œ ì‚¶ì„ ëˆ„ë¦´ ê¸¸ìš´ì…ë‹ˆë‹¤. (í‰ì˜¨ê²©)",
            37: "ê°•ì¸í•œ ì˜ì§€ì™€ ì¶”ì§„ë ¥ìœ¼ë¡œ ë‚œê´€ì„ ê·¹ë³µí•˜ê³  ë§ˆì¹¨ë‚´ ëŒ€ì—…ì„ ë‹¬ì„±í•  ëŒ€ê¸¸ìš´ì…ë‹ˆë‹¤. (íƒœê³µê²©)",
            39: "íƒ€ê³ ë‚œ ì¬ëŠ¥ê³¼ ì¸ë•ìœ¼ë¡œ ë¶€ê·€ì˜í™”ë¥¼ ëˆ„ë¦¬ì§€ë§Œ, ë•Œë¡œëŠ” ê³ ë…í•  ìˆ˜ ìˆëŠ” ìš´ì„¸ì…ë‹ˆë‹¤. (ì•ˆë½ê²©)",
            47: "ì¬ë¬¼ê³¼ ëª…ì˜ˆê°€ í•¨ê»˜ ë”°ë¥´ë©°, ë§ë…„ê¹Œì§€ í’ìš”ë¡­ê³  í–‰ë³µí•˜ê²Œ ì‚´ ëŒ€ê¸¸ìš´ì…ë‹ˆë‹¤. (ì¶œì„¸ê²©)",
            48: "ì§€ë•ì„ ê²¸ë¹„í•˜ì—¬ ì¡´ê²½ë°›ìœ¼ë©°, ì¬ë¬¼ìš´ë„ ë”°ë¥´ëŠ” ê¸¸ìš´ì…ë‹ˆë‹¤. (ìœ ë•ê²©)"
        };

        const HANJA_STROKES = {
            'é‡‘': 8, 'æ': 7, 'æœ´': 6, 'å´”': 11, 'é„­': 19, 'å§œ': 9, 'è¶™': 14, 'å°¹': 4, 'å¼µ': 11, 'æ—': 8, 'éŸ“': 17, 'ç”³': 5, 'å³': 7, 'å¾': 10, 'æ¬Š': 22, 'é»ƒ': 12, 'å®‹': 7, 'å®‰': 6, 'æŸ³': 9, 'æ´ª': 10, 'ä¿Š': 9, 'æµ©': 11, 'ç‰': 10, 'ç‘': 14, 'è³¢': 15, 'æ™º': 12, 'æ—¼': 8, 'èµ«': 14, 'å®‡': 6, 'æ•': 11, 'å§‹': 8, 'å…': 4, 'æˆ': 7, 'é‰‰': 13, 'æº': 14, 'ç': 10, 'ç§€': 7, 'æ¦®': 14, 'å‹³': 16, 'å»º': 9, 'ç†™': 13, 'è‹±': 11, 'ç¾': 9, 'æ·‘': 12, 'æƒ ': 12, 'ç ': 11, 'æ™¶': 12, 'æ©': 10, 'é›…': 12, 'æ„›': 13, 'æƒ…': 11, 'ä¿¡': 9, 'å‰': 6, 'ç«¥': 12, 'ç¦': 14, 'å£½': 14, 'åº·': 11, 'å¯§': 14
        };

        const SajuApp = () => {
            const [activeTab, setActiveTab] = useState('total');
            const [user, setUser] = useState(null);
            
            // Firebase Auth Setup
            useEffect(() => {
                if (window.isFirebaseAvailable) {
                    const auth = window.fbAuth;
                    const initAuth = async () => {
                        if (window.__initial_auth_token) {
                            await window.fbSignInWithCustomToken(auth, window.__initial_auth_token);
                        } else {
                            await window.fbSignInAnonymously(auth);
                        }
                    };
                    initAuth();
                    const unsubscribe = window.fbOnAuthStateChanged(auth, (u) => {
                        if (u) setUser(u);
                    });
                    return () => unsubscribe();
                }
            }, []);

            // --- Logic Functions ---
            const getCharInfo = (char, type) => {
                let elemIdx, polarity; 
                if (type === 'GAN') {
                    const idx = GAN.indexOf(char);
                    if (idx === -1) return { element: "Earth", polarity: 0, elemIdx: 2 }; // Safe fallback
                    elemIdx = Math.floor(idx / 2); polarity = idx % 2;
                } else {
                    const idx = JI.indexOf(char);
                    if (idx === -1) return { element: "Earth", polarity: 0, elemIdx: 2 }; // Safe fallback
                    const jiMap = [{e:4, p:1}, {e:2, p:1}, {e:0, p:0}, {e:0, p:1}, {e:2, p:0}, {e:1, p:0}, {e:1, p:1}, {e:2, p:1}, {e:3, p:0}, {e:3, p:1}, {e:2, p:0}, {e:4, p:0}];
                    elemIdx = jiMap[idx].e; polarity = jiMap[idx].p;
                }
                const elements = ["Wood", "Fire", "Earth", "Metal", "Water"];
                return { element: elements[elemIdx], polarity, elemIdx };
            };

            const getElement = (char) => GAN.includes(char) ? getCharInfo(char, 'GAN').element : getCharInfo(char, 'JI').element;

            const calculateSaju = (dateStr, timeStr, calendarType = 'solar', isLeap = false) => {
                if (!dateStr) return null;
                let date = new Date(dateStr);
                if (calendarType === 'lunar') { date.setDate(date.getDate() + (isLeap ? 60 : 30)); }
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                const hour = timeStr ? parseInt(timeStr.split(':')[0], 10) : 12;
                
                const yearGanIdx = (year - 4 + 600) % 10;
                const yearJiIdx = (year - 4 + 600) % 12;
                let monthJiIdx = (month + 1) % 12;
                if (monthJiIdx < 0) monthJiIdx += 12;
                const monthGanIdx = (yearGanIdx * 2 + monthJiIdx) % 10;
                
                const refDate = new Date('2000-01-01');
                const diffDays = Math.floor((date.getTime() - refDate.getTime()) / (1000 * 60 * 60 * 24));
                let dayCycleIdx = (54 + diffDays) % 60;
                if (dayCycleIdx < 0) dayCycleIdx += 60;
                const dayGanIdx = dayCycleIdx % 10;
                const dayJiIdx = dayCycleIdx % 12;
                
                let hourJiIdx = Math.floor((hour + 1) / 2) % 12;
                const hourGanIdx = (dayGanIdx * 2 + hourJiIdx) % 10;

                return {
                    type: calendarType === 'lunar' ? `ìŒë ¥ ${isLeap ? '(ìœ¤ë‹¬)' : ''}` : 'ì–‘ë ¥',
                    year: { gan: GAN[yearGanIdx], ji: JI[yearJiIdx] },
                    month: { gan: GAN[monthGanIdx], ji: JI[monthJiIdx] },
                    day: { gan: GAN[dayGanIdx], ji: JI[dayJiIdx] },
                    hour: { gan: GAN[hourGanIdx], ji: JI[hourJiIdx] },
                };
            };

            const getSuliInterpretation = (count) => {
                const num = count % 81 === 0 ? 81 : count % 81;
                return SULI_DETAILS[num] || `${num}ìˆ˜ëŠ” ê¸¸í‰ì´ í˜¼ì¬ëœ í‰ì´í•œ ìš´ì„¸ì…ë‹ˆë‹¤. ê¸ì •ì ì¸ ë§ˆìŒìœ¼ë¡œ ë…¸ë ¥í•˜ë©´ ì¢‹ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
            };

            // --- UI Components ---
            const PillarCard = ({ title, data }) => (
                <div className="flex flex-col items-center p-3 md:p-4 bg-gray-800 rounded-lg border border-gray-700 shadow-md">
                    <span className="text-gray-400 text-xs mb-2 tracking-widest uppercase">{title}</span>
                    <div className="flex flex-col gap-3 items-center w-full">
                        <div className="flex flex-col items-center">
                            <div className={`w-10 h-10 md:w-12 md:h-12 flex items-center justify-center rounded-full text-white font-bold text-lg md:text-xl shadow-inner ${COLORS[data.gan]}`}>{data.gan.charAt(0)}</div>
                            <span className="text-gray-500 text-xs mt-1">{data.gan}</span>
                        </div>
                        <div className="w-full h-px bg-gray-700/50"></div>
                        <div className="flex flex-col items-center">
                            <div className={`w-10 h-10 md:w-12 md:h-12 flex items-center justify-center rounded-full text-white font-bold text-lg md:text-xl shadow-inner ${COLORS[data.ji]}`}>{data.ji.charAt(0)}</div>
                            <span className="text-gray-500 text-xs mt-1">{data.ji}</span>
                        </div>
                    </div>
                </div>
            );

            const SajuAnalysisCard = ({ result }) => {
                if (!result) return null;
                const counts = { Wood: 0, Fire: 0, Earth: 0, Metal: 0, Water: 0 };
                [result.year, result.month, result.day, result.hour].forEach(pillar => {
                    counts[getElement(pillar.gan)]++; counts[getElement(pillar.ji)]++;
                });
                const maxElement = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
                const weakElement = Object.keys(counts).reduce((a, b) => counts[a] < counts[b] ? a : b);
                const dayMaster = result.day.gan;
                
                const elementAdvice = {
                    Wood: "ëª©(Wood) ê¸°ìš´ì´ ê°•í•œ ë‹¹ì‹ ì€ ì¶”ì§„ë ¥ê³¼ ì„±ì¥ ìš•êµ¬ê°€ ëŒ€ë‹¨í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë„ˆë¬´ ì•ë§Œ ë³´ê³  ë‹¬ë¦¬ë‹¤ ë¶€ëŸ¬ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ, ë•Œë¡œëŠ” ë©ˆì¶° ì„œì„œ ì£¼ë³€ì„ ëŒì•„ë³´ëŠ” ì—¬ìœ ê°€ í•„ìš”í•©ë‹ˆë‹¤. ëª…ìƒì´ë‚˜ ìš”ê°€ë¡œ ë§ˆìŒì„ ì°¨ë¶„íˆ í•˜ì„¸ìš”.",
                    Fire: "í™”(Fire) ê¸°ìš´ì´ ê°•í•œ ë‹¹ì‹ ì€ ì—´ì •ê³¼ í™”ë ¤í•¨ì„ ì¶”êµ¬í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ê°ì • ê¸°ë³µì´ ì‹¬í•´ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ, ë¬¼(ìˆ˜ì˜, ë°˜ì‹ ìš•)ì„ ê°€ê¹Œì´ í•˜ê±°ë‚˜ ì°¨ë¶„í•œ ë…ì„œë¥¼ í†µí•´ ë‚´ë©´ì„ ë‹¤ìŠ¤ë¦¬ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.",
                    Earth: "í† (Earth) ê¸°ìš´ì´ ê°•í•œ ë‹¹ì‹ ì€ ë¯¿ìŒì§í•˜ê³  í¬ìš©ë ¥ì´ ë„“ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ê³ ì§‘ì´ ì„¸ê³  ë³€í™”ë¥¼ ì‹«ì–´í•´ ì •ì²´ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ì·¨ë¯¸ë‚˜ ì—¬í–‰ì„ í†µí•´ ì‚¶ì— í™œë ¥ì„ ë¶ˆì–´ë„£ìœ¼ì„¸ìš”.",
                    Metal: "ê¸ˆ(Metal) ê¸°ìš´ì´ ê°•í•œ ë‹¹ì‹ ì€ ê²°ë‹¨ë ¥ ìˆê³  ëƒ‰ì² í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë„ˆë¬´ ë‚ ì¹´ë¡œì›Œ ì£¼ë³€ì— ìƒì²˜ë¥¼ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¶€ë“œëŸ¬ìš´ ìŒì•…ì„ ë“£ê±°ë‚˜ ì‹ë¬¼ì„ í‚¤ìš°ë©° ê°ì„±ì„ í‚¤ì›Œë³´ì„¸ìš”.",
                    Water: "ìˆ˜(Water) ê¸°ìš´ì´ ê°•í•œ ë‹¹ì‹ ì€ ì§€í˜œë¡­ê³  ìœ ì—°í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ìƒê°ì´ ë„ˆë¬´ ë§ì•„ ìš°ìš¸í•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í–‡ë³•ì„ ìì£¼ ì¬ê³  í™œë™ì ì¸ ìš´ë™ì„ í•˜ì—¬ ì–‘ê¸°ë¥¼ ë³´ì¶©í•˜ì„¸ìš”."
                };

                return (
                    <div className="mt-8 animate-fade-in border-t border-gray-700 pt-8">
                        <h3 className="text-xl font-bold text-purple-300 mb-2 flex items-center gap-2"><Sparkles className="w-5 h-5" /> ì„ ì²œìš´ ì •ë°€ ë¶„ì„</h3>
                        <div className="grid grid-cols-4 gap-2 mb-6">
                            <PillarCard title="ì‹œì£¼ (ìì‹/ë§ë…„)" data={result.hour} />
                            <PillarCard title="ì¼ì£¼ (ë‚˜/ë°°ìš°ì)" data={result.day} />
                            <PillarCard title="ì›”ì£¼ (ë¶€ëª¨/ì§ì—…)" data={result.month} />
                            <PillarCard title="ë…„ì£¼ (ì¡°ìƒ/ì´ˆë…„)" data={result.year} />
                        </div>
                        
                        <div className="bg-gray-800 p-6 rounded-2xl border border-gray-700 mb-4">
                            <h4 className="text-lg font-bold text-white mb-3 flex items-center gap-2"><User className="w-5 h-5" /> ë³¸ì›(Day Master) ì‹¬ì¸µ ë¶„ì„</h4>
                            <div className="text-2xl font-bold text-purple-400 mb-2">{dayMaster} ({ELEMENTS[getElement(dayMaster)].label})</div>
                            <p className="text-gray-300 leading-relaxed text-sm">{DAY_MASTER_DETAILS[dayMaster]}</p>
                        </div>

                        <div className="bg-gray-800 p-6 rounded-2xl border border-gray-700">
                            <h4 className="text-lg font-bold text-white mb-3 flex items-center gap-2"><Scale className="w-5 h-5" /> ì˜¤í–‰ ê· í˜•ê³¼ ê°œìš´ë²•</h4>
                            <div className="flex gap-1 h-3 rounded-full overflow-hidden bg-gray-900 mb-3">
                                {Object.entries(counts).map(([elem, count]) => (<div key={elem} style={{ width: `${(count / 8) * 100}%` }} className={`h-full ${ELEMENTS[elem].bg}`} />))}
                            </div>
                            <div className="grid grid-cols-2 gap-4 text-sm mb-4">
                                <div className="bg-gray-900/50 p-3 rounded text-center"><span className="block text-gray-500 text-xs">ê°€ì¥ ê°•í•œ ê¸°ìš´</span><span className={`font-bold ${ELEMENTS[maxElement].color}`}>{ELEMENTS[maxElement].label}</span></div>
                                <div className="bg-gray-900/50 p-3 rounded text-center"><span className="block text-gray-500 text-xs">ë³´ì™„ì´ í•„ìš”í•œ ê¸°ìš´</span><span className={`font-bold ${ELEMENTS[weakElement].color}`}>{ELEMENTS[weakElement].label}</span></div>
                            </div>
                            <div className="bg-gray-900/30 p-4 rounded-lg">
                                <p className="text-gray-300 text-sm leading-relaxed"><span className="text-yellow-400 font-bold">ğŸ’¡ ë§ì¶¤ ì¡°ì–¸:</span> {elementAdvice[maxElement]}</p>
                            </div>
                        </div>
                    </div>
                );
            };

            const NamingResultCard = ({ result }) => {
                if (!result) return null;
                return (
                    <div className="mt-8 animate-fade-in border-t border-gray-700 pt-8">
                        <h3 className="text-xl font-bold text-green-300 mb-6 flex items-center gap-2"><BookOpen className="w-5 h-5" /> ì„±ëª…í•™ ì •ë°€ ë¶„ì„</h3>
                        <div className="space-y-4">
                            <div className="bg-gray-800 p-5 rounded-xl border border-gray-700">
                                <div className="flex justify-between items-center mb-2">
                                    <span className="text-green-400 font-bold">ì´ˆë…„ìš´ (ì›ê²©)</span>
                                    <span className="text-2xl font-bold text-white">{result.won}ìˆ˜</span>
                                </div>
                                <p className="text-sm text-gray-300 leading-relaxed">{getSuliInterpretation(result.won)}</p>
                            </div>
                            <div className="bg-gray-800 p-5 rounded-xl border border-gray-700 border-l-4 border-l-yellow-500">
                                <div className="flex justify-between items-center mb-2">
                                    <span className="text-yellow-400 font-bold">ì¥ë…„ìš´ (í˜•ê²©) - í•µì‹¬ ìš´ì„¸</span>
                                    <span className="text-2xl font-bold text-white">{result.hyeong}ìˆ˜</span>
                                </div>
                                <p className="text-sm text-gray-300 leading-relaxed">{getSuliInterpretation(result.hyeong)}</p>
                            </div>
                            <div className="bg-gray-800 p-5 rounded-xl border border-gray-700">
                                <div className="flex justify-between items-center mb-2">
                                    <span className="text-blue-400 font-bold">ì¤‘ë…„ìš´ (ì´ê²©)</span>
                                    <span className="text-2xl font-bold text-white">{result.li}ìˆ˜</span>
                                </div>
                                <p className="text-sm text-gray-300 leading-relaxed">{getSuliInterpretation(result.li)}</p>
                            </div>
                            <div className="bg-gray-800 p-5 rounded-xl border border-gray-700">
                                <div className="flex justify-between items-center mb-2">
                                    <span className="text-purple-400 font-bold">ë§ë…„ìš´ (ì •ê²©) - ì´ìš´</span>
                                    <span className="text-2xl font-bold text-white">{result.jeong}ìˆ˜</span>
                                </div>
                                <p className="text-sm text-gray-300 leading-relaxed">{getSuliInterpretation(result.jeong)}</p>
                            </div>
                        </div>
                    </div>
                );
            };

            const DetailedGunghapResult = ({ result }) => {
                if (!result) return null;
                const getScoreColor = (score) => {
                    if (score >= 85) return "text-pink-400";
                    if (score >= 70) return "text-blue-400";
                    return "text-gray-400";
                };
                
                // Element relationship advice
                const getElementAdvice = (e1, e2) => {
                    if (e1 === e2) return "ê°™ì€ ì˜¤í–‰ì´ë¼ ì¹œêµ¬ì²˜ëŸ¼ í¸ì•ˆí•˜ì§€ë§Œ, ìì¡´ì‹¬ ì‹¸ì›€ì´ ì¦ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„œë¡œì˜ ë‹¤ë¦„ì„ ì¸ì •í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.";
                    // Wood generates Fire, Fire generates Earth... (Generating Cycle)
                    const gen = {Wood:"Fire", Fire:"Earth", Earth:"Metal", Metal:"Water", Water:"Wood"};
                    if (gen[e1] === e2) return "ë‹¹ì‹ ì´ ìƒëŒ€ë°©ì„ ë„ì™€ì£¼ëŠ” ìƒìƒ ê´€ê³„ì…ë‹ˆë‹¤. ë‹¹ì‹ ì˜ í—Œì‹ ì´ ìƒëŒ€ë°©ì—ê²Œ í° í˜ì´ ë©ë‹ˆë‹¤.";
                    if (gen[e2] === e1) return "ìƒëŒ€ë°©ì´ ë‹¹ì‹ ì„ ë„ì™€ì£¼ëŠ” ìƒìƒ ê´€ê³„ì…ë‹ˆë‹¤. ìƒëŒ€ë°©ì˜ ë°°ë ¤ì— ê°ì‚¬í•¨ì„ í‘œí˜„í•˜ì„¸ìš”.";
                    // Controlling Cycle
                    const con = {Wood:"Earth", Earth:"Water", Water:"Fire", Fire:"Metal", Metal:"Wood"};
                    if (con[e1] === e2) return "ë‹¹ì‹ ì´ ìƒëŒ€ë°©ì„ ë¦¬ë“œí•˜ëŠ” ê´€ê³„ì…ë‹ˆë‹¤. ê°•ì••ì ì´ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ë©´ ì£¼ë„ê¶Œì„ ì¡ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                    if (con[e2] === e1) return "ìƒëŒ€ë°©ì´ ë‹¹ì‹ ì„ ë¦¬ë“œí•˜ëŠ” ê´€ê³„ì…ë‹ˆë‹¤. ìƒëŒ€ì˜ ê²°ë‹¨ë ¥ì„ ë¯¿ê³  ë”°ë¥´ë©´ ì•ˆì •ê°ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                    return "ì„œë¡œ ë‹¤ë¥¸ ë§¤ë ¥ì— ëŒë¦¬ì§€ë§Œ, ê°€ì¹˜ê´€ì˜ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ë§ì€ ëŒ€í™”ê°€ í•„ìš”í•©ë‹ˆë‹¤.";
                };

                const elem1 = ELEMENTS[getElement(result.p1.gan)].label.split('(')[0]; 
                const e1Key = getElement(result.p1.gan);
                const e2Key = getElement(result.p2.gan);

                return (
                    <div className="mt-8 animate-fade-in border-t border-gray-700 pt-8 space-y-6">
                        <div className="text-center">
                            <h3 className="text-2xl font-bold text-white mb-2">ë‘ ë¶„ì˜ ê¶í•© ë¦¬í¬íŠ¸</h3>
                            <div className={`text-8xl font-black ${getScoreColor(result.score)} mb-4 drop-shadow-lg tracking-tighter`}>{result.score}ì </div>
                            <p className="text-lg text-gray-300 font-medium px-4">{result.summary}</p>
                        </div>
                        
                        {result.nameChemistry && (
                            <div className="bg-gray-800 p-5 rounded-2xl border border-gray-700">
                                <h4 className="text-green-400 font-bold mb-3 flex items-center gap-2"><BookOpen className="w-4 h-4" /> ì´ë¦„(í•©ìˆ˜) ê¶í•© í’€ì´</h4>
                                <div className="text-center">
                                    <div className="text-2xl font-bold text-white mb-2">í•©ìˆ˜ {result.nameChemistry.totalStrokes}íš</div>
                                    <div className="bg-gray-900/50 p-4 rounded-lg text-left">
                                        <p className="text-sm text-gray-300 leading-relaxed">{getSuliInterpretation(result.nameChemistry.totalStrokes)}</p>
                                    </div>
                                    <span className="text-xs text-gray-500 mt-2 block">(ì´ë¦„ ê¶í•© ì ìˆ˜ê°€ ì¢…í•© ì ìˆ˜ì— ê°€ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤)</span>
                                </div>
                            </div>
                        )}

                        <div className="bg-gray-800 p-6 rounded-2xl border border-gray-700">
                            <h4 className="text-lg font-bold text-purple-300 mb-4 flex items-center gap-2"><User className="w-5 h-5" /> ì„±ê²©(ì¼ê°„) ì¼€ë¯¸ìŠ¤íŠ¸ë¦¬</h4>
                            <div className="flex items-center justify-between px-2 mb-6">
                                <div className="flex flex-col items-center">
                                    <span className="text-sm text-gray-500 mb-2">ë‚˜</span>
                                    <div className={`w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold text-white shadow-lg ${COLORS[result.p1.gan]}`}>{result.p1.gan.charAt(0)}</div>
                                    <span className="text-xs text-gray-400 mt-1">{ELEMENTS[e1Key].label}</span>
                                </div>
                                <div className="flex flex-col items-center px-4 w-full">
                                    <div className="h-1 w-full bg-gray-700 rounded-full mb-2 relative">
                                        <div className="absolute -top-1.5 left-1/2 -translate-x-1/2 w-3 h-3 bg-gray-500 rounded-full"></div>
                                    </div>
                                    <span className="text-xs text-gray-400 text-center">{getElementAdvice(e1Key, e2Key)}</span>
                                </div>
                                <div className="flex flex-col items-center">
                                    <span className="text-sm text-gray-500 mb-2">ìƒëŒ€</span>
                                    <div className={`w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold text-white shadow-lg ${COLORS[result.p2.gan]}`}>{result.p2.gan.charAt(0)}</div>
                                    <span className="text-xs text-gray-400 mt-1">{ELEMENTS[e2Key].label}</span>
                                </div>
                            </div>
                        </div>

                        <div className="bg-gradient-to-r from-pink-900/40 to-purple-900/40 p-6 rounded-2xl border border-pink-500/30">
                            <h4 className="text-pink-300 font-bold mb-3 flex items-center gap-2"><Heart className="w-5 h-5" /> ì—°ì• /ê²°í˜¼ ì¡°ì–¸</h4>
                            <div className="space-y-3 text-sm text-gray-200 leading-relaxed">
                                <p><span className="text-pink-400 font-bold">â™¥ ê°ˆë“± ê´€ë¦¬:</span> {result.branchDesc.includes("ì¶©") ? "ë‘ ë¶„ì€ ì„œë¡œì˜ ìì¡´ì‹¬ì„ ê±´ë“œë¦¬ë©´ í¬ê²Œ ì‹¸ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í™”ê°€ ë‚  ë•ŒëŠ” ìë¦¬ë¥¼ í”¼í•˜ê³ , ê°ì •ì´ ê°€ë¼ì•‰ì€ ë’¤ ëŒ€í™”í•˜ì„¸ìš”." : "í° ê°ˆë“± ì—†ì´ í‰ì˜¨í•œ ê´€ê³„ë¥¼ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì§€ë£¨í•´ì§€ì§€ ì•Šë„ë¡ ìƒˆë¡œìš´ ë°ì´íŠ¸ë¥¼ ì¦ê¸°ì„¸ìš”."}</p>
                                <p><span className="text-pink-400 font-bold">â™¥ ë°ì´íŠ¸ íŒ:</span> {e1Key === "Water" || e2Key === "Water" ? "ë°¤ì— ë¶„ìœ„ê¸° ì¢‹ì€ ê³³ì—ì„œ ì§„ì§€í•œ ëŒ€í™”ë¥¼ ë‚˜ëˆ„ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤." : "í™œë™ì ì¸ ì•¼ì™¸ ë°ì´íŠ¸ë‚˜ ë§›ì§‘ íƒë°©ì´ ì‚¬ë‘ì„ í‚¤ì›Œì¤ë‹ˆë‹¤."}</p>
                            </div>
                        </div>
                    </div>
                );
            };

            const GunghapSection = () => {
                const [p1Date, setP1Date] = useState('');
                const [p2Date, setP2Date] = useState('');
                const [p1NameKr, setP1NameKr] = useState('');
                const [p2NameKr, setP2NameKr] = useState('');
                const [p1Hanja, setP1Hanja] = useState('');
                const [p2Hanja, setP2Hanja] = useState('');
                const [p1Type, setP1Type] = useState('solar');
                const [p1Leap, setP1Leap] = useState(false);
                const [p2Type, setP2Type] = useState('solar');
                const [p2Leap, setP2Leap] = useState(false);
                const [result, setResult] = useState(null);
                const [loading, setLoading] = useState(false);

                const getNameStrokes = (name) => {
                    if (!name) return 0;
                    let total = 0;
                    for (let char of name) { total += (HANJA_STROKES[char] || 0); }
                    return total;
                };

                const checkNameCompatibility = (n1, n2) => {
                    if (!n1 || !n2) return null;
                    const s1 = getNameStrokes(n1); const s2 = getNameStrokes(n2);
                    if (s1 === 0 || s2 === 0) return null;
                    const total = s1 + s2; const mod = total % 81 || 81;
                    const goodNums = [1,3,5,6,7,8,11,13,15,16,17,18,21,23,24,25,29,31,32,33,35,37,38,39,41,45,47,48,52,61,63,65,67,68];
                    const isGood = goodNums.includes(mod);
                    return { totalStrokes: total, isGood, desc: SULI_DETAILS[mod] || (isGood ? "ì„œë¡œì˜ ê¸°ìš´ì´ ì¡°í™”ë¡œìš´ ê¸¸í•œ ìˆ«ìì…ë‹ˆë‹¤." : "ì„œë¡œ ë…¸ë ¥ì´ í•„ìš”í•œ í‰ì´í•œ ìˆ«ìì…ë‹ˆë‹¤."), bonus: isGood ? 10 : 0 };
                };

                const handleAnalyze = async () => {
                    if (!p1Date || !p2Date || !p1NameKr || !p2NameKr) return;
                    setLoading(true); setResult(null);

                    const saju1 = calculateSaju(p1Date, '12:00', p1Type, p1Leap);
                    const saju2 = calculateSaju(p2Date, '12:00', p2Type, p2Leap);
                    const s1Idx = GAN.indexOf(saju1.day.gan); const s2Idx = GAN.indexOf(saju2.day.gan);
                    let score = 60; if (Math.abs(s1Idx - s2Idx) === 5) score += 20; 
                    
                    const j1Idx = JI.indexOf(saju1.day.ji); const j2Idx = JI.indexOf(saju2.day.ji);
                    const dist = (j2Idx - j1Idx + 12) % 12;
                    let branchDesc = "";
                    if (dist === 6) { score -= 15; branchDesc = "ì¶©"; } else if (dist === 4 || dist === 8) { score += 15; branchDesc = "í•©"; }

                    let nameRes = null;
                    if (p1Hanja && p2Hanja) {
                        nameRes = checkNameCompatibility(p1Hanja, p2Hanja);
                        if (nameRes) score += nameRes.bonus;
                    }

                    const resData = {
                        score: Math.min(100, Math.max(0, score)),
                        summary: score > 80 ? "ë†“ì¹˜ì§€ ë§ˆì„¸ìš”! ì²œìƒì—°ë¶„ì…ë‹ˆë‹¤." : score > 60 ? "ì„œë¡œ ë…¸ë ¥í•˜ë©´ ì¢‹ì€ ê²°ì‹¤ì„ ë§ºìŠµë‹ˆë‹¤." : "ì„œë¡œ ë§ì€ ì´í•´ì™€ ì–‘ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤.",
                        p1: { gan: saju1.day.gan }, p2: { gan: saju2.day.gan },
                        nameChemistry: nameRes,
                        branchDesc: branchDesc
                    };

                    if (user && window.isFirebaseAvailable) {
                        try {
                            const db = window.fbDb;
                            const path = `artifacts/${window.appId}/users/${user.uid}/gunghap_history`;
                            await window.fbAddDoc(window.fbCollection(db, path), {
                                p1Date, p2Date, p1Name: p1NameKr, p2Name: p2NameKr, p1Hanja: p1Hanja || null, p2Hanja: p2Hanja || null,
                                score: resData.score, summary: resData.summary, timestamp: window.fbServerTimestamp()
                            });
                        } catch(e) { console.error("Save failed:", e); }
                    }
                    setTimeout(() => { setResult(resData); setLoading(false); }, 800);
                };

                return (
                    <div className="space-y-6 w-full animate-fade-in">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="bg-gray-800 p-4 rounded-lg border border-gray-700">
                                <h4 className="text-pink-400 mb-2 font-bold flex items-center gap-2"><Heart className="w-4 h-4" /> ë‚´ ì •ë³´</h4>
                                <div className="flex items-center gap-2 mb-2">
                                    <div className="bg-gray-900 rounded-lg p-1 flex border border-gray-600">
                                        <button onClick={() => setP1Type('solar')} className={`px-3 py-1 rounded-md text-sm font-bold transition-colors ${p1Type === 'solar' ? 'bg-gray-700 text-white' : 'text-gray-500'}`}>ì–‘ë ¥</button>
                                        <button onClick={() => setP1Type('lunar')} className={`px-3 py-1 rounded-md text-sm font-bold transition-colors ${p1Type === 'lunar' ? 'bg-gray-700 text-white' : 'text-gray-500'}`}>ìŒë ¥</button>
                                    </div>
                                    {p1Type === 'lunar' && <label className="text-xs text-gray-400"><input type="checkbox" checked={p1Leap} onChange={(e)=>setP1Leap(e.target.checked)} className="mr-1"/>ìœ¤ë‹¬</label>}
                                </div>
                                <input type="date" className="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white mb-2" value={p1Date} onChange={(e) => setP1Date(e.target.value)} />
                                <div className="space-y-2">
                                    <input type="text" placeholder="ì´ë¦„ (í•œê¸€)" className="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white text-sm" value={p1NameKr} onChange={(e) => setP1NameKr(e.target.value)} />
                                    <input type="text" placeholder="ì´ë¦„ (í•œì) - ì„ íƒ" className="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white text-sm" value={p1Hanja} onChange={(e) => setP1Hanja(e.target.value)} />
                                </div>
                            </div>
                            <div className="bg-gray-800 p-4 rounded-lg border border-gray-700">
                                <h4 className="text-blue-400 mb-2 font-bold flex items-center gap-2"><Heart className="w-4 h-4" /> ìƒëŒ€ë°© ì •ë³´</h4>
                                <div className="flex items-center gap-2 mb-2">
                                    <div className="bg-gray-900 rounded-lg p-1 flex border border-gray-600">
                                        <button onClick={() => setP2Type('solar')} className={`px-3 py-1 rounded-md text-sm font-bold transition-colors ${p2Type === 'solar' ? 'bg-gray-700 text-white' : 'text-gray-500'}`}>ì–‘ë ¥</button>
                                        <button onClick={() => setP2Type('lunar')} className={`px-3 py-1 rounded-md text-sm font-bold transition-colors ${p2Type === 'lunar' ? 'bg-gray-700 text-white' : 'text-gray-500'}`}>ìŒë ¥</button>
                                    </div>
                                    {p2Type === 'lunar' && <label className="text-xs text-gray-400"><input type="checkbox" checked={p2Leap} onChange={(e)=>setP2Leap(e.target.checked)} className="mr-1"/>ìœ¤ë‹¬</label>}
                                </div>
                                <input type="date" className="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white mb-2" value={p2Date} onChange={(e) => setP2Date(e.target.value)} />
                                <div className="space-y-2">
                                    <input type="text" placeholder="ì´ë¦„ (í•œê¸€)" className="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white text-sm" value={p2NameKr} onChange={(e) => setP2NameKr(e.target.value)} />
                                    <input type="text" placeholder="ì´ë¦„ (í•œì) - ì„ íƒ" className="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white text-sm" value={p2Hanja} onChange={(e) => setP2Hanja(e.target.value)} />
                                </div>
                            </div>
                        </div>
                        <button onClick={handleAnalyze} disabled={!p1Date || !p2Date || !p1NameKr || !p2NameKr || loading} className={`w-full py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition-all ${(!p1Date || !p2Date || !p1NameKr || !p2NameKr) ? 'bg-gray-700 text-gray-500 cursor-not-allowed' : 'bg-gradient-to-r from-pink-600 to-purple-600 text-white hover:from-pink-500 hover:to-purple-500 transform hover:-translate-y-1'}`}>
                            {loading ? <RefreshCw className="w-6 h-6 animate-spin" /> : <><Heart className="fill-current" /> ê¶í•© ë³´ê¸°</>}
                        </button>
                        <DetailedGunghapResult result={result} />
                    </div>
                );
            };

            const [inputDate, setInputDate] = useState('');
            const [inputTime, setInputTime] = useState('');
            const [calendarType, setCalendarType] = useState('solar');
            const [isLeapMonth, setIsLeapMonth] = useState(false);
            const [nameKorean, setNameKorean] = useState('');
            const [nameHanja, setNameHanja] = useState('');
            const [strokes, setStrokes] = useState([]);
            const [manualStrokes, setManualStrokes] = useState({});
            const [sajuResult, setSajuResult] = useState(null);
            const [namingResult, setNamingResult] = useState(null);

            const handleHanjaChange = (e) => {
                const val = e.target.value.replace(/\s/g, '');
                setNameHanja(val);
                setStrokes(val.split('').map(char => { return { char, count: HANJA_STROKES[char] || manualStrokes[char] || null }; }));
                setNamingResult(null); 
            };

            const updateManualStroke = (char, count) => {
                if (count === '') {
                    const newManual = {...manualStrokes}; delete newManual[char];
                    setManualStrokes(newManual); setStrokes(prev => prev.map(s => s.char === char ? { ...s, count: null } : s));
                    return;
                }
                const num = parseInt(count, 10);
                if (!isNaN(num)) {
                    setManualStrokes(prev => ({...prev, [char]: num})); setStrokes(prev => prev.map(s => s.char === char ? { ...s, count: num } : s));
                }
            };

            const calculateNaming = (strokes) => {
                const counts = strokes.map(s => s.count);
                let won, hyeong, li, jeong;
                if (counts.length === 3) {
                    hyeong = counts[0] + counts[1]; won = counts[1] + counts[2];
                    li = counts[0] + counts[2]; jeong = counts[0] + counts[1] + counts[2];
                } else if (counts.length === 2) {
                    hyeong = counts[0] + counts[1]; won = counts[1] + 1; 
                    li = counts[0] + 1; jeong = counts[0] + counts[1];
                } else {
                    jeong = counts.reduce((a,b) => a+b, 0); won = jeong; hyeong = jeong; li = jeong;
                }
                return { won, hyeong, li, jeong };
            };

            const handleTotalAnalyze = async () => {
                if (!inputDate || !nameKorean) return;
                const sRes = calculateSaju(inputDate, inputTime, calendarType, isLeapMonth);
                setSajuResult(sRes);
                let nRes = null;
                if (nameHanja && strokes.length > 0) {
                    if (strokes.some(s => !s.count)) { alert("íšìˆ˜ ì •ë³´ê°€ ì—†ëŠ” í•œìê°€ ìˆìŠµë‹ˆë‹¤."); return; }
                    nRes = calculateNaming(strokes);
                    setNamingResult(nRes);
                } else { setNamingResult(null); }

                if (user && window.isFirebaseAvailable) {
                    try {
                        const db = window.fbDb;
                        const path = `artifacts/${window.appId}/users/${user.uid}/saju_history`;
                        await window.fbAddDoc(window.fbCollection(db, path), {
                            date: inputDate, time: inputTime, calendarType, isLeapMonth,
                            name: nameKorean, hanja: nameHanja || null, dayMaster: sRes.day.gan, timestamp: window.fbServerTimestamp()
                        });
                    } catch(e) { console.error("Save failed:", e); }
                }
            };

            return (
                <div className="w-full max-w-2xl px-4 pb-12 flex flex-col items-center">
                    <header className="w-full max-w-2xl px-6 py-8 flex flex-col items-center text-center">
                        <h1 className="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-pink-400 to-yellow-400 mb-2 tracking-tight">ì²œê¸°ëˆ„ì„¤ (å¤©æ©Ÿæ¼æ´©)</h1>
                        <p className="text-gray-400 text-sm">ìš´ëª…ì˜ íë¦„ì„ ì½ê³  ë¯¸ë˜ë¥¼ ì¤€ë¹„í•˜ì„¸ìš”</p>
                    </header>
                    <main className="w-full">
                        <div className="bg-gray-800/50 backdrop-blur-lg rounded-3xl shadow-2xl border border-gray-700 overflow-hidden">
                            <div className="flex border-b border-gray-700">
                                <button onClick={() => setActiveTab('total')} className={`flex-1 py-4 text-center font-bold transition-colors ${activeTab === 'total' ? 'bg-gray-800 text-purple-400 border-b-2 border-purple-500' : 'bg-gray-900/50 text-gray-500'}`}><Sparkles className="w-4 h-4 inline mr-1" /> ì¢…í•© ë¶„ì„</button>
                                <button onClick={() => setActiveTab('gunghap')} className={`flex-1 py-4 text-center font-bold transition-colors ${activeTab === 'gunghap' ? 'bg-gray-800 text-pink-400 border-b-2 border-pink-500' : 'bg-gray-900/50 text-gray-500'}`}><Heart className="w-4 h-4 inline mr-1" /> ì—°ì¸ ê¶í•©</button>
                            </div>
                            <div className="p-6 md:p-8">
                                {activeTab === 'total' && (
                                    <div className="space-y-6 animate-fade-in">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div className="md:col-span-1">
                                                <label className="block text-gray-400 text-sm font-bold mb-2 flex items-center gap-2"><Calendar className="w-4 h-4" /> ìƒë…„ì›”ì¼</label>
                                                <div className="flex items-center gap-2 mb-2">
                                                    <div className="bg-gray-900 rounded-lg p-1 flex border border-gray-600">
                                                        <button onClick={() => setCalendarType('solar')} className={`px-3 py-1 rounded-md text-sm font-bold transition-colors ${calendarType === 'solar' ? 'bg-gray-700 text-white shadow' : 'text-gray-500 hover:text-gray-300'}`}>ì–‘ë ¥</button>
                                                        <button onClick={() => setCalendarType('lunar')} className={`px-3 py-1 rounded-md text-sm font-bold transition-colors ${calendarType === 'lunar' ? 'bg-gray-700 text-white shadow' : 'text-gray-500 hover:text-gray-300'}`}>ìŒë ¥</button>
                                                    </div>
                                                    {calendarType === 'lunar' && (<label className="flex items-center gap-2 text-sm text-gray-400 cursor-pointer select-none"><input type="checkbox" checked={isLeapMonth} onChange={(e) => setIsLeapMonth(e.target.checked)} className="w-4 h-4 rounded border-gray-600 bg-gray-900 text-purple-500 focus:ring-purple-500" />ìœ¤ë‹¬</label>)}
                                                </div>
                                                <input type="date" className="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-purple-500 outline-none transition-all" value={inputDate} onChange={(e) => setInputDate(e.target.value)} />
                                            </div>
                                            <div className="md:col-span-1">
                                                <label className="block text-gray-400 text-sm font-bold mb-2 flex items-center gap-2"><Clock className="w-4 h-4" /> íƒœì–´ë‚œ ì‹œê°„</label>
                                                <div className="h-[42px] mb-2 hidden md:block"></div> 
                                                <input type="time" className="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-purple-500 outline-none transition-all" value={inputTime} onChange={(e) => setInputTime(e.target.value)} />
                                            </div>
                                            <div className="md:col-span-2">
                                                <label className="block text-gray-400 text-sm font-bold mb-2 flex items-center gap-2"><User className="w-4 h-4" /> ì´ë¦„ ì •ë³´</label>
                                                <div className="space-y-3">
                                                    <input type="text" placeholder="ì´ë¦„ (í•œê¸€) - í•„ìˆ˜" className="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-green-500 outline-none transition-all placeholder-gray-600 tracking-widest" value={nameKorean} onChange={(e) => setNameKorean(e.target.value)} />
                                                    <input type="text" placeholder="ì´ë¦„ (í•œì) - ì„ íƒ (ì„±ëª…í•™ ë¶„ì„ìš©)" className="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-green-500 outline-none transition-all placeholder-gray-600 tracking-widest" value={nameHanja} onChange={handleHanjaChange} />
                                                </div>
                                            </div>
                                        </div>
                                        {strokes.length > 0 && nameHanja && (
                                            <div className="bg-gray-900/50 p-4 rounded-lg border border-gray-700 animate-fade-in">
                                                <span className="text-sm text-gray-400 block mb-3">í•œì íšìˆ˜ í™•ì¸</span>
                                                <div className="flex flex-wrap gap-4">
                                                    {strokes.map((s, idx) => {
                                                        const isDb = HANJA_STROKES[s.char] !== undefined;
                                                        return (
                                                            <div key={idx} className="flex flex-col items-center gap-2 bg-gray-800 p-3 rounded border border-gray-600">
                                                                <span className="text-2xl font-serif text-white">{s.char}</span>
                                                                {isDb ? (<span className="text-green-400 font-bold text-sm">{s.count}íš</span>) : (
                                                                    <div className="flex flex-col items-center gap-1"><span className="text-red-400 text-xs font-bold">ë¯¸í™•ì¸</span>
                                                                        <div className="flex items-center gap-1">
                                                                            <input type="number" className="w-12 bg-gray-700 border border-gray-500 rounded text-center text-sm p-1 text-white" placeholder="?" value={s.count || ''} onChange={(e) => updateManualStroke(s.char, e.target.value)} />
                                                                            <a href={`https://hanja.dict.naver.com/search?query=${s.char}`} target="_blank" rel="noreferrer" className="p-1 bg-blue-600 rounded text-white hover:bg-blue-500" title="ë„¤ì´ë²„ í•œìì‚¬ì „ ê²€ìƒ‰"><Search className="w-3 h-3" /></a>
                                                                        </div>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        )}
                                        <button onClick={handleTotalAnalyze} className={`w-full py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition-all mt-2 ${(!inputDate || !nameKorean) ? 'bg-gray-700 text-gray-500 cursor-not-allowed' : 'bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:from-purple-500 hover:to-indigo-500 transform hover:-translate-y-1'}`} disabled={!inputDate || !nameKorean}>ìš´ëª… ë¶„ì„í•˜ê¸° <ArrowRight className="w-5 h-5" /></button>
                                        <SajuAnalysisCard result={sajuResult} />
                                        <NamingResultCard result={namingResult} />
                                    </div>
                                )}
                                {activeTab === 'gunghap' && <GunghapSection />}
                            </div>
                        </div>
                    </main>
                    <footer className="py-6 text-gray-600 text-xs text-center"><p>Â© 2024 CheonGiNuSeol. All destiny is in your hands.</p></footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SajuApp />);
    </script>
</body>
</html>
