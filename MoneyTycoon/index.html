<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Î®∏Îãà ÌÉÄÏù¥Ïø§: Í≤ΩÏ†úÏùò ÏßÄÎ∞∞Ïûê</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(30, 41, 59, 0.5); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(71, 85, 105, 0.8); border-radius: 4px; }
        
        body { 
            background-color: #0f172a; 
            color: #f1f5f9; 
            -webkit-tap-highlight-color: transparent; 
            user-select: none; 
            overflow: hidden; 
            touch-action: manipulation;
        }
        
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }

        @keyframes ticker-slide {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        .ticker-text {
            display: inline-block;
            white-space: nowrap;
            animation: ticker-slide 15s linear infinite;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-40px) scale(1.1); opacity: 0; }
        }
        .float-text {
            position: absolute;
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
            font-weight: 800;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            z-index: 9999;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .animated-bg {
            background: linear-gradient(-45deg, #0f172a, #1e293b, #171717, #111827);
            background-size: 400% 400%;
            animation: gradientMove 15s ease infinite;
        }
        .fever-bg {
            background: linear-gradient(-45deg, #450a0a, #7f1d1d, #991b1b, #b91c1c);
            background-size: 400% 400%;
            animation: gradientMove 2s ease infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(239, 68, 68, 0.5); transform: scale(1); }
            50% { box-shadow: 0 0 25px rgba(239, 68, 68, 0.8); transform: scale(1.05); }
        }
        .fever-button { animation: pulse-glow 1s infinite; }

        @keyframes spin-slot {
            0% { transform: translateY(0); }
            100% { transform: translateY(-1000%); }
        }
        .slot-spinning { animation: spin-slot 0.5s linear infinite; }
    </style>
</head>
<body id="body-bg" class="animated-bg transition-colors duration-1000">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // --- ÏïÑÏù¥ÏΩò Ïª¥Ìè¨ÎÑåÌä∏ ---
        const Icon = ({ path, className, size = 24, color = "currentColor" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Coins: (props) => <Icon {...props} path={<><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></>} />,
            TrendingUp: (props) => <Icon {...props} path={<><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></>} />,
            TrendingDown: (props) => <Icon {...props} path={<><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></>} />,
            Briefcase: (props) => <Icon {...props} path={<><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></>} />,
            Building2: (props) => <Icon {...props} path={<><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></>} />,
            Zap: (props) => <Icon {...props} path={<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>} />,
            MousePointer2: (props) => <Icon {...props} path={<><path d="m12 6 2-2H6l8 18h2a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2Z"/><path d="m12 6-4 4H4v4h4l4 4"/></>} />,
            Trophy: (props) => <Icon {...props} path={<><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></>} />,
            Activity: (props) => <Icon {...props} path={<path d="M22 12h-4l-3 9L9 3l-3 9H2"/>} />,
            LineChart: (props) => <Icon {...props} path={<><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></>} />,
            Wallet: (props) => <Icon {...props} path={<><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></>} />,
            Landmark: (props) => <Icon {...props} path={<><line x1="3" x2="21" y1="22" y2="22"/><line x1="6" x2="6" y1="18" y2="11"/><line x1="10" x2="10" y1="18" y2="11"/><line x1="14" x2="14" y1="18" y2="11"/><line x1="18" x2="18" y1="18" y2="11"/><polygon points="12 2 20 7 4 7"/></>} />,
            Microscope: (props) => <Icon {...props} path={<><path d="M6 18h8"/><path d="M3 22h18"/><path d="M14 22a7 7 0 1 0 0-14h-1"/><path d="M9 14h2"/><path d="M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z"/><path d="M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3"/></>} />,
            Calculator: (props) => <Icon {...props} path={<><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></>} />,
            Rocket: (props) => <Icon {...props} path={<><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></>} />,
            Globe: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></>} />,
            Gem: (props) => <Icon {...props} path={<path d="M6 3h12l4 6-10 13L2 9Z"/>} />,
            Save: (props) => <Icon {...props} path={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>} />,
            RotateCcw: (props) => <Icon {...props} path={<><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></>} />,
            Medal: (props) => <Icon {...props} path={<><path d="M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15"/><path d="M11 12 5.12 2.2"/><path d="m13 12 5.88-9.8"/><path d="M8 7h8"/><circle cx="12" cy="17" r="5"/><path d="M12 18v-2h-.5"/></>} />,
            Clock: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>} />,
            Crown: (props) => <Icon {...props} path={<><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></>} />,
            AlertTriangle: (props) => <Icon {...props} path={<><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></>} />,
            Info: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></>} />,
            Home: (props) => <Icon {...props} path={<><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></>} />,
            Newspaper: (props) => <Icon {...props} path={<><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/><path d="M18 14h-8"/><path d="M15 18h-5"/><path d="M10 6h8v4h-8V6Z"/></>} />,
            Hammer: (props) => <Icon {...props} path={<><path d="m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9"/><path d="M17.64 15 22 10.64"/><path d="m20.91 11.26-1.2 1.2"/><path d="M16.25 16.25 9 9"/><path d="M10.61 7.39 12 6s3.75-2 5-3 2 4.5 3 6l-1.39 1.39"/></>} />,
            Settings: (props) => <Icon {...props} path={<><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></>} />,
            Copy: (props) => <Icon {...props} path={<><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></>} />,
            Download: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></>} />,
            Volume2: (props) => <Icon {...props} path={<><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></>} />,
            VolumeX: (props) => <Icon {...props} path={<><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" x2="17" y1="9" y2="15"/><line x1="17" x2="23" y1="9" y2="15"/></>} />,
            Maximize: (props) => <Icon {...props} path={<><path d="M8 3H5a2 2 0 0 0-2 2v3"/><path d="M21 8V5a2 2 0 0 0-2-2h-3"/><path d="M3 16v3a2 2 0 0 0 2 2h3"/><path d="M16 21h3a2 2 0 0 0 2-2v-3"/></>} />,
            Flame: (props) => <Icon {...props} path={<><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.5-3.3.3-1.2 1-2.4 1.7-3.3.3-1.2.3-2.6 0-4-.5 1-1 2-1 3a4 4 0 0 0 .8 2.6Z"/></>} />,
            Star: (props) => <Icon {...props} path={<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>} />,
            Diamond: (props) => <Icon {...props} path={<path d="M6 3h12l4 6-10 13L2 9Z"/>} />,
            Dices: (props) => <Icon {...props} path={<><rect width="12" height="12" x="2" y="10" rx="2" ry="2"/><path d="m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6"/><path d="M6 18h.01"/><path d="M10 14h.01"/><path d="M15 6h.01"/><path d="M18 9h.01"/></>} />,
            Cpu: (props) => <Icon {...props} path={<><rect width="16" height="16" x="4" y="4" rx="2"/><rect width="6" height="6" x="9" y="9" rx="1"/><path d="M15 2v2"/><path d="M15 20v2"/><path d="M2 15h2"/><path d="M2 9h2"/><path d="M20 15h2"/><path d="M20 9h2"/><path d="M9 2v2"/><path d="M9 20v2"/></>} />,
            Galaxy: (props) => <Icon {...props} path={<path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5 10 10 0 0 0 0-20Z"/>} />
        };

        // --- Helper Functions ---
        const formatMoney = (amount) => {
            if (amount === 0) return "0";
            if (amount < 10000) return Math.floor(amount).toLocaleString('ko-KR');
            const units = ['', 'Îßå', 'Ïñµ', 'Ï°∞', 'Í≤Ω', 'Ìï¥', 'Ïûê', 'Ïñë', 'Íµ¨', 'Í∞Ñ'];
            let unitIndex = 0;
            let value = amount;
            while (value >= 10000 && unitIndex < units.length - 1) {
                value /= 10000;
                unitIndex++;
            }
            const formattedValue = Number.isInteger(value) ? value : value.toFixed(2);
            return `${formattedValue}${units[unitIndex]}`;
        };

        // ... (getUpgradeDesc, getIcon functions same as before) ...
        const getUpgradeDesc = (upgrade) => {
            let val, curr;
            if (upgrade.type === 'click_base') { val = 10; curr = upgrade.getEffect(upgrade.level); } 
            else if (upgrade.type === 'click_mult') { val = 100; curr = upgrade.getEffect(upgrade.level); } 
            else if (upgrade.type === 'business') { val = 20; curr = Math.round((upgrade.getEffect(upgrade.level) - 1) * 100); } 
            else if (upgrade.type === 'dividend') { val = 0.2; curr = (upgrade.getEffect(upgrade.level) * 100).toFixed(1); } 
            else if (upgrade.type === 'market') { val = 0.5; curr = upgrade.getEffect(upgrade.level).toFixed(1); } 
            else if (upgrade.type === 'discount') { val = 5; curr = Math.round((1 - upgrade.getEffect(upgrade.level)) * 100); }
            return upgrade.descTemplate.replace('{val}', val).replace('{curr}', curr);
        };

        const getIcon = (iconName) => {
            const icons = { 
                'store': Icons.Building2, 'shop': Icons.Briefcase, 'chart': Icons.TrendingUp, 
                'building': Icons.Landmark, 'scooter': Icons.Briefcase, 'rocket': Icons.Zap, 
                'bank': Icons.Coins, 'zap': Icons.Zap, 'space': Icons.Rocket, 'mars': Icons.Globe,
                'cpu': Icons.Cpu, 'galaxy': Icons.Galaxy
            };
            return icons[iconName] || Icons.Briefcase;
        };

        const InvestmentChart = ({ history, color }) => {
            const min = Math.min(...history);
            const max = Math.max(...history);
            const range = max - min || 1;
            const points = history.map((price, i) => `${(i / (history.length - 1)) * 100},${24 - ((price - min) / range) * 24}`).join(' ');
            return <svg width="100%" height={24} viewBox="0 0 100 24" preserveAspectRatio="none" className="overflow-visible"><polyline fill="none" stroke={color} strokeWidth="2" points={points} vectorEffect="non-scaling-stroke"/></svg>;
        };

        const getProgressColor = (statusId) => {
            if (statusId === 'bull') return 'bg-green-500';
            if (statusId === 'bear') return 'bg-red-500';
            return 'bg-blue-500';
        };

        // --- Data Definitions ---
        const getInitialBusinesses = () => [
            { id: 1, name: 'Ìé∏ÏùòÏ†ê ÏïåÎ∞î', baseCost: 15, baseIncome: 3, count: 0, icon: 'store' },
            { id: 2, name: 'ÎÖ∏Ï†êÏÉÅ Ïö¥ÏòÅ', baseCost: 100, baseIncome: 15, count: 0, icon: 'shop' },
            { id: 3, name: 'Ï§ëÏÜåÍ∏∞ÏóÖ Ïö¥ÏòÅ', baseCost: 1100, baseIncome: 90, count: 0, icon: 'chart' },
            { id: 4, name: 'ÌîÑÎûúÏ∞®Ïù¥Ï¶à', baseCost: 12000, baseIncome: 450, count: 0, icon: 'building' },
            { id: 5, name: 'Î∞∞Îã¨ Ïï± Ïä§ÌÉÄÌä∏ÏóÖ', baseCost: 130000, baseIncome: 2200, count: 0, icon: 'scooter' },
            { id: 6, name: 'IT Î≤§Ï≤òÍ∏∞ÏóÖ', baseCost: 850000, baseIncome: 9500, count: 0, icon: 'rocket' },
            { id: 7, name: 'Í∏ÄÎ°úÎ≤å ÏùÄÌñâ', baseCost: 5000000, baseIncome: 45000, count: 0, icon: 'bank' },
            { id: 8, name: 'ÏóêÎÑàÏßÄ Î∞úÏ†ÑÏÜå', baseCost: 45000000, baseIncome: 250000, count: 0, icon: 'zap' },
            { id: 9, name: 'ÎØºÍ∞Ñ Ïö∞Ï£º Ìï≠Í≥µÏÇ¨', baseCost: 350000000, baseIncome: 1500000, count: 0, icon: 'space' },
            { id: 10, name: 'ÌôîÏÑ± ÏãùÎØºÏßÄ', baseCost: 5000000000, baseIncome: 12000000, count: 0, icon: 'mars' },
            { id: 11, name: 'ÏñëÏûê Ïª¥Ìì®ÌÑ∞ ÎÑ§Ìä∏ÏõåÌÅ¨', baseCost: 100000000000, baseIncome: 150000000, count: 0, icon: 'cpu' }, // New
            { id: 12, name: 'ÏùÄÌïòÍ≥Ñ Î¨¥Ïó≠ Ïó∞Ìï©', baseCost: 10000000000000, baseIncome: 9000000000, count: 0, icon: 'galaxy' }, // New
        ];

        const getInitialTreasures = () => [
            { id: 'keyboard', name: 'ÏàúÍ∏à ÌÇ§Î≥¥Îìú', price: 100000000, desc: 'ÌÑ∞ÏπòÍ∞êÏù¥ ÎÇ®Îã§Î¶ÖÎãàÎã§. (ÌÅ¥Î¶≠ ÏàòÏùµ +20%)', effect: 1.2, type: 'click', owned: false },
            { id: 'monalisa', name: 'Î™®ÎÇòÎ¶¨Ïûê ÏõêÎ≥∏', price: 2000000000, desc: 'Í±∞Ïã§Ïóê Í±∏Ïñ¥ÎëêÍ∏∞ Îî± Ï¢ãÎÑ§Ïöî. (ÏÇ¨ÏóÖ ÏàòÏùµ +10%)', effect: 1.1, type: 'passive', owned: false },
            { id: 'moon_land', name: 'Îã¨ ÌÜ†ÏßÄ Î¨∏ÏÑú', price: 50000000000, desc: 'ÎØ∏ÎûòÎ•º ÏúÑÌïú ÌôïÏã§Ìïú Ìà¨Ïûê. (Î™®Îì† ÏàòÏùµ +15%)', effect: 1.15, type: 'all', owned: false },
            { id: 'infinity_stone', name: 'ÌÉÄÏûÑ Ïä§ÌÜ§', price: 1000000000000, desc: 'ÏãúÍ∞ÑÏùÑ ÏßÄÎ∞∞ÌïòÎäî Ìûò. (Í≤åÏûÑ ÏÜçÎèÑ +20%)', effect: 1.2, type: 'speed', owned: false },
        ];

        const getInitialInvestments = () => [
            { id: 'coin', name: 'ÎèÑÏßÄÏôï ÏΩîÏù∏', price: 30, owned: 0, avgPrice: 0, volatility: 0.20, type: 'high_risk', desc: 'Îß§Ïö∞ ÏúÑÌóòÌïòÏßÄÎßå ÎåÄÎ∞ï Í∞ÄÎä•ÏÑ±', history: Array(20).fill(30) },
            { id: 'nft', name: 'Ìù¨Í∑Ä NFT ÏïÑÌä∏', price: 1500, owned: 0, avgPrice: 0, volatility: 0.25, type: 'high_risk', desc: 'ÏòàÏ∏° Î∂àÍ∞ÄÎä•Ìïú ÎîîÏßÄÌÑ∏ ÏûêÏÇ∞', history: Array(20).fill(1500) },
            { id: 'bio_stock', name: 'Î∞îÏù¥Ïò§ Ï£ºÏãù', price: 5500, owned: 0, avgPrice: 0, volatility: 0.12, type: 'medium_risk', desc: 'ÏûÑÏÉÅ Í≤∞Í≥ºÏóê Îî∞Îùº Îì±ÎùΩÌè≠ ÌÅº', history: Array(20).fill(5500) },
            { id: 'stock', name: 'ÏÇºÏÜ°Ï†ÑÏûê', price: 8000, owned: 0, avgPrice: 0, volatility: 0.05, type: 'medium_risk', desc: 'ÏïàÏ†ïÏ†ÅÏù∏ Ïö∞ÎüâÏ£º (Î∞∞ÎãπÍ∏à ÎåÄÏÉÅ)', history: Array(20).fill(8000) },
            { id: 'gold', name: 'ÏàúÍ∏à Í≥®ÎìúÎ∞î', price: 350000, owned: 0, avgPrice: 0, volatility: 0.015, type: 'low_risk', desc: 'Î∂àÌô©ÏóêÎèÑ Í∞ïÌïú ÏµúÍ≥†Ïùò ÏïàÏ†ÑÏûêÏÇ∞', history: Array(20).fill(350000) },
            { id: 'real_estate', name: 'Í∞ïÎÇ® ÏïÑÌååÌä∏', price: 1500000, owned: 0, avgPrice: 0, volatility: 0.02, type: 'low_risk', desc: 'Î≥ÄÎèôÏù¥ Ï†ÅÏùÄ Î∂ÄÎèôÏÇ∞ (Î∞∞ÎãπÍ∏à ÎåÄÏÉÅ)', history: Array(20).fill(1500000) },
        ];

        const getInitialUpgrades = () => [
            { id: 'click_power', name: 'ÌååÏõå Í∏ÄÎü¨Î∏å', type: 'click_base', level: 0, maxLevel: 100, baseCost: 1000, costScale: 1.5, descTemplate: 'ÌÅ¥Î¶≠ Í∏∞Î≥∏ ÏàòÏùµ +{val} (ÌòÑÏû¨: +{curr})', getEffect: (lvl) => lvl * 10 },
            { id: 'click_boost', name: 'ÎÇòÎÖ∏ ÌÅ¥Î¶≠ Í∞ïÌôî', type: 'click_mult', level: 0, maxLevel: 50, baseCost: 500, costScale: 2.5, descTemplate: 'ÌÅ¥Î¶≠ ÏàòÏùµ Î∞∞Ïú® +{val}% (ÌòÑÏû¨: {curr}Î∞∞)', getEffect: (lvl) => 1 + (lvl * 1) },
            { id: 'biz_boost', name: 'ÏÇ¨ÏóÖ ÏûêÎèôÌôî AI', type: 'business', level: 0, maxLevel: 50, baseCost: 2000, costScale: 2.2, descTemplate: 'Î™®Îì† ÏÇ¨ÏóÖ ÏàòÏùµ +{val}% (ÌòÑÏû¨: +{curr}%)', getEffect: (lvl) => 1 + (lvl * 0.2) },
            { id: 'div_boost', name: 'Î∞∞ÎãπÍ∏à Ìà¨Ïûê Ï†ÑÎûµ', type: 'dividend', level: 0, maxLevel: 20, baseCost: 50000, costScale: 3.0, descTemplate: 'Ï£ºÏãù/Î∂ÄÎèôÏÇ∞ Í∞ÄÏπòÏùò {val}% Ï¥àÎãπ ÏàòÏùµ (ÌòÑÏû¨: {curr}%)', getEffect: (lvl) => lvl * 0.002 },
            { id: 'market_boost', name: 'ÏãúÏû• ÏòàÏ∏° Î™®Îç∏', type: 'market', level: 0, maxLevel: 10, baseCost: 100000, costScale: 4.0, descTemplate: 'Ìò∏Ìô©Í∏∞ Î≥¥ÎÑàÏä§ Î∞∞Ïú® +{val} (ÌòÑÏû¨: x{curr})', getEffect: (lvl) => 2.0 + (lvl * 0.5) },
            { id: 'cost_cut', name: 'Î°úÎπÑÏä§Ìä∏ Í≥†Ïö©', type: 'discount', level: 0, maxLevel: 10, baseCost: 500000, costScale: 5.0, descTemplate: 'ÏÇ¨ÏóÖ Ïù∏Ïàò ÎπÑÏö© {val}% Ìï†Ïù∏ (ÌòÑÏû¨: -{curr}%)', getEffect: (lvl) => Math.max(0.1, 1.0 - (lvl * 0.05)) }
        ];

        const ACHIEVEMENT_DEFINITIONS = [
            { id: 'first_money', name: 'Ï≤´ Í±∏Ïùå', desc: 'ÎàÑÏ†Å ÏàòÏùµ 1,000Ïõê Îã¨ÏÑ±', condition: (state) => state.totalEarned >= 1000 },
            { id: 'rich_1m', name: 'Î∞±ÎßåÏû•Ïûê', desc: 'Î≥¥Ïú† ÏûêÏÇ∞ 100ÎßåÏõê Îã¨ÏÑ±', condition: (state) => state.money >= 1000000 },
            { id: 'rich_100m', name: 'ÏñµÎßåÏû•Ïûê', desc: 'Î≥¥Ïú† ÏûêÏÇ∞ 1ÏñµÏõê Îã¨ÏÑ±', condition: (state) => state.money >= 100000000 },
            { id: 'biz_king', name: 'ÏÇ¨ÏóÖÏôï', desc: 'Î™®Îì† Ï¢ÖÎ•òÏùò ÏÇ¨ÏóÖÏ≤¥ 1Í∞ú Ïù¥ÏÉÅ Î≥¥Ïú†', condition: (state) => state.businesses.every(b => b.count > 0) },
            { id: 'investor', name: 'Í∞úÎØ∏ Ìà¨ÏûêÏûê', desc: 'Ï£ºÏãù 100Ï£º Î≥¥Ïú†', condition: (state) => state.investments.find(i => i.id === 'stock').owned >= 100 },
            { id: 'landlord', name: 'Í±¥Î¨ºÏ£º', desc: 'Î∂ÄÎèôÏÇ∞ 10Ï±Ñ Î≥¥Ïú†', condition: (state) => state.investments.find(i => i.id === 'real_estate').owned >= 10 },
            { id: 'researcher', name: 'Îß§Îìú ÏÇ¨Ïù¥Ïñ∏Ìã∞Ïä§Ìä∏', desc: 'Ïó∞Íµ¨ Î†àÎ≤® Ï¥ùÌï© 50 Îã¨ÏÑ±', condition: (state) => state.upgrades.reduce((acc, u) => acc + u.level, 0) >= 50 },
            { id: 'prestige_1', name: 'ÏÉàÎ°úÏö¥ ÏãúÏûë', desc: 'Ï≤´ IPO(ÌôòÏÉù) ÏßÑÌñâ', condition: (state) => state.reputation > 0 },
        ];

        const getInitialAchievements = () => ACHIEVEMENT_DEFINITIONS.map(a => ({ ...a, unlocked: false }));

        const MARKET_EVENTS = [
            { id: 'normal', name: 'ÌèâÏò®Ìïú ÏãúÏû•', multiplier: 1.0, priceBias: 0, color: 'text-gray-400', icon: '‚òÅÔ∏è' },
            { id: 'bull', name: 'Í≤ΩÏ†ú Ìò∏Ìô©', multiplier: 2.0, priceBias: 0.03, color: 'text-green-400', icon: '‚òÄÔ∏è' },
            { id: 'bear', name: 'Í≤ΩÏ†ú Î∂àÌô©', multiplier: 0.5, priceBias: -0.03, color: 'text-red-400', icon: 'üåßÔ∏è' },
        ];

        const NEWS_ITEMS = [
            { text: "Ï†ïÎ∂Ä, Í∞ÄÏÉÅÌôîÌèê Í∑úÏ†ú ÏôÑÌôî ÏãúÏÇ¨...", target: 'coin', effect: 1.3, type: 'good' },
            { text: "Ïú†Î™Ö Ïù∏ÌîåÎ£®Ïñ∏ÏÑú, 'ÎèÑÏßÄÏôï ÏΩîÏù∏' Ï†ÑÎüâ Îß§ÎèÑ Ïù∏Ï¶ù", target: 'coin', effect: 0.7, type: 'bad' },
            { text: "Î∞òÎèÑÏ≤¥ ÏàòÍ∏âÎÇú Ìï¥ÏÜå, Ï†ÑÏûê Í¥ÄÎ†®Ï£º Í∏âÎì± ÏòàÏÉÅ", target: 'stock', effect: 1.15, type: 'good' },
            { text: "Í∏ÄÎ°úÎ≤å Í≤ΩÍ∏∞ Ïπ®Ï≤¥ Ïö∞Î†§, Ï¶ùÏãú ÏñºÏñ¥Î∂ôÎÇò", target: 'stock', effect: 0.85, type: 'bad' },
            { text: "Í∞ïÎÇ® Î∂ÄÎèôÏÇ∞ Î∂àÌå® Ïã†Ìôî, ÏïÑÌååÌä∏Í∞í Îòê ÏµúÍ≥†Í∞Ä Í∞±Ïã†", target: 'real_estate', effect: 1.1, type: 'good' },
            { text: "Ï†ïÎ∂Ä, Í≥†Í∞ïÎèÑ Î∂ÄÎèôÏÇ∞ ÎåÄÏ∂ú Í∑úÏ†ú Î∞úÌëú", target: 'real_estate', effect: 0.9, type: 'bad' },
            { text: "ÏïàÏ†ÑÏûêÏÇ∞ ÏÑ†Ìò∏ Ïã¨Î¶¨ ÌôïÏÇ∞, Í∏àÍ∞í ÏÉÅÏäπÏÑ∏", target: 'gold', effect: 1.05, type: 'good' },
            { text: "Ïã†ÏïΩ ÏûÑÏÉÅ 3ÏÉÅ ÏÑ±Í≥µ Î£®Î®∏ ÌôïÏÇ∞!", target: 'bio_stock', effect: 1.5, type: 'good' },
            { text: "Î∞îÏù¥Ïò§ Í∏∞ÏóÖ ÌöåÍ≥Ñ Î∂ÄÏ†ï ÏùòÌòπ Ï†úÍ∏∞...", target: 'bio_stock', effect: 0.5, type: 'bad' },
            { text: "ÎîîÏßÄÌÑ∏ ÏïÑÌä∏ NFT, Í≤ΩÎß§ÏÑú 100Ïñµ ÎÇôÏ∞∞", target: 'nft', effect: 1.4, type: 'good' },
            { text: "NFT ÏãúÏû• Í±∞Ìíà Î∂ïÍ¥¥? Í±∞ÎûòÎüâ Í∏âÍ∞ê", target: 'nft', effect: 0.6, type: 'bad' },
            { text: "Ï†Ñ ÏÑ∏Í≥ÑÏ†ÅÏù∏ Ï†ÑÏóºÎ≥ë Ïö∞Î†§ ÏôÑÌôî, Í≤ΩÏ†ú ÌôúÎèô Ïû¨Í∞ú", target: 'all', effect: 1.0, type: 'good' },
        ];

        function App() {
            // --- State ---
            const [money, setMoney] = useState(0);
            const [totalEarned, setTotalEarned] = useState(0);
            const [businesses, setBusinesses] = useState(getInitialBusinesses);
            const [investments, setInvestments] = useState(getInitialInvestments);
            const [upgrades, setUpgrades] = useState(getInitialUpgrades);
            const [achievements, setAchievements] = useState(getInitialAchievements);
            const [treasures, setTreasures] = useState(getInitialTreasures); // New
            const [reputation, setReputation] = useState(0);
            const [marketStatus, setMarketStatus] = useState(MARKET_EVENTS[0]);
            
            const [currentNews, setCurrentNews] = useState({ text: "Ïò§ÎäòÏùò Í≤ΩÏ†ú Îâ¥Ïä§Î•º Í∏∞Îã§Î¶¨Îäî Ï§ë...", type: 'neutral' });
            const [newsHistory, setNewsHistory] = useState([]); 

            const [activeTab, setActiveTab] = useState('home'); 
            const [tradeAmount, setTradeAmount] = useState(1);
            const [clickEffects, setClickEffects] = useState([]); 
            
            // Fever State
            const [feverValue, setFeverValue] = useState(0); 
            const [isFeverActive, setIsFeverActive] = useState(false);
            const [feverTimeLeft, setFeverTimeLeft] = useState(0);
            
            // Slot Machine State
            const [slotResult, setSlotResult] = useState(null);
            const [isSpinning, setIsSpinning] = useState(false);
            
            // Modals
            const [offlineEarnings, setOfflineEarnings] = useState(0);
            const [showOfflineModal, setShowOfflineModal] = useState(false);
            const [showIPOModal, setShowIPOModal] = useState(false);
            const [showResetModal, setShowResetModal] = useState(false);
            const [showSettingsModal, setShowSettingsModal] = useState(false); 
            const [saveString, setSaveString] = useState("");
            const [toastMessage, setToastMessage] = useState(null);
            
            const [soundEnabled, setSoundEnabled] = useState(true);
            const audioCtx = useRef(null);
            
            const gameStateRef = useRef({});

            useEffect(() => {
                gameStateRef.current = {
                    money, totalEarned, businesses, investments, upgrades, achievements, reputation, marketStatus, currentNews, newsHistory, soundEnabled,
                    feverValue, treasures // Added treasures
                };
            }, [money, totalEarned, businesses, investments, upgrades, achievements, reputation, marketStatus, currentNews, newsHistory, soundEnabled, feverValue, treasures]);

            // --- Utils & Hooks ---
            const playSound = useCallback((type) => {
                if (!soundEnabled) return;
                try {
                    if (!audioCtx.current) { audioCtx.current = new (window.AudioContext || window.webkitAudioContext)(); }
                    const ctx = audioCtx.current;
                    if (ctx.state === 'suspended') ctx.resume();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    const now = ctx.currentTime;
                    
                    if (type === 'click') {
                        osc.type = 'sine'; osc.frequency.setValueAtTime(1200, now); osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
                        gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                        osc.start(now); osc.stop(now + 0.1);
                    } else if (type === 'buy') {
                        osc.type = 'triangle'; osc.frequency.setValueAtTime(400, now); osc.frequency.linearRampToValueAtTime(800, now + 0.1);
                        gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.2);
                        osc.start(now); osc.stop(now + 0.2);
                    } else if (type === 'error') {
                        osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(100, now + 0.1);
                        gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.15);
                        osc.start(now); osc.stop(now + 0.15);
                    } else if (type === 'fever') {
                        osc.type = 'square'; osc.frequency.setValueAtTime(400, now); osc.frequency.linearRampToValueAtTime(800, now + 0.3);
                        gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.5);
                        osc.start(now); osc.stop(now + 0.5);
                    } else if (type === 'jackpot') {
                        osc.type = 'sine'; osc.frequency.setValueAtTime(500, now); osc.frequency.linearRampToValueAtTime(1000, now + 0.5);
                        gain.gain.setValueAtTime(0.2, now); gain.gain.linearRampToValueAtTime(0.01, now + 1.0);
                        osc.start(now); osc.stop(now + 1.0);
                    }
                } catch (e) { console.error("Audio error", e); }
            }, [soundEnabled]);

            const showToast = (msg) => { setToastMessage(msg); setTimeout(() => setToastMessage(null), 3000); };
            const toggleFullScreen = () => { if (!document.fullscreenElement) { document.documentElement.requestFullscreen().catch(e=>console.log(e)); } else { if (document.exitFullscreen) document.exitFullscreen(); } };
            const getNetWorth = useCallback(() => { const assetsValue = investments.reduce((acc, inv) => acc + (inv.price * inv.owned), 0); return money + assetsValue; }, [money, investments]);

            const saveData = useCallback(() => {
                const state = gameStateRef.current;
                if(!state.money && state.money !== 0) return;
                const gameState = {
                    money: state.money, totalEarned: state.totalEarned, businesses: state.businesses, investments: state.investments,
                    upgrades: state.upgrades, achievements: state.achievements, reputation: state.reputation, soundEnabled: state.soundEnabled,
                    newsHistory: state.newsHistory, feverValue: state.feverValue, treasures: state.treasures, // Added treasures
                    lastSaveTime: Date.now()
                };
                localStorage.setItem('moneyTycoonSaveV9', JSON.stringify(gameState)); // V9
            }, []);

            useEffect(() => { const interval = setInterval(() => { saveData(); }, 5000); const handleUnload = () => saveData(); window.addEventListener('beforeunload', handleUnload); return () => { clearInterval(interval); window.removeEventListener('beforeunload', handleUnload); }; }, [saveData]);

            // Load Data
            useEffect(() => {
                const savedData = localStorage.getItem('moneyTycoonSaveV9');
                if (savedData) {
                    try {
                        const parsed = JSON.parse(savedData);
                        setMoney(parsed.money || 0);
                        setTotalEarned(parsed.totalEarned || 0);
                        if (parsed.businesses) setBusinesses(parsed.businesses);
                        if (parsed.investments) setInvestments(parsed.investments);
                        if (parsed.upgrades) {
                            const mergedUpgrades = getInitialUpgrades().map(initUp => { const loaded = parsed.upgrades.find(u => u.id === initUp.id); return loaded ? { ...initUp, level: loaded.level } : initUp; });
                            setUpgrades(mergedUpgrades);
                        }
                        if (parsed.achievements) {
                            const mergedAch = getInitialAchievements().map(initAch => { const loaded = parsed.achievements.find(a => a.id === initAch.id); return loaded ? { ...initAch, unlocked: loaded.unlocked } : initAch; });
                            setAchievements(mergedAch);
                        }
                        if (parsed.treasures) {
                             const mergedTreasures = getInitialTreasures().map(initTr => { const loaded = parsed.treasures.find(t => t.id === initTr.id); return loaded ? { ...initTr, owned: loaded.owned } : initTr; });
                             setTreasures(mergedTreasures);
                        }
                        if (parsed.reputation) setReputation(parsed.reputation);
                        if (parsed.soundEnabled !== undefined) setSoundEnabled(parsed.soundEnabled);
                        if (parsed.newsHistory) setNewsHistory(parsed.newsHistory);
                        if (parsed.feverValue) setFeverValue(parsed.feverValue);

                        if (parsed.lastSaveTime) {
                            const now = Date.now();
                            const timeDiffSeconds = (now - parsed.lastSaveTime) / 1000;
                            if (timeDiffSeconds > 60) {
                                // Offline Calc (Simplified)
                                const currentBusinesses = parsed.businesses || getInitialBusinesses();
                                const currentUpgrades = parsed.upgrades || getInitialUpgrades();
                                const currentReputation = parsed.reputation || 0;
                                let businessIncome = 0;
                                currentBusinesses.forEach(bus => {
                                    let baseInc = bus.baseIncome * bus.count;
                                    if (bus.count >= 25) baseInc *= 2; if (bus.count >= 50) baseInc *= 2; if (bus.count >= 100) baseInc *= 2; if (bus.count >= 200) baseInc *= 2; if (bus.count >= 400) baseInc *= 2;
                                    businessIncome += baseInc;
                                });
                                const bizUpgrade = currentUpgrades.find(u => u.id === 'biz_boost');
                                if (bizUpgrade) businessIncome *= (1 + (bizUpgrade.level * 0.2));
                                const unlockedCount = (parsed.achievements || []).filter(a => a.unlocked).length;
                                const achievementMultiplier = 1 + (unlockedCount * 0.01);
                                const prestigeMultiplier = 1 + (currentReputation * 0.002);
                                
                                // Treasure bonus for offline? Let's ignore complex treasury logic for offline to keep simple or add basic 1.1x if any owned.
                                
                                const earnings = Math.floor(businessIncome * achievementMultiplier * prestigeMultiplier * timeDiffSeconds);
                                if (earnings > 0) {
                                    setOfflineEarnings(earnings);
                                    setShowOfflineModal(true);
                                    setMoney(prev => prev + earnings);
                                    setTotalEarned(prev => prev + earnings);
                                }
                            }
                        }
                    } catch (e) { console.error("Save file corrupted", e); }
                }
            }, []);

            const handleResetConfirm = () => {
                localStorage.removeItem('moneyTycoonSaveV9');
                setMoney(0); setTotalEarned(0); setBusinesses(getInitialBusinesses()); setInvestments(getInitialInvestments());
                setUpgrades(getInitialUpgrades()); setAchievements(getInitialAchievements()); setTreasures(getInitialTreasures());
                setReputation(0); setNewsHistory([]); setFeverValue(0); setIsFeverActive(false);
                setShowResetModal(false); showToast("Îç∞Ïù¥ÌÑ∞Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§."); playSound('error');
            };

            const handleIPO = () => {
                const netWorth = getNetWorth();
                const potentialReputation = Math.floor(netWorth / 1000000000); 
                if (potentialReputation <= 0) { playSound('error'); return; }
                setReputation(prev => prev + potentialReputation);
                setMoney(0); setTotalEarned(0); setBusinesses(getInitialBusinesses()); setInvestments(getInitialInvestments());
                setUpgrades(getInitialUpgrades()); setFeverValue(0); setIsFeverActive(false);
                // Keep Treasures!
                setShowIPOModal(false); showToast(`IPO ÏÑ±Í≥µ! Î™ÖÏÑ± ${potentialReputation}Ï†êÏùÑ ÌöçÎìùÌñàÏäµÎãàÎã§.`); playSound('buy');
            };

            const activateFever = () => {
                if (feverValue >= 100 && !isFeverActive) {
                    setIsFeverActive(true); setFeverValue(0); setFeverTimeLeft(15); playSound('fever'); showToast("üî• ÌîºÎ≤Ñ ÌÉÄÏûÑ Î∞úÎèô! ÏàòÏùµ 5Î∞∞!");
                }
            };
            useEffect(() => {
                let timer; if (isFeverActive && feverTimeLeft > 0) { timer = setInterval(() => { setFeverTimeLeft(prev => prev - 1); }, 1000); } else if (isFeverActive && feverTimeLeft <= 0) { setIsFeverActive(false); }
                return () => clearInterval(timer);
            }, [isFeverActive, feverTimeLeft]);

            // Slot Machine Logic
            const playSlotMachine = () => {
                if (money < 1000) { showToast("ÏµúÏÜå 1,000ÏõêÏù¥ ÌïÑÏöîÌï©ÎãàÎã§."); playSound('error'); return; }
                if (isSpinning) return;
                
                const betAmount = Math.max(1000, Math.floor(money * 0.01)); // 1% or 1000
                setMoney(prev => prev - betAmount);
                setIsSpinning(true);
                
                // Spin animation simulation
                setTimeout(() => {
                    const rand = Math.random() * 100;
                    let multiplier = 0;
                    if (rand > 99) multiplier = 777; // 1% Jackpot
                    else if (rand > 95) multiplier = 10; // 4% Big Win
                    else if (rand > 80) multiplier = 3; // 15% Win
                    else if (rand > 50) multiplier = 1.5; // 30% Small Win
                    else multiplier = 0; // 50% Lose
                    
                    const winAmount = Math.floor(betAmount * multiplier);
                    setMoney(prev => prev + winAmount);
                    setTotalEarned(prev => prev + winAmount);
                    setSlotResult({ bet: betAmount, win: winAmount, multiplier });
                    setIsSpinning(false);
                    
                    if (multiplier >= 10) { playSound('jackpot'); showToast(`üé∞ Ïû≠Ìåü! ${multiplier}Î∞∞ ÎãπÏ≤®!`); }
                    else if (multiplier > 0) { playSound('buy'); }
                    else { playSound('error'); }
                }, 1000);
            };
            
            // Buy Treasure
            const buyTreasure = (id) => {
                const idx = treasures.findIndex(t => t.id === id);
                if (money >= treasures[idx].price && !treasures[idx].owned) {
                    setMoney(prev => prev - treasures[idx].price);
                    const newTr = [...treasures];
                    newTr[idx].owned = true;
                    setTreasures(newTr);
                    playSound('buy');
                    showToast(`${treasures[idx].name} Íµ¨Îß§ ÏôÑÎ£å!`);
                } else { playSound('error'); }
            };

            const handleManualClick = (e) => {
                const baseClick = 1;
                const powerUpgrade = upgrades.find(u => u.type === 'click_base');
                const addedPower = powerUpgrade ? powerUpgrade.getEffect(powerUpgrade.level) : 0;
                const boostUpgrade = upgrades.find(u => u.type === 'click_mult');
                const boostMult = boostUpgrade ? boostUpgrade.getEffect(boostUpgrade.level) : 1;
                const unlockedAchievements = achievements.filter(a => a.unlocked).length;
                const achievementMultiplier = 1 + (unlockedAchievements * 0.01);
                const prestigeMultiplier = 1 + (reputation * 0.002);
                
                // Treasure Multiplier (Click type)
                const treasureClickMult = treasures.filter(t => t.owned && (t.type === 'click' || t.type === 'all')).reduce((acc, t) => acc * t.effect, 1);

                const feverMultiplier = isFeverActive ? 5 : 1;
                const clickValue = (baseClick + addedPower) * boostMult * achievementMultiplier * prestigeMultiplier * treasureClickMult * feverMultiplier;
                
                setMoney(prev => prev + clickValue); setTotalEarned(prev => prev + clickValue);
                if (!isFeverActive && feverValue < 100) setFeverValue(prev => Math.min(100, prev + 0.5));
                playSound('click');

                let x = e.clientX; let y = e.clientY;
                if (!x || !y || x === 0 || y === 0) { const rect = e.target.getBoundingClientRect(); x = rect.left + rect.width / 2 + (Math.random() * 40 - 20); y = rect.top + rect.height / 2 + (Math.random() * 40 - 20); }
                const newEffect = { id: Date.now() + Math.random(), x: x, y: y, text: `+${formatMoney(clickValue)}` };
                setClickEffects(prev => [...prev, newEffect]);
                setTimeout(() => { setClickEffects(prev => prev.filter(ef => ef.id !== newEffect.id)); }, 800);
            };

            // ... (Other handlers same) ...
            const handleExportSave = () => {
                const saveData = localStorage.getItem('moneyTycoonSaveV9');
                if (saveData) { setSaveString(btoa(unescape(encodeURIComponent(saveData)))); } else { setSaveString("Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§."); }
            };
            const handleImportSave = () => {
                try {
                    const decoded = decodeURIComponent(escape(atob(saveString))); JSON.parse(decoded); localStorage.setItem('moneyTycoonSaveV9', decoded); window.location.reload();
                } catch (e) { showToast("ÏûòÎ™ªÎêú ÏÑ∏Ïù¥Î∏å Îç∞Ïù¥ÌÑ∞ÏûÖÎãàÎã§."); playSound('error'); }
            };

            const getUpgradeCost = useCallback((upgrade) => Math.floor(upgrade.baseCost * Math.pow(upgrade.costScale, upgrade.level)), []);
            const calculateBusinessCost = useCallback((baseCost, count, amount) => {
                const discountUpgrade = upgrades.find(u => u.type === 'discount');
                const discountMultiplier = discountUpgrade ? discountUpgrade.getEffect(discountUpgrade.level) : 1.0;
                const r = 1.15;
                if (amount === 1) return Math.floor(baseCost * Math.pow(r, count) * discountMultiplier);
                const startCost = baseCost * Math.pow(r, count);
                const totalCost = startCost * (Math.pow(r, amount) - 1) / (r - 1);
                return Math.floor(totalCost * discountMultiplier);
            }, [upgrades]);
            const calculateCost = useCallback((baseCost, count) => calculateBusinessCost(baseCost, count, 1), [calculateBusinessCost]);

            const calculateIncomePerSecond = useCallback(() => {
                let businessIncome = businesses.reduce((acc, bus) => {
                    let base = bus.baseIncome * bus.count;
                    if (bus.count >= 25) base *= 2; if (bus.count >= 50) base *= 2; if (bus.count >= 100) base *= 2; if (bus.count >= 200) base *= 2; if (bus.count >= 400) base *= 2;
                    return acc + base;
                }, 0);
                const bizUpgrade = upgrades.find(u => u.type === 'business');
                if (bizUpgrade) businessIncome *= bizUpgrade.getEffect(bizUpgrade.level);
                const divUpgrade = upgrades.find(u => u.type === 'dividend');
                let dividendIncome = 0;
                if (divUpgrade && divUpgrade.level > 0) {
                    const dividendRate = divUpgrade.getEffect(divUpgrade.level);
                    const dividendAssets = ['stock', 'real_estate', 'gold', 'bio_stock'];
                    let assetValue = 0;
                    investments.forEach(inv => { if (dividendAssets.includes(inv.id)) assetValue += inv.price * inv.owned; });
                    dividendIncome = assetValue * dividendRate;
                }
                
                // Treasure Multipliers
                const treasurePassiveMult = treasures.filter(t => t.owned && (t.type === 'passive' || t.type === 'all')).reduce((acc, t) => acc * t.effect, 1);
                
                let currentMarketMult = marketStatus.multiplier;
                if (marketStatus.id === 'bull') {
                    const marketUpgrade = upgrades.find(u => u.type === 'market');
                    if (marketUpgrade) currentMarketMult = marketUpgrade.getEffect(marketUpgrade.level);
                }
                const unlockedAchievements = achievements.filter(a => a.unlocked).length;
                const achievementMultiplier = 1 + (unlockedAchievements * 0.01);
                const prestigeMultiplier = 1 + (reputation * 0.002);
                const feverMultiplier = isFeverActive ? 5 : 1;

                return (businessIncome + dividendIncome) * currentMarketMult * achievementMultiplier * prestigeMultiplier * feverMultiplier * treasurePassiveMult;
            }, [businesses, upgrades, marketStatus, investments, achievements, reputation, isFeverActive, treasures]);

            useEffect(() => {
                const checkAchievements = () => {
                    setAchievements(prev => {
                        let hasChanges = false;
                        const next = prev.map(ach => {
                            if (!ach.unlocked && ach.condition({ money, totalEarned, businesses, investments, upgrades, reputation })) {
                                hasChanges = true; return { ...ach, unlocked: true };
                            } return ach;
                        });
                        return hasChanges ? next : prev;
                    });
                };
                const timer = setInterval(checkAchievements, 1000);
                return () => clearInterval(timer);
            }, [money, totalEarned, businesses, investments, upgrades, reputation]);

            useEffect(() => {
                const timer = setInterval(() => {
                    const income = calculateIncomePerSecond();
                    if (income > 0) { setMoney(prev => prev + income); setTotalEarned(prev => prev + income); }
                }, 1000);
                return () => clearInterval(timer);
            }, [calculateIncomePerSecond]);

            useEffect(() => {
                const eventLoop = setInterval(() => {
                    if (Math.random() < 0.3) {
                        const randomNews = NEWS_ITEMS[Math.floor(Math.random() * NEWS_ITEMS.length)];
                        setCurrentNews(randomNews);
                        setNewsHistory(prev => [{...randomNews, id: Date.now(), time: new Date().toLocaleTimeString()}, ...prev].slice(0, 20));
                        showToast("ÏÜçÎ≥¥: " + randomNews.text);
                        if (randomNews.target !== 'all') {
                            setInvestments(prev => prev.map(inv => {
                                if (inv.id === randomNews.target) {
                                    let newPrice = Math.round(inv.price * randomNews.effect);
                                    if (newPrice < 1) newPrice = 1;
                                    const newHistory = [...inv.history.slice(1), newPrice];
                                    return { ...inv, price: newPrice, history: newHistory };
                                } return inv;
                            }));
                        }
                    }
                    if (Math.random() < 0.2) {
                         const random = Math.random();
                         let newEvent;
                         if (random < 0.6) newEvent = MARKET_EVENTS[0];
                         else if (random < 0.85) newEvent = MARKET_EVENTS[1];
                         else newEvent = MARKET_EVENTS[2];
                         setMarketStatus(newEvent);
                    }
                    setInvestments(prevInvestments => {
                        return prevInvestments.map(item => {
                            const randomFactor = (Math.random() - 0.5) * 2; 
                            const marketBias = marketStatus.priceBias;
                            const changePercent = (randomFactor * item.volatility) + marketBias;
                            let newPrice = Math.round(item.price * (1 + changePercent));
                            if (newPrice < 1) newPrice = 1;
                            const newHistory = [...item.history.slice(1), newPrice];
                            return { ...item, price: newPrice, history: newHistory };
                        });
                    });
                }, 4000);
                return () => clearInterval(eventLoop);
            }, [marketStatus]);

            const buyBusiness = (id) => {
                const idx = businesses.findIndex(b => b.id === id);
                let amount = 1;
                if (tradeAmount === 10) amount = 10;
                else if (tradeAmount === 100) amount = 100;
                else if (tradeAmount === 'MAX') {
                    amount = 1; let tempMoney = money; let tempCount = businesses[idx].count; let maxBuy = 0;
                    while (maxBuy < 100) { let nextCost = calculateBusinessCost(businesses[idx].baseCost, tempCount, 1); if (tempMoney >= nextCost) { tempMoney -= nextCost; tempCount++; maxBuy++; } else { break; } }
                    if (maxBuy > 0) amount = maxBuy; else return;
                }
                const cost = calculateBusinessCost(businesses[idx].baseCost, businesses[idx].count, amount);
                if (money >= cost) { setMoney(prev => prev - cost); const newBus = [...businesses]; newBus[idx].count += amount; setBusinesses(newBus); playSound('buy'); } else { playSound('error'); }
            };
            const buyUpgrade = (id) => { const idx = upgrades.findIndex(u => u.id === id); const cost = getUpgradeCost(upgrades[idx]); if (money >= cost && upgrades[idx].level < upgrades[idx].maxLevel) { setMoney(prev => prev - cost); const newUps = [...upgrades]; newUps[idx].level += 1; setUpgrades(newUps); playSound('buy'); } else { playSound('error'); } };
            const buyInvestment = (id) => { const idx = investments.findIndex(i => i.id === id); const item = investments[idx]; let amountToBuy = tradeAmount === 'MAX' ? Math.floor(money / item.price) : tradeAmount; if (amountToBuy <= 0) { playSound('error'); return; } const cost = item.price * amountToBuy; if (money >= cost) { setMoney(prev => prev - cost); setInvestments(prev => { const newInv = [...prev]; const totalValue = (newInv[idx].avgPrice * newInv[idx].owned) + cost; const totalCount = newInv[idx].owned + amountToBuy; newInv[idx].owned = totalCount; newInv[idx].avgPrice = totalValue / totalCount; return newInv; }); playSound('buy'); } else { playSound('error'); } };
            const sellInvestment = (id) => { const idx = investments.findIndex(i => i.id === id); const item = investments[idx]; let amountToSell = tradeAmount === 'MAX' ? item.owned : Math.min(item.owned, tradeAmount); if (amountToSell <= 0) { playSound('error'); return; } const revenue = item.price * amountToSell; setMoney(prev => prev + revenue); setInvestments(prev => { const newInv = [...prev]; newInv[idx].owned -= amountToSell; if (newInv[idx].owned === 0) newInv[idx].avgPrice = 0; return newInv; }); playSound('buy'); };

            // --- Sub Components ---
            const HomeContent = () => (
                <div className="flex flex-col gap-4 pb-24">
                    <div className="bg-slate-800 rounded-2xl p-6 shadow-lg border border-slate-700 relative overflow-hidden flex flex-col justify-center min-h-[120px]">
                        <div className="flex items-center gap-2 mb-3"><Icons.Newspaper size={20} className="text-blue-400" /><h2 className="text-lg font-bold text-white">Ïã§ÏãúÍ∞Ñ ÏÜçÎ≥¥</h2></div>
                        <div className="bg-slate-700/50 p-3 rounded-lg border-l-4 border-blue-500"><p className="text-sm text-slate-200 font-medium animate-pulse">{currentNews.text}</p></div>
                        {currentNews.type !== 'neutral' && <div className={`text-xs mt-2 font-bold ${currentNews.type === 'good' ? 'text-green-400' : 'text-red-400'}`}>{currentNews.type === 'good' ? '‚ñ≤ ÏãúÏû• Ìò∏Ïû¨ Î∞úÏÉù' : '‚ñº ÏãúÏû• ÏïÖÏû¨ Î∞úÏÉù'}</div>}
                    </div>
                    <h3 className="text-lg font-bold text-slate-300 px-1 flex items-center gap-2"><Icons.Newspaper size={20}/> Îâ¥Ïä§ ÌûàÏä§ÌÜ†Î¶¨</h3>
                    <div className="space-y-2">
                        {newsHistory.length === 0 ? (<div className="text-center text-slate-500 py-10">ÏïÑÏßÅ Îâ¥Ïä§Í∞Ä ÏóÜÏäµÎãàÎã§.</div>) : (
                            newsHistory.map((news) => (
                                <div key={news.id} className="bg-slate-800 p-4 rounded-xl border border-slate-700 shadow-sm flex gap-3">
                                    <div className="shrink-0 mt-1">{news.type === 'good' ? <span className="text-green-400">‚ñ≤</span> : news.type === 'bad' ? <span className="text-red-400">‚ñº</span> : <span className="text-blue-400">‚óè</span>}</div>
                                    <div><p className="text-sm font-medium text-slate-200">{news.text}</p><div className="text-xs text-slate-500 mt-1 flex gap-2"><span>{news.time}</span>{news.target !== 'all' && <span className="bg-slate-700 px-1.5 rounded text-slate-300">{news.target.toUpperCase()}</span>}</div></div>
                                </div>
                            ))
                        )}
                    </div>
                </div>
            );

            const BusinessContent = () => (
                <div className="space-y-3 pb-24">
                    <div className="bg-slate-700/50 p-2 rounded-lg border border-slate-600 flex items-center justify-between gap-2 mb-3">
                        <span className="text-sm text-slate-300 font-bold px-2 flex items-center gap-2"><Icons.Calculator size={16} /> ÏàòÎüâ</span>
                        <div className="flex gap-1 flex-1 justify-end">{[1, 10, 100, 'MAX'].map((amt) => (<button key={amt} onClick={() => setTradeAmount(amt)} className={`px-2 py-1.5 rounded-md text-xs font-bold transition-all ${tradeAmount === amt ? 'bg-indigo-500 text-white shadow-lg' : 'bg-slate-600 text-slate-400'}`}>{amt === 'MAX' ? 'MAX' : `x${amt}`}</button>))}</div>
                    </div>
                    <h3 className="text-lg font-bold text-slate-300 mb-4 px-1">ÏûêÎèô ÏàòÏùµÏõê Îß§ÏûÖ</h3>
                    {businesses.map((biz) => {
                        const isMax = tradeAmount === 'MAX';
                        const currentCost = calculateBusinessCost(biz.baseCost, biz.count, isMax ? 1 : tradeAmount);
                        const canAfford = money >= currentCost;
                        const BusinessIcon = getIcon(biz.icon);
                        let nextMilestone = 25;
                        if (biz.count >= 25) nextMilestone = 50; if (biz.count >= 50) nextMilestone = 100; if (biz.count >= 100) nextMilestone = 200; if (biz.count >= 200) nextMilestone = 400;
                        const progress = Math.min(100, (biz.count / nextMilestone) * 100);
                        return (
                            <button key={biz.id} onClick={() => buyBusiness(biz.id)} disabled={!canAfford} className={`w-full flex items-center justify-between p-4 rounded-xl border transition-all relative overflow-hidden ${canAfford ? 'bg-slate-700 border-slate-600 hover:bg-slate-650' : 'bg-slate-800/50 border-slate-700 opacity-60 cursor-not-allowed'}`}>
                                <div className="absolute bottom-0 left-0 h-1 bg-indigo-500/30 w-full"><div className="h-full bg-indigo-400" style={{ width: `${progress}%` }}></div></div>
                                <div className="flex items-center gap-4 text-left relative z-10"><div className={`p-3 rounded-lg ${canAfford ? 'bg-blue-500/20 text-blue-400' : 'bg-slate-600/20 text-slate-500'}`}><BusinessIcon size={24} /></div><div><h3 className="font-bold text-slate-200">{biz.name}</h3><div className="text-xs text-slate-400">Î≥¥Ïú†: <span className="text-white font-bold">{biz.count}</span> <span className="text-[10px] text-slate-500">/ {nextMilestone}</span></div><div className="text-xs text-emerald-400">+{formatMoney(biz.baseIncome * (biz.count >= 25 ? (biz.count >= 50 ? (biz.count >= 100 ? (biz.count >= 200 ? (biz.count >= 400 ? 32 : 16) : 8) : 4) : 2) : 1))}/Ï¥à</div></div></div>
                                <div className="text-right relative z-10"><div className={`font-mono font-bold ${canAfford ? 'text-yellow-400' : 'text-slate-500'}`}>‚Ç© {formatMoney(currentCost)}</div>{isMax && <div className="text-[10px] text-indigo-400">ÏµúÎåÄ Îß§Ïàò</div>}</div>
                            </button>
                        );
                    })}
                </div>
            );

            const InvestmentContent = () => (
                <div className="space-y-4 pb-24">
                    <div className="bg-slate-700/50 p-2 rounded-lg border border-slate-600 flex items-center justify-between gap-2"><span className="text-sm text-slate-300 font-bold px-2 flex items-center gap-2"><Icons.Calculator size={16} /> ÏàòÎüâ</span><div className="flex gap-1 flex-1 justify-end">{[1, 10, 100, 'MAX'].map((amt) => (<button key={amt} onClick={() => setTradeAmount(amt)} className={`px-2 py-1.5 rounded-md text-xs font-bold transition-all ${tradeAmount === amt ? 'bg-indigo-500 text-white shadow-lg' : 'bg-slate-600 text-slate-400'}`}>{amt === 'MAX' ? 'MAX' : `x${amt}`}</button>))}</div></div>
                    <div className="grid grid-cols-2 md:grid-cols-1 lg:grid-cols-2 gap-2"> 
                        {investments.map((item) => {
                            let profitRate = 0; let profitColor = 'text-slate-400';
                            if (item.owned > 0) { profitRate = ((item.price - item.avgPrice) / item.avgPrice) * 100; if (profitRate > 0) profitColor = 'text-red-400'; else if (profitRate < 0) profitColor = 'text-blue-400'; }
                            const isPriceUp = item.history[item.history.length - 1] > item.history[item.history.length - 2];
                            const chartColor = isPriceUp ? '#f87171' : '#60a5fa';
                            let buyCostDisplay = 0, sellCountDisplay = 0, canBuy = false, canSell = false;
                            if (tradeAmount === 'MAX') { const maxCanBuy = Math.floor(money / item.price); buyCostDisplay = maxCanBuy * item.price; canBuy = maxCanBuy > 0; sellCountDisplay = item.owned; canSell = item.owned > 0; }
                            else { buyCostDisplay = item.price * tradeAmount; canBuy = money >= buyCostDisplay; sellCountDisplay = Math.min(item.owned, tradeAmount); canSell = sellCountDisplay > 0; }
                            
                            let InvIcon = Icons.TrendingUp;
                            if (item.id === 'coin') InvIcon = Icons.Coins; else if (item.id === 'nft') InvIcon = Icons.Gem; else if (item.id === 'bio_stock') InvIcon = Icons.Activity; else if (item.id === 'gold') InvIcon = Icons.Wallet; else if (item.id === 'real_estate') InvIcon = Icons.Building2;

                            return (
                                <div key={item.id} className="bg-slate-700 rounded-xl p-2 border border-slate-600 shadow-sm flex flex-col justify-between">
                                    <div className="flex justify-between items-center mb-1"><div className="flex items-center gap-1 overflow-hidden"><div className={`p-1 rounded-lg shrink-0 ${item.type === 'high_risk' ? 'bg-orange-500/20 text-orange-400' : item.type === 'low_risk' ? 'bg-blue-500/20 text-blue-400' : 'bg-purple-500/20 text-purple-400'}`}><InvIcon size={14} /></div><h3 className="font-bold text-xs text-slate-100 truncate">{item.name}</h3></div></div>
                                    <div className="text-right mb-1"><div className={`font-mono font-bold text-xs flex items-center justify-end gap-1 ${isPriceUp ? 'text-red-400' : 'text-blue-400'}`}>{isPriceUp ? '‚ñ≤' : '‚ñº'} ‚Ç© {formatMoney(item.price)}</div></div>
                                    <div className="h-6 mb-1 bg-slate-800/50 rounded overflow-hidden"><InvestmentChart history={item.history} color={chartColor} /></div>
                                    <div className="flex justify-between px-1 mb-1 text-[10px] text-slate-400"><span>{formatMoney(item.owned)}Í∞ú</span><span className={`${profitColor} font-bold`}>{profitRate.toFixed(1)}%</span></div>
                                    <div className="flex gap-1 mt-auto">
                                        <button onClick={() => buyInvestment(item.id)} className={`flex-1 py-1 rounded text-[10px] font-bold transition-colors ${canBuy ? 'bg-red-500/20 text-red-400 hover:bg-red-500/30 border border-red-500/50' : 'bg-slate-600 text-slate-400 cursor-not-allowed'}`} disabled={!canBuy}>Îß§Ïàò</button>
                                        <button onClick={() => sellInvestment(item.id)} className={`flex-1 py-1 rounded text-[10px] font-bold transition-colors ${canSell ? 'bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 border border-blue-500/50' : 'bg-slate-600 text-slate-400 cursor-not-allowed'}`} disabled={!canSell}>Îß§ÎèÑ</button>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );

            const UpgradeContent = () => (
                <div className="space-y-3 pb-24">
                    <h3 className="text-lg font-bold text-slate-300 mb-4 px-1">Í≤ΩÏ†úÌïô Ïó∞Íµ¨ÏÜå</h3>
                    {upgrades.map((upgrade) => {
                        const currentCost = getUpgradeCost(upgrade);
                        const isMaxed = upgrade.level >= upgrade.maxLevel;
                        const canBuy = !isMaxed && money >= currentCost;
                        const UpgIcon = isMaxed ? Icons.Trophy : Icons.Microscope;
                        return (
                            <button key={upgrade.id} onClick={() => buyUpgrade(upgrade.id)} disabled={!canBuy} className={`w-full flex items-center justify-between p-3 rounded-xl border transition-all ${isMaxed ? 'bg-green-900/10 border-green-800 opacity-80' : canBuy ? 'bg-slate-700 border-slate-600 hover:bg-slate-650' : 'bg-slate-800/50 border-slate-700 opacity-60'}`}>
                                <div className="flex items-center gap-3 text-left"><div className={`p-2 rounded-lg ${isMaxed ? 'bg-green-500/20 text-green-400' : 'bg-purple-500/20 text-purple-400'}`}><UpgIcon size={20} /></div><div><div className="flex items-center gap-2"><h3 className={`font-bold text-sm ${isMaxed ? 'text-green-400' : 'text-slate-200'}`}>{upgrade.name}</h3><span className="text-xs px-1.5 py-0.5 rounded bg-slate-800 text-slate-400">Lv.{upgrade.level} / {upgrade.maxLevel}</span></div><p className="text-xs text-slate-400 mt-1">{getUpgradeDesc(upgrade)}</p></div></div>
                                <div className="text-right min-w-[80px]">{isMaxed ? (<span className="text-xs font-bold text-green-500">Ïó∞Íµ¨ ÏôÑÎ£å</span>) : (<span className={`text-sm font-mono font-bold ${canBuy ? 'text-yellow-400' : 'text-slate-500'}`}>‚Ç© {formatMoney(currentCost)}</span>)}</div>
                            </button>
                        );
                    })}
                </div>
            );

            const AchievementContent = () => (
                <div className="space-y-3 pb-24">
                    <h3 className="text-lg font-bold text-slate-300 mb-4 px-1">ÎÇòÏùò ÏóÖÏ†Å</h3>
                    <div className="bg-slate-700/50 p-4 rounded-lg border border-slate-600 text-sm text-slate-300 mb-4"><p>üèÜ ÏóÖÏ†ÅÏùÑ Îã¨ÏÑ±Ìï† ÎïåÎßàÎã§ Ï†ÑÏ≤¥ ÏàòÏùµ(ÌÅ¥Î¶≠, ÏÇ¨ÏóÖ, Ìà¨Ïûê)Ïù¥ <strong>1%Ïî© Ï¶ùÍ∞Ä</strong>Ìï©ÎãàÎã§.</p></div>
                    <div className="grid grid-cols-1 gap-3">
                        {achievements.map((ach) => (
                            <div key={ach.id} className={`p-4 rounded-xl border flex items-center gap-4 ${ach.unlocked ? 'bg-indigo-900/30 border-indigo-500/50' : 'bg-slate-800 border-slate-700 opacity-60'}`}>
                                <div className={`p-3 rounded-full ${ach.unlocked ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-500/50' : 'bg-slate-700 text-slate-500'}`}><Icons.Medal size={24} /></div>
                                <div><h4 className={`font-bold ${ach.unlocked ? 'text-white' : 'text-slate-400'}`}>{ach.name}</h4><p className="text-sm text-slate-400">{ach.desc}</p></div>
                                {ach.unlocked && (<div className="ml-auto text-xs font-bold text-indigo-400 bg-indigo-900/50 px-2 py-1 rounded">Îã¨ÏÑ± ÏôÑÎ£å</div>)}
                            </div>
                        ))}
                    </div>
                </div>
            );

            // --- VIP Content (Casino & Luxury) ---
            const VipContent = () => (
                <div className="space-y-6 pb-24">
                    {/* Casino Section */}
                    <div className="bg-slate-800 rounded-2xl p-6 border border-yellow-500/30 relative overflow-hidden">
                        <div className="absolute top-0 right-0 p-4 opacity-10"><Icons.Dices size={80} /></div>
                        <h3 className="text-xl font-bold text-yellow-400 mb-2 flex items-center gap-2"><Icons.Dices/> VIP Ïπ¥ÏßÄÎÖ∏</h3>
                        <p className="text-sm text-slate-400 mb-4">Î≥¥Ïú† ÏûêÏÇ∞Ïùò 1%Î•º Í±∏Í≥† Ïù∏ÏÉù Ïó≠Ï†ÑÏùÑ ÎÖ∏Î†§Î≥¥ÏÑ∏Ïöî!</p>
                        
                        <div className="bg-slate-900 rounded-xl p-6 text-center border-4 border-slate-700 mb-4 relative h-32 flex items-center justify-center">
                            {isSpinning ? (
                                <div className="text-4xl font-bold text-white animate-pulse">üé≤ ÎèåÏïÑÍ∞ÄÎäî Ï§ë...</div>
                            ) : slotResult ? (
                                <div>
                                    <div className="text-sm text-slate-400">Í≤∞Í≥º</div>
                                    <div className={`text-4xl font-bold ${slotResult.multiplier >= 1 ? 'text-green-400' : 'text-red-500'}`}>
                                        {slotResult.multiplier >= 1 ? `x${slotResult.multiplier} ÎãπÏ≤®!` : 'ÍΩù!'}
                                    </div>
                                    <div className="text-sm mt-1 text-slate-300">
                                        {slotResult.multiplier >= 1 ? `+${formatMoney(slotResult.win)}Ïõê` : `-${formatMoney(slotResult.bet)}Ïõê`}
                                    </div>
                                </div>
                            ) : (
                                <div className="text-slate-500">Ïä¨Î°ØÏùÑ ÎèåÎ†§Ï£ºÏÑ∏Ïöî</div>
                            )}
                        </div>

                        <button 
                            onClick={playSlotMachine} 
                            disabled={isSpinning || money < 1000}
                            className={`w-full py-4 rounded-xl font-bold text-lg shadow-lg transition-all ${
                                isSpinning || money < 1000
                                ? 'bg-slate-700 text-slate-500 cursor-not-allowed'
                                : 'bg-gradient-to-r from-red-600 to-red-500 hover:from-red-500 hover:to-red-400 text-white active:scale-95'
                            }`}
                        >
                            {isSpinning ? 'ÏßÑÌñâ Ï§ë...' : `üé∞ 1% Î∞∞ÌåÖÌïòÍ∏∞ (ÏµúÏÜå 1,000Ïõê)`}
                        </button>
                    </div>

                    {/* Luxury Shop Section */}
                    <div className="space-y-3">
                        <h3 className="text-lg font-bold text-slate-300 px-1 flex items-center gap-2"><Icons.Gem/> Î™ÖÌíàÍ¥Ä (ÏòÅÍµ¨ Ìö®Í≥º)</h3>
                        {treasures.map((item) => (
                            <button
                                key={item.id}
                                onClick={() => buyTreasure(item.id)}
                                disabled={item.owned || money < item.price}
                                className={`w-full flex items-center justify-between p-4 rounded-xl border transition-all ${
                                    item.owned
                                        ? 'bg-yellow-900/20 border-yellow-700/50'
                                        : money >= item.price
                                        ? 'bg-slate-700 border-slate-600 hover:bg-slate-650'
                                        : 'bg-slate-800/50 border-slate-700 opacity-60 cursor-not-allowed'
                                }`}
                            >
                                <div className="flex items-center gap-4 text-left">
                                    <div className={`p-3 rounded-lg ${item.owned ? 'bg-yellow-500/20 text-yellow-400' : 'bg-slate-600/20 text-slate-500'}`}>
                                        <Icons.Diamond size={24} />
                                    </div>
                                    <div>
                                        <h3 className={`font-bold ${item.owned ? 'text-yellow-400' : 'text-slate-200'}`}>{item.name}</h3>
                                        <p className="text-xs text-slate-400">{item.desc}</p>
                                    </div>
                                </div>
                                <div className="text-right min-w-[80px]">
                                    {item.owned ? (
                                        <span className="text-xs font-bold text-yellow-500">ÏÜåÏú†Ï§ë</span>
                                    ) : (
                                        <span className={`text-sm font-mono font-bold ${money >= item.price ? 'text-yellow-400' : 'text-slate-500'}`}>
                                            ‚Ç© {formatMoney(item.price)}
                                        </span>
                                    )}
                                </div>
                            </button>
                        ))}
                    </div>
                </div>
            );

            // --- Render ---
            const bgClass = isFeverActive ? "fever-bg" : "animated-bg";

            return (
                <div className={`h-screen text-slate-100 font-sans selection:bg-indigo-500 selection:text-white flex flex-col relative pb-safe overflow-hidden transition-colors duration-1000 ${bgClass}`}>
                    
                    {/* Click Effects */}
                    {clickEffects.map(effect => (
                        <div key={effect.id} className="float-text text-emerald-400 text-xl pointer-events-none" style={{ left: effect.x, top: effect.y }}>
                            {effect.text}
                        </div>
                    ))}

                    {/* Modals */}
                    {toastMessage && <div className="fixed top-20 left-1/2 -translate-x-1/2 bg-slate-800/90 backdrop-blur text-white px-6 py-3 rounded-full shadow-2xl border border-slate-600 z-50 animate-bounce flex items-center gap-2 whitespace-nowrap"><Icons.Info size={18} className="text-blue-400"/>{toastMessage}</div>}
                    
                    {showSettingsModal && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
                            <div className="bg-slate-800 border-2 border-slate-600 rounded-2xl p-6 max-w-md w-full">
                                <h2 className="text-2xl font-bold mb-4 flex items-center gap-2"><Icons.Settings className="text-slate-400"/> ÏÑ§Ï†ï</h2>
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center bg-slate-900 p-3 rounded">
                                        <span className="text-slate-300">Ìö®Í≥ºÏùå</span>
                                        <button onClick={() => setSoundEnabled(!soundEnabled)} className={`p-2 rounded-full ${soundEnabled ? 'bg-blue-600 text-white' : 'bg-slate-700 text-slate-500'}`}>
                                            {soundEnabled ? <Icons.Volume2 size={20} /> : <Icons.VolumeX size={20} />}
                                        </button>
                                    </div>
                                    <div>
                                        <label className="block text-sm text-slate-400 mb-1">ÏÑ∏Ïù¥Î∏å Îç∞Ïù¥ÌÑ∞ (ÎÇ¥Î≥¥ÎÇ¥Í∏∞/Î∂àÎü¨Ïò§Í∏∞)</label>
                                        <textarea className="w-full bg-slate-900 p-2 rounded text-xs h-24 font-mono break-all" value={saveString} onChange={(e) => setSaveString(e.target.value)} placeholder="Ïó¨Í∏∞Ïóê ÏÑ∏Ïù¥Î∏å ÏΩîÎìúÎ•º Î∂ôÏó¨ÎÑ£Í±∞ÎÇò, 'ÎÇ¥Î≥¥ÎÇ¥Í∏∞'Î•º ÎàåÎü¨ ÏΩîÎìúÎ•º ÏÉùÏÑ±ÌïòÏÑ∏Ïöî."></textarea>
                                    </div>
                                    <div className="flex gap-2">
                                        <button onClick={handleExportSave} className="flex-1 bg-blue-600 text-white py-2 rounded flex items-center justify-center gap-1"><Icons.Copy size={16}/> ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                                        <button onClick={handleImportSave} className="flex-1 bg-emerald-600 text-white py-2 rounded flex items-center justify-center gap-1"><Icons.Download size={16}/> Î∂àÎü¨Ïò§Í∏∞</button>
                                    </div>
                                    <hr className="border-slate-700"/>
                                    <button onClick={() => setShowResetModal(true)} className="w-full bg-red-900/50 text-red-400 py-3 rounded border border-red-900 hover:bg-red-900 transition-colors">Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî</button>
                                    <button onClick={() => setShowSettingsModal(false)} className="w-full bg-slate-700 text-white py-3 rounded">Îã´Í∏∞</button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* ... (Other modals are same as before) ... */}
                     {showIPOModal && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                            <div className="bg-slate-800 border-2 border-yellow-500 rounded-2xl p-6 max-w-md w-full text-center shadow-[0_0_50px_rgba(234,179,8,0.3)]">
                                <Icons.Crown className="w-16 h-16 text-yellow-400 mx-auto mb-4 animate-bounce" />
                                <h2 className="text-3xl font-bold text-white mb-2">Í∏∞ÏóÖ Í≥µÍ∞ú (IPO)</h2>
                                <p className="text-slate-300 mb-6">ÌöåÏÇ¨Î•º Îß§Í∞ÅÌïòÍ≥† ÏÉàÎ°úÏö¥ Ï†ÑÏÑ§ÏùÑ Ïì∞ÏãúÍ≤†ÏäµÎãàÍπå?</p>
                                <div className="bg-slate-700/50 rounded-xl p-4 mb-4 space-y-2">
                                    <div className="flex justify-between text-sm"><span className="text-slate-400">ÌòÑÏû¨ ÏàúÏûêÏÇ∞</span><span className="text-white font-mono">‚Ç© {formatMoney(getNetWorth())}</span></div>
                                    <div className="flex justify-between text-lg font-bold"><span className="text-yellow-400">ÌöçÎìù Î™ÖÏÑ±</span><span className="text-yellow-400">+{Math.floor(getNetWorth() / 1000000000)} Ï†ê</span></div>
                                </div>
                                <div className="text-left text-xs text-slate-400 mb-6 bg-slate-900/50 p-3 rounded-lg">
                                    <p>‚ö†Ô∏è <strong>Ï¥àÍ∏∞Ìôî:</strong> ÌòÑÍ∏à, ÏÇ¨ÏóÖÏ≤¥, Ìà¨Ïûê ÏûêÏÇ∞, Ïó∞Íµ¨ Î†àÎ≤®, ÌîºÎ≤Ñ</p>
                                    <p>‚úÖ <strong>Ïú†ÏßÄ:</strong> ÏóÖÏ†Å, Í∏∞ÏóÖ Î™ÖÏÑ±, <strong>Î™ÖÌíà(Treasures)</strong></p>
                                    <p className="text-yellow-400 mt-2">üî• Î™ÖÏÑ± 1Ï†êÎãπ ÏàòÏùµ +0.2% ÏòÅÍµ¨ Ï¶ùÍ∞Ä (10ÏñµÎãπ 1Ï†ê)</p>
                                </div>
                                <div className="flex gap-3">
                                    <button onClick={() => setShowIPOModal(false)} className="flex-1 bg-slate-600 hover:bg-slate-500 text-white font-bold py-3 rounded-xl">Ï∑®ÏÜå</button>
                                    <button onClick={handleIPO} disabled={Math.floor(getNetWorth() / 1000000000) <= 0} className={`flex-1 font-bold py-3 rounded-xl shadow-lg transition-all ${Math.floor(getNetWorth() / 1000000000) > 0 ? 'bg-gradient-to-r from-yellow-600 to-yellow-500 hover:from-yellow-500 hover:to-yellow-400 text-white' : 'bg-slate-700 text-slate-500 cursor-not-allowed'}`}>{Math.floor(getNetWorth() / 1000000000) > 0 ? 'IPO ÏßÑÌñâ' : 'ÏûêÏÇ∞ Î∂ÄÏ°± (10Ïñµ‚Üë)'}</button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {showResetModal && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                            <div className="bg-slate-800 border-2 border-red-500 rounded-2xl p-6 max-w-md w-full text-center">
                                <Icons.AlertTriangle className="w-16 h-16 text-red-500 mx-auto mb-4" />
                                <h2 className="text-2xl font-bold text-white mb-2">Îç∞Ïù¥ÌÑ∞ ÏôÑÏ†Ñ Ï¥àÍ∏∞Ìôî</h2>
                                <p className="text-slate-300 mb-6">Ï†ïÎßêÎ°ú Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?<br/><span className="text-red-400 font-bold">Ïù¥ ÏûëÏóÖÏùÄ Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.</span></p>
                                <div className="flex gap-3">
                                    <button onClick={() => setShowResetModal(false)} className="flex-1 bg-slate-600 hover:bg-slate-500 text-white font-bold py-3 rounded-xl">Ï∑®ÏÜå</button>
                                    <button onClick={handleResetConfirm} className="flex-1 bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-xl">Ï¥àÍ∏∞Ìôî</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showOfflineModal && (
                        <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
                            <div className="bg-slate-800 border border-slate-600 rounded-2xl p-6 max-w-sm w-full text-center shadow-2xl">
                                <Icons.Clock className="w-12 h-12 text-blue-400 mx-auto mb-4" />
                                <h2 className="text-2xl font-bold text-white mb-2">ÌôòÏòÅÌï©ÎãàÎã§!</h2>
                                <p className="text-slate-400 mb-4">ÏûêÎ¶¨Î•º ÎπÑÏö¥ ÎèôÏïà ÏÇ¨ÏóÖÏ≤¥Îì§Ïù¥ Ïó¥Ïã¨Ìûà ÏùºÌñàÍµ∞Ïöî.</p>
                                <div className="bg-slate-700 rounded-xl p-4 mb-6">
                                    <p className="text-sm text-slate-400">Ïò§ÌîÑÎùºÏù∏ ÏàòÏùµ</p>
                                    <p className="text-3xl font-mono font-bold text-emerald-400">+ ‚Ç© {formatMoney(offlineEarnings)}</p>
                                </div>
                                <button onClick={() => setShowOfflineModal(false)} className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl transition-colors">ÏàòÏùµ Î∞õÍ∏∞</button>
                            </div>
                        </div>
                    )}

                    {/* [Desktop Layout] */}
                    <div className="hidden md:flex p-8 gap-6 h-screen overflow-hidden">
                        <div className="w-[400px] flex flex-col gap-6 shrink-0 h-full overflow-y-auto custom-scrollbar">
                            <div className="bg-slate-800 rounded-2xl p-6 shadow-lg border border-slate-700 relative">
                                <div className="absolute top-4 right-4 flex gap-2">
                                    <button onClick={() => setShowSettingsModal(true)} className="p-2 bg-slate-700 rounded-lg hover:bg-slate-600 text-slate-400 hover:text-white" title="ÏÑ§Ï†ï"><Icons.Settings size={18} /></button>
                                    <button onClick={() => setShowIPOModal(true)} className={`p-2 border rounded-lg ${getNetWorth() >= 1000000000 ? 'bg-yellow-500/20 text-yellow-400 border-yellow-500/50 animate-pulse' : 'bg-slate-700 text-slate-500 border-slate-600'}`} title="IPO"><Icons.Crown size={18} /></button>
                                    <button onClick={() => setShowResetModal(true)} className="p-2 bg-slate-700 rounded-lg hover:bg-red-900/50 text-slate-400 hover:text-red-400" title="Ï¥àÍ∏∞Ìôî"><Icons.RotateCcw size={18} /></button>
                                    <button onClick={toggleFullScreen} className="p-2 bg-slate-700 rounded-lg hover:bg-slate-600 text-slate-400 hover:text-white" title="Ï†ÑÏ≤¥ÌôîÎ©¥"><Icons.Maximize size={18} /></button>
                                </div>
                                <div className="flex items-center gap-3 mb-2"><Icons.Coins className="text-yellow-400 w-8 h-8" /><h1 className="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-yellow-200">Î®∏Îãà ÌÉÄÏù¥Ïø§</h1></div>
                                <div className="mt-4"><p className="text-slate-400 text-sm flex justify-between"><span>Î≥¥Ïú† ÌòÑÍ∏à</span><span className="text-xs text-slate-500">ÏàúÏûêÏÇ∞: ‚Ç© {formatMoney(getNetWorth())}</span></p><p className="text-4xl font-mono font-bold text-white mt-1 break-all">‚Ç© {formatMoney(money)}</p></div>
                                <div className="mt-4 flex flex-wrap items-center gap-2">
                                    <div className="flex items-center gap-2 text-emerald-400 bg-emerald-400/10 w-fit px-3 py-1 rounded-full"><Icons.TrendingUp size={18} /><span className="font-bold">+{formatMoney(calculateIncomePerSecond())} / Ï¥à</span></div>
                                    {reputation > 0 && (<div className="flex items-center gap-2 text-yellow-400 bg-yellow-400/10 w-fit px-3 py-1 rounded-full text-xs border border-yellow-500/30"><Icons.Crown size={14} /><span className="font-bold">Î™ÖÏÑ± Ìö®Í≥º: +{(reputation * 0.2).toFixed(1)}%</span></div>)}
                                    {isFeverActive && (<div className="flex items-center gap-2 text-red-400 bg-red-400/10 w-fit px-3 py-1 rounded-full text-xs border border-red-500/30 animate-pulse"><Icons.Zap size={14} /><span className="font-bold">ÌîºÎ≤Ñ: x5 ({feverTimeLeft}s)</span></div>)}
                                </div>
                            </div>
                            
                            <HomeContent />
                            
                            {/* Desktop Work Button */}
                            <div className="bg-slate-800 rounded-2xl p-6 shadow-lg border border-slate-700 flex flex-col items-center justify-center min-h-[200px] relative overflow-hidden group shrink-0">
                                <button onClick={handleManualClick} className={`relative z-10 text-white w-48 h-48 rounded-full shadow-[0_0_40px_rgba(79,70,229,0.3)] flex flex-col items-center justify-center gap-2 border-4 transition-all active:scale-95 ${isFeverActive ? 'bg-red-600 border-red-400 shadow-[0_0_60px_rgba(239,68,68,0.6)] animate-pulse' : 'bg-indigo-600 border-indigo-400/30 hover:bg-indigo-500'}`}>
                                    {isFeverActive ? <Icons.Zap size={48} /> : <Icons.MousePointer2 size={48} />}
                                    <span className="font-bold text-lg">{isFeverActive ? 'FEVER!' : 'ÎÖ∏ÎèôÌïòÍ∏∞'}</span>
                                </button>
                                <div className="absolute bottom-4 w-3/4 h-2 bg-slate-700 rounded-full overflow-hidden"><div className="h-full bg-red-500 transition-all duration-300" style={{ width: `${feverValue}%` }}></div></div>
                                {feverValue >= 100 && !isFeverActive && (<button onClick={activateFever} className="absolute bottom-8 z-20 bg-red-500 hover:bg-red-400 text-white px-4 py-1 rounded-full font-bold text-sm shadow-lg animate-bounce fever-button">üî• ÌîºÎ≤Ñ Î∞úÎèô</button>)}
                            </div>
                        </div>

                        {/* Right Panel (Desktop Tabs) */}
                        <div className="flex-1 bg-slate-800 rounded-2xl shadow-lg border border-slate-700 flex flex-col overflow-hidden h-full">
                            <div className="flex border-b border-slate-700 overflow-x-auto shrink-0">
                                <button onClick={() => setActiveTab('business')} className={`flex-1 py-4 px-2 font-bold flex items-center justify-center gap-2 transition-colors min-w-[100px] ${activeTab === 'business' || activeTab === 'home' ? 'bg-slate-700 text-white' : 'text-slate-400 hover:bg-slate-750'}`}><Icons.Briefcase size={18} /> ÏÇ¨ÏóÖ</button>
                                <button onClick={() => setActiveTab('investment')} className={`flex-1 py-4 px-2 font-bold flex items-center justify-center gap-2 transition-colors min-w-[100px] ${activeTab === 'investment' ? 'bg-slate-700 text-white' : 'text-slate-400 hover:bg-slate-750'}`}><Icons.LineChart size={18} /> Ìà¨Ïûê</button>
                                <button onClick={() => setActiveTab('upgrade')} className={`flex-1 py-4 px-2 font-bold flex items-center justify-center gap-2 transition-colors min-w-[100px] ${activeTab === 'upgrade' ? 'bg-slate-700 text-white' : 'text-slate-400 hover:bg-slate-750'}`}><Icons.Microscope size={18} /> Ïó∞Íµ¨</button>
                                <button onClick={() => setActiveTab('vip')} className={`flex-1 py-4 px-2 font-bold flex items-center justify-center gap-2 transition-colors min-w-[100px] ${activeTab === 'vip' ? 'bg-slate-700 text-yellow-400' : 'text-slate-400 hover:bg-slate-750'}`}><Icons.Crown size={18} /> VIP</button>
                                <button onClick={() => setActiveTab('achievement')} className={`flex-1 py-4 px-2 font-bold flex items-center justify-center gap-2 transition-colors min-w-[100px] ${activeTab === 'achievement' ? 'bg-slate-700 text-white' : 'text-slate-400 hover:bg-slate-750'}`}><Icons.Medal size={18} /> ÏóÖÏ†Å</button>
                            </div>
                            <div className="flex-1 p-6 overflow-y-auto custom-scrollbar">
                                {(activeTab === 'business' || activeTab === 'home') && <BusinessContent />}
                                {activeTab === 'investment' && <InvestmentContent />}
                                {activeTab === 'upgrade' && <UpgradeContent />}
                                {activeTab === 'vip' && <VipContent />}
                                {activeTab === 'achievement' && <AchievementContent />}
                            </div>
                        </div>
                    </div>

                    {/* Mobile Content */}
                    <div className="md:hidden flex-1 overflow-y-auto pt-[130px] pb-[80px] px-4 custom-scrollbar">
                        {activeTab === 'home' && <HomeContent />}
                        {activeTab === 'business' && <BusinessContent />}
                        {activeTab === 'investment' && <InvestmentContent />}
                        {activeTab === 'upgrade' && <UpgradeContent />}
                        {activeTab === 'vip' && <VipContent />}
                        {activeTab === 'achievement' && <AchievementContent />}
                    </div>

                    {/* Mobile Floating Work Button */}
                    <div className="md:hidden fixed bottom-24 right-4 z-50 flex flex-col items-end gap-2">
                         {feverValue >= 100 && !isFeverActive && (
                            <button onClick={activateFever} className="bg-red-500 hover:bg-red-400 text-white px-4 py-2 rounded-full font-bold text-sm shadow-lg animate-bounce fever-button mb-2">üî• ÌîºÎ≤Ñ Î∞úÎèô</button>
                        )}
                        <div className="relative">
                            <button onClick={handleManualClick} className={`text-white px-5 py-3 rounded-full shadow-[0_4px_14px_0_rgba(79,70,229,0.5)] border-2 active:scale-95 transition-all flex items-center justify-center gap-2 font-bold ${isFeverActive ? 'bg-red-600 border-red-400 shadow-red-500/50 animate-pulse' : 'bg-indigo-600 border-indigo-400/30 hover:bg-indigo-500'}`} aria-label="ÎÖ∏ÎèôÌïòÍ∏∞">
                                {isFeverActive ? <Icons.Zap size={24} /> : <Icons.MousePointer2 size={24} />}
                                <span className="text-sm">{isFeverActive ? 'FEVER!' : 'ÎÖ∏ÎèôÌïòÍ∏∞'}</span>
                            </button>
                            <div className="absolute -bottom-2 left-0 w-full h-1.5 bg-slate-700 rounded-full overflow-hidden"><div className="h-full bg-red-500 transition-all duration-300" style={{ width: `${feverValue}%` }}></div></div>
                        </div>
                    </div>

                    {/* Mobile Bottom Nav */}
                    <div className="md:hidden fixed bottom-0 left-0 w-full bg-slate-800 border-t border-slate-700 flex justify-around items-center pb-safe z-40 shadow-2xl">
                        <button onClick={() => setActiveTab('home')} className={`flex flex-col items-center justify-center p-3 w-full transition-colors ${activeTab === 'home' ? 'text-indigo-400' : 'text-slate-500'}`}><Icons.Home size={20} /><span className="text-[10px] mt-1 font-bold">Ìôà</span></button>
                        <button onClick={() => setActiveTab('business')} className={`flex flex-col items-center justify-center p-3 w-full transition-colors ${activeTab === 'business' ? 'text-indigo-400' : 'text-slate-500'}`}><Icons.Briefcase size={20} /><span className="text-[10px] mt-1 font-bold">ÏÇ¨ÏóÖ</span></button>
                        <button onClick={() => setActiveTab('investment')} className={`flex flex-col items-center justify-center p-3 w-full transition-colors ${activeTab === 'investment' ? 'text-indigo-400' : 'text-slate-500'}`}><Icons.LineChart size={20} /><span className="text-[10px] mt-1 font-bold">Ìà¨Ïûê</span></button>
                        <button onClick={() => setActiveTab('upgrade')} className={`flex flex-col items-center justify-center p-3 w-full transition-colors ${activeTab === 'upgrade' ? 'text-indigo-400' : 'text-slate-500'}`}><Icons.Microscope size={20} /><span className="text-[10px] mt-1 font-bold">Ïó∞Íµ¨</span></button>
                        <button onClick={() => setActiveTab('vip')} className={`flex flex-col items-center justify-center p-3 w-full transition-colors ${activeTab === 'vip' ? 'text-yellow-400' : 'text-slate-500'}`}><Icons.Crown size={20} /><span className="text-[10px] mt-1 font-bold">VIP</span></button>
                        <button onClick={() => setActiveTab('achievement')} className={`flex flex-col items-center justify-center p-3 w-full transition-colors ${activeTab === 'achievement' ? 'text-indigo-400' : 'text-slate-500'}`}><Icons.Medal size={20} /><span className="text-[10px] mt-1 font-bold">ÏóÖÏ†Å</span></button>
                    </div>

                    {/* Mobile Top Header (Fixed) */}
                    <div className="md:hidden fixed top-0 left-0 w-full bg-slate-900/95 backdrop-blur-md border-b border-slate-700 z-50 px-4 py-2 shadow-lg transition-all h-[130px]">
                        <div className="flex justify-between items-start">
                            <div>
                                <div className="text-xs text-slate-400 mb-0.5 flex items-center gap-1">Î≥¥Ïú† ÏûêÏÇ∞<span className="text-[10px] text-slate-500">(ÏàúÏûêÏÇ∞: {formatMoney(getNetWorth())})</span></div>
                                <div className="text-xl font-bold font-mono text-white leading-tight">‚Ç© {formatMoney(money)}</div>
                                <div className="flex items-center gap-2 mt-1">
                                    <div className="text-xs text-emerald-400 font-bold flex items-center gap-1 bg-emerald-400/10 px-1.5 py-0.5 rounded"><Icons.TrendingUp size={10} /> +{formatMoney(calculateIncomePerSecond())}/s</div>
                                    {isFeverActive && (<div className="text-xs text-red-400 font-bold flex items-center gap-1 bg-red-400/10 px-1.5 py-0.5 rounded animate-pulse"><Icons.Zap size={10} /> Fever! {feverTimeLeft}s</div>)}
                                </div>
                            </div>
                            <div className="flex gap-1">
                                <button onClick={toggleFullScreen} className="p-1.5 bg-slate-800 rounded-lg text-slate-400 border border-slate-700"><Icons.Maximize size={16}/></button>
                                <button onClick={() => setShowIPOModal(true)} className={`p-1.5 border rounded-lg transition-colors ${getNetWorth() >= 1000000000 ? 'bg-yellow-500/20 text-yellow-400 border-yellow-500/50 animate-pulse' : 'bg-slate-800 text-slate-500 border-slate-700'}`}><Icons.Crown size={16}/></button>
                                <button onClick={() => setShowSettingsModal(true)} className="p-1.5 bg-slate-800 rounded-lg text-slate-400 border border-slate-700"><Icons.Settings size={16}/></button>
                            </div>
                        </div>
                        <div className="mt-2 pt-2 border-t border-slate-700/50 flex justify-between items-center text-xs">
                            <div className={`flex items-center gap-1 font-bold ${marketStatus.color}`}><span className="text-sm">{marketStatus.icon}</span> {marketStatus.name}</div>
                            <div className="text-slate-400 max-w-[200px] truncate overflow-hidden whitespace-nowrap"><span className="ticker-text">üì¢ {currentNews.text}</span></div>
                        </div>
                    </div>

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
