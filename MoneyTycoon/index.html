<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¨¸ë‹ˆ íƒ€ì´ì¿¤: ê²½ì œì˜ ì§€ë°°ì</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (JSX ì»´íŒŒì¼ëŸ¬) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(30, 41, 59, 0.5); border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(71, 85, 105, 0.8); border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(100, 116, 139, 1); }
        
        body { background-color: #0f172a; color: #f1f5f9; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // --- ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ (Lucide ì•„ì´ì½˜ì„ SVGë¡œ ì§ì ‘ êµ¬í˜„) ---
        // ìˆ˜ì • ì‚¬í•­: ì—¬ëŸ¬ ê²½ë¡œë¥¼ ê°€ì§„ ì•„ì´ì½˜ë“¤ì€ <>...</> (Fragment)ë¡œ ê°ì‹¸ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.
        const Icon = ({ path, className, size = 24, color = "currentColor" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke={color} 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {path}
            </svg>
        );

        const Icons = {
            Coins: (props) => <Icon {...props} path={<><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></>} />,
            TrendingUp: (props) => <Icon {...props} path={<><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></>} />,
            TrendingDown: (props) => <Icon {...props} path={<><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></>} />,
            Briefcase: (props) => <Icon {...props} path={<><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></>} />,
            Building2: (props) => <Icon {...props} path={<><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></>} />,
            Zap: (props) => <Icon {...props} path={<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>} />,
            MousePointer2: (props) => <Icon {...props} path={<><path d="m12 6 2-2H6l8 18h2a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2Z"/><path d="m12 6-4 4H4v4h4l4 4"/></>} />,
            ArrowUpCircle: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="m16 12-4-4-4 4"/><path d="M12 16V8"/></>} />,
            Trophy: (props) => <Icon {...props} path={<><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></>} />,
            Activity: (props) => <Icon {...props} path={<path d="M22 12h-4l-3 9L9 3l-3 9H2"/>} />,
            LineChart: (props) => <Icon {...props} path={<><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></>} />,
            Wallet: (props) => <Icon {...props} path={<><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></>} />,
            Landmark: (props) => <Icon {...props} path={<><line x1="3" x2="21" y1="22" y2="22"/><line x1="6" x2="6" y1="18" y2="11"/><line x1="10" x2="10" y1="18" y2="11"/><line x1="14" x2="14" y1="18" y2="11"/><line x1="18" x2="18" y1="18" y2="11"/><polygon points="12 2 20 7 4 7"/></>} />,
            Microscope: (props) => <Icon {...props} path={<><path d="M6 18h8"/><path d="M3 22h18"/><path d="M14 22a7 7 0 1 0 0-14h-1"/><path d="M9 14h2"/><path d="M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z"/><path d="M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3"/></>} />,
            Calculator: (props) => <Icon {...props} path={<><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></>} />,
            Rocket: (props) => <Icon {...props} path={<><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></>} />,
            Globe: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></>} />,
            Gem: (props) => <Icon {...props} path={<path d="M6 3h12l4 6-10 13L2 9Z"/>} />,
            Save: (props) => <Icon {...props} path={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>} />,
            RotateCcw: (props) => <Icon {...props} path={<><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></>} />,
            Medal: (props) => <Icon {...props} path={<><path d="M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15"/><path d="M11 12 5.12 2.2"/><path d="m13 12 5.88-9.8"/><path d="M8 7h8"/><circle cx="12" cy="17" r="5"/><path d="M12 18v-2h-.5"/></>} />,
            Clock: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>} />,
            Crown: (props) => <Icon {...props} path={<><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></>} />,
            AlertTriangle: (props) => <Icon {...props} path={<><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></>} />,
            Info: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></>} />
        };

        // --- ê²Œì„ ë°ì´í„° ---
        const getInitialBusinesses = () => [
            { id: 1, name: 'í¸ì˜ì  ì•Œë°”', baseCost: 15, baseIncome: 3, count: 0, icon: 'store' },
            { id: 2, name: 'ë…¸ì ìƒ ìš´ì˜', baseCost: 100, baseIncome: 15, count: 0, icon: 'shop' },
            { id: 3, name: 'ì¤‘ì†Œê¸°ì—… ìš´ì˜', baseCost: 1100, baseIncome: 90, count: 0, icon: 'chart' },
            { id: 4, name: 'í”„ëœì°¨ì´ì¦ˆ', baseCost: 12000, baseIncome: 450, count: 0, icon: 'building' },
            { id: 5, name: 'ë°°ë‹¬ ì•± ìŠ¤íƒ€íŠ¸ì—…', baseCost: 130000, baseIncome: 2200, count: 0, icon: 'scooter' },
            { id: 6, name: 'IT ë²¤ì²˜ê¸°ì—…', baseCost: 850000, baseIncome: 9500, count: 0, icon: 'rocket' },
            { id: 7, name: 'ê¸€ë¡œë²Œ ì€í–‰', baseCost: 5000000, baseIncome: 45000, count: 0, icon: 'bank' },
            { id: 8, name: 'ì—ë„ˆì§€ ë°œì „ì†Œ', baseCost: 45000000, baseIncome: 250000, count: 0, icon: 'zap' },
            { id: 9, name: 'ë¯¼ê°„ ìš°ì£¼ í•­ê³µì‚¬', baseCost: 350000000, baseIncome: 1500000, count: 0, icon: 'space' },
            { id: 10, name: 'í™”ì„± ì‹ë¯¼ì§€', baseCost: 5000000000, baseIncome: 12000000, count: 0, icon: 'mars' },
        ];

        const getInitialInvestments = () => [
            { id: 'coin', name: 'ë„ì§€ì™• ì½”ì¸', price: 30, owned: 0, avgPrice: 0, volatility: 0.20, type: 'high_risk', desc: 'ë§¤ìš° ìœ„í—˜í•˜ì§€ë§Œ ëŒ€ë°• ê°€ëŠ¥ì„±', history: Array(20).fill(30) },
            { id: 'nft', name: 'í¬ê·€ NFT ì•„íŠ¸', price: 1500, owned: 0, avgPrice: 0, volatility: 0.25, type: 'high_risk', desc: 'ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ë””ì§€í„¸ ìì‚°', history: Array(20).fill(1500) },
            { id: 'bio_stock', name: 'ë°”ì´ì˜¤ ì£¼ì‹', price: 5500, owned: 0, avgPrice: 0, volatility: 0.12, type: 'medium_risk', desc: 'ì„ìƒ ê²°ê³¼ì— ë”°ë¼ ë“±ë½í­ í¼', history: Array(20).fill(5500) },
            { id: 'stock', name: 'ì‚¼ì†¡ì „ì', price: 8000, owned: 0, avgPrice: 0, volatility: 0.05, type: 'medium_risk', desc: 'ì•ˆì •ì ì¸ ìš°ëŸ‰ì£¼ (ë°°ë‹¹ê¸ˆ ëŒ€ìƒ)', history: Array(20).fill(8000) },
            { id: 'gold', name: 'ìˆœê¸ˆ ê³¨ë“œë°”', price: 350000, owned: 0, avgPrice: 0, volatility: 0.015, type: 'low_risk', desc: 'ë¶ˆí™©ì—ë„ ê°•í•œ ìµœê³ ì˜ ì•ˆì „ìì‚°', history: Array(20).fill(350000) },
            { id: 'real_estate', name: 'ê°•ë‚¨ ì•„íŒŒíŠ¸', price: 1500000, owned: 0, avgPrice: 0, volatility: 0.02, type: 'low_risk', desc: 'ë³€ë™ì´ ì ì€ ë¶€ë™ì‚° (ë°°ë‹¹ê¸ˆ ëŒ€ìƒ)', history: Array(20).fill(1500000) },
        ];

        const getInitialUpgrades = () => [
            { id: 'click_boost', name: 'ë‚˜ë…¸ í´ë¦­ ê°•í™”', type: 'click', level: 0, maxLevel: 50, baseCost: 500, costScale: 2.5, descTemplate: 'í´ë¦­ ìˆ˜ìµ +{val}% (í˜„ì¬: {curr}ë°°)', getEffect: (lvl) => 1 + (lvl * 1) },
            { id: 'biz_boost', name: 'ì‚¬ì—… ìë™í™” AI', type: 'business', level: 0, maxLevel: 50, baseCost: 2000, costScale: 2.2, descTemplate: 'ëª¨ë“  ì‚¬ì—… ìˆ˜ìµ +{val}% (í˜„ì¬: +{curr}%)', getEffect: (lvl) => 1 + (lvl * 0.2) },
            { id: 'div_boost', name: 'ë°°ë‹¹ê¸ˆ íˆ¬ì ì „ëµ', type: 'dividend', level: 0, maxLevel: 20, baseCost: 50000, costScale: 3.0, descTemplate: 'ì£¼ì‹/ë¶€ë™ì‚° ê°€ì¹˜ì˜ {val}% ì´ˆë‹¹ ìˆ˜ìµ (í˜„ì¬: {curr}%)', getEffect: (lvl) => lvl * 0.002 },
            { id: 'market_boost', name: 'ì‹œì¥ ì˜ˆì¸¡ ëª¨ë¸', type: 'market', level: 0, maxLevel: 10, baseCost: 100000, costScale: 4.0, descTemplate: 'í˜¸í™©ê¸° ë³´ë„ˆìŠ¤ ë°°ìœ¨ +{val} (í˜„ì¬: x{curr})', getEffect: (lvl) => 2.0 + (lvl * 0.5) },
            { id: 'cost_cut', name: 'ë¡œë¹„ìŠ¤íŠ¸ ê³ ìš©', type: 'discount', level: 0, maxLevel: 10, baseCost: 500000, costScale: 5.0, descTemplate: 'ì‚¬ì—… ì¸ìˆ˜ ë¹„ìš© {val}% í• ì¸ (í˜„ì¬: -{curr}%)', getEffect: (lvl) => Math.max(0.1, 1.0 - (lvl * 0.05)) }
        ];

        const ACHIEVEMENT_DEFINITIONS = [
            { id: 'first_money', name: 'ì²« ê±¸ìŒ', desc: 'ëˆ„ì  ìˆ˜ìµ 1,000ì› ë‹¬ì„±', condition: (state) => state.totalEarned >= 1000 },
            { id: 'rich_1m', name: 'ë°±ë§Œì¥ì', desc: 'ë³´ìœ  ìì‚° 100ë§Œì› ë‹¬ì„±', condition: (state) => state.money >= 1000000 },
            { id: 'rich_100m', name: 'ì–µë§Œì¥ì', desc: 'ë³´ìœ  ìì‚° 1ì–µì› ë‹¬ì„±', condition: (state) => state.money >= 100000000 },
            { id: 'biz_king', name: 'ì‚¬ì—…ì™•', desc: 'ëª¨ë“  ì¢…ë¥˜ì˜ ì‚¬ì—…ì²´ 1ê°œ ì´ìƒ ë³´ìœ ', condition: (state) => state.businesses.every(b => b.count > 0) },
            { id: 'investor', name: 'ê°œë¯¸ íˆ¬ìì', desc: 'ì£¼ì‹ 100ì£¼ ë³´ìœ ', condition: (state) => state.investments.find(i => i.id === 'stock').owned >= 100 },
            { id: 'landlord', name: 'ê±´ë¬¼ì£¼', desc: 'ë¶€ë™ì‚° 10ì±„ ë³´ìœ ', condition: (state) => state.investments.find(i => i.id === 'real_estate').owned >= 10 },
            { id: 'researcher', name: 'ë§¤ë“œ ì‚¬ì´ì–¸í‹°ìŠ¤íŠ¸', desc: 'ì—°êµ¬ ë ˆë²¨ ì´í•© 50 ë‹¬ì„±', condition: (state) => state.upgrades.reduce((acc, u) => acc + u.level, 0) >= 50 },
            { id: 'prestige_1', name: 'ìƒˆë¡œìš´ ì‹œì‘', desc: 'ì²« IPO(í™˜ìƒ) ì§„í–‰', condition: (state) => state.reputation > 0 },
        ];

        const getInitialAchievements = () => ACHIEVEMENT_DEFINITIONS.map(a => ({ ...a, unlocked: false }));

        const MARKET_EVENTS = [
            { id: 'normal', name: 'í‰ì˜¨í•œ ì‹œì¥', multiplier: 1.0, priceBias: 0, color: 'text-gray-400', desc: 'ê²½ì œê°€ ì•ˆì •ì ì…ë‹ˆë‹¤.' },
            { id: 'bull', name: 'ê²½ì œ í˜¸í™©', multiplier: 2.0, priceBias: 0.03, color: 'text-green-400', desc: 'ìˆ˜ìµ í­ë°œ & ì£¼ê°€ ìƒìŠ¹ì¥!' },
            { id: 'bear', name: 'ê²½ì œ ë¶ˆí™©', multiplier: 0.5, priceBias: -0.03, color: 'text-red-400', desc: 'ìˆ˜ìµ ë°˜í† ë§‰ & ì£¼ê°€ í•˜ë½ì¥...' },
        ];

        function App() {
            const [money, setMoney] = useState(0);
            const [totalEarned, setTotalEarned] = useState(0);
            const [businesses, setBusinesses] = useState(getInitialBusinesses);
            const [investments, setInvestments] = useState(getInitialInvestments);
            const [upgrades, setUpgrades] = useState(getInitialUpgrades);
            const [achievements, setAchievements] = useState(getInitialAchievements);
            const [reputation, setReputation] = useState(0);
            const [marketStatus, setMarketStatus] = useState(MARKET_EVENTS[0]);
            const [timeLeftForEvent, setTimeLeftForEvent] = useState(30);
            const [activeTab, setActiveTab] = useState('business');
            const [tradeAmount, setTradeAmount] = useState(1);
            
            const [offlineEarnings, setOfflineEarnings] = useState(0);
            const [showOfflineModal, setShowOfflineModal] = useState(false);
            const [showIPOModal, setShowIPOModal] = useState(false);
            const [showResetModal, setShowResetModal] = useState(false);
            const [toastMessage, setToastMessage] = useState(null);
            
            const formatMoney = (amount) => Math.floor(amount).toLocaleString('ko-KR');

            const showToast = (msg) => {
                setToastMessage(msg);
                setTimeout(() => setToastMessage(null), 3000);
            };

            const getNetWorth = useCallback(() => {
                const assetsValue = investments.reduce((acc, inv) => acc + (inv.price * inv.owned), 0);
                return money + assetsValue;
            }, [money, investments]);

            const saveData = useCallback(() => {
                const gameState = {
                    money, totalEarned, businesses, investments, upgrades, achievements, reputation, lastSaveTime: Date.now()
                };
                localStorage.setItem('moneyTycoonSaveV3', JSON.stringify(gameState));
            }, [money, totalEarned, businesses, investments, upgrades, achievements, reputation]);

            useEffect(() => {
                const saveTimer = setInterval(saveData, 5000);
                return () => clearInterval(saveTimer);
            }, [saveData]);

            useEffect(() => {
                const savedData = localStorage.getItem('moneyTycoonSaveV3');
                if (savedData) {
                    try {
                        const parsed = JSON.parse(savedData);
                        setMoney(parsed.money || 0);
                        setTotalEarned(parsed.totalEarned || 0);
                        if (parsed.businesses) setBusinesses(parsed.businesses);
                        if (parsed.investments) setInvestments(parsed.investments);
                        
                        if (parsed.upgrades) {
                            const mergedUpgrades = getInitialUpgrades().map(initUp => {
                                const loaded = parsed.upgrades.find(u => u.id === initUp.id);
                                return loaded ? { ...initUp, level: loaded.level } : initUp;
                            });
                            setUpgrades(mergedUpgrades);
                        }

                        if (parsed.achievements) {
                            const mergedAch = getInitialAchievements().map(initAch => {
                                const loaded = parsed.achievements.find(a => a.id === initAch.id);
                                return loaded ? { ...initAch, unlocked: loaded.unlocked } : initAch;
                            });
                            setAchievements(mergedAch);
                        }
                        
                        if (parsed.reputation) setReputation(parsed.reputation);

                        if (parsed.lastSaveTime) {
                            const now = Date.now();
                            const timeDiffSeconds = (now - parsed.lastSaveTime) / 1000;
                            if (timeDiffSeconds > 60) {
                                const currentBusinesses = parsed.businesses || getInitialBusinesses();
                                const currentUpgrades = parsed.upgrades || getInitialUpgrades();
                                const currentReputation = parsed.reputation || 0;
                                
                                let businessIncome = currentBusinesses.reduce((acc, bus) => acc + (bus.baseIncome * bus.count), 0);
                                const bizUpgrade = currentUpgrades.find(u => u.id === 'biz_boost');
                                if (bizUpgrade) businessIncome *= (1 + (bizUpgrade.level * 0.2));

                                const unlockedCount = (parsed.achievements || []).filter(a => a.unlocked).length;
                                const achievementMultiplier = 1 + (unlockedCount * 0.01);
                                const prestigeMultiplier = 1 + (currentReputation * 0.1); 

                                const earnings = Math.floor(businessIncome * achievementMultiplier * prestigeMultiplier * timeDiffSeconds);
                                
                                if (earnings > 0) {
                                    setOfflineEarnings(earnings);
                                    setShowOfflineModal(true);
                                    setMoney(prev => prev + earnings);
                                    setTotalEarned(prev => prev + earnings);
                                }
                            }
                        }
                    } catch (e) {
                        console.error("Save file corrupted", e);
                    }
                }
            }, []);

            const handleResetConfirm = () => {
                localStorage.removeItem('moneyTycoonSaveV3');
                setMoney(0);
                setTotalEarned(0);
                setBusinesses(getInitialBusinesses());
                setInvestments(getInitialInvestments());
                setUpgrades(getInitialUpgrades());
                setAchievements(getInitialAchievements());
                setReputation(0);
                setShowResetModal(false);
                showToast("ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
            };

            const handleIPO = () => {
                const netWorth = getNetWorth();
                const potentialReputation = Math.floor(netWorth / 100000000); 

                if (potentialReputation <= 0) return;

                setReputation(prev => prev + potentialReputation);
                setMoney(0);
                setTotalEarned(0);
                setBusinesses(getInitialBusinesses());
                setInvestments(getInitialInvestments());
                setUpgrades(getInitialUpgrades());
                setShowIPOModal(false);
                showToast(`IPO ì„±ê³µ! ëª…ì„± ${potentialReputation}ì ì„ íšë“í–ˆìŠµë‹ˆë‹¤.`);
            };

            const getUpgradeCost = useCallback((upgrade) => {
                return Math.floor(upgrade.baseCost * Math.pow(upgrade.costScale, upgrade.level));
            }, []);

            const calculateCost = useCallback((baseCost, count) => {
                const discountUpgrade = upgrades.find(u => u.type === 'discount');
                const discountMultiplier = discountUpgrade ? discountUpgrade.getEffect(discountUpgrade.level) : 1.0;
                return Math.floor(baseCost * Math.pow(1.15, count) * discountMultiplier);
            }, [upgrades]);

            const calculateIncomePerSecond = useCallback(() => {
                let businessIncome = businesses.reduce((acc, bus) => acc + (bus.baseIncome * bus.count), 0);
                const bizUpgrade = upgrades.find(u => u.type === 'business');
                if (bizUpgrade) businessIncome *= bizUpgrade.getEffect(bizUpgrade.level);

                const divUpgrade = upgrades.find(u => u.type === 'dividend');
                let dividendIncome = 0;
                if (divUpgrade && divUpgrade.level > 0) {
                    const dividendRate = divUpgrade.getEffect(divUpgrade.level);
                    const dividendAssets = ['stock', 'real_estate', 'gold', 'bio_stock'];
                    let assetValue = 0;
                    investments.forEach(inv => {
                        if (dividendAssets.includes(inv.id)) {
                            assetValue += inv.price * inv.owned;
                        }
                    });
                    dividendIncome = assetValue * dividendRate;
                }

                let currentMarketMult = marketStatus.multiplier;
                if (marketStatus.id === 'bull') {
                    const marketUpgrade = upgrades.find(u => u.type === 'market');
                    if (marketUpgrade) currentMarketMult = marketUpgrade.getEffect(marketUpgrade.level);
                }

                const unlockedAchievements = achievements.filter(a => a.unlocked).length;
                const achievementMultiplier = 1 + (unlockedAchievements * 0.01);
                const prestigeMultiplier = 1 + (reputation * 0.1);

                return (businessIncome + dividendIncome) * currentMarketMult * achievementMultiplier * prestigeMultiplier;
            }, [businesses, upgrades, marketStatus, investments, achievements, reputation]);

            useEffect(() => {
                const checkAchievements = () => {
                    setAchievements(prev => {
                        let hasChanges = false;
                        const next = prev.map(ach => {
                            if (!ach.unlocked && ach.condition({ money, totalEarned, businesses, investments, upgrades, reputation })) {
                                hasChanges = true;
                                return { ...ach, unlocked: true };
                            }
                            return ach;
                        });
                        return hasChanges ? next : prev;
                    });
                };
                const timer = setInterval(checkAchievements, 1000);
                return () => clearInterval(timer);
            }, [money, totalEarned, businesses, investments, upgrades, reputation]);

            useEffect(() => {
                const timer = setInterval(() => {
                    const income = calculateIncomePerSecond();
                    if (income > 0) {
                        setMoney(prev => prev + income);
                        setTotalEarned(prev => prev + income);
                    }
                }, 1000);
                return () => clearInterval(timer);
            }, [calculateIncomePerSecond]);

            useEffect(() => {
                const priceTimer = setInterval(() => {
                    setInvestments(prevInvestments => {
                        return prevInvestments.map(item => {
                            const randomFactor = (Math.random() - 0.5) * 2; 
                            const marketBias = marketStatus.priceBias;
                            const changePercent = (randomFactor * item.volatility) + marketBias;
                            let newPrice = Math.round(item.price * (1 + changePercent));
                            if (newPrice < 1) newPrice = 1;
                            const newHistory = [...item.history.slice(1), newPrice];
                            return { ...item, price: newPrice, history: newHistory };
                        });
                    });
                }, 1500);
                return () => clearInterval(priceTimer);
            }, [marketStatus]);

            useEffect(() => {
                const eventTimer = setInterval(() => {
                    setTimeLeftForEvent(prev => {
                        if (prev <= 1) {
                            const random = Math.random();
                            let newEvent;
                            if (random < 0.6) newEvent = MARKET_EVENTS[0];
                            else if (random < 0.85) newEvent = MARKET_EVENTS[1];
                            else newEvent = MARKET_EVENTS[2];
                            setMarketStatus(newEvent);
                            return 30;
                        }
                        return prev - 1;
                    });
                }, 1000);
                return () => clearInterval(eventTimer);
            }, []);

            const handleManualClick = () => {
                const baseClick = 1;
                const clickUpgrade = upgrades.find(u => u.type === 'click');
                const clickMult = clickUpgrade ? clickUpgrade.getEffect(clickUpgrade.level) : 1;
                const passiveBonus = calculateIncomePerSecond() * 0.01; 
                const unlockedAchievements = achievements.filter(a => a.unlocked).length;
                const achievementMultiplier = 1 + (unlockedAchievements * 0.01);
                const prestigeMultiplier = 1 + (reputation * 0.1);
                const clickValue = (baseClick + passiveBonus) * clickMult * achievementMultiplier * prestigeMultiplier;
                setMoney(prev => prev + clickValue);
                setTotalEarned(prev => prev + clickValue);
            };

            const buyBusiness = (id) => {
                const idx = businesses.findIndex(b => b.id === id);
                const cost = calculateCost(businesses[idx].baseCost, businesses[idx].count);
                if (money >= cost) {
                    setMoney(prev => prev - cost);
                    const newBus = [...businesses];
                    newBus[idx].count += 1;
                    setBusinesses(newBus);
                }
            };

            const buyUpgrade = (id) => {
                const idx = upgrades.findIndex(u => u.id === id);
                const upgrade = upgrades[idx];
                const cost = getUpgradeCost(upgrade);
                if (money >= cost && upgrade.level < upgrade.maxLevel) {
                    setMoney(prev => prev - cost);
                    const newUps = [...upgrades];
                    newUps[idx].level += 1;
                    setUpgrades(newUps);
                }
            };

            const buyInvestment = (id) => {
                const idx = investments.findIndex(i => i.id === id);
                const item = investments[idx];
                let amountToBuy = 0;
                if (tradeAmount === 'MAX') {
                    amountToBuy = Math.floor(money / item.price);
                } else {
                    amountToBuy = tradeAmount;
                }
                if (amountToBuy <= 0) return;
                const cost = item.price * amountToBuy;
                if (money >= cost) {
                    setMoney(prev => prev - cost);
                    setInvestments(prev => {
                        const newInv = [...prev];
                        const totalValue = (newInv[idx].avgPrice * newInv[idx].owned) + cost;
                        const totalCount = newInv[idx].owned + amountToBuy;
                        newInv[idx].owned = totalCount;
                        newInv[idx].avgPrice = totalValue / totalCount;
                        return newInv;
                    });
                }
            };

            const sellInvestment = (id) => {
                const idx = investments.findIndex(i => i.id === id);
                const item = investments[idx];
                let amountToSell = 0;
                if (tradeAmount === 'MAX') {
                    amountToSell = item.owned;
                } else {
                    amountToSell = Math.min(item.owned, tradeAmount);
                }
                if (amountToSell <= 0) return;
                const revenue = item.price * amountToSell;
                setMoney(prev => prev + revenue);
                setInvestments(prev => {
                    const newInv = [...prev];
                    newInv[idx].owned -= amountToSell;
                    if (newInv[idx].owned === 0) newInv[idx].avgPrice = 0;
                    return newInv;
                });
            };

            const InvestmentChart = ({ history, color }) => {
                const min = Math.min(...history);
                const max = Math.max(...history);
                const range = max - min || 1;
                const height = 40;
                const width = 100;
                const points = history.map((price, i) => {
                    const x = (i / (history.length - 1)) * width;
                    const y = height - ((price - min) / range) * height;
                    return `${x},${y}`;
                }).join(' ');
                return (
                    <svg width="100%" height={height} viewBox={`0 0 ${width} ${height}`} preserveAspectRatio="none" className="overflow-visible">
                        <polyline fill="none" stroke={color} strokeWidth="2" points={points} vectorEffect="non-scaling-stroke"/>
                    </svg>
                );
            };

            const getProgressColor = () => {
                if (marketStatus.id === 'bull') return 'bg-green-500';
                if (marketStatus.id === 'bear') return 'bg-red-500';
                return 'bg-blue-500';
            };

            const getUpgradeDesc = (upgrade) => {
                let val, curr;
                if (upgrade.type === 'click') {
                    val = 100; curr = upgrade.getEffect(upgrade.level);
                } else if (upgrade.type === 'business') {
                    val = 20; curr = Math.round((upgrade.getEffect(upgrade.level) - 1) * 100);
                } else if (upgrade.type === 'dividend') {
                    val = 0.2; curr = (upgrade.getEffect(upgrade.level) * 100).toFixed(1);
                } else if (upgrade.type === 'market') {
                    val = 0.5; curr = upgrade.getEffect(upgrade.level).toFixed(1);
                } else if (upgrade.type === 'discount') {
                    val = 5; curr = Math.round((1 - upgrade.getEffect(upgrade.level)) * 100);
                }
                return upgrade.descTemplate.replace('{val}', val).replace('{curr}', curr);
            };

            const getIcon = (iconName) => {
                const icons = {
                    'store': Icons.Building2,
                    'shop': Icons.Briefcase,
                    'chart': Icons.TrendingUp,
                    'building': Icons.Landmark,
                    'scooter': Icons.Briefcase,
                    'rocket': Icons.Zap,
                    'bank': Icons.Coins,
                    'zap': Icons.Zap,
                    'space': Icons.Rocket,
                    'mars': Icons.Globe,
                };
                return icons[iconName] || Icons.Briefcase;
            };

            return (
                <div className="min-h-screen bg-slate-900 text-slate-100 font-sans selection:bg-indigo-500 selection:text-white p-4 md:p-8 flex flex-col md:flex-row gap-6 relative">
                    
                    {toastMessage && (
                        <div className="fixed bottom-24 md:bottom-10 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl border border-slate-600 z-50 animate-bounce flex items-center gap-2">
                            <Icons.Info size={18} className="text-blue-400"/>
                            {toastMessage}
                        </div>
                    )}

                    {/* IPO ëª¨ë‹¬ */}
                    {showIPOModal && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                            <div className="bg-slate-800 border-2 border-yellow-500 rounded-2xl p-6 max-w-md w-full text-center shadow-[0_0_50px_rgba(234,179,8,0.3)]">
                                <Icons.Crown className="w-16 h-16 text-yellow-400 mx-auto mb-4 animate-bounce" />
                                <h2 className="text-3xl font-bold text-white mb-2">ê¸°ì—… ê³µê°œ (IPO)</h2>
                                <p className="text-slate-300 mb-6">íšŒì‚¬ë¥¼ ë§¤ê°í•˜ê³  ìƒˆë¡œìš´ ì „ì„¤ì„ ì“°ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                                <div className="bg-slate-700/50 rounded-xl p-4 mb-4 space-y-2">
                                    <div className="flex justify-between text-sm">
                                        <span className="text-slate-400">í˜„ì¬ ìˆœìì‚°</span>
                                        <span className="text-white font-mono">â‚© {formatMoney(getNetWorth())}</span>
                                    </div>
                                    <div className="flex justify-between text-lg font-bold">
                                        <span className="text-yellow-400">íšë“ ëª…ì„±</span>
                                        <span className="text-yellow-400">+{Math.floor(getNetWorth() / 100000000)} ì </span>
                                    </div>
                                </div>
                                <div className="text-left text-xs text-slate-400 mb-6 bg-slate-900/50 p-3 rounded-lg">
                                    <p>âš ï¸ <strong>ì´ˆê¸°í™” í•­ëª©:</strong> í˜„ê¸ˆ, ì‚¬ì—…ì²´, íˆ¬ì ìì‚°, ì—°êµ¬ ë ˆë²¨</p>
                                    <p>âœ… <strong>ìœ ì§€ í•­ëª©:</strong> ì—…ì , ê¸°ì—… ëª…ì„±</p>
                                    <p className="text-yellow-400 mt-2">ğŸ”¥ ëª…ì„± 1ì ë‹¹ ëª¨ë“  ìˆ˜ìµ +10% ì˜êµ¬ ì¦ê°€</p>
                                </div>
                                <div className="flex gap-3">
                                    <button onClick={() => setShowIPOModal(false)} className="flex-1 bg-slate-600 hover:bg-slate-500 text-white font-bold py-3 rounded-xl">ì·¨ì†Œ</button>
                                    <button onClick={handleIPO} disabled={Math.floor(getNetWorth() / 100000000) <= 0} className={`flex-1 font-bold py-3 rounded-xl shadow-lg transition-all ${Math.floor(getNetWorth() / 100000000) > 0 ? 'bg-gradient-to-r from-yellow-600 to-yellow-500 hover:from-yellow-500 hover:to-yellow-400 text-white' : 'bg-slate-700 text-slate-500 cursor-not-allowed'}`}>{Math.floor(getNetWorth() / 100000000) > 0 ? 'IPO ì§„í–‰' : 'ìì‚° ë¶€ì¡± (1ì–µâ†‘)'}</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Reset Modal */}
                    {showResetModal && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                            <div className="bg-slate-800 border-2 border-red-500 rounded-2xl p-6 max-w-md w-full text-center">
                                <Icons.AlertTriangle className="w-16 h-16 text-red-500 mx-auto mb-4" />
                                <h2 className="text-2xl font-bold text-white mb-2">ë°ì´í„° ì™„ì „ ì´ˆê¸°í™”</h2>
                                <p className="text-slate-300 mb-6">ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br/><span className="text-red-400 font-bold">ì´ ì‘ì—…ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span></p>
                                <div className="flex gap-3">
                                    <button onClick={() => setShowResetModal(false)} className="flex-1 bg-slate-600 hover:bg-slate-500 text-white font-bold py-3 rounded-xl">ì·¨ì†Œ</button>
                                    <button onClick={handleResetConfirm} className="flex-1 bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-xl">ì´ˆê¸°í™”</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Offline Modal */}
                    {showOfflineModal && (
                        <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
                            <div className="bg-slate-800 border border-slate-600 rounded-2xl p-6 max-w-sm w-full text-center shadow-2xl">
                                <Icons.Clock className="w-12 h-12 text-blue-400 mx-auto mb-4" />
                                <h2 className="text-2xl font-bold text-white mb-2">í™˜ì˜í•©ë‹ˆë‹¤!</h2>
                                <p className="text-slate-400 mb-4">ìë¦¬ë¥¼ ë¹„ìš´ ë™ì•ˆ ì‚¬ì—…ì²´ë“¤ì´ ì—´ì‹¬íˆ ì¼í–ˆêµ°ìš”.</p>
                                <div className="bg-slate-700 rounded-xl p-4 mb-6">
                                    <p className="text-sm text-slate-400">ì˜¤í”„ë¼ì¸ ìˆ˜ìµ</p>
                                    <p className="text-3xl font-mono font-bold text-emerald-400">+ â‚© {formatMoney(offlineEarnings)}</p>
                                </div>
                                <button onClick={() => setShowOfflineModal(false)} className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl transition-colors">ìˆ˜ìµ ë°›ê¸°</button>
                            </div>
                        </div>
                    )}

                    {/* Left Panel */}
                    <div className="w-full md:w-[400px] flex flex-col gap-6 shrink-0 md:sticky md:top-8 h-fit">
                        <div className="bg-slate-800 rounded-2xl p-6 shadow-lg border border-slate-700 relative">
                            <div className="absolute top-4 right-4 flex gap-2">
                                <button onClick={() => setShowIPOModal(true)} className={`p-2 border rounded-lg transition-colors ${getNetWorth() >= 100000000 ? 'bg-yellow-500/20 text-yellow-400 border-yellow-500/50 hover:bg-yellow-500/40 animate-pulse' : 'bg-slate-700 text-slate-500 border-slate-600 hover:bg-slate-600'}`} title="IPO ì§„í–‰ (ê¸°ì—… ê³µê°œ)"><Icons.Crown size={18} /></button>
                                <button onClick={saveData} className="p-2 bg-slate-700 rounded-lg hover:bg-slate-600 text-slate-400 hover:text-white transition-colors" title="ì €ì¥"><Icons.Save size={18} /></button>
                                <button onClick={() => setShowResetModal(true)} className="p-2 bg-slate-700 rounded-lg hover:bg-red-900/50 text-slate-400 hover:text-red-400 transition-colors" title="ì´ˆê¸°í™”"><Icons.RotateCcw size={18} /></button>
                            </div>
                            <div className="flex items-center gap-3 mb-2">
                                <Icons.Coins className="text-yellow-400 w-8 h-8" />
                                <h1 className="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-yellow-200">ë¨¸ë‹ˆ íƒ€ì´ì¿¤</h1>
                            </div>
                            <div className="mt-4">
                                <p className="text-slate-400 text-sm flex justify-between"><span>ë³´ìœ  í˜„ê¸ˆ</span><span className="text-xs text-slate-500">ìˆœìì‚°: â‚© {formatMoney(getNetWorth())}</span></p>
                                <p className="text-4xl font-mono font-bold text-white mt-1 break-all">â‚© {formatMoney(money)}</p>
                            </div>
                            <div className="mt-4 flex flex-wrap items-center gap-2">
                                <div className="flex items-center gap-2 text-emerald-400 bg-emerald-400/10 w-fit px-3 py-1 rounded-full"><Icons.TrendingUp size={18} /><span className="font-bold">+{formatMoney(calculateIncomePerSecond())} / ì´ˆ</span></div>
                                {reputation > 0 && (<div className="flex items-center gap-2 text-yellow-400 bg-yellow-400/10 w-fit px-3 py-1 rounded-full text-xs border border-yellow-500/30"><Icons.Crown size={14} /><span className="font-bold">ëª…ì„± íš¨ê³¼: +{reputation * 10}%</span></div>)}
                            </div>
                        </div>

                        {/* Market Status */}
                        <div className="bg-slate-800 rounded-2xl p-6 shadow-lg border border-slate-700 relative overflow-hidden">
                            <div className="flex justify-between items-center mb-2 relative z-10">
                                <h2 className="text-lg font-semibold flex items-center gap-2"><Icons.Activity size={20} /> ì‹œì¥ ê²½ì œ ë‰´ìŠ¤</h2>
                                <span className="text-xs text-slate-400">{timeLeftForEvent}ì´ˆ í›„ ë³€ë™</span>
                            </div>
                            <div className="relative z-10">
                                <p className={`text-xl font-bold ${marketStatus.color}`}>{marketStatus.name}</p>
                                <div className="flex items-center gap-2 text-sm text-slate-400 mt-1"><span>{marketStatus.desc}</span>{marketStatus.id === 'bull' && (<span className="text-green-400 font-bold bg-green-400/10 px-2 rounded">x{upgrades.find(u => u.type === 'market').getEffect(upgrades.find(u => u.type === 'market').level).toFixed(1)} íš¨ê³¼</span>)}</div>
                            </div>
                            <div className="absolute bottom-0 left-0 h-1 w-full bg-slate-700">
                                <div className={`h-full transition-all duration-1000 ease-linear ${getProgressColor()}`} style={{ width: `${(timeLeftForEvent / 30) * 100}%` }} />
                            </div>
                        </div>

                        {/* Work Button */}
                        <div className="flex-1 bg-slate-800 rounded-2xl p-6 shadow-lg border border-slate-700 flex flex-col items-center justify-center min-h-[200px] relative overflow-hidden group">
                            <button onClick={handleManualClick} className="relative z-10 bg-indigo-600 hover:bg-indigo-500 active:scale-95 transition-all w-48 h-48 rounded-full shadow-[0_0_40px_rgba(79,70,229,0.3)] flex flex-col items-center justify-center gap-2 group-hover:shadow-[0_0_60px_rgba(79,70,229,0.5)] border-4 border-indigo-400/30">
                                <Icons.MousePointer2 size={48} className="text-white mb-2" />
                                <span className="font-bold text-lg">ë…¸ë™í•˜ê¸°</span>
                            </button>
                            <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-indigo-900/20 to-transparent pointer-events-none"></div>
                            <p className="mt-6 text-slate-400 text-sm text-center">í´ë¦­í•˜ì—¬ ì‹œë“œë¨¸ë‹ˆë¥¼ ëª¨ìœ¼ì„¸ìš”.<br/>(ì—…ì  & ëª…ì„± ë³´ë„ˆìŠ¤ ì ìš© ì¤‘)</p>
                        </div>
                    </div>

                    {/* Right Panel */}
                    <div className="flex-1 bg-slate-800 rounded-2xl shadow-lg border border-slate-700 flex flex-col overflow-hidden min-h-[600px]">
                        <div className="flex border-b border-slate-700 overflow-x-auto">
                            <button onClick={() => setActiveTab('business')} className={`flex-1 py-4 px-2 font-bold flex items-center justify-center gap-2 transition-colors min-w-[100px] ${activeTab === 'business' ? 'bg-slate-700 text-white' : 'text-slate-400 hover:bg-slate-750'}`}><Icons.Briefcase size={18} /> <span className="hidden sm:inline">ì‚¬ì—…</span></button>
                            <button onClick={() => setActiveTab('investment')} className={`flex-1 py-4 px-2 font-bold flex items-center justify-center gap-2 transition-colors min-w-[100px] ${activeTab === 'investment' ? 'bg-slate-700 text-white' : 'text-slate-400 hover:bg-slate-750'}`}><Icons.LineChart size={18} /> <span className="hidden sm:inline">íˆ¬ì</span></button>
                            <button onClick={() => setActiveTab('upgrade')} className={`flex-1 py-4 px-2 font-bold flex items-center justify-center gap-2 transition-colors min-w-[100px] ${activeTab === 'upgrade' ? 'bg-slate-700 text-white' : 'text-slate-400 hover:bg-slate-750'}`}><Icons.Microscope size={18} /> <span className="hidden sm:inline">ì—°êµ¬</span></button>
                            <button onClick={() => setActiveTab('achievement')} className={`flex-1 py-4 px-2 font-bold flex items-center justify-center gap-2 transition-colors min-w-[100px] ${activeTab === 'achievement' ? 'bg-slate-700 text-white' : 'text-slate-400 hover:bg-slate-750'}`}><Icons.Medal size={18} /> <span className="hidden sm:inline">ì—…ì </span></button>
                        </div>

                        <div className="flex-1 p-6 overflow-y-auto custom-scrollbar bg-slate-800">
                            {/* Business Tab */}
                            {activeTab === 'business' && (
                                <div className="space-y-3">
                                    <h3 className="text-lg font-bold text-slate-300 mb-4">ìë™ ìˆ˜ìµì› ë§¤ì…</h3>
                                    {businesses.map((biz) => {
                                        const currentCost = calculateCost(biz.baseCost, biz.count);
                                        const canAfford = money >= currentCost;
                                        const BusinessIcon = getIcon(biz.icon);
                                        return (
                                            <button key={biz.id} onClick={() => buyBusiness(biz.id)} disabled={!canAfford} className={`w-full flex items-center justify-between p-4 rounded-xl border transition-all ${canAfford ? 'bg-slate-700 border-slate-600 hover:bg-slate-650' : 'bg-slate-800/50 border-slate-700 opacity-60 cursor-not-allowed'}`}>
                                                <div className="flex items-center gap-4 text-left">
                                                    <div className={`p-3 rounded-lg ${canAfford ? 'bg-blue-500/20 text-blue-400' : 'bg-slate-600/20 text-slate-500'}`}><BusinessIcon size={24} /></div>
                                                    <div><h3 className="font-bold text-slate-200">{biz.name}</h3><div className="text-xs text-slate-400">ë³´ìœ : <span className="text-white">{biz.count}</span></div><div className="text-xs text-emerald-400">+{formatMoney(biz.baseIncome)}/ì´ˆ</div></div>
                                                </div>
                                                <div className="text-right"><div className={`font-mono font-bold ${canAfford ? 'text-yellow-400' : 'text-slate-500'}`}>â‚© {formatMoney(currentCost)}</div></div>
                                            </button>
                                        );
                                    })}
                                </div>
                            )}

                            {/* Investment Tab */}
                            {activeTab === 'investment' && (
                                <div className="space-y-4">
                                    <div className="bg-slate-700/50 p-2 rounded-lg border border-slate-600 flex items-center justify-between gap-2">
                                        <span className="text-sm text-slate-300 font-bold px-2 flex items-center gap-2"><Icons.Calculator size={16} /> ê±°ë˜ ìˆ˜ëŸ‰</span>
                                        <div className="flex gap-1 flex-1 justify-end">
                                            {[1, 10, 100, 'MAX'].map((amt) => (<button key={amt} onClick={() => setTradeAmount(amt)} className={`px-3 py-1.5 rounded-md text-sm font-bold transition-all ${tradeAmount === amt ? 'bg-indigo-500 text-white shadow-lg scale-105' : 'bg-slate-600 text-slate-400 hover:bg-slate-500'}`}>{amt === 'MAX' ? 'MAX' : `x${amt}`}</button>))}
                                        </div>
                                    </div>
                                    <div className="bg-slate-700/50 p-4 rounded-lg border border-slate-600 text-sm text-slate-300"><p>ğŸ’¡ <strong>íˆ¬ì íŒ:</strong> ë°°ë‹¬ì•±, ì—ë„ˆì§€ ë“± ìƒˆë¡œìš´ ì‚¬ì—…ìœ¼ë¡œ ëˆì„ ë²Œê³  <strong>NFT, ë°”ì´ì˜¤ ì£¼ì‹</strong> ë“± ë‹¤ì–‘í•œ ìì‚°ì— íˆ¬ìí•´ë³´ì„¸ìš”.</p></div>
                                    {investments.map((item) => {
                                        let profitRate = 0; let profitColor = 'text-slate-400';
                                        if (item.owned > 0) { profitRate = ((item.price - item.avgPrice) / item.avgPrice) * 100; if (profitRate > 0) profitColor = 'text-red-400'; else if (profitRate < 0) profitColor = 'text-blue-400'; }
                                        const isPriceUp = item.history[item.history.length - 1] > item.history[item.history.length - 2];
                                        const chartColor = isPriceUp ? '#f87171' : '#60a5fa';
                                        let buyCostDisplay = 0, sellCountDisplay = 0, canBuy = false, canSell = false;
                                        if (tradeAmount === 'MAX') { const maxCanBuy = Math.floor(money / item.price); buyCostDisplay = maxCanBuy * item.price; canBuy = maxCanBuy > 0; sellCountDisplay = item.owned; canSell = item.owned > 0; }
                                        else { buyCostDisplay = item.price * tradeAmount; canBuy = money >= buyCostDisplay; sellCountDisplay = Math.min(item.owned, tradeAmount); canSell = sellCountDisplay > 0; }
                                        
                                        // ì•„ì´ì½˜ ë§¤í•‘
                                        let InvIcon = Icons.TrendingUp;
                                        if (item.id === 'coin') InvIcon = Icons.Coins;
                                        else if (item.id === 'nft') InvIcon = Icons.Gem;
                                        else if (item.id === 'bio_stock') InvIcon = Icons.Activity;
                                        else if (item.id === 'gold') InvIcon = Icons.Wallet;
                                        else if (item.id === 'real_estate') InvIcon = Icons.Building2;

                                        return (
                                            <div key={item.id} className="bg-slate-700 rounded-xl p-5 border border-slate-600 shadow-md">
                                                <div className="flex justify-between items-start mb-2">
                                                    <div className="flex items-center gap-3">
                                                        <div className={`p-2 rounded-lg ${item.type === 'high_risk' ? 'bg-orange-500/20 text-orange-400' : item.type === 'low_risk' ? 'bg-blue-500/20 text-blue-400' : 'bg-purple-500/20 text-purple-400'}`}><InvIcon size={24} /></div>
                                                        <div><h3 className="font-bold text-lg text-slate-100">{item.name}</h3><p className="text-xs text-slate-400">{item.desc}</p></div>
                                                    </div>
                                                    <div className="text-right"><div className={`text-2xl font-mono font-bold flex items-center justify-end gap-2 ${isPriceUp ? 'text-red-400' : 'text-blue-400'}`}>{isPriceUp ? <Icons.TrendingUp size={20} /> : <Icons.TrendingDown size={20} />} â‚© {formatMoney(item.price)}</div><div className="text-xs text-slate-400 mt-1">í˜„ì¬ê°€ (ì‹¤ì‹œê°„)</div></div>
                                                </div>
                                                <div className="h-10 mb-4 bg-slate-800/50 rounded overflow-hidden"><InvestmentChart history={item.history} color={chartColor} /></div>
                                                <div className="bg-slate-800/80 rounded-lg p-3 mb-4 flex justify-between items-center text-sm"><div><span className="text-slate-400">ë³´ìœ ëŸ‰: </span><span className="text-white font-bold ml-1">{formatMoney(item.owned)} ì£¼/ê°œ</span></div><div><span className="text-slate-400">í‰ë‹¨ê°€: </span><span className="text-slate-200 ml-1">â‚© {formatMoney(item.avgPrice)}</span></div><div><span className="text-slate-400">ìˆ˜ìµë¥ : </span><span className={`font-bold ml-1 ${profitColor}`}>{profitRate.toFixed(2)}%</span></div></div>
                                                <div className="flex gap-2">
                                                    <button onClick={() => buyInvestment(item.id)} className={`flex-1 py-3 rounded-lg font-bold text-sm transition-colors flex flex-col items-center justify-center gap-0.5 ${canBuy ? 'bg-red-500/20 text-red-400 hover:bg-red-500/30 border border-red-500/50' : 'bg-slate-600 text-slate-400 cursor-not-allowed'}`} disabled={!canBuy}><span>{tradeAmount === 'MAX' ? 'ìµœëŒ€ ë§¤ìˆ˜' : `ë§¤ìˆ˜ (${tradeAmount}ê°œ)`}</span><span className="text-xs font-mono opacity-80">-{formatMoney(buyCostDisplay)}</span></button>
                                                    <button onClick={() => sellInvestment(item.id)} className={`flex-1 py-3 rounded-lg font-bold text-sm transition-colors flex flex-col items-center justify-center gap-0.5 ${canSell ? 'bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 border border-blue-500/50' : 'bg-slate-600 text-slate-400 cursor-not-allowed'}`} disabled={!canSell}><span>{tradeAmount === 'MAX' ? 'ì „ëŸ‰ ë§¤ë„' : `ë§¤ë„ (${tradeAmount}ê°œ)`}</span><span className="text-xs font-mono opacity-80">+{formatMoney(item.price * sellCountDisplay)}</span></button>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}

                            {/* Upgrade Tab */}
                            {activeTab === 'upgrade' && (
                                <div className="space-y-3">
                                    <h3 className="text-lg font-bold text-slate-300 mb-4">ê²½ì œí•™ ì—°êµ¬ì†Œ</h3>
                                    {upgrades.map((upgrade) => {
                                        const currentCost = getUpgradeCost(upgrade);
                                        const isMaxed = upgrade.level >= upgrade.maxLevel;
                                        const canBuy = !isMaxed && money >= currentCost;
                                        const UpgIcon = isMaxed ? Icons.Trophy : Icons.Microscope;
                                        return (
                                            <button key={upgrade.id} onClick={() => buyUpgrade(upgrade.id)} disabled={!canBuy} className={`w-full flex items-center justify-between p-3 rounded-xl border transition-all ${isMaxed ? 'bg-green-900/10 border-green-800 opacity-80' : canBuy ? 'bg-slate-700 border-slate-600 hover:bg-slate-650' : 'bg-slate-800/50 border-slate-700 opacity-60'}`}>
                                                <div className="flex items-center gap-3 text-left">
                                                    <div className={`p-2 rounded-lg ${isMaxed ? 'bg-green-500/20 text-green-400' : 'bg-purple-500/20 text-purple-400'}`}><UpgIcon size={20} /></div>
                                                    <div><div className="flex items-center gap-2"><h3 className={`font-bold text-sm ${isMaxed ? 'text-green-400' : 'text-slate-200'}`}>{upgrade.name}</h3><span className="text-xs px-1.5 py-0.5 rounded bg-slate-800 text-slate-400">Lv.{upgrade.level} / {upgrade.maxLevel}</span></div><p className="text-xs text-slate-400 mt-1">{getUpgradeDesc(upgrade)}</p></div>
                                                </div>
                                                <div className="text-right min-w-[80px]">{isMaxed ? (<span className="text-xs font-bold text-green-500">ì—°êµ¬ ì™„ë£Œ</span>) : (<span className={`text-sm font-mono font-bold ${canBuy ? 'text-yellow-400' : 'text-slate-500'}`}>â‚© {formatMoney(currentCost)}</span>)}</div>
                                            </button>
                                        );
                                    })}
                                </div>
                            )}

                            {/* Achievement Tab */}
                            {activeTab === 'achievement' && (
                                <div className="space-y-3">
                                    <h3 className="text-lg font-bold text-slate-300 mb-4">ë‚˜ì˜ ì—…ì </h3>
                                    <div className="bg-slate-700/50 p-4 rounded-lg border border-slate-600 text-sm text-slate-300 mb-4"><p>ğŸ† ì—…ì ì„ ë‹¬ì„±í•  ë•Œë§ˆë‹¤ ì „ì²´ ìˆ˜ìµ(í´ë¦­, ì‚¬ì—…, íˆ¬ì)ì´ <strong>1%ì”© ì¦ê°€</strong>í•©ë‹ˆë‹¤.</p></div>
                                    <div className="grid grid-cols-1 gap-3">
                                        {achievements.map((ach) => (
                                            <div key={ach.id} className={`p-4 rounded-xl border flex items-center gap-4 ${ach.unlocked ? 'bg-indigo-900/30 border-indigo-500/50' : 'bg-slate-800 border-slate-700 opacity-60'}`}>
                                                <div className={`p-3 rounded-full ${ach.unlocked ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-500/50' : 'bg-slate-700 text-slate-500'}`}><Icons.Medal size={24} /></div>
                                                <div><h4 className={`font-bold ${ach.unlocked ? 'text-white' : 'text-slate-400'}`}>{ach.name}</h4><p className="text-sm text-slate-400">{ach.desc}</p></div>
                                                {ach.unlocked && (<div className="ml-auto text-xs font-bold text-indigo-400 bg-indigo-900/50 px-2 py-1 rounded">ë‹¬ì„± ì™„ë£Œ</div>)}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    <button onClick={handleManualClick} className="fixed bottom-8 right-8 z-50 bg-indigo-600 hover:bg-indigo-500 text-white p-4 rounded-full shadow-[0_0_20px_rgba(79,70,229,0.5)] border-4 border-indigo-400/30 active:scale-95 transition-all md:hidden flex items-center justify-center" aria-label="ë…¸ë™í•˜ê¸°"><Icons.MousePointer2 size={28} /></button>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
