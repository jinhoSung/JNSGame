<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Skeleton Knight's Revenge</title>
    <style>
        body {
            background-color: #1a1a1a;
            color: white;
            margin: 0;
            overflow: hidden;
            font-family: 'DungGeunMo', monospace, sans-serif;
            touch-action: none;
        }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
        }

        canvas {
            image-rendering: pixelated;
            display: block;
        }

        /* UI ê³µí†µ */
        .overlay {
            position: absolute;
            pointer-events: none;
            text-shadow: 2px 2px 0 #000;
            z-index: 10;
        }

        /* ìŠ¤íƒ¯ë°” */
        #stat-bar {
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 8px;
            border: 2px solid #888;
            font-size: 18px;
            pointer-events: auto;
        }
        .btn-group button {
            background: #444; color: white; border: 1px solid #fff;
            padding: 5px 10px; cursor: pointer; margin-left: 5px; font-family: inherit;
        }
        .btn-group button:hover { background: #666; }

        /* ëŒ€í™”ì°½ */
        #dialog-box {
            bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 80%; max-width: 600px;
            background: rgba(0, 0, 0, 0.9); border: 3px solid #fff;
            padding: 20px; font-size: 18px; display: none;
            white-space: pre-line; line-height: 1.6; z-index: 20;
        }

        /* ì‹œì‘ í™”ë©´ */
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 100; text-align: center;
        }
        #start-screen h1 { color: #e74c3c; font-size: 40px; margin-bottom: 10px; }
        #start-screen .keys { color: #f1c40f; margin: 20px 0; font-size: 20px; }
        #start-btn {
            padding: 15px 40px; font-size: 24px; background: #e74c3c;
            color: white; border: 4px solid #fff; cursor: pointer;
            font-family: inherit; animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* === í†µí•© ì¹´ì§€ë…¸ íŒ¨ë„ === */
        #casino-panel {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; max-width: 500px;
            background: #2c3e50; border: 4px solid gold;
            padding: 20px; display: none; text-align: center;
            pointer-events: auto; z-index: 50;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            max-height: 90vh; overflow-y: auto;
        }
        
        .casino-header { color: gold; margin-bottom: 15px; border-bottom: 2px solid gold; padding-bottom: 10px; }
        .casino-btn {
            background: #e74c3c; color: white; border: none;
            padding: 10px 20px; margin: 5px; cursor: pointer;
            font-size: 16px; border-radius: 4px; font-family: inherit;
        }
        .casino-btn:hover { background: #c0392b; }
        .casino-btn.secondary { background: #555; }
        .casino-btn.secondary:hover { background: #333; }

        /* ê²Œì„ ì„ íƒ ë©”ë‰´ */
        #casino-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        #casino-menu button { height: 60px; font-size: 18px; }

        /* ê°œë³„ ê²Œì„ ì»¨í…Œì´ë„ˆ */
        .game-view { display: none; }
        .game-view.active { display: block; }
        
        .result-msg { height: 30px; font-weight: bold; color: yellow; margin: 10px 0; }
        .bet-info { background: rgba(0,0,0,0.3); padding: 10px; margin: 10px 0; border-radius: 5px; }

        /* ìŠ¬ë¡¯ë¨¸ì‹  */
        .slot-machine { display: flex; justify-content: center; gap: 10px; margin: 20px 0; }
        .reel { width: 60px; height: 80px; background: white; color: black; font-size: 40px; display: flex; align-items: center; justify-content: center; border: 3px solid #333; border-radius: 5px; }
        
        /* ê²½ë§ˆ */
        .race-track { background: #2e7d32; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .horse-lane { display: flex; align-items: center; margin: 5px 0; border-bottom: 1px dashed rgba(255,255,255,0.3); position: relative; height: 30px;}
        .horse { font-size: 24px; position: absolute; left: 0; transition: left 0.2s linear; }
        .finish-line { position: absolute; right: 10px; height: 100%; width: 2px; background: red; }

        /* ë‹¤ì´ì‚¬ì´ */
        .dice-box { display: flex; justify-content: center; gap: 15px; margin: 20px 0; }
        .dice { width: 50px; height: 50px; background: white; color: black; border-radius: 8px; font-size: 30px; display: flex; align-items: center; justify-content: center; border: 2px solid #999; }

        #toast {
            position: absolute; top: 80px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 100, 0, 0.9); color: white;
            padding: 10px 30px; border-radius: 20px; display: none; z-index: 999;
        }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <!-- ì‹œì‘ í™”ë©´ -->
        <div id="start-screen">
            <h1>ğŸ’€ í•´ê³¨ ê¸°ì‚¬ì˜ ë³µìˆ˜</h1>
            <p>ëˆ„ëª…ì„ ì“°ê³  í•´ê³¨ì´ ëœ ê¸°ì‚¬ì˜ ëª¨í—˜</p>
            <div class="keys">
                [ì´ë™] ë°©í–¥í‚¤ (â†‘â†“â†â†’)<br>
                [ì¡°ì‚¬] ìŠ¤í˜ì´ìŠ¤ë°” (Space)
            </div>
            <button id="start-btn" onclick="startGameFlow()">ê²Œì„ ì‹œì‘</button>
        </div>

        <!-- ìŠ¤íƒ¯ ì°½ -->
        <div id="stat-bar" class="overlay">
            <div>
                ğŸ’€ Lv.1 <span style="margin: 0 10px; color:#888;">|</span> 
                ğŸ’° <span id="gold-display" style="color:gold;">0</span>G
            </div>
            <div class="btn-group">
                <button onclick="saveGame()">ğŸ’¾ ì €ì¥</button>
                <button onclick="loadGame()">ğŸ“‚ ë¡œë“œ</button>
            </div>
        </div>

        <!-- ëŒ€í™” ì°½ -->
        <div id="dialog-box" class="overlay"></div>
        <div id="toast">ê²Œì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>

        <!-- === ì¹´ì§€ë…¸ íŒ¨ë„ === -->
        <div id="casino-panel">
            <h2 class="casino-header">ğŸ° ê³ ë¸”ë¦° ì¹´ì§€ë…¸</h2>
            
            <!-- 1. ê²Œì„ ì„ íƒ ë©”ë‰´ -->
            <div id="casino-menu">
                <button class="casino-btn" onclick="showGame('blackjack')">ğŸƒ ë¸”ë™ì­</button>
                <button class="casino-btn" onclick="showGame('roulette')">ğŸ¡ ë£°ë ›</button>
                <button class="casino-btn" onclick="showGame('slots')">ğŸ’ ìŠ¬ë¡¯ë¨¸ì‹ </button>
                <button class="casino-btn" onclick="showGame('racing')">ğŸ ê²½ë§ˆ</button>
                <button class="casino-btn" onclick="showGame('sicbo')">ğŸ² ë‹¤ì´ì‚¬ì´</button>
                <button class="casino-btn secondary" onclick="exitCasino()" style="grid-column: span 2;">ğŸšª ë‚˜ê°€ê¸°</button>
            </div>

            <!-- 2. ë¸”ë™ì­ ê²Œì„ -->
            <div id="game-blackjack" class="game-view">
                <h3>ë¸”ë™ì­ (Blackjack)</h3>
                <p>21ì— ê°€ê¹Œìš´ ìˆ˜ë¥¼ ë§Œë“œì„¸ìš”.</p>
                <div class="bet-info">íŒëˆ: 100G (ìŠ¹ë¦¬ ì‹œ 200G)</div>
                <div id="bj-board" class="hidden">
                    <div style="font-size: 20px; margin: 20px 0;">
                        ë‚˜: <span id="p-score" style="color:#4caf50;">0</span> vs ë”œëŸ¬: <span id="d-score" style="color:#e74c3c;">?</span>
                    </div>
                    <div id="bj-result" class="result-msg"></div>
                    <button class="casino-btn" onclick="bjHit()">íˆíŠ¸</button>
                    <button class="casino-btn" onclick="bjStand()">ìŠ¤íƒ ë“œ</button>
                </div>
                <div id="bj-controls">
                    <button class="casino-btn" onclick="startBlackjack()">ê²Œì„ ì‹œì‘ (-100G)</button>
                    <button class="casino-btn secondary" onclick="backToMenu()">ë’¤ë¡œê°€ê¸°</button>
                </div>
            </div>

            <!-- 3. ë£°ë › ê²Œì„ -->
            <div id="game-roulette" class="game-view">
                <h3>ë£°ë › (Roulette)</h3>
                <p>ìˆ«ì(1~12)ë‚˜ í™€ì§ì„ ë§ì¶”ì„¸ìš”.</p>
                <div class="bet-info">íŒëˆ: 100G</div>
                <div id="roulette-result" class="result-msg"></div>
                <div style="margin-bottom: 10px;">
                    <div style="font-size:40px; margin:10px;">ğŸ¡ <span id="roulette-wheel">?</span></div>
                </div>
                <div>
                    <button class="casino-btn" onclick="playRoulette('odd')">í™€ìˆ˜ (2ë°°)</button>
                    <button class="casino-btn" onclick="playRoulette('even')">ì§ìˆ˜ (2ë°°)</button>
                    <button class="casino-btn" onclick="playRoulette('lucky7')">Lucky 7 (10ë°°)</button>
                </div>
                <button class="casino-btn secondary" onclick="backToMenu()" style="margin-top:20px;">ë’¤ë¡œê°€ê¸°</button>
            </div>

            <!-- 4. ìŠ¬ë¡¯ë¨¸ì‹  -->
            <div id="game-slots" class="game-view">
                <h3>ìŠ¬ë¡¯ë¨¸ì‹  (Slots)</h3>
                <p>ê°™ì€ ê·¸ë¦¼ì„ 3ê°œ ë§ì¶”ì„¸ìš”! (777: ì­íŒŸ)</p>
                <div class="bet-info">íŒëˆ: 50G</div>
                <div class="slot-machine">
                    <div id="reel1" class="reel">?</div>
                    <div id="reel2" class="reel">?</div>
                    <div id="reel3" class="reel">?</div>
                </div>
                <div id="slot-result" class="result-msg"></div>
                <button class="casino-btn" onclick="spinSlots()">ëŒë¦¬ê¸° (-50G)</button>
                <button class="casino-btn secondary" onclick="backToMenu()">ë’¤ë¡œê°€ê¸°</button>
            </div>

            <!-- 5. ê²½ë§ˆ -->
            <div id="game-racing" class="game-view">
                <h3>í•´ê³¨ ê²½ë§ˆ (Horse Racing)</h3>
                <p>ìš°ìŠ¹ë§ˆë¥¼ ì˜ˆì¸¡í•˜ì„¸ìš”! (4ë°° ë°°ë‹¹)</p>
                <div class="bet-info">íŒëˆ: 100G</div>
                <div class="race-track" id="race-track">
                    <!-- ìŠ¤í¬ë¦½íŠ¸ë¡œ ìƒì„± -->
                </div>
                <div id="race-result" class="result-msg"></div>
                <div id="race-btns">
                    <button class="casino-btn" onclick="startRace(1)">1ë²ˆë§ˆ</button>
                    <button class="casino-btn" onclick="startRace(2)">2ë²ˆë§ˆ</button>
                    <button class="casino-btn" onclick="startRace(3)">3ë²ˆë§ˆ</button>
                    <button class="casino-btn" onclick="startRace(4)">4ë²ˆë§ˆ</button>
                </div>
                <button class="casino-btn secondary" onclick="backToMenu()">ë’¤ë¡œê°€ê¸°</button>
            </div>

            <!-- 6. ë‹¤ì´ì‚¬ì´ (ì‹ë³´) -->
            <div id="game-sicbo" class="game-view">
                <h3>ë‹¤ì´ì‚¬ì´ (Sic Bo)</h3>
                <p>ì£¼ì‚¬ìœ„ 3ê°œì˜ í•©: ì†Œ(4-10) vs ëŒ€(11-17)</p>
                <div class="bet-info">íŒëˆ: 200G (ìŠ¹ë¦¬ ì‹œ 400G)</div>
                <div class="dice-box">
                    <div id="dice1" class="dice">ğŸ²</div>
                    <div id="dice2" class="dice">ğŸ²</div>
                    <div id="dice3" class="dice">ğŸ²</div>
                </div>
                <div style="font-size:20px; margin-bottom:10px;">í•©ê³„: <span id="sicbo-sum">0</span></div>
                <div id="sicbo-result" class="result-msg"></div>
                <div>
                    <button class="casino-btn" onclick="playSicBo('small')">ì†Œ (Small)</button>
                    <button class="casino-btn" onclick="playSicBo('big')">ëŒ€ (Big)</button>
                </div>
                <button class="casino-btn secondary" onclick="backToMenu()" style="margin-top:20px;">ë’¤ë¡œê°€ê¸°</button>
            </div>

        </div>
    </div>

<script>
    // --- 1. ê¸°ë³¸ ì„¤ì • ë° ì´ˆê¸°í™” ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const dialogBox = document.getElementById('dialog-box');
    const goldDisplay = document.getElementById('gold-display');
    const casinoPanel = document.getElementById('casino-panel');
    const startScreen = document.getElementById('start-screen');
    const toast = document.getElementById('toast');

    const TILE_SIZE = 40;
    const MAP_SIZE = 512;
    const TILE = { GRASS: 0, WATER: 1, MOUNTAIN: 2, VILLAGE: 3, CASINO: 9 };
    const STATE = { MENU: 'menu', EXPLORE: 'explore', DIALOG: 'dialog', MINIGAME: 'minigame' };
    
    let currentState = STATE.MENU;
    let camera = { x: 0, y: 0 };
    let mapData = [];

    const player = {
        x: 256, y: 256,
        gold: 1000, // ì‹œì‘ ê³¨ë“œ ì•½ê°„ ìƒí–¥
        sprite: 'ğŸ’€'
    };

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        if(typeof updateCamera === 'function') updateCamera();
        if(typeof draw === 'function') draw();
    }
    window.addEventListener('resize', resizeCanvas);

    // --- 2. ë§µ ìƒì„± ---
    function generateMap() {
        for(let y=0; y<MAP_SIZE; y++) mapData.push(new Array(MAP_SIZE).fill(TILE.GRASS));
        for(let i=0; i<800; i++) createBlob(TILE.MOUNTAIN, 10, 30);
        for(let i=0; i<400; i++) createBlob(TILE.WATER, 5, 15);

        const center = MAP_SIZE / 2;
        for(let y=center-10; y<center+10; y++) {
            for(let x=center-10; x<center+10; x++) mapData[y][x] = TILE.VILLAGE;
        }
        mapData[center-5][center] = TILE.CASINO;
        mapData[center-5][center+1] = TILE.CASINO;
    }
    function createBlob(type, min, max) {
        let cx = Math.floor(Math.random() * MAP_SIZE);
        let cy = Math.floor(Math.random() * MAP_SIZE);
        let size = Math.floor(Math.random() * (max - min) + min);
        for(let y=cy-size; y<cy+size; y++) {
            for(let x=cx-size; x<cx+size; x++) {
                if(x>=0 && x<MAP_SIZE && y>=0 && y<MAP_SIZE) {
                    if(Math.random() > 0.3) mapData[y][x] = type; 
                }
            }
        }
    }
    generateMap();

    // --- 3. ê·¸ë˜í”½ & ë£¨í”„ ---
    function updateCamera() {
        camera.x = player.x * TILE_SIZE - canvas.width / 2 + (TILE_SIZE / 2);
        camera.y = player.y * TILE_SIZE - canvas.height / 2 + (TILE_SIZE / 2);
        const maxX = MAP_SIZE * TILE_SIZE - canvas.width;
        const maxY = MAP_SIZE * TILE_SIZE - canvas.height;
        if (camera.x < 0) camera.x = 0; if (camera.y < 0) camera.y = 0;
        if (camera.x > maxX) camera.x = maxX; if (camera.y > maxY) camera.y = maxY;
    }

    function draw() {
        if (currentState === STATE.MENU) return;
        ctx.fillStyle = '#000'; ctx.fillRect(0, 0, canvas.width, canvas.height);

        const startCol = Math.floor(camera.x / TILE_SIZE);
        const endCol = startCol + (canvas.width / TILE_SIZE) + 1;
        const startRow = Math.floor(camera.y / TILE_SIZE);
        const endRow = startRow + (canvas.height / TILE_SIZE) + 1;
        const offsetX = -camera.x + startCol * TILE_SIZE;
        const offsetY = -camera.y + startRow * TILE_SIZE;

        for (let y = startRow; y <= endRow; y++) {
            for (let x = startCol; x <= endCol; x++) {
                if (y >= 0 && y < MAP_SIZE && x >= 0 && x < MAP_SIZE) {
                    const tile = mapData[y][x];
                    let color = '#2e8b57';
                    if (tile === TILE.WATER) color = '#3498db';
                    else if (tile === TILE.MOUNTAIN) color = '#555';
                    else if (tile === TILE.VILLAGE) color = '#d3a95d';
                    else if (tile === TILE.CASINO) color = '#8e44ad';
                    
                    ctx.fillStyle = color;
                    ctx.fillRect((x - startCol)*TILE_SIZE + offsetX, (y - startRow)*TILE_SIZE + offsetY, TILE_SIZE+1, TILE_SIZE+1);
                    if (tile === TILE.CASINO) {
                        ctx.font = '20px Arial'; ctx.fillStyle = '#fff';
                        ctx.fillText("ğŸ°", (x-startCol)*TILE_SIZE+offsetX+8, (y-startRow)*TILE_SIZE+offsetY+28);
                    }
                }
            }
        }

        const px = player.x * TILE_SIZE - camera.x;
        const py = player.y * TILE_SIZE - camera.y;
        ctx.fillStyle = 'rgba(0,0,0,0.5)';
        ctx.beginPath(); ctx.ellipse(px + 20, py + 35, 10, 5, 0, 0, Math.PI * 2); ctx.fill();
        ctx.font = '30px Arial'; ctx.fillText(player.sprite, px + 5, py + 30);
    }
    resizeCanvas();

    // --- 4. ê²Œì„ ì»¨íŠ¸ë¡¤ ---
    function startGameFlow() {
        startScreen.style.display = 'none';
        currentState = STATE.EXPLORE;
        updateUI(); resizeCanvas(); draw();
        setTimeout(() => showDialog("ì¹´ì§€ë…¸ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!\në‹¤ì–‘í•œ ê²Œì„ì„ ì¦ê¸°ê³  ë¶€ìê°€ ë˜ì–´ë³´ì„¸ìš”."), 500);
    }
    
    function updateUI() { goldDisplay.innerText = player.gold; }

    window.saveGame = function() {
        if(currentState !== STATE.EXPLORE) { alert("íƒí—˜ ëª¨ë“œì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."); return; }
        const data = { gold: player.gold, savedAt: new Date().toLocaleString() };
        localStorage.setItem('skeletonRPG_v3', JSON.stringify(data));
        toast.innerText = "ì €ì¥ ì™„ë£Œ!"; toast.style.display = 'block';
        setTimeout(() => { toast.style.display = 'none'; }, 2000);
    };

    window.loadGame = function() {
        const str = localStorage.getItem('skeletonRPG_v3');
        if(!str) { alert("ì €ì¥ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤."); return; }
        const data = JSON.parse(str);
        player.gold = data.gold;
        player.x = MAP_SIZE/2; player.y = MAP_SIZE/2;
        updateUI(); updateCamera(); draw();
        alert(`ë¡œë“œ ì™„ë£Œ! ê³¨ë“œ: ${player.gold}`);
    };

    window.addEventListener('keydown', (e) => {
        if (currentState === STATE.MENU || currentState === STATE.MINIGAME) return;
        if (currentState === STATE.DIALOG) {
            if (e.key === ' ' || e.key === 'Spacebar' || e.key === 'Enter') closeDialog();
            return;
        }
        let dx = 0, dy = 0;
        if (e.key === 'ArrowUp') dy = -1;
        if (e.key === 'ArrowDown') dy = 1;
        if (e.key === 'ArrowLeft') dx = -1;
        if (e.key === 'ArrowRight') dx = 1;
        if (e.key === ' ') { checkInteraction(); return; }
        
        const nx = player.x + dx, ny = player.y + dy;
        if (canMove(nx, ny)) { player.x = nx; player.y = ny; updateCamera(); draw(); }
    });

    function canMove(x, y) {
        if(x<0||x>=MAP_SIZE||y<0||y>=MAP_SIZE) return false;
        const t = mapData[y][x];
        return t !== TILE.WATER && t !== TILE.MOUNTAIN;
    }
    function checkInteraction() {
        if (mapData[player.y][player.x] === TILE.CASINO) enterCasino();
        else showDialog("ì•„ë¬´ê²ƒë„ ì—†ë‹¤.");
    }
    function showDialog(t) { currentState = STATE.DIALOG; dialogBox.innerText = t; dialogBox.style.display = 'block'; }
    function closeDialog() { dialogBox.style.display = 'none'; currentState = STATE.EXPLORE; }

    // ==========================================
    // 5. ì¹´ì§€ë…¸ ì‹œìŠ¤í…œ (í†µí•©)
    // ==========================================
    function enterCasino() {
        currentState = STATE.MINIGAME;
        casinoPanel.style.display = 'block';
        backToMenu(); // í•­ìƒ ë©”ë‰´ë¡œ ì‹œì‘
    }
    window.exitCasino = function() {
        casinoPanel.style.display = 'none';
        currentState = STATE.EXPLORE;
        draw();
    };

    window.showGame = function(gameId) {
        // ëª¨ë“  ê²Œì„ ë·° ìˆ¨ê¸°ê¸°
        document.querySelectorAll('.game-view').forEach(el => el.classList.remove('active'));
        document.getElementById('casino-menu').style.display = 'none';
        
        // ì„ íƒí•œ ê²Œì„ ë³´ì´ê¸°
        const target = document.getElementById('game-' + gameId);
        if(target) target.classList.add('active');
        
        // ê²Œì„ë³„ ì´ˆê¸°í™”
        document.querySelectorAll('.result-msg').forEach(el => el.innerText = '');
        if(gameId === 'racing') initRaceTrack();
    };

    window.backToMenu = function() {
        document.querySelectorAll('.game-view').forEach(el => el.classList.remove('active'));
        document.getElementById('casino-menu').style.display = 'grid';
    };

    // --- [1] ë¸”ë™ì­ ë¡œì§ ---
    let pScore=0, dScore=0;
    window.startBlackjack = function() {
        if(!checkGold(100)) return;
        document.getElementById('bj-controls').classList.add('hidden');
        document.getElementById('bj-board').classList.remove('hidden');
        pScore = rCard() + rCard(); dScore = rCard();
        updateBjUI();
    };
    window.bjHit = function() {
        pScore += rCard(); updateBjUI();
        if(pScore > 21) endBj(false, "ë²„ìŠ¤íŠ¸! (21 ì´ˆê³¼)");
    };
    window.bjStand = function() {
        while(dScore < 17) dScore += rCard();
        updateBjUI();
        if(dScore > 21) endBj(true, "ë”œëŸ¬ ë²„ìŠ¤íŠ¸! ìŠ¹ë¦¬!");
        else if(pScore > dScore) endBj(true, "ìŠ¹ë¦¬!");
        else if(pScore === dScore) { player.gold += 100; endBj(false, "ë¬´ìŠ¹ë¶€"); }
        else endBj(false, "íŒ¨ë°°");
    };
    function rCard() { return Math.floor(Math.random()*10)+2; }
    function updateBjUI() {
        document.getElementById('p-score').innerText = pScore;
        document.getElementById('d-score').innerText = dScore;
    }
    function endBj(win, msg) {
        document.getElementById('bj-result').innerText = msg;
        if(win) { player.gold += 200; updateUI(); }
        setTimeout(() => {
            document.getElementById('bj-board').classList.add('hidden');
            document.getElementById('bj-controls').classList.remove('hidden');
        }, 1500);
    }

    // --- [2] ë£°ë › ë¡œì§ ---
    window.playRoulette = function(type) {
        const bet = 100;
        if(!checkGold(bet)) return;

        // íœ  ëŒë¦¬ê¸° ì• ë‹ˆë©”ì´ì…˜ í‰ë‚´
        const wheel = document.getElementById('roulette-wheel');
        let count = 0;
        const interval = setInterval(() => {
            wheel.innerText = Math.floor(Math.random()*12)+1;
            count++;
            if(count > 10) {
                clearInterval(interval);
                const result = Math.floor(Math.random()*12)+1;
                wheel.innerText = result;
                checkRouletteWin(type, result, bet);
            }
        }, 100);
    };

    function checkRouletteWin(type, num, bet) {
        let win = false;
        let multi = 0;

        if(type === 'odd' && num % 2 !== 0) { win = true; multi = 2; }
        else if(type === 'even' && num % 2 === 0) { win = true; multi = 2; }
        else if(type === 'lucky7' && num === 7) { win = true; multi = 10; }

        const msgBox = document.getElementById('roulette-result');
        if(win) {
            const prize = bet * multi;
            player.gold += prize;
            msgBox.innerText = `ë‹¹ì²¨! ${num} (${prize}G íšë“)`;
            msgBox.style.color = 'lime';
        } else {
            msgBox.innerText = `ê½! ${num} ë‚˜ì™”ìŠµë‹ˆë‹¤.`;
            msgBox.style.color = 'red';
        }
        updateUI();
    }

    // --- [3] ìŠ¬ë¡¯ë¨¸ì‹  ë¡œì§ ---
    const slots = ['ğŸ’','ğŸ‹','ğŸ‡','ğŸ’','7ï¸âƒ£'];
    window.spinSlots = function() {
        if(!checkGold(50)) return;
        
        const r1 = slots[Math.floor(Math.random()*slots.length)];
        const r2 = slots[Math.floor(Math.random()*slots.length)];
        const r3 = slots[Math.floor(Math.random()*slots.length)];
        
        document.getElementById('reel1').innerText = r1;
        document.getElementById('reel2').innerText = r2;
        document.getElementById('reel3').innerText = r3;
        
        const msgBox = document.getElementById('slot-result');
        let prize = 0;

        // ì­íŒŸ
        if(r1 === '7ï¸âƒ£' && r2 === '7ï¸âƒ£' && r3 === '7ï¸âƒ£') prize = 2500; // 50 * 50
        else if(r1===r2 && r2===r3) prize = 500; // 3ê°œ ì¼ì¹˜
        else if(r1===r2 || r2===r3 || r1===r3) prize = 100; // 2ê°œ ì¼ì¹˜

        if(prize > 0) {
            player.gold += prize;
            msgBox.innerText = `ì¶•í•˜í•©ë‹ˆë‹¤! ${prize}G íšë“!`;
            msgBox.style.color = 'gold';
        } else {
            msgBox.innerText = "ì•„ì‰½ë„¤ìš”.. ë‹¤ìŒ ê¸°íšŒì—";
            msgBox.style.color = '#ccc';
        }
        updateUI();
    }

    // --- [4] ê²½ë§ˆ ë¡œì§ ---
    function initRaceTrack() {
        const track = document.getElementById('race-track');
        track.innerHTML = '';
        for(let i=1; i<=4; i++) {
            track.innerHTML += `
                <div class="horse-lane">
                    <div class="horse" id="horse-${i}">ğŸ<span style="font-size:12px;">${i}</span></div>
                    <div class="finish-line"></div>
                </div>`;
        }
        document.getElementById('race-btns').style.display = 'block';
    }

    window.startRace = function(pick) {
        if(!checkGold(100)) return;
        document.getElementById('race-btns').style.display = 'none'; // ì¤‘ë³µ í´ë¦­ ë°©ì§€
        
        const horses = [
            {id:1, pos:0, speed:0}, {id:2, pos:0, speed:0},
            {id:3, pos:0, speed:0}, {id:4, pos:0, speed:0}
        ];
        
        const timer = setInterval(() => {
            let winner = null;
            
            horses.forEach(h => {
                h.speed = Math.random() * 3; // ë§¤ í‹±ë§ˆë‹¤ ëœë¤ ì†ë„
                h.pos += h.speed;
                const el = document.getElementById(`horse-${h.id}`);
                if(el) el.style.left = h.pos + '%';
                
                if(h.pos >= 90 && !winner) winner = h.id; // 90% ì§€ì  ë„ë‹¬ ì‹œ ìŠ¹ë¦¬ íŒì •
            });

            if(winner) {
                clearInterval(timer);
                const msgBox = document.getElementById('race-result');
                if(winner === pick) {
                    player.gold += 400; // 4ë°°
                    msgBox.innerText = `ìš°ìŠ¹! ${winner}ë²ˆ ë§ì´ 1ë“±ì…ë‹ˆë‹¤! (+400G)`;
                    msgBox.style.color = 'lime';
                } else {
                    msgBox.innerText = `íŒ¨ë°°.. ìš°ìŠ¹ë§ˆëŠ” ${winner}ë²ˆ ì…ë‹ˆë‹¤.`;
                    msgBox.style.color = 'red';
                }
                updateUI();
                setTimeout(() => { document.getElementById('race-btns').style.display = 'block'; }, 2000);
            }
        }, 50);
    }

    // --- [5] ë‹¤ì´ì‚¬ì´ ë¡œì§ ---
    window.playSicBo = function(pick) {
        if(!checkGold(200)) return;
        
        const d1 = Math.floor(Math.random()*6)+1;
        const d2 = Math.floor(Math.random()*6)+1;
        const d3 = Math.floor(Math.random()*6)+1;
        const sum = d1+d2+d3;
        
        document.getElementById('dice1').innerText = getDiceFace(d1);
        document.getElementById('dice2').innerText = getDiceFace(d2);
        document.getElementById('dice3').innerText = getDiceFace(d3);
        document.getElementById('sicbo-sum').innerText = sum;
        
        let result = (sum >= 4 && sum <= 10) ? 'small' : 'big';
        // íŠ¸ë¦¬í”Œ(ëª¨ë‘ ê°™ì€ ìˆ˜)ì¼ ê²½ìš° ì¹´ì§€ë…¸ ìŠ¹ë¦¬ (ì‹ë³´ ë£°)
        if(d1===d2 && d2===d3) result = 'triple'; 

        const msgBox = document.getElementById('sicbo-result');
        if(pick === result) {
            player.gold += 400;
            msgBox.innerText = "ì ì¤‘í–ˆìŠµë‹ˆë‹¤! (+400G)";
            msgBox.style.color = 'lime';
        } else {
            msgBox.innerText = "í‹€ë ¸ìŠµë‹ˆë‹¤..";
            msgBox.style.color = 'red';
        }
        updateUI();
    }
    function getDiceFace(n) { return ['âš€','âš','âš‚','âšƒ','âš„','âš…'][n-1]; }

    // ê³µí†µ: ê³¨ë“œ ì°¨ê° ë° í™•ì¸
    function checkGold(amount) {
        if(player.gold < amount) { alert("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!"); return false; }
        player.gold -= amount;
        updateUI();
        return true;
    }

</script>
</body>
</html>
